<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å››æŸ±æ¨å‘½ï¼ˆå…«å­—ï¼‰Â· ã‚¯ã‚¤ãƒƒã‚¯é‘‘å®š</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
/* ---- same visual style as CN version ---- */
:root{
  --bg:#0b0f14; --bg-accent:#0e1520; --card:#11161dcc; --surface:#0f1624; --line:#1f2a36;
  --text:#e8edf3; --muted:#98a7b7; --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
  --radius:14px; --radius-sm:10px; --radius-lg:18px; --shadow:0 8px 30px rgba(0,0,0,.35); --shadow-sm:0 4px 14px rgba(0,0,0,.28);
  --container:1100px; --gap:12px; --pad:18px; --focus:0 0 0 2px rgba(212,175,55,0.2);
  --bp-s:520px; --bp-m:760px; --bp-l:900px;
}
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0; color:var(--text);
  background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
             linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}
.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}
.site-header{position:sticky; top:0; z-index:10; background:rgba(11,15,20,.8); border-bottom:1px solid #0f1622; backdrop-filter:saturate(140%) blur(12px)}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:var(--shadow-sm); font-weight:800; color:#ffe084}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}
.now{font-size:.9rem; color:var(--muted)}

.section{margin-top:18px}
.card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:var(--pad); margin:16px 0}
.h2{font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084; display:flex; gap:8px; align-items:center}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}
.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width:760px){ .row.cols-3{grid-template-columns:1fr 1fr 1fr} .row.cols-2{grid-template-columns:1fr 1fr} }
input,select{width:100%; border-radius:12px; border:1px solid #243244; background:var(--bg-accent); color:var(--text); padding:12px 12px; font-size:15px; outline:0}
input::placeholder{color:#6f8092}
input:focus,select:focus{box-shadow:var(--focus); border-color:#3a4c63}
.btn{display:inline-grid; place-items:center; padding:12px 16px; border-radius:12px; border:1px solid #e6c76e; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; cursor:pointer; transition:transform .2s ease, box-shadow .2s ease}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}
.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width:520px){ .pillars{grid-template-columns:repeat(2,1fr)} }
.bazi-table{width:100%; border-collapse:collapse; margin-top:12px; background:var(--surface); border-radius:8px; overflow:hidden}
.bazi-table th,.bazi-table td{padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
.bazi-table-wrap{overflow:auto}
@media (max-width:420px){ .bazi-table th,.bazi-table td{padding:8px 10px} }
.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:80px 1fr 60px; gap:10px; align-items:center}
.error-message{background:rgba(255,90,95,.1); border:1px solid #ff5a5f; border-radius:8px; padding:10px; display:none; margin-top:10px}
.muted{color:var(--muted)}
.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}
.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}
.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}
.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px; background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

/* Butler / Pro report */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.05rem}

/* floating chat */
.chat-float{position:fixed; bottom:20px; right:20px; width:350px; height:500px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(10px); z-index:1000; display:none; flex-direction:column}
.chat-float-header{padding:12px 16px; border-bottom:1px solid var(--line); background:rgba(212,175,55,.1); color:var(--gold2); font-weight:700; display:flex; justify-content:space-between; align-items:center; cursor:move}
.chat-float-close{background:none; border:none; color:var(--gold2); font-size:1.2rem; cursor:pointer; padding:4px; border-radius:4px}
.chat-float-close:hover{background:rgba(212,175,55,.2)}
.chat-float-body{flex:1; display:flex; flex-direction:column; padding:0}
.chat-float-messages{flex:1; overflow-y:auto; padding:12px; background:var(--surface); font-size:0.9rem}
.chat-float-input-area{padding:12px; border-top:1px solid var(--line); background:var(--bg-accent)}
.chat-toggle-btn{position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:linear-gradient(180deg,#fff9e6,#e6c76e); border:1px solid #e6c76e; color:#191919; font-size:1.5rem; cursor:pointer; box-shadow:0 4px 12px rgba(230,199,110,.3); z-index:1001; display:flex; align-items:center; justify-content:center}
.chat-toggle-btn:hover{transform:scale(1.05); box-shadow:0 6px 20px rgba(230,199,110,.5)}
@media (max-width:768px){
  .chat-float{width:300px; height:400px; bottom:10px; right:10px}
  .chat-toggle-btn{width:50px; height:50px; bottom:10px; right:10px}
}

/* form focus simplification */
input:focus,select:focus,textarea:focus{outline:none!important; box-shadow:none!important; border-color:#243244!important}
button:focus,.btn:focus,a:focus{outline:none!important; box-shadow:none!important}
*{-webkit-tap-highlight-color:transparent}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}
@media (prefers-reduced-motion: reduce){ *{animation:none !important; transition:none !important} }
  </style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="https://astro.5xliving.com/" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title">5xLiving Â· å››æŸ±æ¨å‘½ã‚¯ã‚¤ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ</span>
    </a>
    <div style="display:flex; align-items:center; gap:10px;">
      <!-- Language selector -->
      <select id="langSelect" style="border-radius:999px; padding:6px 10px; border:1px solid #243244; background:#0e1520; color:#e8edf3; font-size:0.85rem;">
        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="th">à¹„à¸—à¸¢</option>
        <option value="ms">Bahasa Melayu</option>
      </select>

      <span id="nowBox" class="now"></span>
    </div>
  </div>
</header>

  <main class="container">
    <!-- Input card -->
    <section class="card">
      <div class="h2">å››æŸ±æ¨å‘½ Â· ã‚¯ã‚¤ãƒƒã‚¯é‘‘å®š</div>
      <div class="row cols-3">
        <div>
          <label class="muted">ãŠåå‰ï¼ˆä»»æ„ï¼‰</label>
          <input id="name" placeholder="å€‹åˆ¥è¡¨ç¤ºã®ãŸã‚ã®ãŠåå‰" />
        </div>
        <div>
          <label class="muted">æ€§åˆ¥</label>
          <select id="gender">
            <option value="">ç„¡å›ç­”</option>
            <option value="male">ç”·æ€§</option>
            <option value="female">å¥³æ€§</option>
          </select>
        </div>
        <div>
          <label class="muted">æš¦</label>
          <select id="calendar">
            <option value="gregorian">è¥¿æš¦</option>
            <option value="lunar">æ—§æš¦ï¼ˆæœªå¯¾å¿œï¼‰</option>
          </select>
        </div>
      </div>
      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted">ç”Ÿå¹´æœˆæ—¥</label>
          <input type="date" id="birthdate" />
        </div>
        <div>
          <label class="muted">å‡ºç”Ÿæ™‚åˆ»</label>
          <div class="time-row">
            <input type="time" id="birthtime" />
            <label class="muted time-unknown">
              <input type="checkbox" id="timeUnknown" />
              <span>æ™‚åˆ»ä¸æ˜</span>
            </label>
          </div>
        </div>
        <div class="gen-wrap">
          <button class="btn" id="genBtn" type="button">
            <span id="genBtnText">å‘½å¼ã‚’ä½œæˆ</span>
            <span id="genBtnLoading" style="display:none">è¨ˆç®—ä¸­...</span>
          </button>
        </div>
      </div>
      <div id="error" class="error-message"></div>
    </section>

    <!-- Result: pillars & elements -->
    <section id="result" style="display:none;">
      <div class="card">
        <div class="h2">ã‚ãªãŸã®å››æŸ±ï¼ˆå…«å­—ï¼‰ãƒãƒ£ãƒ¼ãƒˆ</div>
        <div class="pillars" id="bazi-pillars"></div>
        <div class="muted" id="bazi-date" style="margin-top:6px"></div>
        <table class="bazi-table">
          <thead>
          <tr>
            <th></th>
            <th>å¹´æŸ±</th>
            <th>æœˆæŸ±</th>
            <th>æ—¥æŸ±</th>
            <th>æ™‚æŸ±</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>å¤©å¹²</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td>åœ°æ”¯</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td>äº”è¡Œ</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td>ç´éŸ³</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="h2">äº”è¡Œãƒãƒ©ãƒ³ã‚¹è§£æ</div>
        <div class="bar-row"><span>æœ¨</span><div class="bar"><i id="bar-wood"></i></div><span id="pct-wood">0%</span></div>
        <div class="bar-row"><span>ç«</span><div class="bar"><i id="bar-fire"></i></div><span id="pct-fire">0%</span></div>
        <div class="bar-row"><span>åœŸ</span><div class="bar"><i id="bar-earth"></i></div><span id="pct-earth">0%</span></div>
        <div class="bar-row"><span>é‡‘</span><div class="bar"><i id="bar-metal"></i></div><span id="pct-metal">0%</span></div>
        <div class="bar-row"><span>æ°´</span><div class="bar"><i id="bar-water"></i></div><span id="pct-water">0%</span></div>
        <div id="bazi-elements-balance" class="muted" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- Pro report -->
    <section id="butlerProfessional" class="butler-professional">
      <div class="butler-header">
        <span>ğŸ§™â€â™‚ï¸ å¿ƒæ€œãƒãƒˆãƒ©ãƒ¼ Â· ãƒ—ãƒ­é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆ</span>
      </div>
      <div class="butler-content" id="professionalReport"></div>
    </section>

    <!-- Floating chat -->
    <button class="chat-toggle-btn" id="chatToggle">è³ªå•</button>
    <div class="chat-float" id="chatFloat">
      <div class="chat-float-header">
        <span>ğŸ§™â€â™‚ï¸ å¿ƒæ€œãƒãƒˆãƒ©ãƒ¼ Â· Q&amp;A</span>
        <button class="chat-float-close" id="chatClose">Ã—</button>
      </div>
      <div class="chat-float-body">
        <div class="chat-float-messages" id="chatMessages">
          <div class="ss-msg">
            ã¯ã˜ã‚ã¾ã—ã¦ã€ã‚ãªãŸã®ã€Œäººç”Ÿã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã€ã§ã™ã€‚ä»Šã®å‘½å¼ã‚’ã‚‚ã¨ã«ç°¡æ˜“ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚
            æ‹æ„›ãƒ»çµå©šãƒ»ä»•äº‹ãƒ»ãŠé‡‘ãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦ã€æ°—ã«ãªã‚‹ã“ã¨ã‚’è‡ªç”±ã«è³ªå•ã—ã¦ãã ã•ã„ã€‚
          </div>
        </div>
        <div class="chat-float-input-area">
          <div style="display:flex;gap:8px;">
            <input type="text" id="chatInput" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„â€¦" style="flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3;">
            <button class="btn" id="chatSend" style="padding:8px 16px;">é€ä¿¡</button>
          </div>
        </div>
      </div>
    </div>

    <!-- VIP segment -->
    <section class="card section">
      <h2 class="group-title">ğŸŒ™ VIP ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title">ğŸ— å‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ Â· ä¼šå“¡é™å®š</div>
          <ul>
            <li>æ‹æ„›ãƒ»çµå©šï¼šã”ç¸ã®å‚¾å‘ãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚¿ã‚¤ãƒ—ãƒ»çµå©šã‚¿ã‚¤ãƒŸãƒ³ã‚°</li>
            <li>ä»•äº‹ãƒ»ã‚­ãƒ£ãƒªã‚¢ï¼šé©è·ãƒ»ç‹¬ç«‹ãƒ»å‰¯æ¥­ã®å¯èƒ½æ€§</li>
            <li>é‡‘é‹ï¼šè²¡ã®å…¥ã‚Šæ–¹ãƒ»è²¯è“„ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»é‹æ°—ã®æ³¢</li>
            <li>ãƒšãƒƒãƒˆã®å‘½å¼ï¼šæ€§æ ¼ãƒ»æ°—è³ªãƒ»ã‚ãªãŸã¨ã®ç›¸æ€§</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title">ğŸŒ™ å¿ƒæ€œã‚¹ãƒšãƒ¼ã‚¹ Â· ä¼šå“¡é™å®š</div>
          <ul>
            <li>ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¨˜éŒ²ï¼šå†™çœŸãƒ»å¤¢ãƒ»ãƒœã‚¤ã‚¹ãƒ¡ãƒ¢ãƒ»ç¥ˆã‚Šã®è¨€è‘‰ã‚’ä¿å­˜</li>
            <li>è¬›åº§ï¼šå››æŸ±æ¨å‘½ / ã‚¿ãƒ­ãƒƒãƒˆ / è¥¿æ´‹å æ˜Ÿè¡“ / æ•°ç§˜è¡“ ãªã©</li>
            <li>å®¶æ—ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ï¼šã”å…ˆç¥–ãƒ»æ•…äººã®è¨˜æ†¶ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</li>
            <li>æ¯é€±ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¯ãƒ¼ã‚¯ &amp; ç¥æ§˜ã‚¹ã‚¿ã‚¤ãƒ«ã®å®Ÿè·µã‚¿ã‚¹ã‚¯</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px">ğŸ’ VIP ãƒ­ã‚°ã‚¤ãƒ³</div>
      <section class="astro-auth">
        <div class="auth-grid">
          <div class="panel">
            <div class="head">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</div>
            <div class="body">
              <div class="row one">
                <button class="btn ghost block" id="toggleAuthFields" type="button">
                  ãƒ¡ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚¤ãƒ³ / ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                </button>
              </div>
              <div class="spacer"></div>
              <div class="row" id="authFields" style="display:none;">
                <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
                <input id="password" name="password" type="password" autocomplete="current-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šãƒ»å¤§å°è‹±å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ï¼‰">
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</button>
                <div class="muted">ç™»éŒ²ã™ã‚‹ã¨ã€å‘½ç†ã‚µãƒ¼ãƒ“ã‚¹ã®ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚’ 1 å›å—ã‘å–ã‚Œã¾ã™ã€‚</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <div class="panel">
            <div class="head">ä¼šå“¡ã‚µãƒ¼ãƒ“ã‚¹</div>
            <div class="body">
              <div class="row one">
                <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer">
                  ğŸ’ æœˆé¡ VIP ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
                </a>
              </div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer">
                  â† Astro ã‚·ãƒ§ãƒƒãƒ—ã«æˆ»ã‚‹
                </a>
              </div>
              <div class="muted">æœˆé¡ 9.9 ãƒ‰ãƒ« Â· å‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ + å¿ƒæ€œã‚¹ãƒšãƒ¼ã‚¹ + ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¬›åº§</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
  </main>

  <script>
  // If you hook to your worker, set it here (optional)
  window.API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';

  (function(){
    'use strict';
    const SG_TZ = 'Asia/Singapore';
    const $ = id => document.getElementById(id);
    const state = window.state = window.state || {};
    state.lang = 'ja';

    // current page language
    const CURRENT_LANG = 'ja'; // this page is the Japanese version

    // map language code -> page URL (relative paths)
const LANG_PAGES = {
  'en': '/assets/bazi-language-pack/bazi-en.html', // adjust if EN is in a different folder
  'zh-CN': '/assets/bazi-language-pack/bazi-zh-CN.html',
  'zh-TW': '/assets/bazi-language-pack/bazi-zh-TW.html',
  'ja': '/assets/bazi-language-pack/bazi-ja.html',
  'th': '/assets/bazi-language-pack/bazi-th.html',
  'ms': '/assets/bazi-language-pack/bazi-ms.html'
};  

    /* ===== time in header (SG) ===== */
    function updateNowBox(){
      try{
        const now = new Date();
        const fmt = new Intl.DateTimeFormat('ja-SG',{
          timeZone:SG_TZ,
          year:'numeric',month:'short',day:'2-digit',
          hour:'2-digit',minute:'2-digit'
        });
        const box = $('nowBox');
        if(box) box.textContent = fmt.format(now) + ' Â· SGT';
      }catch(e){}
    }
    updateNowBox();
    setInterval(updateNowBox, 60000);

    /* ===== Bazi calculator (same logic as CN) ===== */
    class BaziCalculator {
      constructor(){
        this.HEAVENLY_STEMS=['Jia','Yi','Bing','Ding','Wu','Ji','Geng','Xin','Ren','Gui']; // for display we keep EN pinyin
        this.STEMS_CN=['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸']; // internal CN for mapping
        this.EARTHLY_BRANCHES=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
        this.NAYIN=[
          'Ocean Metal','ç‚‰ä¸­ç«','æ¾æŸæœ¨','è·¯å‚åœŸ',
          'å‰‘é”‹é‡‘','å±±é ­ç«','æ¶§ä¸‹æ°´','åŸé ­åœŸ',
          'ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ',
          'éœ¹é›³ç«','æ¾æŸæœ¨','é•·æµæ°´','ç ‚ä¸­é‡‘',
          'å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘',
          'ç¯ç«','å¤©æ²³æ°´','åŸéšåœŸ','çŸ³æ¦´æœ¨',
          'å¤§é©¿åœŸ','æ²™ä¸­åœŸ','å¤©ä¸Šç«','è¦†ç¯ç«',
          'å¤§æ—æœ¨','å¤§æµ·æ°´'
        ];
      }
      stemCn(index){ return this.STEMS_CN[(index+10)%10]; }
      yearPillar(year){
        const s=(year-4)%10, b=(year-4)%12;
        return {stemCn:this.stemCn(s), stem:this.HEAVENLY_STEMS[(s+10)%10], branch:this.EARTHLY_BRANCHES[(b+12)%12]};
      }
      solarMonthIndex(y,m,d){
        const mmdd=m*100+d;
        const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]];
        let idx=11; for(const [thr,val] of gates){ if(mmdd>=thr) idx=val; }
        const branchBy={1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'};
        return {index:idx, branch:branchBy[idx]};
      }
      monthPillar(year,month,day){
        const {index,branch}=this.solarMonthIndex(year,month,day);
        const yStemCn = this.yearPillar(year).stemCn;
        const yStemIdx=(yStemCn && this.STEMS_CN.indexOf(yStemCn)) || 0;
        const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0};
        const stemIdx=(startMap[yStemIdx]+(index-1))%10;
        return {stemCn:this.stemCn(stemIdx), stem:this.HEAVENLY_STEMS[stemIdx], branch};
      }
      dayPillar(year,month,day){
        const baseUTC=Date.UTC(1900,0,31), targetUTC=Date.UTC(year,month-1,day);
        const dayDiff=Math.floor((targetUTC-baseUTC)/86400000);
        const stemIdx=(0+dayDiff)%10, branchIdx=(4+dayDiff)%12;
        return {stemCn:this.stemCn(stemIdx), stem:this.HEAVENLY_STEMS[(stemIdx+10)%10],branch:this.EARTHLY_BRANCHES[(branchIdx+12)%12]};
      }
      hourPillar(dayStemCn,hour){
        const branchMap={23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'};
        const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8};
        const dayIdx=this.STEMS_CN.indexOf(dayStemCn);
        const hourIndex=Math.floor((hour+1)/2)%12;
        const stemIdx=(startMap[dayIdx]+hourIndex)%10;
        return {stemCn:this.stemCn(stemIdx), stem:this.HEAVENLY_STEMS[stemIdx], branch:branchMap[hour]};
      }
      stemElem(cn){
        return ({'ç”²':'Wood','ä¹™':'Wood','ä¸™':'Fire','ä¸':'Fire','æˆŠ':'Earth','å·±':'Earth',
                 'åºš':'Metal','è¾›':'Metal','å£¬':'Water','ç™¸':'Water'})[cn]||'-';
      }
      branchElem(b){
        return ({'å­':'Water','ä¸‘':'Earth','å¯…':'Wood','å¯':'Wood','è¾°':'Earth','å·³':'Fire',
                 'åˆ':'Fire','æœª':'Earth','ç”³':'Metal','é…‰':'Metal','æˆŒ':'Earth','äº¥':'Water'})[b]||'-';
      }

      // Stem name in English + element, e.g. "Yi (Wood)"
      stemNameEn(stemCn){
        const idx = this.STEMS_CN.indexOf(stemCn);
        if (idx === -1) return stemCn;
        const base = this.HEAVENLY_STEMS[idx];    // Jia, Yi, Bing...
        const elem = this.stemElem(stemCn);       // Wood, Fire, Earth...
        return `${base} (${elem})`;
      }

      // Branch name in English + animal, e.g. "Si (Snake)"
      branchNameEn(b){
        const map = {
          'å­':'Zi (Rat)',
          'ä¸‘':'Chou (Ox)',
          'å¯…':'Yin (Tiger)',
          'å¯':'Mao (Rabbit)',
          'è¾°':'Chen (Dragon)',
          'å·³':'Si (Snake)',
          'åˆ':'Wu (Horse)',
          'æœª':'Wei (Goat)',
          'ç”³':'Shen (Monkey)',
          'é…‰':'You (Rooster)',
          'æˆŒ':'Xu (Dog)',
          'äº¥':'Hai (Pig)'
        };
        return map[b] || b;
      }

      nayin(stemCn,branch){
        const si=this.STEMS_CN.indexOf(stemCn), bi=this.EARTHLY_BRANCHES.indexOf(branch);
        return this.NAYIN[(si*2+bi)%this.NAYIN.length];
      }
    }

    /* ===== Simple analysis helpers (Japanese) ===== */
    const DayMasterText = {
      'ç”²':'ç”²æœ¨ã‚¿ã‚¤ãƒ—ï¼šå¤§æœ¨ã®ã‚ˆã†ã«ã¾ã£ã™ãã§é–‹æ‹“çš„ã€‚æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ãåŠ›ãŒå¼·ãã€è¡Œå‹•çš„ã§ã™ã€‚',
      'ä¹™':'ä¹™æœ¨ã‚¿ã‚¤ãƒ—ï¼šè‰èŠ±ã®ã‚ˆã†ã«ã—ãªã‚„ã‹ã§å„ªã—ã„ã€‚äººã‚’æ”¯ãˆã€èª¿å’Œã‚’å¤§åˆ‡ã«ã—ã¾ã™ã€‚',
      'ä¸™':'ä¸™ç«ã‚¿ã‚¤ãƒ—ï¼šå¤ªé™½ã®ã‚ˆã†ã«æ˜ã‚‹ãæƒ…ç†±çš„ã€‚è¡¨ç¾åŠ›ãŒã‚ã‚Šã€äººã®å‰ã«å‡ºã‚‹ã»ã©åŠ›ãŒå‡ºã¾ã™ã€‚',
      'ä¸':'ä¸ç«ã‚¿ã‚¤ãƒ—ï¼šã‚ã†ããã®ç¯ã®ã‚ˆã†ã«ç©ã‚„ã‹ã§æ¸©ã‹ã„ã€‚èº«è¿‘ãªäººã‚’å®ˆã‚‹åŠ›ãŒå¼·ã„ã§ã™ã€‚',
      'æˆŠ':'æˆŠåœŸã‚¿ã‚¤ãƒ—ï¼šå±±ã®ã‚ˆã†ã«ã©ã£ã—ã‚Šå®‰å®šã€‚é•·æœŸçš„ãªæˆæœã‚„åŸºç›¤ä½œã‚ŠãŒå¾—æ„ã§ã™ã€‚',
      'å·±':'å·±åœŸã‚¿ã‚¤ãƒ—ï¼šç•‘ã®åœŸã®ã‚ˆã†ã«æŸ”ã‚‰ã‹ãé¢å€’è¦‹ãŒè‰¯ã„ã€‚ç´°ã‹ã„é…æ…®ã‚„ã‚µãƒãƒ¼ãƒˆãŒã§ãã¾ã™ã€‚',
      'åºš':'åºšé‡‘ã‚¿ã‚¤ãƒ—ï¼šåˆ€ã®é‡‘å±ã®ã‚ˆã†ã«é‹­ãæ±ºæ–­åŠ›ãŒã‚ã‚‹ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã¨è¡Œå‹•åŠ›ãŒç‰¹å¾´ã§ã™ã€‚',
      'è¾›':'è¾›é‡‘ã‚¿ã‚¤ãƒ—ï¼šå®çŸ³ã®ã‚ˆã†ã«ç¹Šç´°ã§ç¾æ„è­˜ãŒé«˜ã„ã€‚å“è³ªã‚„ç´°éƒ¨ã«ã“ã ã‚ã‚Šã¾ã™ã€‚',
      'å£¬':'å£¬æ°´ã‚¿ã‚¤ãƒ—ï¼šå¤§æ²³ã®æ°´ã®ã‚ˆã†ã«è‡ªç”±ã§æŸ”è»Ÿã€‚å‹•ãã¨å¤‰åŒ–ã®ä¸­ã§åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚',
      'ç™¸':'ç™¸æ°´ã‚¿ã‚¤ãƒ—ï¼šé›¨ã®ã‚ˆã†ã«é™ã‹ã§æ„Ÿå—æ€§ãŒé«˜ã„ã€‚å†…é¢ã®ä¸–ç•ŒãŒæ·±ãã€ç›´æ„Ÿã‚‚é‹­ã„ã§ã™ã€‚'
    };
    const RelationText = {
      'ç”²':{
        traits:'æ‹æ„›ã§ã¯ç©æ¥µçš„ãƒ»ãƒªãƒ¼ãƒ‰ã™ã‚‹å´ã«ãªã‚Šã‚„ã™ã„ä¸€æ–¹ã€ç›¸æ‰‹ã«ã‚‚è‡ªç”±ãªã‚¹ãƒšãƒ¼ã‚¹ãŒå¿…è¦ã§ã™ã€‚',
        tips:'æ±ºã‚ã‚‹å‰ã«ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚Šã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚’ã‚ˆãèãæ™‚é–“ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚'
      },
      'ä¹™':{
        traits:'ã¨ã¦ã‚‚å„ªã—ãç›¸æ‰‹ã‚’æ”¯ãˆã‚‹ã‚¿ã‚¤ãƒ—ã§ã€è‡ªåˆ†ã‚ˆã‚Šç›¸æ‰‹ã‚’å„ªå…ˆã—ãŒã¡ã§ã™ã€‚',
        tips:'å¢ƒç•Œç·šã‚’å®ˆã‚Šã¤ã¤ã€è‡ªåˆ†ã®å¸Œæœ›ã‚„æœ¬éŸ³ã‚‚ç´ ç›´ã«ä¼ãˆã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚'
      },
      'ä¸™':{
        traits:'æƒ…ç†±çš„ã§ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªæ‹æ„›ã‚’å¥½ã¿ã¾ã™ãŒã€æ„Ÿæƒ…ãŒå¼·ãå‡ºã‚„ã™ã„é¢ã‚‚ã‚ã‚Šã¾ã™ã€‚',
        tips:'æ„Ÿæƒ…ãŒé«˜ã¶ã£ãŸã¨ãã¯ã€è¨€è‘‰ã«ã™ã‚‹å‰ã«ä¸€åº¦ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚'
      },
      'ä¸':{
        traits:'é™ã‹ãªæ„›æƒ…è¡¨ç¾ã§ã™ãŒã€ä¸€åº¦å¿ƒã«æ±ºã‚ã‚‹ã¨é•·ãæ·±ãç›¸æ‰‹ã‚’æƒ³ã„ç¶šã‘ã¾ã™ã€‚',
        tips:'é ­ã®ä¸­ã ã‘ã§ãªãã€è¨€è‘‰ã‚„è¡Œå‹•ã§ã€Œã‚ã‹ã‚Šã‚„ã™ãã€å„ªã—ã•ã‚’è¦‹ã›ã‚‹ã“ã¨ã‚’æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚'
      },
      'æˆŠ':{
        traits:'è²¬ä»»æ„ŸãŒå¼·ãã€å°†æ¥ã‚„å®‰å®šã‚’çœŸå‰£ã«è€ƒãˆã‚‹æ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚',
        tips:'è¨ˆç”»ã‚„ç¾å®Ÿã ã‘ã§ãªãã€ã€Œä»Šã“ã®ç¬é–“ã‚’æ¥½ã—ã‚€æ™‚é–“ã€ã‚‚æ„è­˜ã—ã¦ä½œã‚‹ã¨é–¢ä¿‚ãŒæ¸©ã‹ããªã‚Šã¾ã™ã€‚'
      },
      'å·±':{
        traits:'ç›¸æ‰‹ã®ã“ã¨ã‚’ã‚ˆãæ°—ã«ã‹ã‘ã€ã¤ã„å¿ƒé…ã—ã™ãã¦ã—ã¾ã†ã¨ã“ã‚ãŒã‚ã‚Šã¾ã™ã€‚',
        tips:'ã™ã¹ã¦ã‚’ä¸€äººã§æŠ±ãˆè¾¼ã¾ãšã€ã€Œä¸€ç·’ã«è€ƒãˆã‚ˆã†ã€ã¨ç›¸æ‰‹ã‚’ä¿¡é ¼ã™ã‚‹ã“ã¨ã‚‚å¤§åˆ‡ã§ã™ã€‚'
      },
      'åºš':{
        traits:'ã¯ã£ãã‚Šãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãªç‰©è¨€ã„ã§ã€é§†ã‘å¼•ãã‚„æ›–æ˜§ã•ã‚’å«Œã„ã¾ã™ã€‚',
        tips:'æ­£ç›´ã•ã¯å¼·ã¿ã§ã™ãŒã€ä¼ãˆæ–¹ã‚’å°‘ã—æŸ”ã‚‰ã‹ãã™ã‚‹ã“ã¨ã§é–¢ä¿‚ãŒãã£ã¨ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚'
      },
      'è¾›':{
        traits:'å°ã•ãªå¤‰åŒ–ã«ã‚‚æ•æ„Ÿã§ã€æ‹æ„›ã«ãŠã„ã¦ã‚‚ç†æƒ³ã‚„åŸºæº–ãŒé«˜ã‚ã§ã™ã€‚',
        tips:'å®Œç’§ã‚’æ±‚ã‚ã™ããšã€ã€ŒãŠäº’ã„ã«æˆé•·ã—ã¦ã„ãé–¢ä¿‚ã€ã¨ã—ã¦è¦‹ã¦ã„ãã¨å¿ƒãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚'
      },
      'å£¬':{
        traits:'é–¢ä¿‚ã®ä¸­ã«ã‚‚è‡ªç”±ã•ãƒ»æ–°é®®ã•ã‚’æ±‚ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
        tips:'äºŒäººã§æ–°ã—ã„ä½“é¨“ã‚„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã§ã€å¤–ã«åˆºæ¿€ã‚’æ±‚ã‚ã™ããšã«æ¸ˆã¿ã¾ã™ã€‚'
      },
      'ç™¸':{
        traits:'ç©ºæ°—ã‚„é›°å›²æ°—ã«ã¨ã¦ã‚‚æ•æ„Ÿã§ã€ç›¸æ‰‹ã®ã¡ã‚‡ã£ã¨ã—ãŸè¡¨æƒ…ã®å¤‰åŒ–ã‚‚æ„Ÿã˜å–ã‚Šã¾ã™ã€‚',
        tips:'æ„Ÿæƒ…ãŒæºã‚ŒãŸã¨ãã“ãã€ã¾ãšã¯è‡ªåˆ†ã®å¿ƒã‚’è½ã¡ç€ã‹ã›ã¦ã‹ã‚‰å¯¾è©±ã®å ´ã‚’ã¤ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚'
      }
    };

    function strongestWeakest(counts){
      const order=['Wood','Fire','Earth','Metal','Water'];
      let max = -1, min = 1e9, maxKey='Wood', minKey='Wood';
      order.forEach(k=>{
        const v = counts[k]||0;
        if(v>max){ max=v; maxKey=k; }
        if(v<min){ min=v; minKey=k; }
      });
      return {strongest:maxKey, weakest:minKey};
    }

    function jpElemName(e){
      return {
        Wood:'æœ¨',
        Fire:'ç«',
        Earth:'åœŸ',
        Metal:'é‡‘',
        Water:'æ°´'
      }[e] || e;
    }

    /* ===== Pro report builder (local, Japanese) ===== */
    function buildProReport(ctx){
      const box = $('professionalReport');
      if(!box || !ctx) return;
      const dmStemCn = ctx.day.stemCn;
      const rel = RelationText[dmStemCn] || {
        traits:'æ‹æ„›ã«ãŠã„ã¦ã¯ã€èª å®Ÿã•ã¨æ”¯ãˆåˆã„ã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
        tips:'æœ¬éŸ³ã‚’æˆ‘æ…¢ã—ã™ããšã€ç´ ç›´ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¿ƒãŒã‘ã‚‹ã¨é–¢ä¿‚ãŒå®‰å®šã—ã‚„ã™ããªã‚Šã¾ã™ã€‚'
      };
      const dmLine = DayMasterText[dmStemCn] || 'ã‚ãªãŸã®æ—¥ä¸»ã¯ãƒãƒ©ãƒ³ã‚¹å‹ã§ã€çŠ¶æ³ã«åˆã‚ã›ã¦æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚';
      const {strongest, weakest} = strongestWeakest(ctx.elements);

      const strongestJp = jpElemName(strongest);
      const weakestJp = jpElemName(weakest);
      const dayElemJp = jpElemName(ctx.day.element); // æœ¨ãƒ»ç«ãƒ»åœŸãƒ»é‡‘ãƒ»æ°´

      const parts = [];

      parts.push(`
        <div class="butler-section">
          <h4>1. å…¨ä½“åƒ Â· æ—¥ä¸»ã‚¿ã‚¤ãƒ—</h4>
          <p><strong>æ—¥ä¸»ï¼š</strong> ${dmStemCn}${dayElemJp}ã‚¿ã‚¤ãƒ—</p>
          <p>${dmLine}</p>
        </div>
      `);

      parts.push(`
        <div class="butler-section">
          <h4>2. äº”è¡Œãƒãƒ©ãƒ³ã‚¹</h4>
          <p>
            æœ¨ï¼š${ctx.elements.Wood}% Â· ç«ï¼š${ctx.elements.Fire}% Â·
            åœŸï¼š${ctx.elements.Earth}% Â· é‡‘ï¼š${ctx.elements.Metal}% Â· æ°´ï¼š${ctx.elements.Water}%ã€‚
          </p>
              <p>
                <strong>ä¸€ç•ªå¼·ã„äº”è¡Œï¼š</strong>${strongestJp}<br/>
                <strong>ä¸€ç•ªå¼±ã„äº”è¡Œï¼š</strong>${weakestJp}
              </p>
          <p>
            å®Ÿè·µé¢ã§ã¯ã€ã€Œå¼·ã„äº”è¡Œã€ã¯è‡ªåˆ†ã®å¾—æ„åˆ†é‡ã¨ã—ã¦å¤§åˆ‡ãªå ´é¢ã§æ´»ã‹ã—ã€
            ã€Œå¼±ã„äº”è¡Œã€ã¯ç’°å¢ƒãƒ»ç¿’æ…£ãƒ»äººé–“é–¢ä¿‚ã‚’é€šã—ã¦å°‘ã—ãšã¤è‚²ã¦ã¦ã„ãã¨ãƒãƒ©ãƒ³ã‚¹ãŒæ•´ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚
          </p>
        </div>
      `);

      parts.push(`
        <div class="butler-section">
          <h4>3. æ‹æ„› &amp; çµå©šã®å‚¾å‘</h4>
          <p><strong>æ‹æ„›ã®ç‰¹å¾´ï¼š</strong>${rel.traits}</p>
          <p><strong>ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š</strong>${rel.tips}</p>
          <p>
            å¼·ã„ã‚¹ãƒˆãƒ¬ã‚¹ã‚„ãŠé‡‘ã®ä¸å®‰ãŒå¤§ãã„æ™‚æœŸã¯ã€å¤§ããªæ‹æ„›ã®æ±ºæ–­ã‚’é¿ã‘ã€
            ã¾ãšå¿ƒã¨ç”Ÿæ´»ã®å®‰å®šã‚’å„ªå…ˆã™ã‚‹ã¨è‰¯ã„æµã‚Œã‚’ã¤ãã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚
          </p>
        </div>
      `);

      parts.push(`
        <div class="butler-section">
          <h4>4. ä»•äº‹ãƒ»ã‚­ãƒ£ãƒªã‚¢ã®æ–¹å‘æ€§</h4>
          <p>
            <strong>ã‚­ãƒ£ãƒªã‚¢ã®ãƒã‚¤ãƒ³ãƒˆï¼š</strong>ã“ã®å‘½å¼ã¯ã€Œã‚³ãƒ„ã‚³ãƒ„ç©ã¿ä¸Šã’å‹ã€ã®æˆé•·ã¨ç›¸æ€§ãŒè‰¯ãã€
            ä¸€æ°—ã«å¤§ããè·³ã­ã‚‹ã‚ˆã‚Šã‚‚ã€å°‚é–€æ€§ã‚„ä¿¡é ¼ã‚’å°‘ã—ãšã¤è‚²ã¦ã‚‹ã»ã©æˆæœãŒå‡ºã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚
          </p>
          <p>
            æœ¨ãƒ»ç«ãŒå¼·ã„å ´åˆã¯ã€äººã¨é–¢ã‚ã‚‹ä»•äº‹ã‚„å‹•ãã®ã‚ã‚‹ç¾å ´å‘ãã€‚
            é‡‘ãƒ»æ°´ãŒå¼·ã„å ´åˆã¯ã€åˆ†æãƒ»æŠ€è¡“ãƒ»ãƒªã‚µãƒ¼ãƒç³»ã®ä»•äº‹ã¨ã®ç›¸æ€§ãŒè‰¯ããªã‚Šã¾ã™ã€‚
          </p>
        </div>
      `);

      parts.push(`
        <div class="butler-section">
          <h4>5. é‡‘é‹ &amp; å®Ÿå‹™çš„ãªãƒ’ãƒ³ãƒˆ</h4>
          <p>
            ã“ã®ç°¡æ˜“é‘‘å®šã§ã¯ã€ç‰¹ã«<strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã®ç®¡ç†</strong>ã«æ³¨ç›®ã—ã¾ã™ã€‚
            ã€Œæ¯æœˆã®äºˆç®—ã€ã€Œå°ã•ãªç·Šæ€¥è³‡é‡‘ã€ã€Œãƒªã‚¹ã‚¯ã‚’å–ã£ã¦ã‚ˆã„ãŠé‡‘ï¼ˆæŠ•æ©Ÿãƒ»ãƒãƒ£ãƒ¬ãƒ³ã‚¸è³‡é‡‘ï¼‰ã€ã‚’
            ã–ã£ãã‚Šåˆ†ã‘ã¦æ„è­˜ã™ã‚‹ã ã‘ã§ã‚‚ã€é‡‘é‹ã®æ³¢ã«æŒ¯ã‚Šå›ã•ã‚Œã«ãããªã‚Šã¾ã™ã€‚
          </p>
          <p>
            ã¾ãšã¯æœ¬æ¥­ãƒ»ã‚¹ã‚­ãƒ«ãƒ»å®‰å®šåå…¥ã‚’å›ºã‚ã€ãã®ä¸Šã§è‡ªåˆ†ã®æ€§è³ªã«åˆã£ãŸå‰¯åå…¥ã‚„å‰¯æ¥­ã‚’
            å°‘ã—ãšã¤å¢—ã‚„ã—ã¦ã„ãæµã‚ŒãŒãŠã™ã™ã‚ã§ã™ã€‚
          </p>
        </div>
      `);

      parts.push(`
        <div class="butler-section">
          <h4>6. ç›´è¿‘ 30 æ—¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯</h4>
          <ul>
            <li>ã“ã® 30 æ—¥ã§é”æˆã—ãŸã„ç¾å®Ÿçš„ãªç›®æ¨™ã‚’ 1 ã¤æ±ºã‚ã¦ã€ç´™ã‚„ãƒ¡ãƒ¢ã«æ›¸ãå‡ºã™ã€‚</li>
            <li>é€±ã« 1 å›ã€ã€ŒæŒ¯ã‚Šè¿”ã‚Šã‚¿ã‚¤ãƒ ã€ï¼ˆæ—¥è¨˜ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»è¨ˆç”»ã‚¿ã‚¤ãƒ ï¼‰ã‚’å›ºå®šã§å…¥ã‚Œã‚‹ã€‚</li>
            <li>ä¸€ç•ªå¼·ã„äº”è¡Œã‚’æ„è­˜ã—ã€ãã‚Œã«åˆã†ç’°å¢ƒï¼ˆè‰²ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ãƒ»è¡Œå‹•ãƒ»äººé–“é–¢ä¿‚ï¼‰ã‚’ç”Ÿæ´»ã«å–ã‚Šå…¥ã‚Œã‚‹ã€‚</li>
            <li>ä¸€ç•ªå¼±ã„äº”è¡Œã¯ã€å°ã•ãªç¿’æ…£ï¼ˆãŸã¨ãˆã°é‹å‹•ãƒ»å‹‰å¼·ãƒ»äººã¨ã®äº¤æµãªã©ï¼‰ã§å°‘ã—ãšã¤è‚²ã¦ã¦ã„ãã€‚</li>
          </ul>
        </div>
      `);

      box.innerHTML = parts.join('\n');
      const sec = $('butlerProfessional');
      if(sec) sec.style.display = 'block';
    }

    /* ===== Generate Bazi flow ===== */
    const calc = new BaziCalculator();

    function showError(msg){
      const e = $('error');
      if(!e) return;
      e.textContent = msg;
      e.style.display = 'block';
    }
    function clearError(){
      const e = $('error');
      if(e){ e.textContent=''; e.style.display='none'; }
    }

function onGenerate(){
  clearError();
  const btn = $('genBtn');
  const textSpan = $('genBtnText');
  const loadSpan = $('genBtnLoading');
  const birthdate = $('birthdate').value;
  const timeStr = $('birthtime').value;
  const timeUnknown = $('timeUnknown').checked;

  if(!birthdate){
    showError('ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
    return;
  }
  const m = birthdate.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if(!m){
    showError('æ—¥ä»˜ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ï¼ˆYYYY-MM-DDï¼‰');
    return;
  }
  const year = parseInt(m[1],10), month=parseInt(m[2],10), day=parseInt(m[3],10);

  let hour = null, minute = null;
  if(!timeUnknown && timeStr){
    const tm = timeStr.match(/^(\d{2}):(\d{2})$/);
    if(tm){
      hour = parseInt(tm[1],10);
      minute = parseInt(tm[2],10);
    }
  }

  if(btn){ btn.disabled=true; }
  if(textSpan) textSpan.style.display='none';
  if(loadSpan) loadSpan.style.display='inline';

  try{
    const yearP = calc.yearPillar(year);
    const monthP = calc.monthPillar(year,month,day);
    const dayP = calc.dayPillar(year,month,day);
    const hasHour = hour!==null && !isNaN(hour);
    const hourP = hasHour ? calc.hourPillar(dayP.stemCn,hour) : null;

    // â˜… äº”è¡Œï¼ˆæœ¨ç«åœŸé‡‘æ°´ï¼‰ã‚’å…ˆã«è¨ˆç®—
    const yearElem  = calc.stemElem(yearP.stemCn);
    const monthElem = calc.stemElem(monthP.stemCn);
    const dayElem   = calc.stemElem(dayP.stemCn);
    const hourElem  = hourP ? calc.stemElem(hourP.stemCn) : 'â€”';

    // ä¸Šã®ã‚«ãƒ¼ãƒ‰ï¼ˆ4 æœ¬æŸ±ï¼‰
    const pillarsBox = $('bazi-pillars');
    if(pillarsBox){
      pillarsBox.innerHTML = '';
      const arr = [
        {label:'å¹´æŸ±', p:yearP},
        {label:'æœˆæŸ±', p:monthP},
        {label:'æ—¥æŸ±', p:dayP},
        {label:'æ™‚æŸ±', p:hourP}
      ];
      arr.forEach(item=>{
        const div = document.createElement('div');
        div.className='pillar';
        if (item.p) {
          const stemElemJp   = jpElemName(calc.stemElem(item.p.stemCn));   // æœ¨ãƒ»ç«ãƒ»åœŸãƒ»é‡‘ãƒ»æ°´
          const branchElemJp = jpElemName(calc.branchElem(item.p.branch)); // æœ¨ãƒ»ç«ãƒ»åœŸãƒ»é‡‘ãƒ»æ°´
          div.innerHTML = `
            <div class="tit">${item.label}</div>
            <div class="gz">${item.p.stemCn}${item.p.branch}</div>
            <div class="muted">å¹²ï¼š${stemElemJp} ï¼ æ”¯ï¼š${branchElemJp}</div>
          `;
        } else {
          div.innerHTML = `
            <div class="tit">${item.label}</div>
            <div class="gz">â€”</div>
            <div class="muted">N/A</div>
          `;
        }
        pillarsBox.appendChild(div);
      });
    }

    // ä¸‹ã®è¡¨
    function setText(id,val){ const el=$(id); if(el) el.textContent = val==null?'-':val; }

    // å¤©å¹²ï¼šæ¼¢å­— + äº”è¡Œ
    setText('year-stem',  `${yearP.stemCn}ï¼ˆ${jpElemName(yearElem)}ï¼‰`);
    setText('month-stem', `${monthP.stemCn}ï¼ˆ${jpElemName(monthElem)}ï¼‰`);
    setText('day-stem',   `${dayP.stemCn}ï¼ˆ${jpElemName(dayElem)}ï¼‰`);
    setText('hour-stem',  hourP ? `${hourP.stemCn}ï¼ˆ${jpElemName(hourElem)}ï¼‰` : 'â€”');

    // åœ°æ”¯ï¼šæ¼¢å­—ã®ã¿
    setText('year-branch',  yearP.branch);
    setText('month-branch', monthP.branch);
    setText('day-branch',   dayP.branch);
    setText('hour-branch',  hourP ? hourP.branch : 'â€”');

    // äº”è¡Œè¡Œï¼šæœ¨ç«åœŸé‡‘æ°´ï¼ˆæ—¥æœ¬èªï¼‰
    setText('year-element',  jpElemName(yearElem));
    setText('month-element', jpElemName(monthElem));
    setText('day-element',   jpElemName(dayElem));
    setText('hour-element',  hourElem === 'â€”' ? 'â€”' : jpElemName(hourElem));

    // ç´éŸ³
    const yearNa  = calc.nayin(yearP.stemCn,yearP.branch);
    const monthNa = calc.nayin(monthP.stemCn,monthP.branch);
    const dayNa   = calc.nayin(dayP.stemCn,dayP.branch);
    const hourNa  = hourP?calc.nayin(hourP.stemCn,hourP.branch):'â€”';
    setText('year-nayin',yearNa);
    setText('month-nayin',monthNa);
    setText('day-nayin',dayNa);
    setText('hour-nayin',hourNa);

    const dateBox = $('bazi-date');
    if(dateBox){
      let timePart = timeUnknown ? 'æ™‚åˆ»ä¸æ˜'
        : (hour!=null ? `${String(hour).padStart(2,'0')}:${String(minute||0).padStart(2,'0')}` : 'æ™‚åˆ»ä¸æ˜');
      dateBox.textContent = `å‡ºç”Ÿï¼š${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')} Â· ${timePart}`;
    }

    // äº”è¡Œã‚«ã‚¦ãƒ³ãƒˆï¼ˆå¹²ï¼‹æ”¯ï¼‰
    const counts = {Wood:0,Fire:0,Earth:0,Metal:0,Water:0};
    function addElem(e){ if(e && counts.hasOwnProperty(e)) counts[e]++; }
    const all = [yearP,monthP,dayP].concat(hourP? [hourP] : []);
    all.forEach(p=>{
      const se = calc.stemElem(p.stemCn);
      const be = calc.branchElem(p.branch);
      addElem(se); addElem(be);
    });
    const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;
    const pct = {};
    Object.keys(counts).forEach(k=>{
      pct[k] = Math.round(counts[k]/total*100);
    });

    function setBar(name,val){
      const bar = $('bar-'+name.toLowerCase());
      const txt = $('pct-'+name.toLowerCase());
      if(bar) bar.style.width = val + '%';
      if(txt) txt.textContent = val + '%';
    }
    setBar('wood',pct.Wood);
    setBar('fire',pct.Fire);
    setBar('earth',pct.Earth);
    setBar('metal',pct.Metal);
    setBar('water',pct.Water);

    const bw = $('bazi-elements-balance');
    const {strongest,weakest} = strongestWeakest(pct);
    if(bw){
      bw.textContent = `ã“ã®å‘½å¼ã§ã¯ã€äº”è¡Œã®ä¸­ã§ã€Œ${jpElemName(strongest)}ã€ãŒæœ€ã‚‚å¼·ãã€ã€Œ${jpElemName(weakest)}ã€ãŒæœ€ã‚‚å¼±ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚`;
    }

    // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿å­˜ & ãƒ—ãƒ­ãƒ¬ãƒæ§‹ç¯‰
    const ctx = {
      name: $('name').value || '',
      gender: $('gender').value || '',
      birth: {year,month,day,hour,minute,timeUnknown},
      year: {stemCn:yearP.stemCn, stemEn:yearP.stem, branch:yearP.branch, element:yearElem, nayin:yearNa},
      month:{stemCn:monthP.stemCn, stemEn:monthP.stem, branch:monthP.branch, element:monthElem, nayin:monthNa},
      day:  {stemCn:dayP.stemCn, stemEn:dayP.stem, branch:dayP.branch, element:dayElem, nayin:dayNa},
      hour: hourP?{stemCn:hourP.stemCn, stemEn:hourP.stem, branch:hourP.branch, element:hourElem, nayin:hourNa}:null,
      elements:pct
    };
    window.lastCtx = ctx;

    const resSec = $('result');
    if(resSec) resSec.style.display = 'block';
    buildProReport(ctx);

  }catch(e){
    console.error(e);
    showError('å‘½å¼ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  }finally{
    if(btn){ btn.disabled=false; }
    if(textSpan) textSpan.style.display='inline';
    if(loadSpan) loadSpan.style.display='none';
  }
}

    /* ===== Chat behaviour (simple echo; you can replace with API) ===== */
    function appendChat(role,text){
      const box = $('chatMessages');
      if(!box) return;
      const div = document.createElement('div');
      div.style.marginBottom = '8px';
      div.style.whiteSpace = 'pre-wrap';
      if(role==='user'){
        div.style.textAlign='right';
        div.innerHTML = `<strong>ã‚ãªãŸï¼š</strong> ${text}`;
      }else{
        div.innerHTML = `<strong>ãƒãƒˆãƒ©ãƒ¼ï¼š</strong> ${text}`;
      }
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    async function handleChatSend(){
      const input = $('chatInput');
      if(!input) return;
      const q = input.value.trim();
      if(!q) return;
      appendChat('user', q);
      input.value = '';

      const ctx = window.lastCtx;
      if(!ctx){
        appendChat('bot','ã¾ãšã¯ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å››æŸ±æ¨å‘½ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ã‹ã‚‰ã€æ‹æ„›ãƒ»ä»•äº‹ãƒ»ãŠé‡‘ãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã©ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      const dmStemCn = ctx.day.stemCn;
      const dmElemJp = jpElemName(ctx.day.element); // æœ¨ãƒ»ç«ãƒ»åœŸãƒ»é‡‘ãƒ»æ°´
      const dmLabel = `${dmStemCn}${dmElemJp}ã‚¿ã‚¤ãƒ—`;

      appendChat(
        'bot',
        `ã‚ãªãŸã®æ—¥ä¸»ã¯ ${dm} ã§ã™ã€‚\n\n` +
        `ã“ã®ã”è³ªå•ã€Œ${q}ã€ã«ã¤ã„ã¦ã¯ã€æ¬¡ã® 3 ã¤ã®ãƒã‚¤ãƒ³ãƒˆã‚’æ„è­˜ã™ã‚‹ã¨åˆ¤æ–­ã—ã‚„ã™ããªã‚Šã¾ã™ï¼š\n` +
        `1ï¼‰ãã®é¸æŠãŒã€ã‚ãªãŸã®ã€Œé•·æœŸçš„ãªå®‰å®šï¼ˆåœŸã®è¦ç´ ï¼‰ã€ã‚’å®ˆã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã€‚\n` +
        `2ï¼‰ã‚ãªãŸã®æ€§è³ªï¼ˆæ—¥ä¸»ãƒ»äº”è¡Œï¼‰ã¨åˆã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã€‚\n` +
        `3ï¼‰ã„ããªã‚Šã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã§ã¯ãªãã€å°ã•ãªä¸€æ­©ãšã¤é€²ã‚ã‚‰ã‚Œã‚‹å½¢ã«ã§ãã‚‹ã‹ã©ã†ã‹ã€‚\n\n` +
        `ã“ã® 3 ç‚¹ã‚’åŸºæº–ã«ã—ãªãŒã‚‰ã€å…·ä½“çš„ãªè¡Œå‹•ã‚’ä¸€ç·’ã«æ•´ç†ã—ã¦ã„ãã‚¤ãƒ¡ãƒ¼ã‚¸ã§è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚`
      );
    }

    /* ===== Chat toggle & drag ===== */
    function initChat(){
      const toggle = $('chatToggle');
      const panel = $('chatFloat');
      const closeBtn = $('chatClose');
      const sendBtn = $('chatSend');
      const input = $('chatInput');
      if(!toggle || !panel) return;
      toggle.addEventListener('click', ()=>{ panel.style.display = panel.style.display==='flex'?'none':'flex'; });
      if(closeBtn) closeBtn.addEventListener('click', ()=>{ panel.style.display='none'; });
      if(sendBtn) sendBtn.addEventListener('click', handleChatSend);
      if(input) input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); handleChatSend(); } });

      const header = panel.querySelector('.chat-float-header');
      if(header){
        let dragging=false, startX=0,startY=0,startLeft=0,startTop=0;
        header.addEventListener('mousedown',e=>{
          dragging=true;
          startX=e.clientX; startY=e.clientY;
          const rect=panel.getBoundingClientRect();
          startLeft=rect.left; startTop=rect.top;
          document.body.style.userSelect='none';
        });
        window.addEventListener('mousemove',e=>{
          if(!dragging) return;
          const dx=e.clientX-startX, dy=e.clientY-startY;
          panel.style.left = (startLeft+dx)+'px';
          panel.style.top = (startTop+dy)+'px';
          panel.style.right = 'auto';
          panel.style.bottom = 'auto';
        });
        window.addEventListener('mouseup',()=>{
          dragging=false;
          document.body.style.userSelect='';
        });
      }
    }

    /* ===== Init ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  const btn = $('genBtn');
  if(btn) btn.addEventListener('click', onGenerate);
  initChat();

  // language selector: set current and handle change
  const langSelect = $('langSelect');
  if (langSelect) {
    langSelect.value = CURRENT_LANG;
    langSelect.addEventListener('change', e => {
      const code = e.target.value;
      const url = LANG_PAGES[code];
      if (url) window.location.href = url;
    });
  }

  // auth fields toggle (hidden by default)
  const authFields = $('authFields');
  const toggleAuth = $('toggleAuthFields');
  if (toggleAuth && authFields) {
    authFields.style.display = 'none';
    toggleAuth.addEventListener('click', () => {
      const now = authFields.style.display === 'none' ? 'grid' : 'none';
      authFields.style.display = now;
      toggleAuth.textContent = (now === 'none')
        ? 'ãƒ¡ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚¤ãƒ³ / ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º'
        : 'ãƒ¡ãƒ¼ãƒ«å…¥åŠ›æ¬„ã‚’éš ã™';
    });
  }

  // simple dummy handlers for auth buttons (no backend wired)
  const loginForm = $('loginForm');
  const registerForm = $('registerForm');
  const resetBtn = $('resetBtn');
  const authError = $('authError');
  if(loginForm){
    loginForm.addEventListener('submit', e=>{
      e.preventDefault();
      if(authError){
        authError.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ API ã¯ã¾ã æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨æ¥ç¶šã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚';
        authError.style.display='block';
      }
    });
  }
  if(registerForm){
    registerForm.addEventListener('submit', e=>{
      e.preventDefault();
      if(authError){
        authError.textContent = 'æ–°è¦ç™»éŒ² API ã¯ã¾ã æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨æ¥ç¶šã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚';
        authError.style.display='block';
      }
    });
  }
  if(resetBtn){
    resetBtn.addEventListener('click', ()=>{
      if(authError){
        authError.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã¯æœªæ¥ç¶šã§ã™ã€‚åˆ¥é€”ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚';
        authError.style.display='block';
      }
    });
  }
});
  })();
  </script>
  <!-- Clock + defaults keep-in-sync with language -->
<script>
(function () {
  const $ = (id) => document.getElementById(id);
  const TZ = 'Asia/Singapore';
  const localeMap = { 'zh-CN':'zh-CN','zh-TW':'zh-TW','en':'en-US','ja':'ja-JP','th':'th-TH','ms':'ms' };
  const getLocale = () => (localeMap[(window.state && window.state.lang) || 'ja'] || 'ja-JP');

  // Chain applyI18n without breaking the version the app set earlier
  window.applyI18n = (function(prev){
    return function(){
      if (typeof prev === 'function') prev();
      if (typeof window.tickNow === 'function') window.tickNow();
    };
  })(window.applyI18n);

  // Define tickNow only if the app hasn't already defined it
  if (typeof window.tickNow !== 'function') {
    window.tickNow = function tickNow(){
      const box = $('nowBox'); if (!box) return;
      const fmt = new Intl.DateTimeFormat(getLocale(), {
        weekday:'short', year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', hour12:false, timeZone: TZ
      });
      box.textContent = fmt.format(new Date()) + ' (SGT)';
    };
  }

  // One-time birth defaults (kept exactly as behavior you intended)
  function initBirthDefaults() {
    const bd = $('birthdate'); const bt = $('birthtime'); const unk = $('timeUnknown');
    const nowSG = new Date(new Date().toLocaleString('en-US', { timeZone: TZ }));

    if (bd && !bd.value){
      const y=nowSG.getFullYear(), m=String(nowSG.getMonth()+1).padStart(2,'0'), d=String(nowSG.getDate()).padStart(2,'0');
      bd.value = `${y}-${m}-${d}`;
    }

    if (bt){
      const hh=String(nowSG.getHours()).padStart(2,'0'), mm=String(nowSG.getMinutes()).padStart(2,'0');
      if (!bt.value) bt.value = `${hh}:${mm}`;
      const setUnknownState = ()=>{ const isUnknown = !!(unk && unk.checked); bt.disabled = isUnknown; if (isUnknown) bt.value = ''; };
      setUnknownState();
      if (unk && !unk._wired){
        unk._wired = true;
        unk.addEventListener('change', ()=>{
          if (unk.checked){
            bt.disabled = true; bt.value = '';
          } else {
            bt.disabled = false;
            if (!bt.value){
              const n = new Date(new Date().toLocaleString('en-US',{timeZone:TZ}));
              bt.value = `${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}`;
            }
          }
        });
      }
    }
  }

  // Initial render + clock; guard against duplicate intervals from the main app
  initBirthDefaults();
  if (typeof window.tickNow === 'function') window.tickNow();
  if (!window._clock) window._clock = setInterval(()=>{ try{ window.tickNow(); }catch{} }, 60000);
})();
</script>
</body>
</html>
