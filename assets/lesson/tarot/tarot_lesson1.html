<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>朗读测试</title>
</head>
<body>
  <h1>🎧 多语言朗读测试</h1>

  <select id="langSelect">
    <option value="zh-CN">中文</option>
    <option value="en">English</option>
    <option value="ja">日本語</option>
  </select>

  <button onclick="play()">🔊 Play</button>

  <script>
    const ttsData = {
      "tarot_lesson_1": {
        "zh-CN": [
          "你好，欢迎来到塔罗课。",
          "这是第二段内容。",
          "第三段也是重点。"
        ],
        "en": [
          "Hello, welcome to the Tarot course.",
          "This is the second paragraph.",
          "The third part is important too."
        ],
        "ja": [
          "こんにちは。タロット講座へようこそ。",
          "これは2番目の段落です。",
          "そして最後の部分も重要です。"
        ]
      }
    };

    let isPlaying = false;
    function play() {
      const lang = document.getElementById("langSelect").value;
      const lesson = ttsData["tarot_lesson_1"];
      const textArray = lesson[lang];
      const synth = window.speechSynthesis;

      if (isPlaying) {
        synth.cancel();
        isPlaying = false;
        return;
      }

      const voices = synth.getVoices();
      const voice = voices.find(v => v.lang === lang)
                   || voices.find(v => v.lang.startsWith(lang.split('-')[0]))
                   || voices.find(v => v.lang.startsWith('en'));

      let index = 0;
      isPlaying = true;

      function speakNext() {
        if (!isPlaying || index >= textArray.length) {
          isPlaying = false;
          return;
        }
        const utter = new SpeechSynthesisUtterance(textArray[index]);
        utter.lang = lang;
        if (voice) utter.voice = voice;
        utter.onend = () => {
          index++;
          speakNext();
        };
        synth.speak(utter);
      }

      speakNext();
    }

    window.speechSynthesis.onvoiceschanged = () => {
      speechSynthesis.getVoices();
    };
  </script>
</body>
</html>
