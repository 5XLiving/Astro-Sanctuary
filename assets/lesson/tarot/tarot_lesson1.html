<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æœ—è¯»æµ‹è¯•</title>
</head>
<body>
  <h1>ðŸŽ§ å¤šè¯­è¨€æœ—è¯»æµ‹è¯•</h1>

  <select id="langSelect">
    <option value="zh-CN">ä¸­æ–‡</option>
    <option value="en">English</option>
    <option value="ja">æ—¥æœ¬èªž</option>
  </select>

  <button onclick="play()">ðŸ”Š Play</button>

  <script>
    const ttsData = {
      "tarot_lesson_1": {
        "zh-CN": [
          "ä½ å¥½ï¼Œæ¬¢è¿Žæ¥åˆ°å¡”ç½—è¯¾ã€‚",
          "è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹ã€‚",
          "ç¬¬ä¸‰æ®µä¹Ÿæ˜¯é‡ç‚¹ã€‚"
        ],
        "en": [
          "Hello, welcome to the Tarot course.",
          "This is the second paragraph.",
          "The third part is important too."
        ],
        "ja": [
          "ã“ã‚“ã«ã¡ã¯ã€‚ã‚¿ãƒ­ãƒƒãƒˆè¬›åº§ã¸ã‚ˆã†ã“ãã€‚",
          "ã“ã‚Œã¯2ç•ªç›®ã®æ®µè½ã§ã™ã€‚",
          "ãã—ã¦æœ€å¾Œã®éƒ¨åˆ†ã‚‚é‡è¦ã§ã™ã€‚"
        ]
      }
    };

    let isPlaying = false;
    function play() {
      const lang = document.getElementById("langSelect").value;
      const lesson = ttsData["tarot_lesson_1"];
      const textArray = lesson[lang];
      const synth = window.speechSynthesis;

      if (isPlaying) {
        synth.cancel();
        isPlaying = false;
        return;
      }

      const voices = synth.getVoices();
      const voice = voices.find(v => v.lang === lang)
                   || voices.find(v => v.lang.startsWith(lang.split('-')[0]))
                   || voices.find(v => v.lang.startsWith('en'));

      let index = 0;
      isPlaying = true;

      function speakNext() {
        if (!isPlaying || index >= textArray.length) {
          isPlaying = false;
          return;
        }
        const utter = new SpeechSynthesisUtterance(textArray[index]);
        utter.lang = lang;
        if (voice) utter.voice = voice;
        utter.onend = () => {
          index++;
          speakNext();
        };
        synth.speak(utter);
      }

      speakNext();
    }

    window.speechSynthesis.onvoiceschanged = () => {
      speechSynthesis.getVoices();
    };
  </script>
</body>
</html>
