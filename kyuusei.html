<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title data-i18n="title">ä¹æ˜Ÿæ°”å­¦æ·±åº¦åˆ†æ Â· 5XLiving</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="icon" href="data:,">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
    --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
    --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
  }
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                linear-gradient(180deg,#0b0f14,#0b0f14);
    font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  body::before{
    content:""; position:fixed; inset:0; z-index:-2;
    background:url('assets/images/gate.jpg') center/cover no-repeat;
    filter:brightness(.45) saturate(.9) blur(2px)
  }
  .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

  /* å¤´éƒ¨æ ·å¼ï¼ˆç»Ÿä¸€ç‰ˆï¼‰ */
  .site-header{
    position:sticky; top:0; z-index:10;
    background:#0b0f14cc;
    border-bottom:1px solid #0f1622;
    backdrop-filter:saturate(140%) blur(12px);
  }
  .head-inner{
    display:flex; align-items:center; justify-content:space-between;
    gap:14px; padding:14px 16px;
  }
  .brand{
    display:flex; align-items:center; gap:10px;
    text-decoration:none; color:var(--text)
  }
  .brand-badge{
    display:inline-grid; place-items:center;
    width:34px; height:34px; border-radius:8px;
    background:linear-gradient(180deg,#0e1520,#0b1018);
    border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35);
    font-weight:800; color:#ffe084;
  }
  .title{
    font-family:"Noto Serif SC",serif;
    font-weight:700; letter-spacing:.02em;
  }

  .lang{display:flex; align-items:center; gap:8px}
  .lang label{white-space:nowrap; color:var(--muted); margin-right:4px}
  .lang select{
    appearance:none; min-width:170px;
    border-radius:10px; border:1px solid #243244;
    background:#0e1520; color:var(--text);
    padding:10px 34px 10px 12px; font-size:.95rem;
    background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
  }

  .section{margin-top:18px}
  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    backdrop-filter:blur(10px);
    padding:18px;
    margin:16px 0;
  }
  .h2{
    font-size:1.2rem;margin:0 0 12px;
    font-weight:800;color:#ffe084;
    display:flex;gap:8px;align-items:center
  }
  .h2::before{
    content:"";width:4px;height:18px;
    background:var(--brand);border-radius:2px
  }

  .row{display:grid;gap:12px}
  @media(min-width:760px){
    .row.cols-3{grid-template-columns:1fr 1fr 1fr}
    .row.cols-2{grid-template-columns:1fr 1fr}
  }

  input,select,textarea{
    width:100%;box-sizing:border-box;border-radius:12px;
    border:1px solid #243244;background:#0e1520;color:var(--text);
    padding:12px 12px;font-size:15px;outline:none;
  }
  input::placeholder{color:#6f8092}
  .btn{
    display:inline-grid;place-items:center;
    padding:12px 16px;border-radius:12px;
    border:1px solid #e6c76e;
    background:linear-gradient(180deg,#fff9e6,#e6c76e);
    color:#191919;font-weight:800;cursor:pointer
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn.ghost{
    background:transparent;color:var(--gold2);
    border:1px solid rgba(212,175,55,.45);box-shadow:none
  }
  .btn.block{display:block;width:100%}
  .muted{color:var(--muted)}
  .badge{
    display:inline-block;padding:4px 8px;margin:2px 4px 2px 0;
    background:rgba(212,175,55,.15);
    border:1px solid rgba(212,175,55,.3);
    border-radius:6px;font-size:.85rem
  }

  /* æ·±åº¦åˆ†æå¸ƒå±€ */
  .analysis-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin-top: 20px;
  }
  @media (min-width: 768px) {
    .analysis-grid {
      grid-template-columns: 1fr 1fr;
    }
  }
  .analysis-card {
    background: linear-gradient(145deg, rgba(17,22,29,0.9), rgba(12,16,22,0.9));
    border: 1px solid var(--line);
    border-radius: var(--radius);
    padding: 20px;
    position: relative;
  }
  .analysis-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .analysis-title {
    font-family: "Noto Serif SC", serif;
    font-weight: 600;
    color: var(--gold2);
    margin-bottom: 12px;
    font-size: 1.1rem;
  }
  .analysis-content {
    line-height: 1.6;
    font-size: 0.95rem;
  }

  .element-chart {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    margin: 15px 0;
  }
  .element-item {
    text-align: center;
    padding: 10px 5px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
  }
  .element-item.strong {
    background: rgba(212,175,55,0.2);
    border-color: var(--gold);
  }
  .element-name {
    font-weight: 600;
    margin-bottom: 4px;
  }
  .element-value {
    font-size: 0.9rem;
    color: var(--muted);
  }

  /* è¿åŠ¿æ—¶é—´çº¿ */
  .timeline { position: relative; padding-left: 20px; }
  .timeline::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 2px;
    background: linear-gradient(180deg, var(--gold), transparent);
  }
  .timeline-item {
    position: relative;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -24px; top: 6px;
    width: 8px;height: 8px;border-radius: 50%;
    background: var(--gold);
  }
  .timeline-period {
    font-weight: 600;
    color: var(--gold2);
    margin-bottom: 5px;
  }

  /* ä¸“ä¸šå»ºè®® */
  .advice-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
    margin-top: 20px;
  }
  .advice-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 16px;
    transition: all 0.3s ease;
  }
  .advice-card:hover {
    border-color: var(--gold);
    transform: translateY(-2px);
  }
  .advice-category {
    font-weight: 600;
    color: var(--gold2);
    margin-bottom: 8px;
    font-size: 0.95rem;
  }

  .analysis-type-indicator {
    display: inline-block;
    padding: 4px 12px;
    background: rgba(212,175,55,0.2);
    border: 1px solid var(--gold);
    border-radius: 20px;
    font-size: 0.85rem;
    color: var(--gold2);
    margin-left: 10px;
  }

  /* Butler AI + æŠ¥å‘Š sec æ ·å¼ */
  .report{margin-top:12px;display:grid;gap:10px}
  .report .sec{
    padding:12px;border:1px solid var(--line);
    background:#0e1520;border-radius:12px
  }
  .report .sec h3{
    margin:0 0 6px;color:var(--gold2);font-size:1.05rem
  }
  .report p,.report li{line-height:1.7}

  /* VIP åŒºåŸŸå¸ƒå±€ï¼ˆä¿ç•™ï¼‰ */
  .columns{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
  .list-block{
    border:1px solid #263448;
    background:#0e1520;
    border-radius:12px;padding:16px
  }
  .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
  .group-title{
    font-size:1.05rem;color:#ffe084;
    margin:6px 0 14px
  }
  .astro-auth{
    max-width:980px;margin:28px auto;
    padding:20px 18px;
    background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
    border:1px solid rgba(212,175,55,.22);
    border-radius:14px;
    box-shadow:0 18px 50px rgba(0,0,0,.35)
  }
  .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
  @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
  .panel{
    background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
    border:1px solid rgba(212,175,55,.22);
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.35)
  }
  .panel .head{
    padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);
    color:var(--gold);font-weight:700;letter-spacing:.3px
  }
  .panel .body{padding:18px; overflow:hidden;}
  .spacer{height:12px}

  footer{
    color:#6c7b8c;font-size:.85rem;
    text-align:center;padding:30px 0
  }

  /* Butler chips / skeleton */
  .ai-content{white-space:pre-wrap;line-height:1.7}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .chip{
    padding:6px 10px;border-radius:999px;
    border:1px solid #2a3546;background:#0e1520;
    color:#e8edf3;cursor:pointer
  }
  .chip:hover{border-color:#f2d27a;box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
  .skeleton{display:grid;gap:8px}
  .skeleton div{
    height:12px;border-radius:6px;
    background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);
    animation:sh 1.2s infinite
  }
  @keyframes sh{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}

  .sr-only{
    position:absolute !important;
    width:1px;height:1px;padding:0;margin:-1px;
    overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
  }

  /* å°å±ä¼˜åŒ– */
  @media (max-width:520px){
    .title{font-size:1rem}
    .lang select{min-width:140px}
  }

  /* æ ¹å­—å·ä¸æ ‡é¢˜ç»Ÿä¸€ */
  html { font-size: 16px; }
  @media (min-width: 768px){ html { font-size: 17px; } }
  @media (min-width: 1200px){ html { font-size: 18px; } }
  .site-header .brand .title,
  .site-header .title{
    font-family: "Noto Serif SC","Noto Serif",serif !important;
    font-weight: 600 !important;
    letter-spacing: .02em;
    font-size: 1.1rem !important;
    line-height: 1.25;
  }
</style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="https://astro.5xliving.com/" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title">
        5xLiving Â· <span data-i18n="title_kyuusei_brief">ä¹æ˜Ÿæ°”å­¦æ·±åº¦åˆ†æ</span>
      </span>
    </a>

    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en">English</option>
        <option value="ja-JP">æ—¥æœ¬èª</option>
        <option value="th-TH">à¹„à¸—à¸¢</option>
        <option value="ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <!-- ä¸“ä¸šåˆ†æè¡¨å• -->
  <div class="card">
    <div class="h2" data-i18n="form_title">ä¹æ˜Ÿæ°”å­¦ Â· ä¸“ä¸šå‘½ç†åˆ†æ</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="birth_label">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate">
      </div>
      <div>
        <label class="muted" data-i18n="gender_label">æ€§åˆ«</label>
        <select id="gender">
          <option value="male" data-i18n="gender_male">ç”·æ€§</option>
          <option value="female" data-i18n="gender_female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="analysis_type">åˆ†æç±»å‹</label>
        <select id="analysisType">
          <option value="comprehensive" data-i18n="analysis_type_comprehensive">ç»¼åˆå‘½ç†åˆ†æ</option>
          <option value="career" data-i18n="analysis_type_career">äº‹ä¸šè´¢è¿ä¸“é¡¹</option>
          <option value="relationship" data-i18n="analysis_type_relationship">æ„Ÿæƒ…å©šå§»ä¸“é¡¹</option>
          <option value="health" data-i18n="analysis_type_health">å¥åº·è¿åŠ¿ä¸“é¡¹</option>
        </select>
      </div>
    </div>
    <div style="margin-top:16px">
      <button id="go" class="btn block" data-i18n="btn_gen">ç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š</button>
    </div>
    <div class="muted" style="margin-top:8px;font-size:0.85rem" id="nowInfo"></div>
  </div>

  <!-- ä¸»æ˜Ÿåˆ†æ -->
  <div id="starCard" class="section card" style="display:none">
    <div class="h2">
      <span data-i18n="sec_star">æ‚¨çš„ä¹æ˜Ÿå‘½ç›˜åˆ†æ</span>
      <span class="analysis-type-indicator" id="analysisTypeIndicator"></span>
    </div>
    <div class="row cols-2">
      <div>
        <h3 style="color:var(--gold2); margin-bottom:12px;" data-i18n="sec_star_main">æœ¬å‘½ä¸»æ˜Ÿ</h3>
        <p><strong id="starName"></strong>ï¼ˆ<span id="starJP"></span>ï¼‰</p>
        <div id="starBadges" style="margin:12px 0"></div>
        <div id="starAbout" class="muted"></div>
      </div>
      <div>
        <h3 style="color:var(--gold2); margin-bottom:12px;" data-i18n="sec_star_elements">äº”è¡Œèƒ½é‡åˆ†å¸ƒ</h3>
        <div class="element-chart" id="elementChart"></div>
        <div id="elementAnalysis" class="muted" style="font-size:0.9rem; line-height:1.5"></div>
      </div>
    </div>
  </div>

  <!-- æ·±åº¦åˆ†æ -->
  <div id="analysisCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_deep">æ·±åº¦å‘½ç†è§£è¯»</div>
    <div class="analysis-grid">
      <div class="analysis-card">
        <div class="analysis-title" data-i18n="sec_personality">æ€§æ ¼ç‰¹è´¨åˆ†æ</div>
        <div class="analysis-content" id="personalityAnalysis"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" data-i18n="sec_talent">å¤©èµ‹æ½œèƒ½</div>
        <div class="analysis-content" id="talentAnalysis"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" data-i18n="sec_challenge">äººç”Ÿè¯¾é¢˜</div>
        <div class="analysis-content" id="challengeAnalysis"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" data-i18n="sec_development">å‘å±•å»ºè®®</div>
        <div class="analysis-content" id="developmentAdvice"></div>
      </div>
    </div>
  </div>

  <!-- ä¸“é¡¹åˆ†æ -->
  <div id="specializedCard" class="section card" style="display:none">
    <div class="h2" id="specializedTitle">ä¸“é¡¹æ·±åº¦åˆ†æ</div>
    <div class="analysis-grid">
      <div class="analysis-card">
        <div class="analysis-title" id="specializedSubtitle1">æ ¸å¿ƒåˆ†æ</div>
        <div class="analysis-content" id="specializedContent1"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" id="specializedSubtitle2">å…³é”®æœºé‡</div>
        <div class="analysis-content" id="specializedContent2"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" id="specializedSubtitle3">é£é™©æç¤º</div>
        <div class="analysis-content" id="specializedContent3"></div>
      </div>
      <div class="analysis-card">
        <div class="analysis-title" id="specializedSubtitle4">è¡ŒåŠ¨æŒ‡å—</div>
        <div class="analysis-content" id="specializedContent4"></div>
      </div>
    </div>
  </div>

  <!-- è¿åŠ¿åˆ†æ -->
  <div id="fortuneCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_fortune">è¿åŠ¿èµ°åŠ¿åˆ†æ</div>
    <div class="timeline" id="fortuneTimeline"></div>
  </div>

  <!-- ä¸“ä¸šå»ºè®® -->
  <div id="adviceCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_advice">ä¸“ä¸šè°ƒæ•´å»ºè®®</div>
    <div class="advice-grid">
      <div class="advice-card">
        <div class="advice-category" data-i18n="advice_direction">æ–¹ä½è°ƒæ•´</div>
        <div id="directionAdvice"></div>
      </div>
      <div class="advice-card">
        <div class="advice-category" data-i18n="advice_color">è‰²å½©è¿ç”¨</div>
        <div id="colorAdvice"></div>
      </div>
      <div class="advice-card">
        <div class="advice-category" data-i18n="advice_career">èŒä¸šå‘å±•</div>
        <div id="careerAdvice"></div>
      </div>
      <div class="advice-card">
        <div class="advice-category" data-i18n="advice_relationship">äººé™…å…³ç³»</div>
        <div id="relationshipAdvice"></div>
      </div>
    </div>
  </div>

  <!-- Butler AI è§£è¯»ï¼ˆå¹³é¢ GPT åŒºï¼‰ -->
  <div id="aiCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_ai">å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®</div>
    <pre id="aiText" class="ai-content"></pre>
    <div id="aiChips" class="chips"></div>
    <div id="aiReco" style="margin-top:10px"></div>
  </div>

  <!-- ä¼šå‘˜ä¸“åŒºï¼ˆåŸæ ·ä¿ç•™ï¼‰ -->
  <section class="card section">
    <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
          <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
          <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
          <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
          <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
          <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

    <section class="astro-auth">
      <div class="auth-grid">
        <!-- å·¦ä¾§ï¼šè¾“å…¥ + æ³¨å†Œ/ç™»å½• -->
        <div class="panel">
          <div class="head" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <label for="email" class="sr-only" data-i18n="ph_email">é‚®ç®± Email</label>
              <input
                id="email"
                name="email"
                type="email"
                inputmode="email"
                autocomplete="username"
                placeholder=""
                data-i18n-ph="ph_email"
                required
              />
              <label for="password" class="sr-only" data-i18n="ph_label_password">å¯†ç  Password</label>
              <input
                id="password"
                name="password"
                type="password"
                autocomplete="current-password"
                placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰"
                data-i18n-ph="ph_password"
                required
              />
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <!-- å³ä¾§ï¼šä¼šå‘˜ä¸è¿”å› -->
        <div class="panel">
          <div class="head" data-i18n="panel_member_head">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="spacer"></div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="spacer"></div>
            <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>

<script>
/* ===== åŸºæœ¬é…ç½® ===== */
const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';
const LANG_KEY = "site_lang";

/* å·¥å…· */
const $  = id => document.getElementById(id);
const getLang = () => localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN";
const setLang = v => { localStorage.setItem(LANG_KEY, v); document.documentElement.lang = v; };

/* ===== i18n è¯åº“ï¼ˆåªå†™ zh-CNï¼Œå…¶å®ƒè¯­è¨€å…ˆç”¨ zh-CN å›é€€ï¼‰ ===== */
const i18n = {
  "zh-CN": {
    title:"ä¹æ˜Ÿæ°”å­¦æ·±åº¦åˆ†æ Â· 5XLiving",
    title_kyuusei_brief:"ä¹æ˜Ÿæ°”å­¦æ·±åº¦åˆ†æ",
    lang_label:"è¯­è¨€",
    form_title:"ä¹æ˜Ÿæ°”å­¦ Â· ä¸“ä¸šå‘½ç†åˆ†æ",
    birth_label:"å‡ºç”Ÿæ—¥æœŸ",
    gender_label:"æ€§åˆ«",
    gender_male:"ç”·æ€§",
    gender_female:"å¥³æ€§",
    analysis_type:"åˆ†æç±»å‹",
    analysis_type_comprehensive:"ç»¼åˆå‘½ç†åˆ†æ",
    analysis_type_career:"äº‹ä¸šè´¢è¿ä¸“é¡¹",
    analysis_type_relationship:"æ„Ÿæƒ…å©šå§»ä¸“é¡¹",
    analysis_type_health:"å¥åº·è¿åŠ¿ä¸“é¡¹",
    btn_gen:"ç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š",
    now_info_prefix:"å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š",
    sec_star:"æ‚¨çš„ä¹æ˜Ÿå‘½ç›˜åˆ†æ",
    sec_star_main:"æœ¬å‘½ä¸»æ˜Ÿ",
    sec_star_elements:"äº”è¡Œèƒ½é‡åˆ†å¸ƒ",
    sec_deep:"æ·±åº¦å‘½ç†è§£è¯»",
    sec_personality:"æ€§æ ¼ç‰¹è´¨åˆ†æ",
    sec_talent:"å¤©èµ‹æ½œèƒ½",
    sec_challenge:"äººç”Ÿè¯¾é¢˜",
    sec_development:"å‘å±•å»ºè®®",
    sec_fortune:"è¿åŠ¿èµ°åŠ¿åˆ†æ",
    sec_advice:"ä¸“ä¸šè°ƒæ•´å»ºè®®",
    advice_direction:"æ–¹ä½è°ƒæ•´",
    advice_color:"è‰²å½©è¿ç”¨",
    advice_career:"èŒä¸šå‘å±•",
    advice_relationship:"äººé™…å…³ç³»",
    sec_ai:"å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®",

    badge_elem:"äº”è¡Œ", badge_color:"è‰²", badge_kw:"å…³é”®è¯",
    about_label:"æ€§æ ¼å€¾å‘",

    please_birth:"è¯·å…ˆé€‰æ‹©å‡ºç”Ÿæ—¥æœŸ",
    bad_date:"æ—¥æœŸæ ¼å¼æœ‰è¯¯",
    generating:"æ­£åœ¨ç”Ÿæˆè§£è¯»â€¦",
    retry:"æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•ç”Ÿæˆï¼Œè¯·ç¨åå†è¯•ã€‚",
    neterr:"ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚",

    vip_title:"ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment",
    vip_mingli:"ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹",
    vip_xinlian:"ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹",
    vip_love:"å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿",
    vip_career:"äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›",
    vip_wealth:"è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº",
    vip_pet:"å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†",
    vip_hepan:"åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶",
    vip_name:"æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿",
    vip_fengshui:"è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ",
    vip_record:"çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·",
    vip_course:"å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾",
    vip_memorial:"å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­",
    vip_tasks:"æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡",
    vip_shop:"èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
    login_title:"ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",

    ph_email:"é‚®ç®± Email",
    ph_password:"å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰",
    ph_label_password:"å¯†ç  Password",
    panel_login_head:"è´¦æˆ·ç™»å½• / æ³¨å†Œ",
    panel_member_head:"ä¼šå‘˜æœåŠ¡",
    btn_login:"ç™»å…¥è´¦æˆ·",
    btn_reset:"ğŸ”‘ é‡è®¾å¯†ç ",
    btn_register:"æ³¨å†Œè´¦æˆ·",
    btn_upgrade:"ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰",
    btn_backshop:"â† è¿”å›å‘½ç†å•†åŸ",
    note_price:"æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ",
    note_price1:"$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰",

    // AI èŠ¯ç‰‡
    chip_career:"äº‹ä¸š",
    chip_love:"æ„Ÿæƒ…",
    chip_money:"è´¢è¿",
    chip_list:"ä»Šæ—¥å¾…åŠ",
    chip_30d:"30å¤©å»ºè®®",
  },
  "zh-TW": {},
  "en": {},
  "ja-JP": {},
  "th-TH": {},
  "ms": {}
};

function t(key){
  const L = i18n[getLang()] || i18n["zh-CN"];
  return L[key] || (i18n["zh-CN"][key] || key);
}

function applyI18n(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.textContent = t(key);
  });
  document.querySelectorAll("[data-i18n-ph]").forEach(el=>{
    const key = el.getAttribute("data-i18n-ph");
    el.setAttribute("placeholder", t(key));
  });
  const titleEl = document.querySelector("title[data-i18n]");
  if (titleEl) titleEl.textContent = t(titleEl.getAttribute("data-i18n"));
}

/* ===== Butler AI: èŠ¯ç‰‡æ¸²æŸ“ ===== */
function renderChips() {
  let box = $('aiChips');
  if (!box) return;

  box.innerHTML = '';

  const chips = [
    { key: 'chip_career', fallback: 'äº‹ä¸š' },
    { key: 'chip_love',   fallback: 'æ„Ÿæƒ…' },
    { key: 'chip_money',  fallback: 'è´¢è¿' },
    { key: 'chip_list',   fallback: 'ä»Šæ—¥å¾…åŠ' },
    { key: 'chip_30d',    fallback: '30å¤©å»ºè®®' },
  ];

  chips.forEach((c) => {
    const label = t(c.key) || c.fallback;
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'chip';
    btn.textContent = label;
    btn.setAttribute('data-i18n', c.key);

    btn.addEventListener('click', () => {
      const aiBox = $('aiText');
      if (aiBox) {
        aiBox.textContent = t('generating') || 'æ­£åœ¨ç”Ÿæˆè§£è¯»â€¦';
      }
      // å¯åœ¨æ­¤æ‰©å±•ï¼šæ ¹æ®ä¸åŒ chip å‘é€ä¸åŒ prompt
    });

    box.appendChild(btn);
  });
}

/* ===== ä¹æ˜Ÿç®—æ³• ===== */
function reduce1(n){
  let s=Math.abs(n).toString().split('').reduce((a,b)=>a+Number(b),0);
  while(s>9) s=s.toString().split('').reduce((a,b)=>a+Number(b),0);
  return s;
}
function isBeforeSetsubun(d){
  const m=d.getMonth(),day=d.getDate();
  return (m===0)||(m===1&&day<=3);
}
function calcHonmei(dateStr){
  const d=new Date(dateStr);
  if(isNaN(d))return null;
  const root=reduce1(d.getFullYear());
  let num=(isBeforeSetsubun(d)?12:11)-root;
  while(num<=0)num+=9;
  return num;
}

/* ===== ä¹æ˜ŸåŸºç¡€ç”»åƒï¼ˆå¤šè¯­è¨€ä¸»æ˜Ÿå¡ï¼‰ ===== */
const STARS = {
  1:{zh:'ä¸€ç™½æ°´æ˜Ÿ',jp:'Ippaku Suisei',elem:{zh:'æ°´'},color:{zh:'ç™½'},key:{zh:['æµåŠ¨','ç›´è§‰','æ²Ÿé€š']},about:{zh:'æ•æ„Ÿç»†è…»ã€å…±æƒ…åŠ›å¼ºï¼Œè¡ŒåŠ¨çµæ´»ï¼Œæ“…é•¿ä¿¡æ¯ä¸å…³ç³»åè°ƒã€‚'}},
  2:{zh:'äºŒé»‘åœŸæ˜Ÿ',jp:'Jikoku Dosei',elem:{zh:'åœŸ'},color:{zh:'é»‘'},key:{zh:['æ»‹å…»','æ‰¿è½½','è€æ€§']},about:{zh:'åŠ¡å®ç¨³å¥ã€é‡è§†ç§©åºä¸ç…§æ–™ï¼Œæ“…é•¿æŒç»­è€•è€˜ä¸è½åœ°ã€‚'}},
  3:{zh:'ä¸‰ç¢§æœ¨æ˜Ÿ',jp:'Sanpeki Mokusei',elem:{zh:'æœ¨'},color:{zh:'ç¢§'},key:{zh:['ç”Ÿå‘','è¡¨è¾¾','çªç ´']},about:{zh:'å¥½å¥‡è¡¨è¾¾æ¬²å¼ºï¼Œå–œæ¬¢åˆ›æ„ä¸å¼€ç–†æ‹“åœŸã€‚'}},
  4:{zh:'å››ç»¿æœ¨æ˜Ÿ',jp:'Shiroku Mokusei',elem:{zh:'æœ¨'},color:{zh:'ç»¿'},key:{zh:['äº¤æµ','å­¦ä¹ ','æ—…è¡Œ']},about:{zh:'æ¸©å’ŒåŒ…å®¹ã€æ“…é•¿å€¾å¬ä¸çŸ¥è¯†æ•´åˆï¼Œé€‚åˆæ•™è‚²ä¸åä½œã€‚'}},
  5:{zh:'äº”é»„åœŸæ˜Ÿ',jp:'Gogou Dosei',elem:{zh:'åœŸ'},color:{zh:'é»„'},key:{zh:['ä¸­å®«','æƒè¡¡','é‡å¯']},about:{zh:'å±…ä¸­å®šç›˜ã€æŠ—å‹å¼ºï¼Œæ“…é•¿ç­–ç•¥ä¸å±æœºç®¡ç†ã€‚'}},
  6:{zh:'å…­ç™½é‡‘æ˜Ÿ',jp:'Roppaku Kinsei',elem:{zh:'é‡‘'},color:{zh:'ç™½'},key:{zh:['ç§©åº','é¢†å¯¼','è¿œè§']},about:{zh:'è‡ªå¾‹æœæ–­ã€æ“…ç«‹è§„åˆ™ä¸å¸¦é˜Ÿã€‚'}},
  7:{zh:'ä¸ƒèµ¤é‡‘æ˜Ÿ',jp:'Shichiseki Kinsei',elem:{zh:'é‡‘'},color:{zh:'èµ¤'},key:{zh:['ç¤¾äº¤','å“å‘³','äº«å—']},about:{zh:'äººç¼˜å¥½ã€å®¡ç¾åœ¨çº¿ï¼Œæ“…å“ç‰Œä¸ç¤¾ç¾¤ã€‚'}},
  8:{zh:'å…«ç™½åœŸæ˜Ÿ',jp:'Happaku Dosei',elem:{zh:'åœŸ'},color:{zh:'ç™½'},key:{zh:['ç§¯ç´¯','è½¬æŠ˜','å®šå±±']},about:{zh:'ç¨³ä¸­æ±‚å˜ã€åšç§¯è–„å‘ï¼Œå…³é”®æ—¶åˆ»èƒ½ç¿»ç›˜ã€‚'}},
  9:{zh:'ä¹ç´«ç«æ˜Ÿ',jp:'KyÅ«shi Kasei',elem:{zh:'ç«'},color:{zh:'ç´«'},key:{zh:['å…‰å½©','çµæ„Ÿ','ä¼ æ’­']},about:{zh:'çƒ­æƒ…å¤–æ”¾ã€çµæ„Ÿå¤šï¼Œé€‚åˆç™»å°è¡¨è¾¾ä¸IPæ‰“é€ ã€‚'}}
};

/* ===== ä¹æ˜Ÿæ·±åº¦æ•°æ®ï¼ˆæ ·ä¾‹ï¼š1/2/3ï¼Œå…¶å®ƒå¯æŒ‰æ­¤ç»“æ„æ‰©å±•ï¼‰ ===== */
const STARS_DEEP = {
  1: {
    zh: 'ä¸€ç™½æ°´æ˜Ÿ', jp: 'Ippaku Suisei',
    element: 'æ°´', color: 'ç™½ã€è“ã€é»‘',
    personality: 'æ•æ„Ÿç»†è…»ï¼Œç›´è§‰åŠ›å¼ºï¼Œå–„äºæ²Ÿé€šåè°ƒï¼Œå…·æœ‰æµåŠ¨æ€§å’Œé€‚åº”æ€§ã€‚',
    talents: ['æ²Ÿé€šåè°ƒ', 'ç›´è§‰åˆ¤æ–­', 'ä¿¡æ¯å¤„ç†', 'äººé™…å…³ç³»'],
    challenges: ['æƒ…ç»ªæ³¢åŠ¨', 'ç¼ºä¹å®šåŠ›', 'å®¹æ˜“å—ç¯å¢ƒå½±å“'],
    directions: { favorable: ['ä¸œå—', 'å—'], avoid: ['è¥¿å—', 'ä¸œåŒ—'] },
    career: 'ä¼ åª’ã€æ•™è‚²ã€å’¨è¯¢ã€è´¸æ˜“ã€å¤–äº¤',
    elements: { æ°´: 4, æœ¨: 2, é‡‘: 2, ç«: 1, åœŸ: 1 },
    career_analysis: {
      strengths: ['æ²Ÿé€šåè°ƒèƒ½åŠ›çªå‡º', 'ä¿¡æ¯å¤„ç†å¿«é€Ÿ', 'é€‚åº”æ€§å¼º'],
      opportunities: ['æ–°åª’ä½“è¡Œä¸š', 'æ•™è‚²åŸ¹è®­', 'å›½é™…è´¸æ˜“'],
      risks: ['ç«äº‰æ¿€çƒˆ', 'éœ€è¦æŒç»­å­¦ä¹ ', 'è¡Œä¸šå˜åŒ–å¿«'],
      actions: ['æå‡ä¸“ä¸šæŠ€èƒ½', 'å»ºç«‹äººè„‰ç½‘ç»œ', 'å…³æ³¨è¡Œä¸šåŠ¨æ€']
    },
    relationship_analysis: {
      strengths: ['å–„è§£äººæ„', 'æ²Ÿé€šèƒ½åŠ›å¼º', 'æƒ…æ„Ÿç»†è…»'],
      opportunities: ['æ‹“å±•ç¤¾äº¤åœˆ', 'æ·±åº¦æƒ…æ„Ÿè¿æ¥', 'å®¶åº­å’Œè°'],
      risks: ['æƒ…ç»ªæ•æ„Ÿ', 'å®¹æ˜“å—ä¼¤', 'ç¼ºä¹å®‰å…¨æ„Ÿ'],
      actions: ['å»ºç«‹ä¿¡ä»»', 'è¡¨è¾¾çœŸå®æ„Ÿå—', 'ä¿æŒè¾¹ç•Œ']
    },
    health_analysis: {
      strengths: ['æ¢å¤åŠ›å¼º', 'é€‚åº”èƒ½åŠ›å¥½', 'æ–°é™ˆä»£è°¢å¿«'],
      opportunities: ['æ°´ä¸Šè¿åŠ¨', 'å†¥æƒ³ç»ƒä¹ ', 'æ¸©å’Œé”»ç‚¼'],
      risks: ['è‚¾è„è´Ÿæ‹…', 'æƒ…ç»ªå‹åŠ›', 'å…ç–«åŠ›æ³¢åŠ¨'],
      actions: ['è§„å¾‹ä½œæ¯', 'æƒ…ç»ªç®¡ç†', 'é€‚åº¦è¿åŠ¨']
    }
  },
  2: {
    zh: 'äºŒé»‘åœŸæ˜Ÿ', jp: 'Jikoku Dosei',
    element: 'åœŸ', color: 'é»„ã€æ£•ã€å’–å•¡',
    personality: 'åŠ¡å®ç¨³é‡ï¼Œè´£ä»»å¿ƒå¼ºï¼Œæ³¨é‡å®é™…ï¼Œå…·æœ‰æ‰¿è½½åŠ›å’Œè€å¿ƒã€‚',
    talents: ['ç»è¥ç®¡ç†', 'èµ„æºæ•´åˆ', 'æŒç»­è€•è€˜', 'è½åœ°æ‰§è¡Œ'],
    challenges: ['å›ºæ‰§ä¿å®ˆ', 'ç¼ºä¹å˜é€š', 'å®¹æ˜“ç„¦è™‘'],
    directions: { favorable: ['è¥¿å—', 'ä¸œåŒ—'], avoid: ['ä¸œ', 'ä¸œå—'] },
    career: 'æˆ¿åœ°äº§ã€å†œä¸šã€é‡‘èã€ç®¡ç†ã€æ•™è‚²',
    elements: { åœŸ: 4, é‡‘: 2, ç«: 2, æ°´: 1, æœ¨: 1 },
    career_analysis: {
      strengths: ['ç®¡ç†èƒ½åŠ›å¼º', 'èµ„æºæ•´åˆ', 'æ‰§è¡ŒåŠ›çªå‡º'],
      opportunities: ['ä¼ ç»Ÿè¡Œä¸š', 'ç®¡ç†å²—ä½', 'å®ä¸šæŠ•èµ„'],
      risks: ['åˆ›æ–°ä¸è¶³', 'å¸‚åœºå˜åŒ–', 'ç«äº‰å‹åŠ›'],
      actions: ['å­¦ä¹ æ–°æŠ€èƒ½', 'å…³æ³¨å¸‚åœºè¶‹åŠ¿', 'å›¢é˜Ÿå»ºè®¾']
    },
    relationship_analysis: {
      strengths: ['è´£ä»»æ„Ÿå¼º', 'ç¨³å®šå¯é ', 'å®¶åº­è§‚å¿µé‡'],
      opportunities: ['å»ºç«‹ç¨³å®šå…³ç³»', 'å®¶åº­å¹¸ç¦', 'é•¿ä¹…ä¼´ä¾£'],
      risks: ['ç¼ºä¹æµªæ¼«', 'æ²Ÿé€šç›´æ¥', 'æƒ…æ„Ÿè¡¨è¾¾ä¸è¶³'],
      actions: ['å­¦ä¹ è¡¨è¾¾æƒ…æ„Ÿ', 'åŸ¹å…»å…±åŒå…´è¶£', 'åŠ å¼ºæ²Ÿé€š']
    },
    health_analysis: {
      strengths: ['ä½“è´¨ç¨³å®š', 'è€åŠ›å¼º', 'æ¢å¤åŠ›å¥½'],
      opportunities: ['æˆ·å¤–æ´»åŠ¨', 'åŠ›é‡è®­ç»ƒ', 'å…»ç”Ÿä¿å¥'],
      risks: ['æ¶ˆåŒ–ç³»ç»Ÿ', 'å‹åŠ›ç§¯ç´¯', 'ä»£è°¢é—®é¢˜'],
      actions: ['è§„å¾‹é¥®é£Ÿ', 'å‹åŠ›ç®¡ç†', 'é€‚åº¦è¿åŠ¨']
    }
  },
  3: {
    zh: 'ä¸‰ç¢§æœ¨æ˜Ÿ', jp: 'Sanpeki Mokusei',
    element: 'æœ¨', color: 'ç»¿ã€é’',
    personality: 'ç§¯æè¿›å–ï¼Œè¡¨è¾¾åŠ›å¼ºï¼Œå¯Œæœ‰åˆ›æ„ï¼Œå…·æœ‰å¼€æ‹“ç²¾ç¥ã€‚',
    talents: ['åˆ›æ–°æ€ç»´', 'å¼€æ‹“è¿›å–', 'è¡¨è¾¾æ²Ÿé€š', 'å¿«é€Ÿå­¦ä¹ '],
    challenges: ['å†²åŠ¨æ€¥èº', 'ç¼ºä¹è€å¿ƒ', 'å®¹æ˜“å†²çª'],
    directions: { favorable: ['ä¸œ', 'ä¸œå—'], avoid: ['è¥¿', 'è¥¿åŒ—'] },
    career: 'åˆ›æ„äº§ä¸šã€é”€å”®ã€æ•™è‚²ã€åª’ä½“ã€åˆ›ä¸š',
    elements: { æœ¨: 4, æ°´: 2, ç«: 2, åœŸ: 1, é‡‘: 1 },
    career_analysis: {
      strengths: ['åˆ›æ–°èƒ½åŠ›å¼º', 'è¡¨è¾¾åŠ›çªå‡º', 'å­¦ä¹ å¿«é€Ÿ'],
      opportunities: ['åˆ›æ„è¡Œä¸š', 'è‡ªä¸»åˆ›ä¸š', 'æ•™è‚²åŸ¹è®­'],
      risks: ['ç¼ºä¹æŒä¹…æ€§', 'ç«äº‰æ¿€çƒˆ', 'èµ„æºæœ‰é™'],
      actions: ['ä¸“æ³¨æ ¸å¿ƒé¢†åŸŸ', 'å»ºç«‹ä¸“ä¸šå“ç‰Œ', 'æŒç»­å­¦ä¹ ']
    },
    relationship_analysis: {
      strengths: ['çƒ­æƒ…ä¸»åŠ¨', 'å–„äºè¡¨è¾¾', 'å¯Œæœ‰é­…åŠ›'],
      opportunities: ['ç§¯æç¤¾äº¤', 'æµªæ¼«å…³ç³»', 'æƒ…æ„Ÿäº¤æµ'],
      risks: ['æƒ…ç»ªæ³¢åŠ¨', 'ç¼ºä¹æ·±åº¦', 'å…³ç³»ä¸ç¨³å®š'],
      actions: ['åŸ¹å…»è€å¿ƒ', 'æ·±åº¦æ²Ÿé€š', 'å»ºç«‹ä¿¡ä»»']
    },
    health_analysis: {
      strengths: ['æ´»åŠ›å……æ²›', 'æ¢å¤åŠ›å¼º', 'é€‚åº”åŠ›å¥½'],
      opportunities: ['æœ‰æ°§è¿åŠ¨', 'æˆ·å¤–æ´»åŠ¨', 'åˆ›æ„è¡¨è¾¾'],
      risks: ['è‚è„è´Ÿæ‹…', 'æƒ…ç»ªæ³¢åŠ¨', 'è¿‡åº¦æ¶ˆè€—'],
      actions: ['è§„å¾‹ä½œæ¯', 'æƒ…ç»ªå¹³è¡¡', 'é€‚åº¦ä¼‘æ¯']
    }
  }
};

/* åˆ†æç±»å‹æ˜ å°„ */
const ANALYSIS_TYPE_MAP = {
  comprehensive: {
    name: 'ç»¼åˆå‘½ç†åˆ†æ',
    titles: ['æ€§æ ¼ç‰¹è´¨åˆ†æ', 'å¤©èµ‹æ½œèƒ½', 'äººç”Ÿè¯¾é¢˜', 'å‘å±•å»ºè®®']
  },
  career: {
    name: 'äº‹ä¸šè´¢è¿ä¸“é¡¹',
    titles: ['èŒä¸šä¼˜åŠ¿åˆ†æ', 'è´¢å¯Œæœºé‡', 'èŒåœºæŒ‘æˆ˜', 'å‘å±•ç­–ç•¥']
  },
  relationship: {
    name: 'æ„Ÿæƒ…å©šå§»ä¸“é¡¹',
    titles: ['æƒ…æ„Ÿç‰¹è´¨', 'ç¼˜åˆ†æœºé‡', 'å…³ç³»æŒ‘æˆ˜', 'ç›¸å¤„ä¹‹é“']
  },
  health: {
    name: 'å¥åº·è¿åŠ¿ä¸“é¡¹',
    titles: ['ä½“è´¨ç‰¹ç‚¹', 'å¥åº·æœºé‡', 'æ½œåœ¨é£é™©', 'å…»ç”Ÿå»ºè®®']
  }
};

/* å…ƒç´ å›¾ */
function renderElementChart(starData) {
  const chart = $('elementChart');
  if (!chart || !starData || !starData.elements) return;
  const elements = starData.elements;
  const maxValue = Math.max(...Object.values(elements));
  chart.innerHTML = Object.entries(elements).map(([element, value]) => `
    <div class="element-item ${value === maxValue ? 'strong' : ''}">
      <div class="element-name">${element}</div>
      <div class="element-value">${value}/5</div>
    </div>
  `).join('');
}

/* è¾…åŠ©å‡½æ•° */
function getSpecializedFocus(analysisType) {
  const focusMap = {
    career: 'èŒä¸šå‘å±•ä¸è´¢å¯Œç§¯ç´¯',
    relationship: 'æ„Ÿæƒ…å©šå§»ä¸äººé™…å…³ç³»',
    health: 'èº«å¿ƒå¥åº·ä¸ç”Ÿæ´»å“è´¨',
    comprehensive: 'æ•´ä½“äººç”Ÿè§„åˆ’ä¸å‘å±•'
  };
  return focusMap[analysisType] || 'æ•´ä½“äººç”Ÿå‘å±•';
}
function getElementSupport(element) {
  const supports = {
    'æ°´': 'æœ¨ã€ç«', 'æœ¨': 'ç«ã€åœŸ', 'ç«': 'åœŸã€é‡‘',
    'åœŸ': 'é‡‘ã€æ°´', 'é‡‘': 'æ°´ã€æœ¨'
  };
  return supports[element] || 'ç»¼åˆå¹³è¡¡';
}
function getSupportingElements(element) {
  const supports = {
    'æ°´': 'æœ¨å…ƒç´ å’Œç«å…ƒç´ ',
    'æœ¨': 'ç«å…ƒç´ å’ŒåœŸå…ƒç´ ',
    'ç«': 'åœŸå…ƒç´ å’Œé‡‘å…ƒç´ ',
    'åœŸ': 'é‡‘å…ƒç´ å’Œæ°´å…ƒç´ ',
    'é‡‘': 'æ°´å…ƒç´ å’Œæœ¨å…ƒç´ '
  };
  return supports[element] || 'ç›¸ç”Ÿå…ƒç´ ';
}
function getElementBalanceAdvice(element) {
  const advice = {
    'æ°´': 'å¢åŠ æœ¨ç«å…ƒç´ çš„æ´»åŠ¨ï¼Œå¦‚å­¦ä¹ æˆé•¿å’Œç¤¾äº¤äº’åŠ¨ã€‚',
    'æœ¨': 'åŠ å¼ºç«åœŸå…ƒç´ çš„å®è·µï¼Œå¦‚åˆ›ä½œè¡¨è¾¾å’ŒåŠ¡å®ç»è¥ã€‚',
    'ç«': 'æ³¨é‡åœŸé‡‘å…ƒç´ çš„ç¨³å®šï¼Œå¦‚èµ„äº§ç®¡ç†å’Œè§„åˆ™å»ºç«‹ã€‚',
    'åœŸ': 'å¼•å…¥é‡‘æ°´å…ƒç´ çš„æµåŠ¨ï¼Œå¦‚æŠ€èƒ½æå‡å’Œäººè„‰æ‹“å±•ã€‚',
    'é‡‘': 'è¿ç”¨æ°´æœ¨å…ƒç´ çš„ç”Ÿæœºï¼Œå¦‚çŸ¥è¯†æ›´æ–°å’Œåˆ›æ–°æ€ç»´ã€‚'
  };
  return advice[element] || 'äº”è¡Œå¹³è¡¡çš„æ–¹æ³•ã€‚';
}
function getYearlyAdvice(starNum, year, analysisType) {
  const adviceMap = {
    career: [
      'èŒåœºæ™‹å‡å…³é”®æœŸï¼ŒæŠŠæ¡é‡è¦é¡¹ç›®æœºä¼šã€‚',
      'é€‚åˆæŠ€èƒ½æå‡ï¼Œè€ƒå–ä¸“ä¸šèµ„æ ¼è¯ä¹¦ã€‚',
      'è´¢è¿ä¸Šå‡ï¼Œä½†éœ€è°¨æ…æŠ•èµ„å†³ç­–ã€‚',
      'åˆä½œè¿ä½³ï¼Œé€‚åˆå›¢é˜Ÿåä½œå‘å±•ã€‚'
    ],
    relationship: [
      'æ¡ƒèŠ±è¿æ—ºç››ï¼Œé€‚åˆæ‹“å±•ç¤¾äº¤åœˆã€‚',
      'æ„Ÿæƒ…ç¨³å®šæœŸï¼Œé€‚åˆæ·±åº¦å…³ç³»å‘å±•ã€‚',
      'å®¶åº­å’Œè°ï¼Œé€‚åˆå¤„ç†å®¶åº­äº‹åŠ¡ã€‚',
      'äººé™…è¿ä½³ï¼Œè´µäººç›¸åŠ©æ˜æ˜¾ã€‚'
    ],
    health: [
      'ä½“è´¨è°ƒæ•´æœŸï¼Œæ³¨é‡å…»ç”Ÿä¿å¥ã€‚',
      'è¿åŠ¨è¿ä½³ï¼Œé€‚åˆå»ºç«‹é”»ç‚¼ä¹ æƒ¯ã€‚',
      'æƒ…ç»ªç¨³å®šï¼Œå¿ƒç†å¥åº·çŠ¶æ€è‰¯å¥½ã€‚',
      'æ¢å¤åŠ›å¼ºï¼Œé€‚åˆè°ƒç†æ—§ç–¾ã€‚'
    ],
    comprehensive: [
      'ç»¼åˆå‘å±•æœŸï¼Œå„æ–¹é¢å‡è¡¡è¿›æ­¥ã€‚',
      'å­¦ä¹ è¿ä½³ï¼Œé€‚åˆçŸ¥è¯†æŠ€èƒ½æå‡ã€‚',
      'äººé™…å…³ç³»å’Œè°ï¼Œåˆä½œæœºä¼šå¢å¤šã€‚',
      'æ•´ä½“è¿åŠ¿å¹³ç¨³ï¼Œé€‚åˆé•¿æœŸè§„åˆ’ã€‚'
    ]
  };
  const list = adviceMap[analysisType] || adviceMap.comprehensive;
  return list[year % list.length];
}

/* æ·±åº¦åˆ†æç”Ÿæˆ */
function generateDeepAnalysis(starNum, gender, analysisType) {
  const star = STARS_DEEP[starNum];
  if (!star) return null;
  const isMale = gender === 'male';
  const config = ANALYSIS_TYPE_MAP[analysisType] || ANALYSIS_TYPE_MAP.comprehensive;
  const specData = star[`${analysisType}_analysis`] || star.career_analysis;

  return {
    personality: `
      <p>${star.personality}${isMale ? ' ç”·æ€§ç‰¹è´¨ä½¿å¾—ä½ åœ¨å†³ç­–ä¸æ‰§è¡Œæ–¹é¢æ›´å…·æœæ–­æ€§ã€‚' : ' å¥³æ€§ç‰¹è´¨ä½¿å¾—ä½ åœ¨æ„ŸçŸ¥ä¸åè°ƒæ–¹é¢æ›´å…·ç»†è…»åº¦ã€‚'}</p>
      <p><strong>æ ¸å¿ƒç‰¹è´¨ï¼š</strong>${star.talents.join('ã€')}</p>
      ${analysisType !== 'comprehensive'
        ? `<p><strong>æœ¬æ¬¡åˆ†æé‡ç‚¹ï¼š</strong>${getSpecializedFocus(analysisType)}</p>` : ''}`,
    talents: `
      <p>ä½ çš„å¤©èµ‹æ½œèƒ½ä¸»è¦é›†ä¸­åœ¨<strong>${star.talents.slice(0,2).join('ã€')}</strong>é¢†åŸŸã€‚</p>
      <p>å»ºè®®å‘å±•æ–¹å‘ï¼š${star.career}</p>
      <p><strong>å‘å±•ç­–ç•¥ï¼š</strong>å‘æŒ¥ã€Œ${star.element}ã€å…ƒç´ ç‰¹æ€§ï¼Œç»“åˆäº”è¡Œç›¸ç”ŸåŸç†è§„åˆ’é•¿æœŸè·¯å¾„ã€‚</p>`,
    challenges: `
      <p>éœ€è¦ç•™æ„çš„äººç”Ÿè¯¾é¢˜ï¼š${star.challenges.join('ã€')}ã€‚</p>
      <p><strong>è°ƒæ•´å»ºè®®ï¼š</strong>å¯å€ŸåŠ©${getElementSupport(star.element)}å…ƒç´ ç‰¹æ€§ï¼Œç¼“å’Œã€Œ${star.element}ã€èƒ½é‡è¿‡å¼ºæˆ–è¿‡å¼±å¸¦æ¥çš„æ³¢åŠ¨ã€‚</p>`,
    development: `
      <p>åŸºäºä½ çš„ä¹æ˜Ÿç‰¹è´¨ï¼Œå¯å°è¯•ä»¥ä¸‹å‘å±•æ–¹å‘ï¼š</p>
      <ul>
        <li>æŠŠã€Œ${star.talents[0]}ã€è§†ä¸ºé•¿æœŸä¸»è½´æ¥æ·±è€•ã€‚</li>
        <li>é€šè¿‡${getSupportingElements(star.element)}æ¥å¹³è¡¡æ•´ä½“èƒ½é‡ã€‚</li>
        <li>åœ¨${star.directions.favorable.join('ã€')}ç­‰æ–¹ä½å¸ƒå±€å·¥ä½œä¸ç”Ÿæ´»é‡å¿ƒã€‚</li>
      </ul>`,
    elements: `
      <p>äº”è¡Œèƒ½é‡æ˜¾ç¤ºä½ çš„<strong>${star.element}</strong>å…ƒç´ ç›¸å¯¹çªå‡ºã€‚</p>
      <p>${getElementBalanceAdvice(star.element)}</p>`,
    specialized: {
      title: config.name,
      subtitles: config.titles,
      contents: [
        `<p><strong>ä¼˜åŠ¿ç‰¹ç‚¹ï¼š</strong>${specData.strengths.join('ã€')}ã€‚</p>`,
        `<p><strong>å‘å±•æœºé‡ï¼š</strong>${specData.opportunities.join('ã€')}ã€‚</p>`,
        `<p><strong>éœ€è¦æ³¨æ„ï¼š</strong>${specData.risks.join('ã€')}ã€‚</p>`,
        `<p><strong>è¡ŒåŠ¨å»ºè®®ï¼š</strong>${specData.actions.join('ã€')}ã€‚</p>`
      ]
    }
  };
}

/* ä¸“é¡¹åˆ†æåŒºæ›´æ–° */
function updateSpecializedAnalysis(spec) {
  if (!spec) return;
  $('specializedCard').style.display = 'block';
  $('specializedTitle').textContent = spec.title;
  for (let i=0;i<4;i++){
    $(`specializedSubtitle${i+1}`).textContent = spec.subtitles[i] || '';
    $(`specializedContent${i+1}`).innerHTML   = spec.contents[i]  || '';
  }
}

/* è¿åŠ¿æ—¶é—´çº¿ */
function generateFortuneTimeline(starNum, analysisType) {
  const currentYear = new Date().getFullYear();
  const arr = [];
  for (let i=0;i<3;i++){
    const y = currentYear + i;
    arr.push({
      year: `${y}å¹´`,
      advice: getYearlyAdvice(starNum, y, analysisType)
    });
  }
  return arr;
}

/* Butler AI è¯·æ±‚ */
async function askAI(prompt){
  const resp = await fetch(`${API_BASE}/api/chat`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      messages:[
        {role:'system',content:'ä½ æ˜¯ 5XLivingã€Œå¿ƒæ€œç®¡å®¶ã€ä¸èµ„æ·±ä¹æ˜Ÿæ°”å­¦é¡¾é—®ï¼Œè¯­æ°”æ¸©æš–ã€ä¸“ä¸šã€è½åœ°ï¼Œè¾“å‡ºç®€æ˜ç»“æ„åŒ–å»ºè®®ã€‚'},
        {role:'user',content:prompt}
      ]
    })
  });
  let data={}; try{data=await resp.json()}catch{}
  return data.reply ?? data.text ?? data?.choices?.[0]?.message?.content ?? '';
}

/* æ„é€ ç»™ GPT çš„ Promptï¼šç”¨ä¹æ˜Ÿ + åˆ†æç±»å‹ + å½“å‰æ—¶é—´ */
function buildPromptForAI({langCode, starNum, gender, analysisType, birthdate, nowStr}) {
  const starDeep = STARS_DEEP[starNum];
  const starBase = STARS[starNum];
  const config   = ANALYSIS_TYPE_MAP[analysisType] || ANALYSIS_TYPE_MAP.comprehensive;
  if (!starDeep || !starBase) return '';

  const genderLabel = gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§';
  const topicLabel = config.name;
  const starText =
    `ä¸»æ˜Ÿï¼š${starDeep.zh}ï¼ˆ${starDeep.jp}ï¼‰ï¼›äº”è¡Œï¼š${starDeep.element}ï¼›` +
    `å…³é”®è¯ï¼š${starBase.key.zh.join('ã€')}ï¼›æ€§æ ¼ç®€è¿°ï¼š${starDeep.personality}`;

  return `ä½ æ˜¯ 5XLivingã€Œå¿ƒæ€œç®¡å®¶ã€ä¸èµ„æ·±ä¹æ˜Ÿæ°”å­¦é¡¾é—®ã€‚
è¯·ä½¿ç”¨ã€ç®€ä½“ä¸­æ–‡ã€‘è¾“å‡ºï¼Œè¯­æ°”æ¸©æš–ã€ä¸“ä¸šã€ç›´æ¥ç»™å¯æ‰§è¡Œå»ºè®®ã€‚

ã€ç³»ç»Ÿæ—¶é—´ã€‘${nowStr}ï¼ˆGMT+8ï¼‰
ã€ç”¨æˆ·å‡ºç”Ÿæ—¥æœŸã€‘${birthdate}
ã€ç”¨æˆ·æ€§åˆ«ã€‘${genderLabel}
ã€åˆ†æç±»å‹ã€‘${topicLabel}
ã€ä¹æ˜Ÿå‘½ç›˜æ‘˜è¦ã€‘
${starText}

è¯·æŒ‰ä»¥ä¸‹ç»“æ„è¾“å‡ºï¼ˆç”¨ Markdown ä¸€çº§/äºŒçº§æ ‡é¢˜å³å¯ï¼Œä¸è¦é¢å¤–å‰åç¼€ï¼‰ï¼š

# æ ¸å¿ƒåˆ¤æ–­ï¼ˆ2â€“4 å¥ï¼‰
ç»“åˆä¹æ˜Ÿæœ¬å‘½ä¸å½“å‰è¿åŠ¿ï¼Œç»™å‡ºæ•´ä½“å±€åŠ¿ä¸é‡å¿ƒæç¤ºã€‚

# ç°åœ¨è¦åšçš„äº‹ï¼ˆ3 æ¡ï¼‰
ç”¨åˆ—è¡¨ï¼Œæ¯æ¡ä»¥åŠ¨è¯å¼€å¤´ï¼Œä¾‹å¦‚ã€Œæ•´ç†ã€ã€Œæ²Ÿé€šã€ã€Œè°ƒæ•´ã€ã€‚

# é¿å‘æé†’ï¼ˆ2â€“3 æ¡ï¼‰
ç‚¹å‡ºåœ¨æœ¬ç±»å‹ä¸­æœ€å®¹æ˜“è¸©çš„å‘ï¼Œæ¯”å¦‚æƒ…ç»ªã€ç”¨é’±ã€é€‰æ‹©ã€äººé™…æ¨¡å¼ã€‚

# å¯å°è¯•çš„çµæ€§ç»ƒä¹ ï¼ˆ2â€“3 æ¡ï¼‰
å¯ä»å†¥æƒ³ã€manifestationã€ä¹¦å†™æ„¿æœ›ã€å°ä»ªå¼ä¸­é€‰ï¼Œå†™å‡ºå…·ä½“åšæ³•ä¸é¢‘ç‡ã€‚

# AI æ¨ä¸¾å†…å®¹ï¼ˆ3â€“5 æ¡ï¼‰
ç»“åˆæœ¬ç½‘ç«™çš„å¯èƒ½æœåŠ¡ï¼Œä¾‹å¦‚ï¼š
- é¢„çº¦ä¸€å¯¹ä¸€å‘½ç† / ä¹æ˜ŸåŠ æ·±è§£è¯»
- å‡çº§ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ï¼‰
- è®¸æ„¿åŒ… / å¾¡å®ˆè®¢åˆ¶
- æŠŠè®¡åˆ’å†™å…¥ã€Œå¿ƒæ€œç¬”è®°ã€æˆ–å®¶æ—çºªå¿µç³»ç»Ÿ
è¦æ±‚ï¼šæ¯æ¡ç®€çŸ­æ¸…æ™°ï¼Œç”¨ã€Œå»ºè®®ä½ â€¦ã€ã€Œå¯ä»¥è€ƒè™‘â€¦ã€çš„è¯­æ°”ã€‚`;
}

/* æ¸²æŸ“ä¸»æ˜Ÿå¡ï¼ˆåŸºç¡€ï¼‰ */
function renderStarBasic(num){
  const L = i18n[getLang()] || i18n["zh-CN"];
  const star = STARS[num]; if (!star) return;
  $('starName').textContent = star.zh;
  $('starJP').textContent   = star.jp;
  const elem = star.elem.zh;
  const color= star.color.zh;
  const kws  = star.key.zh.join(' / ');
  const about= star.about.zh;
  $('starBadges').innerHTML =
    `<span class="badge">${L.badge_elem}ï¼š${elem}</span>`+
    `<span class="badge">${L.badge_color}ï¼š${color}</span>`+
    `<span class="badge">${L.badge_kw}ï¼š${kws}</span>`;
  $('starAbout').textContent = `${L.about_label}ï¼š${about}`;
  $('starCard').style.display='block';
}

/* ä¿å­˜å½“å‰çŠ¶æ€ï¼Œåˆ‡è¯­è¨€æ—¶ç”¨ */
let __STAR_STATE = null;

/* ä¸»æŒ‰é’®ï¼šç”ŸæˆæŠ¥å‘Š + AI */
$('go').addEventListener('click', async ()=>{
  const lang = getLang();
  const L = i18n[lang] || i18n["zh-CN"];

  const birthdate = $('birthdate').value;
  const gender = $('gender').value || 'male';
  const analysisType = $('analysisType').value || 'comprehensive';

  if (!birthdate){
    alert(L.please_birth || 'è¯·å…ˆé€‰æ‹©å‡ºç”Ÿæ—¥æœŸ');
    return;
  }
  const starNum = calcHonmei(birthdate);
  if (!starNum){
    alert(L.bad_date || 'æ—¥æœŸæ ¼å¼æœ‰è¯¯');
    return;
  }

  __STAR_STATE = {starNum, birthdate, gender, analysisType};

  const starDeep = STARS_DEEP[starNum];
  const analysis = generateDeepAnalysis(starNum, gender, analysisType);

  // æ›´æ–°åˆ†æç±»å‹æŒ‡ç¤ºå™¨
  const typeCfg = ANALYSIS_TYPE_MAP[analysisType] || ANALYSIS_TYPE_MAP.comprehensive;
  $('analysisTypeIndicator').textContent = typeCfg.name;

  // ä¸»æ˜Ÿå¡ï¼ˆåŸºç¡€ï¼‰
  renderStarBasic(starNum);

  // å…ƒç´ å›¾ä¸ç®€è¯„
  renderElementChart(starDeep);
  $('elementAnalysis').innerHTML = analysis ? analysis.elements : '';

  // æ·±åº¦åˆ†æå—
  if (analysis){
    $('analysisCard').style.display = 'block';
    $('personalityAnalysis').innerHTML = analysis.personality;
    $('talentAnalysis').innerHTML      = analysis.talents;
    $('challengeAnalysis').innerHTML   = analysis.challenges;
    $('developmentAdvice').innerHTML   = analysis.development;
    updateSpecializedAnalysis(analysis.specialized);
  }

  // è¿åŠ¿æ—¶é—´çº¿
  $('fortuneCard').style.display = 'block';
  const tl = generateFortuneTimeline(starNum, analysisType);
  $('fortuneTimeline').innerHTML = tl.map(item => `
    <div class="timeline-item">
      <div class="timeline-period">${item.year}</div>
      <div>${item.advice}</div>
    </div>`).join('');

  // ä¸“ä¸šå»ºè®®
  if (starDeep){
    $('adviceCard').style.display = 'block';
    $('directionAdvice').innerHTML =
      `å®œå¾€<strong>${starDeep.directions.favorable.join('ã€')}</strong>æ–¹ä½å‘å±•ï¼Œé¿å…${starDeep.directions.avoid.join('ã€')}æ–¹ä½ã€‚`;
    $('colorAdvice').innerHTML =
      `å¤šä½¿ç”¨<strong>${starDeep.color}</strong>ç­‰è‰²ç³»ï¼Œå¢å¼ºä¸ªäººèƒ½é‡åœºã€‚`;
    $('careerAdvice').innerHTML =
      `é€‚åˆä»äº‹<strong>${starDeep.career}</strong>ç­‰ç›¸å…³é¢†åŸŸã€‚`;
    const lastTalent = (starDeep.talents && starDeep.talents.length) ? starDeep.talents.slice(-1)[0] : 'æ²Ÿé€š';
    $('relationshipAdvice').innerHTML =
      `åœ¨äººé™…ä¸æ„Ÿæƒ…ä¸­å¤šè¿ç”¨<strong>${lastTalent}</strong>ï¼Œæœ‰åŠ©äºæ”¹å–„å…³ç³»è´¨é‡ã€‚`;
  }

  // === Butler AIï¼šå¼€å§‹ç”Ÿæˆ ===
  const aiCard = $('aiCard');
  const aiText = $('aiText');
  const aiReco = $('aiReco');
  aiCard.style.display = 'block';
  aiText.textContent   = L.generating || 'æ­£åœ¨ç”Ÿæˆè§£è¯»â€¦';
  aiReco.innerHTML     = '';
  renderChips();

  const now = new Date();
  const yyyy = now.getFullYear();
  const mm   = String(now.getMonth()+1).padStart(2,'0');
  const dd   = String(now.getDate()).padStart(2,'0');
  const hh   = String(now.getHours()).padStart(2,'0');
  const mi   = String(now.getMinutes()).padStart(2,'0');
  const nowStr = `${yyyy}-${mm}-${dd} ${hh}:${mi}`;

  $('go').disabled = true;
  try{
    const prompt = buildPromptForAI({
      langCode: lang,
      starNum,
      gender,
      analysisType,
      birthdate,
      nowStr
    });
    const text = await askAI(prompt);
    aiText.textContent = text || (L.retry || 'æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•ç”Ÿæˆï¼Œè¯·ç¨åå†è¯•ã€‚');
  }catch(e){
    console.warn('[kyuusei] askAI error', e);
    aiText.textContent = L.neterr || 'ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚';
  }finally{
    $('go').disabled = false;
  }
});

/* åˆå§‹åŒ–ï¼šè¯­è¨€ + é»˜è®¤æ—¥æœŸ + å½“å‰æ—¶é—´æ˜¾ç¤º */
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = getLang();
  setLang(saved);

  const sel = $('langSelect');
  if (sel){
    sel.value = saved;
    sel.addEventListener('change', e=>{
      const code = e.target.value || 'zh-CN';
      setLang(code);
      applyI18n();
      if (__STAR_STATE && __STAR_STATE.starNum){
        renderStarBasic(__STAR_STATE.starNum);
        renderChips();
      }
    });
  }

  applyI18n();
  renderChips();

  // é»˜è®¤å‡ºç”Ÿæ—¥æœŸ = ä»Šå¤©
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm   = String(today.getMonth()+1).padStart(2,'0');
  const dd   = String(today.getDate()).padStart(2,'0');
  if ($('birthdate')){
    $('birthdate').value = `${yyyy}-${mm}-${dd}`;
  }

  // æ˜¾ç¤ºå½“å‰æ—¶é—´ï¼ˆå¹³é¢æ–‡æœ¬ï¼‰
  const nowInfo = $('nowInfo');
  if (nowInfo){
    const hh = String(today.getHours()).padStart(2,'0');
    const mi = String(today.getMinutes()).padStart(2,'0');
    nowInfo.textContent = `${t('now_info_prefix') || 'å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š'}${yyyy}-${mm}-${dd} ${hh}:${mi}ï¼ˆGMT+8ï¼‰`;
  }
});
</script>
</body>
</html>
