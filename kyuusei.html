
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title data-i18n="title">ä¹æ˜Ÿæ°”å­¦ Â· 5XLiving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:16px}
    .title{font-family:"Noto Serif SC",serif;font-weight:700;letter-spacing:.02em}
    .subtitle{color:var(--muted);font-size:.9rem}
    .lang{display:flex;align-items:center;gap:8px}
    .lang select{
      appearance:none;border-radius:10px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:10px 34px 10px 12px;font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat;background-position:calc(100% - 12px) 50%;
    }

    .section{margin-top:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .h2{font-size:1.2rem;margin:0 0 12px;font-weight:800;color:#ffe084;display:flex;gap:8px;align-items:center}
    .h2::before{content:"";width:4px;height:18px;background:var(--brand);border-radius:2px}

    .row{display:grid;gap:12px}
    @media(min-width:760px){.row.cols-3{grid-template-columns:1fr 1fr 1fr}.row.cols-2{grid-template-columns:1fr 1fr}}

    input,select{
      width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:12px 12px;font-size:15px;outline:none;
    }
    input::placeholder{color:#6f8092}
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}
    .btn.block{display:block;width:100%}

    .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0}
    .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
    .error-message{background:rgba(255,90,95,.1);border:1px solid #ff5a5f;border-radius:8px;padding:10px;display:none}
    .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
    .muted{color:var(--muted)}

    /* â€”â€” å‡ºç”Ÿæ—¶é—´ï¼šæ—¶é—´è¾“å…¥ + â€œä¸è¯¦â€åŒä¸€è¡Œ â€”â€” */
    .time-row{display:flex;align-items:center;gap:10px}
    .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
    .btn-mini{padding:8px 10px;border-radius:10px}
    /* â€”â€” éšè—â€œä¼°æ—¶é—´â€æŒ‰é’®ï¼šä»…å‹¾é€‰ä¸è¯¦æ—¶å¼¹çª— â€”â€” */
    #guessTimeBtn{display:none !important; visibility:hidden !important;}

    /* â€”â€” å³ä¸‹è§’å¿ƒæ€œç®¡å®¶ï¼ˆé—®ï¼‰ â€”â€” */
    .ss-chat-fab{
      position:fixed;right:18px;bottom:18px;z-index:50;width:56px;height:56px;border-radius:50%;
      background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;display:grid;place-items:center;font-weight:800;
      box-shadow:0 8px 30px rgba(0,0,0,.35);cursor:pointer;border:1px solid #e6c76e
    }
    .ss-chat-panel{
      position:fixed;right:18px;bottom:88px;z-index:50;width:min(460px,92vw);display:none;
      background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)
    }
    .ss-chat-fab, .ss-chat-panel { display: none !important; }
    .ss-chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #243244}
    .ss-chat-title{font-weight:700}
    .ss-close{cursor:pointer;opacity:.8}
    .ss-chat-body{max-height:300px;overflow:auto;padding:10px 12px}
    .ss-msg{padding:8px 10px;background:#0f1624;border:1px solid #243244;border-radius:10px;margin:6px 0;max-width:80%}
    .ss-msg.me{margin-left:auto;background:#132033}

    /* èŠå¤©è¾“å…¥è¡Œï¼šè¾“å…¥æ¡†æ’‘æ»¡ã€æŒ‰é’®æŒ‰å†…å®¹è‡ªé€‚åº” */
    .ss-chat-input{
    display:flex; align-items:center; gap:8px;
    padding:10px 12px; border-top:1px solid #243244;
   }
    .ss-chat-input input{
    flex:1 1 auto; min-width:0;
   }
    .ss-chat-input .btn,
    .ss-chat-input button{
    flex:0 0 auto;
    width:auto !important;
    white-space:nowrap;
    padding:10px 14px;
   }

    /* â€”â€” ä¼šå‘˜åŒºå¸ƒå±€ â€”â€” */
    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}
    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}

    /* â€”â€” åªä¿ç•™ä¸€ä¸ª GPT çª—å£ï¼šéšè—ç»“æœåŒºçš„ GPT æŠ½å±‰ â€”â€” */
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{display:none !important}

    /* â€”â€” ä¼°æ—¶é—´å¼¹çª— â€”â€” */
    .tw-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:60}
    .tw-box{width:min(560px,94vw);background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)}
    .tw-head{padding:12px 14px;border-bottom:1px solid #243244;font-weight:700}
    .tw-body{padding:14px}
    .tw-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .tw-btn{padding:10px;border:1px solid #243244;border-radius:12px;background:#0f1624;color:var(--text);cursor:pointer}
    .tw-btn.active{border-color:var(--gold2);box-shadow:0 0 0 2px rgba(212,175,55,.25) inset}
    .tw-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #243244}
    /* ä¿®å¤ï¼šGrid å­é¡¹å…è®¸æ”¶ç¼©ï¼Œé¿å…å†…å®¹æŠŠé¢æ¿æ’‘ç ´ */
    .auth-grid > * { min-width: 0; }
    .panel .body .row.one > * { min-width: 0; }

    /* è®©ä¼šå‘˜æŒ‰é’®åœ¨çª„å®½åº¦ä¸‹èƒ½æ¢è¡Œã€å±…ä¸­ä¸”ä¸æº¢å‡º */
    .panel .body .btn {
      display: flex;               /* æ”¹ä¸º flex æ›´ç¨³ */
      align-items: center;
      justify-content: center;
      text-align: center;
      white-space: normal;         /* å…è®¸æ¢è¡Œ */
      line-height: 1.2;
      word-break: break-word;      /* å¤šè¯­è¨€/é•¿è¯å¯æ–­è¡Œ */
    }

/* å—çº§æŒ‰é’®ç¡®ä¿å æ»¡å®¹å™¨ä¸”ä¸è¶…å‡º */
.btn.block { display:block; width:100%; box-sizing:border-box; }

/* å¯é€‰ï¼šå¦‚æœä»æœ‰è½»å¾®ä½ç§»ï¼Œé™åˆ¶æº¢å‡º */
.panel .body { overflow: hidden; }

.panel .body .btn { padding: 10px 14px; }    
    /* === è¡¨å•ç½‘æ ¼ï¼šå¤§å± 3 åˆ—ï¼Œçª„å± 1 åˆ— === */
.row{display:grid;gap:12px;grid-template-columns:1fr;}        /* é»˜è®¤ 1 åˆ— */
.row > *{min-width:0;}                                         /* é˜²æ­¢å­é¡¹æŠŠå®¹å™¨æ’‘çˆ† */
@media (min-width:760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr;}              /* ä¸‰åˆ— */
}

/* æ ‡ç­¾æ›´ç´§å‡‘ */
label.muted{display:block;margin-bottom:4px}

/* æŒ‰é’®ä¸è¦ 100% å®½ */
#genBtn{width:auto !important}
.gen-wrap{display:flex;align-items:flex-end;justify-content:flex-end}

/* æ—¶é—´è¾“å…¥ä¸â€œä¸è¯¦â€å¹¶æ’ã€ç´§å‡‘ */
.time-row{display:flex;align-items:center;gap:10px}
.time-row input[type="time"]{
  width:auto !important; flex:0 0 160px; min-width:140px;
}
.time-row .time-unknown{white-space:nowrap}
    .title a{ color: inherit; text-decoration: none; }
.title a:hover{ text-decoration: underline; text-underline-offset: 3px; }
    /* â€”â€” ç»Ÿä¸€å¤´éƒ¨ â€”â€” */
.site-header{
  position:sticky; top:0; z-index:10;
  background:#0b0f14cc;
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

/* å“ç‰ŒåŒºï¼šå¾½ç«  + æ ‡é¢˜ */
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35);
  font-weight:800; color:#ffe084;
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em}

/* è¯­è¨€é€‰æ‹©ï¼šé˜²æ­¢â€œè¯­è¨€â€ç«–æ’ã€ä¸ç¬¬ä¸€å¼ ä¸€è‡´ */
.lang{display:flex; align-items:center; gap:8px}
.lang label{white-space:nowrap; color:var(--muted); margin-right:4px}
.lang select{
  appearance:none; min-width:170px;
  border-radius:10px; border:1px solid #243244;
  background:#0e1520; color:var(--text);
  padding:10px 34px 10px 12px; font-size:.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}

/* è®©æé—®åŒºåœ¨ grid é‡Œå æ®æ•´è¡Œ */
.field-question {
  grid-column: 1 / -1;   /* ä»ç¬¬ 1 åˆ—æ‹‰åˆ°æœ€åä¸€åˆ— */
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 16px 20px;
}    

.field-question textarea {
  display: block;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;        /* å…³é”®ï¼šé˜²æ­¢è¶…å‡º */
  min-height: 140px;             /* è‡ªå·±çœ‹å°ºå¯¸å¯è°ƒ */
  resize: vertical;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: #050810;
  color: var(--text);
  font: inherit;
}

@media (max-width:520px){
  .title{font-size:1rem}
  .lang select{min-width:140px}
}
/* ä¸ Index ä¿æŒä¸€è‡´çš„æ ¹å­—å·ï¼ˆä¼šå½±å“ rem è®¡ç®—ï¼‰ */
html { font-size: 16px; }
@media (min-width: 768px){ html { font-size: 17px; } }
@media (min-width: 1200px){ html { font-size: 18px; } }

/* æ ‡é¢˜ç”¨ Noto Serif SCï¼›å­—å·/å­—é‡ä¸ Index å®Œå…¨ä¸€è‡´ */
.site-header .brand .title,
.site-header .title{
  font-family: "Noto Serif SC","Noto Serif",serif !important;
  font-weight: 600 !important;
  letter-spacing: .02em;
  font-size: 1.1rem !important;
  line-height: 1.25;
}    

    /* â€”â€” ç®€æ˜“æŠ¥å‘Šæ ·å¼ â€”â€” */
    .report{margin-top:12px;display:grid;gap:10px}
    .report .sec{padding:12px;border:1px solid var(--line);background:#0e1520;border-radius:12px}
    .report .sec h3{margin:0 0 6px;color:var(--gold2);font-size:1.05rem}
    .report p,.report li{line-height:1.7}  

        /* â€”â€” ä¼°æ—¶é—´å¼¹çª— â€”â€” */
    .tw-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:60}
    .tw-box{width:min(560px,94vw);background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)}
    .tw-head{padding:12px 14px;border-bottom:1px solid #243244;font-weight:700}
    .tw-body{padding:14px}
    .tw-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .tw-btn{padding:10px;border:1px solid #243244;border-radius:12px;background:#0f1624;color:#e8edf3;cursor:pointer}
    .tw-btn.active{border-color:var(--gold2);box-shadow:0 0 0 2px rgba(212,175,55,.25) inset}
    .tw-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #243244}
    .auth-grid > * { min-width: 0; }
    .panel .body .row.one > * { min-width: 0; }

    /* â€”â€” ç®€æ˜“æŠ¥å‘Šæ ·å¼ â€”â€” */
    .report{margin-top:12px;display:grid;gap:10px}
    .report .sec{padding:12px;border:1px solid var(--line);background:#0e1520;border-radius:12px}
    .report .sec h3{margin:0 0 6px;color:var(--gold2);font-size:1.05rem}
    .report p,.report li{line-height:1.7}
  
    .sr-only{
      position:absolute !important;
      width:1px;height:1px;padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }        
  </style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="https://astro.5xliving.com/" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title">
        5xLiving Â· <span data-i18n="title_kyuusei_brief">ä¹æ˜Ÿæ°”å­¦</span>
      </span>
    </a>

    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <!-- è¡¨å• -->
  <div class="card">
    <div class="h2" data-i18n="form_title">ä¹æ˜Ÿæ°”å­¦ Â· å¿«é€Ÿè§£è¯»</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="birth_label">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate">
        <div class="muted" style="margin-top:6px" data-i18n="solar_tip">æç¤ºï¼šä¹æ˜Ÿä»¥èŠ‚åˆ†ï¼ˆç«‹æ˜¥ï¼Œçº¦ 2/4ï¼‰ä¸ºæ¢å¹´ç‚¹ï¼›1/1â€“2/3 è®¡ä¸Šä¸€å¹´ã€‚</div>
      </div>
      <div>
        <label class="muted" data-i18n="topic_label">ä¸»é¢˜</label>
        <select id="topic">
          <option value="love"  data-i18n="topic_love">çˆ±æƒ…/å…³ç³»</option>
          <option value="career" data-i18n="topic_career">äº‹ä¸š/å·¥ä½œ</option>
          <option value="wealth" data-i18n="topic_wealth">è´¢å¯Œ/æŠ•èµ„</option>
          <option value="family" data-i18n="topic_family">å®¶åº­/äººé™…</option>
          <option value="health" data-i18n="topic_health">å¥åº·/èº«å¿ƒ</option>
          <option value="study" data-i18n="topic_study">å­¦ä¸š/æˆé•¿</option>
          <option value="move"  data-i18n="topic_move">æ—…è¡Œ/æ¬è¿</option>
          <option value="other" data-i18n="topic_other">å…¶ä»–</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="preset_label">å¸¸ç”¨é—®é¢˜</label>
        <select id="presetQ">
          <option value="" data-i18n="preset_none">ï¼ˆå¯é€‰ï¼‰é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿</option>
          <option data-i18n="preset_1">å¥¹/ä»–çˆ±æˆ‘å—ï¼Ÿæˆ‘ä»¬æ¥ä¸‹æ¥æ€ä¹ˆèµ°æ›´å¥½ï¼Ÿ</option>
          <option data-i18n="preset_2">æˆ‘æ˜¯å¦åº”è¯¥æ¢å·¥ä½œ/åˆ›ä¸šï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</option>
          <option data-i18n="preset_3">è¿‘æœŸåœ¨æŠ•èµ„ä¸ç†è´¢ä¸Šï¼Œåº”å¦‚ä½•å–èˆï¼Ÿ</option>
          <option data-i18n="preset_4">å¦‚ä½•æ”¹å–„ä¸å®¶äººçš„å…³ç³»ä¸æ²Ÿé€šï¼Ÿ</option>
          <option data-i18n="preset_5">æˆ‘æœ€è¿‘å¥åº·/æƒ…ç»ªçš„å…³é”®æé†’æ˜¯ä»€ä¹ˆï¼Ÿ</option>
        </select>
      </div>
    </div>
    <div class="row cols-2" style="margin-top:10px">
      <div><button id="go" class="btn" data-i18n="btn_gen">ç”Ÿæˆåˆ†æ</button></div>
    </div>
  </div>

  <!-- ç»“æœï¼šä¸»æ˜Ÿ -->
  <div id="starCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_star">æ‚¨çš„ä¹æ˜Ÿä¸»æ˜Ÿ</div>
    <p><span data-i18n="star_label">ä¸»æ˜Ÿ</span>ï¼š<b id="starName"></b>ï¼ˆ<span id="starJP"></span>ï¼‰</p>
    <div id="starBadges" style="margin:6px 0"></div>
    <div id="starAbout" class="muted" style="margin-top:8px"></div>
  </div>

  <!-- ç»“æœï¼šAI è§£è¯» -->
  <div id="aiCard" class="section card" style="display:none">
    <div class="h2" data-i18n="sec_ai">å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®</div>
    <pre id="aiText" style="white-space:pre-wrap;line-height:1.7"></pre>
    <div id="aiReco" style="margin-top:10px"></div>
  </div>

<!-- ä¼šå‘˜ä¸“åŒº -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- å·¦ä¾§ï¼šè¾“å…¥ + æ³¨å†Œ/ç™»å½• -->
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
            <div class="body">
       <div class="row" id="authFields">
         <!-- ç™»å½•/æ³¨å†Œå»ºè®®ç”¨ usernameï¼Œå¯†ç ç®¡ç†å™¨æ›´å®¹æ˜“é…å¯¹ -->
         <label for="email" class="sr-only" data-i18n="ph_email">é‚®ç®± Email</label>
         <input
            id="email"
            name="email"
            type="email"
            inputmode="email"
            autocomplete="username"
            placeholder=""
            data-i18n-ph="ph_email"
            required
         />
         <label for="password" class="sr-only" data-i18n="ph_label_password">å¯†ç  Password</label>
         <input
            id="password"
            name="password"
            type="password"
            autocomplete="current-password"
            placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰"
            data-i18n-ph="ph_password"
            required
         />
       </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
                <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- å³ä¾§ï¼šä¼šå‘˜ä¸è¿”å› -->
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">ä¼šå‘˜æœåŠ¡</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
  </main>

  <!-- ä¼°æ—¶é—´å¼¹çª— -->
  <div class="tw-mask" id="twMask" aria-hidden="true">
    <div class="tw-box" role="dialog" aria-modal="true" aria-labelledby="twTitle">
      <div class="tw-head" id="twTitle">ğŸ§­ ä¼°ä¸€ä¸ªå¤§è‡´å‡ºç”Ÿæ—¶é—´</div>
      <div class="tw-body">
        <div class="muted" style="margin-bottom:8px">é€‰æ‹©ä½ è®°å¾—çš„<strong>å¤§æ¦‚æ—¶æ®µ</strong>ï¼ˆåœ°æ”¯åŒå°æ—¶æ®µï¼‰</div>
        <div class="tw-grid" id="twGrid"></div>
        <div class="muted" style="margin-top:10px;font-size:.9em">
          é€‰æ‹©åç‚¹â€œå¡«å…¥æ—¶é—´â€ï¼Œä¼šç”¨è¯¥æ—¶æ®µçš„ä¸­ä½æ—¶é—´å†™åˆ°ä¸Šæ–¹æ—¶é—´è¾“å…¥æ¡†ï¼Œå¹¶è‡ªåŠ¨å–æ¶ˆâ€œæ—¶é—´ä¸è¯¦â€ã€‚
        </div>
      </div>
      <div class="tw-foot">
        <button class="btn ghost" id="twCancel" type="button">å–æ¶ˆ</button>
        <button class="btn" id="twApply" type="button" disabled>å¡«å…¥æ—¶é—´</button>
      </div>
    </div>
  </div>

<script>
/* ===== é…ç½® ===== */
const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev'; // â† ä½ çš„ Workers
const LANG_KEY = "site_lang";

/* ===== å·¥å…· ===== */
const $ = id => document.getElementById(id);
const getLang = () => localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN";
const setLang = v => { localStorage.setItem(LANG_KEY, v); document.documentElement.lang = v; };

/* ===== i18n è¯åº“ ===== */
const i18n = {
  "zh-CN": {
    title:"ä¹æ˜Ÿæ°”å­¦ Â· 5XLiving", brand:"Soul Sanctuary", lang_label:"è¯­è¨€",
    form_title:"ä¹æ˜Ÿæ°”å­¦ Â· å¿«é€Ÿè§£è¯»", birth_label:"å‡ºç”Ÿæ—¥æœŸ",
    solar_tip:"æç¤ºï¼šä¹æ˜Ÿä»¥èŠ‚åˆ†ï¼ˆç«‹æ˜¥ï¼Œçº¦ 2/4ï¼‰ä¸ºæ¢å¹´ç‚¹ï¼›1/1â€“2/3 è®¡ä¸Šä¸€å¹´ã€‚",
    topic_label:"ä¸»é¢˜",
    topic_love:"çˆ±æƒ…/å…³ç³»", topic_career:"äº‹ä¸š/å·¥ä½œ", topic_wealth:"è´¢å¯Œ/æŠ•èµ„",
    topic_family:"å®¶åº­/äººé™…", topic_health:"å¥åº·/èº«å¿ƒ", topic_study:"å­¦ä¸š/æˆé•¿",
    topic_move:"æ—…è¡Œ/æ¬è¿", topic_other:"å…¶ä»–",
    preset_label:"å¸¸ç”¨é—®é¢˜", preset_none:"ï¼ˆå¯é€‰ï¼‰é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿",
    preset_1:"å¥¹/ä»–çˆ±æˆ‘å—ï¼Ÿæˆ‘ä»¬æ¥ä¸‹æ¥æ€ä¹ˆèµ°æ›´å¥½ï¼Ÿ",
    preset_2:"æˆ‘æ˜¯å¦åº”è¯¥æ¢å·¥ä½œ/åˆ›ä¸šï¼Ÿéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ",
    preset_3:"è¿‘æœŸåœ¨æŠ•èµ„ä¸ç†è´¢ä¸Šï¼Œåº”å¦‚ä½•å–èˆï¼Ÿ",
    preset_4:"å¦‚ä½•æ”¹å–„ä¸å®¶äººçš„å…³ç³»ä¸æ²Ÿé€šï¼Ÿ",
    preset_5:"æˆ‘æœ€è¿‘å¥åº·/æƒ…ç»ªçš„å…³é”®æé†’æ˜¯ä»€ä¹ˆï¼Ÿ",
    q_label:"ä½ çš„å…·ä½“é—®é¢˜ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰",
    q_ph:"ä¾‹å¦‚ï¼šä»Šå¤©çš„è¯¾é¢˜æ˜¯â€œå¥¹çˆ±æˆ‘å—â€ã€‚å¸Œæœ›å¾—åˆ°æ¸…æ™°çš„ä¸‹ä¸€æ­¥å»ºè®®ä¸é¿å‘æé†’ã€‚",
    btn_gen:"ç”Ÿæˆåˆ†æ", btn_clear:"æ¸…ç©º",
    sec_star:"æ‚¨çš„ä¹æ˜Ÿä¸»æ˜Ÿ", star_label:"ä¸»æ˜Ÿ",
    badge_elem:"äº”è¡Œ", badge_color:"è‰²", badge_kw:"å…³é”®è¯",
    about_label:"æ€§æ ¼å€¾å‘", sec_ai:"å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®",
    chat_fab:"é—®", chat_title:"å¿ƒæ€œç®¡å®¶ Â· Chat", chat_ph:"æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šå¦‚ä½•å¼€å§‹å…è´¹ä½“éªŒï¼‰", chat_send:"å‘é€",
    please_birth:"è¯·å…ˆé€‰æ‹©å‡ºç”Ÿæ—¥æœŸ", bad_date:"æ—¥æœŸæ ¼å¼æœ‰è¯¯", generating:"æ­£åœ¨ç”Ÿæˆè§£è¯»â€¦",
    reco_title:"å¿ƒæ€œç®¡å®¶æ¨ä¸¾å†…å®¹", retry:"æŠ±æ­‰ï¼Œæš‚æ—¶æ— æ³•ç”Ÿæˆï¼Œè¯·ç¨åå†è¯•ã€‚", neterr:"ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚",

    vip_title: "ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment",
    vip_mingli: "ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹",
    vip_xinlian: "ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹",
    vip_love: "å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿",
    vip_career: "äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›",
    vip_wealth: "è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº",
    vip_pet: "å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†",
    vip_hepan: "åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶",
    vip_name: "æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿",
    vip_fengshui: "è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ",
    vip_record: "çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·",
    vip_course: "å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾",
    vip_memorial: "å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­",
    vip_tasks: "æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡",
    vip_shop: "èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
    login_title: "ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",

    chat_placeholder: "è¯·é—®æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šå¦‚ä½•å¼€å§‹å…è´¹ä½“éªŒï¼‰",
    chat_send: "å‘é€",
    msg_reset_ok: "å¯†ç å·²æˆåŠŸæ›´æ–°ï¼Œè¯·ç”¨æ–°å¯†ç é‡æ–°ç™»å…¥ã€‚",

    ph_email: "é‚®ç®± Email",
    ph_password: "å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰",
    ph_label_password: "å¯†ç  Password",

    title_quickcalc: "å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜",
    title_bazi_brief: "å…«å­—ç®€è¯„",
    label_name: "å§“åï¼ˆå¯é€‰ï¼‰",
    ph_name: "ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰",
    gender_label: "æ€§åˆ«",
    label_calendar: "å†æ³•",
    label_birthdate: "å‡ºç”Ÿæ—¥æœŸ",
    label_birthtime: "å‡ºç”Ÿæ—¶é—´",
    cb_time_unknown: "å‡ºç”Ÿæ—¶é—´ä¸è¯¦",
    btn_generate_chart: "ç”Ÿæˆå…«å­—",
    panel_login_head: "è´¦æˆ·ç™»å½• / æ³¨å†Œ",
    panel_member_head: "ä¼šå‘˜æœåŠ¡",

    // â€”â€” Butler / Report keysï¼ˆä¸­æ–‡ï¼‰ â€”â€”
    butler_title: "å¿ƒæ€œç®¡å®¶ Â· è§£è¯»",
    day_master: "æ—¥ä¸»",
    chart_strength: "å‘½å±€",
    season: "å­£èŠ‚",
    wuxing_distribution: "äº”è¡Œåˆ†å¸ƒ",
    note: "æ³¨æ„",
    time_unknown_checked: "å·²å‹¾é€‰â€œå‡ºç”Ÿæ—¶é—´ä¸è¯¦â€",
    hour_pillar_excluded: "æœªçº³å…¥æ—¶æŸ±",
    hint: "æç¤º",
    no_hour_tip: "æ— æ—¶æŸ±ï¼Œå»ºè®®ä»…ä½œå‚è€ƒã€‚",
    dev_strategy: "å‘å±•ç­–ç•¥ï¼š",
    useful_elements: "å–œç”¨å…ƒç´ ï¼š",
    lucky_colors: "å¹¸è¿é¢œè‰²ï¼š",
    lucky_directions: "é€‚åˆæ–¹ä½ï¼š",
    strength_strong: "åå¼º",
    strength_weak: "åå¼±",
    strength_balanced: "å¹³è¡¡",
    desc_strong: "æ½œåŠ›è¶³ã€æŠ—å‹å¥½",
    desc_weak: "éœ€å¤–æ´æ›´èƒ½å‘æŒ¥",
    desc_balanced: "å‡è¡¡ã€é€‚åº”æ€§å¼º",
    desc_generic: "å…·æœ‰ç‹¬ç‰¹ç‰¹ç‚¹",
    season_spring: "æœ¨æ—ºç”Ÿå‘",
    season_summer: "ç«æ—ºå¤–æ”¾",
    season_autumn: "é‡‘æ—ºæ”¶æ•›",
    season_winter: "æ°´æ—ºå†…è—",
    season_generic: "å­£èŠ‚å¯¹å‘½å±€æœ‰ä¸€å®šå½±å“",
    el_wood: "æœ¨",
    el_fire: "ç«",
    el_earth: "åœŸ",
    el_metal: "é‡‘",
    el_water: "æ°´",
    dir_wood: "ä¸œæ–¹",
    dir_fire: "å—æ–¹",
    dir_earth: "ä¸­å¤®/ä¸œåŒ—/è¥¿å—",
    dir_metal: "è¥¿æ–¹",
    dir_water: "åŒ—æ–¹",
    color_wood: "ç»¿è‰²/é’è‰²",
    color_fire: "çº¢è‰²/ç´«è‰²",
    color_earth: "é»„è‰²/æ£•è‰²",
    color_metal: "ç™½è‰²/é‡‘è‰²",
    color_water: "é»‘è‰²/è“è‰²",

    // æŠ¥å‘Šåˆ†æ®µ
    rpt_free_title: "å…è´¹ç®€æŠ¥",
    rpt_pillars_label: "å››æŸ±",
    rpt_daymaster_label: "æ—¥ä¸»",
    rpt_season_label: "å­£èŠ‚",
    rpt_chart_label: "å‘½å±€",
    rpt_strategy_label: "ç­–ç•¥",
    rpt_wuxing_label: "äº”è¡Œåˆ†å¸ƒ",
    rpt_strongest_word: "åæ—º",
    rpt_weakest_word: "åå¼±",
    rpt_absent_prefix: "ç¼ºï¼š",
    rpt_fav_avoid_template: "å–œç”¨ï¼š{fav}ï½œå¿Œï¼š{avoid}",
    rpt_balance_focus_label: "è°ƒè¡¡è¦ç‚¹",
    rpt_time_hint: "æç¤ºï¼šå‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œæœªçº³å…¥æ—¶æŸ±ï¼Œä»…ä¾›å‚è€ƒã€‚",
    rpt_time_unknown: "æ—¶é—´ä¸è¯¦",
    rpt_sec_overview_title: "ä¸€ã€å‘½ç›˜æ€»è§ˆ",
    rpt_sec_elements_title: "äºŒã€äº”è¡Œèƒ½é‡åˆ†æ",
    rpt_sec_traits_title: "ä¸‰ã€æ€§æ ¼ä¸å¤©èµ‹",
    rpt_traits_intro: "ä¾æ®æ—¥ä¸»ã€å­£èŠ‚ä¸å¼ºå¼±ç»™å‡ºæ ¸å¿ƒæ€§æ ¼æ ‡ç­¾ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_traits_adv: "ä¼˜åŠ¿èƒ½é‡ï¼šæ‰§è¡Œ / åˆ›é€  / å­¦ä¹ ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_traits_chal: "æ½œåœ¨æŒ‘æˆ˜ï¼šèŠ‚å¥ / è¾¹ç•Œ / è¿‡çŠ¹ä¸åŠï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_sec_structure_title: "å››ã€æ ¼å±€ä¸å–œå¿Œ",
    rpt_structure_line_template: "å–œç”¨ï¼š{fav}ï¼›å¿Œè®³ï¼š{avoid}",
    rpt_sec_career_title: "äº”ã€äº‹ä¸šä¸å‘å±•ï¼ˆå…è´¹è¯•è¯»ï¼‰",
    rpt_career_fields_placeholder: "é€‚åˆé¢†åŸŸï¼šç»“åˆå–œç”¨ä¸æ°”è´¨ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_dev_strategy_prefix: "å‘å±•ç­–ç•¥ï¼š",
    rpt_sec_love_title: "å…­ã€æ„Ÿæƒ…ä¸å…³ç³»ï¼ˆå…è´¹è¯•è¯»ï¼‰",
    rpt_love_placeholder: "æ²Ÿé€šèŠ‚å¥ä¸è¾¹ç•Œå»ºè®®ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_sec_wealth_title: "ä¸ƒã€è´¢å¯Œä¸ç†è´¢ï¼ˆå…è´¹è¯•è¯»ï¼‰",
    rpt_wealth_suggestion_template: "ç†è´¢å»ºè®®ï¼šä»¥ {fav} ä¸ºä¸»è°ƒï¼Œç¨³ä¸­æ±‚è¿›ã€‚",
    rpt_sec_health_title: "å…«ã€å¥åº·ä¸ä½œæ¯",
    rpt_health_placeholder_template: "å›´ç»•æœ€å¼±äº”è¡Œï¼ˆ{weak}ï¼‰åšä½œæ¯ä¸ç¯å¢ƒä¼˜åŒ–ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_sec_env_title: "ä¹ã€ç¯å¢ƒä¸è‰²å½©",
    rpt_env_placeholder: "æœ‰åˆ©æ–¹ä½ä¸é…è‰²éšå–œç”¨ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚",
    rpt_strategy_drain: "æ³„ç§€/åˆ¶åŒ–",
    rpt_strategy_support: "ç”Ÿæ‰¶/è¡¥åŠ©",
    rpt_strategy_balance: "è°ƒå’Œ",

    // AI èŠ¯ç‰‡ & ä»»åŠ¡
    chip_career: "äº‹ä¸š",
    chip_love: "æ„Ÿæƒ…",
    chip_money: "è´¢è¿",
    chip_list: "ä»Šæ—¥å¾…åŠ",
    chip_30d: "30å¤©å»ºè®®",
  },

  /* === ä¸‹é¢ç»§ç»­ï¼šzh-TW / en / ja-JP / th-TH / msï¼ˆä¸ä½ ç»™çš„ä¸€æ ·ï¼‰ === */
  /* ä¸ºèŠ‚çœç¯‡å¹…è¿™é‡Œä¸å†é‡å¤è§£é‡Šï¼Œåªä¿æŒä¸ä½ è´´çš„å†…å®¹ä¸€è‡´ */
  "zh-TW": { /* ç›´æ¥ç”¨ä½ ä¸Šé¢é‚£ä»½ zh-TW å¯¹è±¡ */ },
  "en":    { /* ä½ çš„ en å¯¹è±¡ */ },
  "ja-JP": { /* ä½ çš„ ja-JP å¯¹è±¡ */ },
  "th-TH": { /* ä½ çš„ th-TH å¯¹è±¡ */ },
  "ms":    { /* ä½ çš„ ms å¯¹è±¡ */ }
};

/* ===== å°†é¡µé¢é™æ€æ–‡æ¡ˆæ›¿æ¢ä¸ºå½“å‰è¯­è¨€ ===== */
function t(key){
  const L = i18n[getLang()] || i18n["zh-CN"];
  return L[key] || (i18n["zh-CN"][key] || key);
}

function applyI18n(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.textContent = t(key);
  });
  document.querySelectorAll("[data-i18n-ph]").forEach(el=>{
    const key = el.getAttribute("data-i18n-ph");
    el.setAttribute("placeholder", t(key));
  });
  const titleEl = document.querySelector("title[data-i18n]");
  if (titleEl) titleEl.textContent = t(titleEl.getAttribute("data-i18n"));
}

/* ================== Butler AI æ ·å¼ & èŠ¯ç‰‡ ================== */
(function injectAiStyle(){
  const old=document.getElementById('ai-style'); if(old) old.remove();
  const style=document.createElement('style'); style.id='ai-style';
  style.textContent=`
    .sec h3{margin:0 0 8px;color:var(--brand)}
    .ai-content{white-space:pre-wrap;line-height:1.7}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #2a3546;background:#0e1520;color:#e8edf3;cursor:pointer}
    .chip:hover{border-color:#f2d27a;box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
    .skeleton{display:grid;gap:8px}
    .skeleton div{height:12px;border-radius:6px;background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);animation:sh 1.2s infinite}
    @keyframes sh{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
    .ai-lock-overlay{position:static;inset:auto;background:none;backdrop-filter:none;margin-top:10px;padding-top:10px;border-top:1px solid var(--line);text-align:center}
    .ai-lock-overlay .tip{color:#ffd88a;font-weight:700;margin-bottom:4px}
    .ai-lock-overlay .sub{color:var(--muted)}
  `;
  document.head.appendChild(style);
})();

function mdToHtml(md){
  return (md||'')
    .replace(/^###?\s+(.*)$/gm,'<h3 style="margin:12px 0 6px;color:#f2d27a">$1</h3>')
    .replace(/^\s*[-*]\s+(.*)$/gm,'â€¢ $1')
    .replace(/\*\*(.+?)\*\*/g,'<b>$1</b>')
    .replace(/\n{2,}/g,'\n\n')
    .replace(/\n/g,'<br/>');
}

function isVIP(){
  return localStorage.getItem('vipStatus')==='active' || !!localStorage.getItem('vipEmail');
}

/* ç»Ÿä¸€èŠ¯ç‰‡æ¸²æŸ“ï¼šç›´æ¥ç”¨ç°æœ‰ #aiCard å®¹å™¨ */
function renderChips() {
  let box = document.getElementById('aiChips');
  if (!box) {
    const card = $('aiCard');
    if (!card) return;
    box = document.createElement('div');
    box.id = 'aiChips';
    box.className = 'chips';
    card.appendChild(box);
  }

  box.innerHTML = '';

  const chips = [
    { key: 'chip_career', fallback: 'äº‹ä¸š' },
    { key: 'chip_love',   fallback: 'æ„Ÿæƒ…' },
    { key: 'chip_money',  fallback: 'è´¢è¿' },
    { key: 'chip_list',   fallback: 'ä»Šæ—¥å¾…åŠ' },
    { key: 'chip_30d',    fallback: '30å¤©å»ºè®®' },
  ];

  chips.forEach((c) => {
    const label = t(c.key) || c.fallback;
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'chip';
    btn.textContent = label;
    btn.setAttribute('data-i18n', c.key);

    btn.addEventListener('click', () => {
      const aiBox = $('aiText');
      if (aiBox) {
        aiBox.textContent = t('generating') || 'æ­£åœ¨ç”Ÿæˆè§£è¯»â€¦';
      }
      // è¿™é‡Œé¢„ç•™ï¼šå¦‚æœä½ è¦è®© chip å•ç‹¬è§¦å‘ä¸åŒ Promptï¼Œå¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨ askAI(...)
      // ç°åœ¨åªæ˜¯æ˜¾ç¤º loadingï¼Œä¸è¿½åŠ é¢å¤–è¯·æ±‚
    });

    box.appendChild(btn);
  });
}

/* ===== Chat æµ®çª—ï¼ˆå®‰å…¨é˜²å‘†ï¼šå¦‚æœæ²¡æ”¾ DOM å°±ç›´æ¥è·³è¿‡ï¼‰ ===== */
(function(){
  const fab   = $('ssChatFab');
  const panel = $('ssChatPanel');
  const body  = $('ssChatBody');
  const input = $('ssChatInput');
  const send  = $('ssChatSend');
  const closeBtn = $('ssChatClose');
  if (!fab || !panel || !body || !input || !send || !closeBtn) return;

  function addMsg(text,me=false){
    const d=document.createElement('div');
    d.className='ss-msg'+(me?' me':'');
    d.textContent=text;
    body.appendChild(d);
    body.scrollTop=body.scrollHeight;
  }

  async function askChat(prompt){
    addMsg(prompt,true); input.value='';
    try{
      const r=await fetch(`${API_BASE}/api/chat`,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({messages:[
          {role:'system',content:'ä½ æ˜¯â€œå¿ƒæ€œç®¡å®¶â€ï¼Œè¯­æ°”æ¸©æš–ä¸“ä¸šã€ç®€æ´æœ‰æ¡ç†ï¼Œæä¾›ç½‘ç«™å¯¼èˆªä¸ä¸€èˆ¬å’¨è¯¢ã€‚'},
          {role:'user',content:prompt}
        ]})
      });
      let data={}; try{data=await r.json()}catch{}
      const reply=data.reply??data.text??data?.choices?.[0]?.message?.content??'';
      addMsg(reply||t('retry'));
    }catch{
      addMsg(t('neterr'));
    }
  }

  fab.addEventListener('click',()=>{panel.style.display='flex';input.focus()});
  closeBtn.addEventListener('click',()=>panel.style.display='none');
  send.addEventListener('click',()=>{const v=input.value.trim();if(v)askChat(v)});
  input.addEventListener('keydown',e=>{if(e.key==='Enter'){const v=input.value.trim();if(v)askChat(v)}});
})();

/* ===== ä¹æ˜Ÿç®—æ³•ï¼ˆèŠ‚åˆ† 2/4 æ¢å¹´ï¼‰ ===== */
function reduce1(n){
  let s=Math.abs(n).toString().split('').reduce((a,b)=>a+Number(b),0);
  while(s>9) s=s.toString().split('').reduce((a,b)=>a+Number(b),0);
  return s;
}
function isBeforeSetsubun(d){
  const m=d.getMonth(),day=d.getDate();
  return (m===0)||(m===1&&day<=3);
}
function calcHonmei(dateStr){
  const d=new Date(dateStr);
  if(isNaN(d))return null;
  const root=reduce1(d.getFullYear());
  let num=(isBeforeSetsubun(d)?12:11)-root;
  while(num<=0)num+=9;
  return num;
}

/* ===== ä¹æ˜Ÿè¯å…¸ï¼ˆåŸºç¡€ç”»åƒï¼‰ ===== */
const STARS={
  1:{zh:'ä¸€ç™½æ°´æ˜Ÿ',jp:'Ippaku Suisei',elem:{zh:'æ°´',en:'Water',ms:'Air'},color:{zh:'ç™½',en:'White',ms:'Putih'},key:{zh:['æµåŠ¨','ç›´è§‰','æ²Ÿé€š'],en:['Flow','Intuition','Communication'],ms:['Alir','Intuisi','Komunikasi']},about:{zh:'æ•æ„Ÿç»†è…»ã€å…±æƒ…åŠ›å¼ºï¼Œè¡ŒåŠ¨çµæ´»ï¼Œæ“…é•¿ä¿¡æ¯ä¸å…³ç³»åè°ƒã€‚',en:'Sensitive and empathic; agile; great at information & relationship alignment.',ms:'Peka & berempati; lincah; bagus penyelarasan maklumat & hubungan.'}},
  2:{zh:'äºŒé»‘åœŸæ˜Ÿ',jp:'Jikoku Dosei',elem:{zh:'åœŸ',en:'Earth',ms:'Tanah'},color:{zh:'é»‘',en:'Black',ms:'Hitam'},key:{zh:['æ»‹å…»','æ‰¿è½½','è€æ€§'],en:['Nourish','Support','Patience'],ms:['Membaja','Menyokong','Sabar']},about:{zh:'åŠ¡å®ç¨³å¥ã€é‡è§†ç§©åºä¸ç…§æ–™ï¼Œæ“…é•¿æŒç»­è€•è€˜ä¸è½åœ°ã€‚',en:'Practical and steady; values order & care; good at steady execution.',ms:'Praktikal & stabil; nilai tertib & penjagaan; baik pelaksanaan berterusan.'}},
  3:{zh:'ä¸‰ç¢§æœ¨æ˜Ÿ',jp:'Sanpeki Mokusei',elem:{zh:'æœ¨',en:'Wood',ms:'Kayu'},color:{zh:'ç¢§',en:'Cyan',ms:'Biru Hijau'},key:{zh:['ç”Ÿå‘','è¡¨è¾¾','çªç ´'],en:['Growth','Expression','Breakthrough'],ms:['Tumbuh','Ekspresi','Terobosan']},about:{zh:'å¥½å¥‡è¡¨è¾¾æ¬²å¼ºï¼Œå–œæ¬¢åˆ›æ„ä¸å¼€ç–†æ‹“åœŸã€‚',en:'Curious and expressive; loves creativity & pioneering.',ms:'Ingin tahu & ekspresif; suka kreativiti & perintis.'}},
  4:{zh:'å››ç»¿æœ¨æ˜Ÿ',jp:'Shiroku Mokusei',elem:{zh:'æœ¨',en:'Wood',ms:'Kayu'},color:{zh:'ç»¿',en:'Green',ms:'Hijau'},key:{zh:['äº¤æµ','å­¦ä¹ ','æ—…è¡Œ'],en:['Exchange','Learning','Travel'],ms:['Interaksi','Belajar','Perjalanan']},about:{zh:'æ¸©å’ŒåŒ…å®¹ã€æ“…é•¿å€¾å¬ä¸çŸ¥è¯†æ•´åˆï¼Œé€‚åˆæ•™è‚²ä¸åä½œã€‚',en:'Gentle & inclusive; great at listening & integrating knowledge; good for education & collaboration.',ms:'Lunak & inklusif; mahir mendengar & integrasi ilmu; sesuai pendidikan & kolaborasi.'}},
  5:{zh:'äº”é»„åœŸæ˜Ÿ',jp:'Gogou Dosei',elem:{zh:'åœŸ',en:'Earth',ms:'Tanah'},color:{zh:'é»„',en:'Yellow',ms:'Kuning'},key:{zh:['ä¸­å®«','æƒè¡¡','é‡å¯'],en:['Center','Weighing','Reset'],ms:['Pusat','Menimbang','Set Semula']},about:{zh:'å±…ä¸­å®šç›˜ã€æŠ—å‹å¼ºï¼Œæ“…é•¿ç­–ç•¥ä¸å±æœºç®¡ç†ã€‚',en:'Centering & resilient; skilled at strategy & crisis management.',ms:'Memusat & tahan tekanan; mahir strategi & pengurusan krisis.'}},
  6:{zh:'å…­ç™½é‡‘æ˜Ÿ',jp:'Roppaku Kinsei',elem:{zh:'é‡‘',en:'Metal',ms:'Logam'},color:{zh:'ç™½',en:'White',ms:'Putih'},key:{zh:['ç§©åº','é¢†å¯¼','è¿œè§'],en:['Order','Leadership','Vision'],ms:['Tertib','Kepimpinan','Wawasan']},about:{zh:'è‡ªå¾‹æœæ–­ã€æ“…ç«‹è§„åˆ™ä¸å¸¦é˜Ÿã€‚',en:'Disciplined & decisive; sets rules and leads.',ms:'Berdisiplin & tegas; menetap peraturan & memimpin.'}},
  7:{zh:'ä¸ƒèµ¤é‡‘æ˜Ÿ',jp:'Shichiseki Kinsei',elem:{zh:'é‡‘',en:'Metal',ms:'Logam'},color:{zh:'èµ¤',en:'Red',ms:'Merah'},key:{zh:['ç¤¾äº¤','å“å‘³','äº«å—'],en:['Social','Taste','Enjoyment'],ms:['Sosial','Citarasa','Menikmati']},about:{zh:'äººç¼˜å¥½ã€å®¡ç¾åœ¨çº¿ï¼Œæ“…å“ç‰Œä¸ç¤¾ç¾¤ã€‚',en:'Popular with great taste; good at brand & community.',ms:'Popular & citarasa baik; hebat jenama & komuniti.'}},
  8:{zh:'å…«ç™½åœŸæ˜Ÿ',jp:'Happaku Dosei',elem:{zh:'åœŸ',en:'Earth',ms:'Tanah'},color:{zh:'ç™½',en:'White',ms:'Putih'},key:{zh:['ç§¯ç´¯','è½¬æŠ˜','å®šå±±'],en:['Accumulate','Turn','Stability'],ms:['Kumpul','Pusingan','Stabil']},about:{zh:'ç¨³ä¸­æ±‚å˜ã€åšç§¯è–„å‘ï¼Œå…³é”®æ—¶åˆ»èƒ½ç¿»ç›˜ã€‚',en:'Stable yet transformative; turns tides after accumulation.',ms:'Stabil namun berubah; bangkit selepas pengumpulan.'}},
  9:{zh:'ä¹ç´«ç«æ˜Ÿ',jp:'KyÅ«shi Kasei',elem:{zh:'ç«',en:'Fire',ms:'Api'},color:{zh:'ç´«',en:'Purple',ms:'Ungu'},key:{zh:['å…‰å½©','çµæ„Ÿ','ä¼ æ’­'],en:['Radiance','Inspiration','Broadcast'],ms:['Cahaya','Inspirasi','Sebar']},about:{zh:'çƒ­æƒ…å¤–æ”¾ã€çµæ„Ÿå¤šï¼Œé€‚åˆç™»å°è¡¨è¾¾ä¸IPæ‰“é€ ã€‚',en:'Passionate & radiant; good for stage & IP building.',ms:'Bersemangat & bersinar; sesuai pentas & bina IP.'}}
};

/* ä¿å­˜æœ€åä¸€æ¬¡ç»“æœï¼Œåˆ‡è¯­è¨€æ—¶ç”¨äºé‡ç»˜ */
let __STAR_STATE = null;

/* ===== æ¸²æŸ“ä¸»æ˜Ÿå¡ç‰‡ ===== */
function renderStar(n){
  const lang = getLang();
  const L = i18n[lang] || i18n["zh-CN"];
  const star = STARS[n]; if(!star) return;

  $('starName').textContent = star.zh; // ä¸»æ˜Ÿåç”¨ä¼ ç»Ÿä¸­æ–‡
  $('starJP').textContent   = star.jp;

  const elem = star.elem[lang] || star.elem.zh;
  const color= star.color[lang]|| star.color.zh;
  const kws  = (star.key[lang] || star.key.zh).join(' / ');
  const about= star.about[lang] || star.about.zh;

  $('starBadges').innerHTML =
    `<span class="badge">${L.badge_elem}ï¼š${elem}</span>`+
    `<span class="badge">${L.badge_color}ï¼š${color}</span>`+
    `<span class="badge">${L.badge_kw}ï¼š${kws}</span>`;
  $('starAbout').textContent = `${L.about_label}ï¼š${about}`;
  $('starCard').style.display='block';
}

/* ===== ç»„è£…ç»™ GPT çš„æç¤ºè¯ ===== */
function buildPrompt({langName, star, topic, question}){
  const lang = getLang();
  const topicMapCN = {
    love:"çˆ±æƒ…/å…³ç³»",career:"äº‹ä¸š/å·¥ä½œ",wealth:"è´¢å¯Œ/æŠ•èµ„",
    family:"å®¶åº­/äººé™…",health:"å¥åº·/èº«å¿ƒ",study:"å­¦ä¸š/æˆé•¿",
    move:"æ—…è¡Œ/æ¬è¿",other:"å…¶ä»–"
  };
  const topicLabel =
    (lang === 'zh-CN' || lang === 'zh-TW') ? (topicMapCN[topic] || topic) :
    topic;

  const starText =
    `ä¸»æ˜Ÿï¼š${star.zh}ï¼ˆ${star.jp}ï¼‰ï¼›äº”è¡Œï¼š${star.elem.zh}ï¼›å…³é”®è¯ï¼š${star.key.zh.join('ã€')}ã€‚æ€§æ ¼ï¼š${star.about.zh}`;

  return `ä½ æ˜¯ 5XLivingã€Œå¿ƒæ€œç®¡å®¶ã€ä¸èµ„æ·±ä¹æ˜Ÿæ°”å­¦é¡¾é—®ã€‚è¯·ä½¿ç”¨ã€${langName}ã€‘è¾“å‡ºï¼Œè¯­æ°”æ¸©æš–ã€ä¸“ä¸šã€è½åœ°ã€‚
ç”¨æˆ·çš„ä¸»æ˜Ÿä¿¡æ¯ï¼š${starText}
ç”¨æˆ·ä¸»é¢˜ï¼š${topicLabel}
ç”¨æˆ·é—®é¢˜ï¼š${question || 'ï¼ˆæ— å…·ä½“é—®é¢˜ï¼Œè¯·ç»™é€šç”¨æç¤ºï¼‰'}

è¯·æŒ‰ä»¥ä¸‹ç»“æ„è¾“å‡ºï¼ˆä¸è¦åŠ å¤šä½™å‰åç¼€ï¼‰ï¼š
# æ ¸å¿ƒåˆ¤æ–­ï¼ˆ2-4 å¥ï¼‰
# ç°åœ¨è¦åšçš„äº‹ï¼ˆåˆ— 3 æ¡ï¼ŒåŠ¨è¯å¼€å¤´ï¼‰
# é¿å‘æé†’ï¼ˆåˆ— 2-3 æ¡ï¼‰
# å¯å°è¯•çš„çµæ€§ç»ƒä¹ ï¼ˆä»å†¥æƒ³/manifestation/ä¹¦å†™æ„¿æœ›/ä»ªå¼ä¸­ç»™ 2-3 æ¡ï¼Œç»™æ“ä½œè¦ç‚¹ï¼‰
# AI æ¨ä¸¾å†…å®¹ï¼ˆåˆ— 3-5 æ¡ï¼Œç»“åˆæœ¬ç½‘ç«™ï¼šå¦‚é¢„çº¦ä¸€å¯¹ä¸€ã€åŠ å…¥ VIPã€è®¸æ„¿åŒ…/å¾¡å®ˆã€è¯¾ç¨‹ã€æŠŠè®¡åˆ’å­˜å…¥å¿ƒæ€œç¬”è®°ç­‰ï¼‰`;
}

/* ===== è¯·æ±‚ AI ===== */
async function askAI(prompt){
  const resp = await fetch(`${API_BASE}/api/chat`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({messages:[
      {role:'system',content:'ä½ å°†äº§å‡ºç»“æ„åŒ–çš„ä¹æ˜Ÿæ°”å­¦å»ºè®®ï¼ŒåŠ¡å¿…ç®€æ˜æ¸…æ™°ã€å¯æ‰§è¡Œã€‚'},
      {role:'user',content:prompt}
    ]})
  });
  let data={}; try{data=await resp.json()}catch{}
  return data.reply ?? data.text ?? data?.choices?.[0]?.message?.content ?? '';
}

/* ===== äº¤äº’ï¼šé¢„è®¾é—®é¢˜ & æ¸…ç©º ===== */
$('presetQ').addEventListener('change',e=>{
  const v=e.target.value;
  if(v){
    const q=$('question');
    q.value = q.value ? (q.value + '\n' + v) : v;
  }
});

$('clear').addEventListener('click',()=>{
  $('birthdate').value='';
  $('question').value='';
  $('presetQ').value='';
  $('topic').value='love';
  $('starCard').style.display='none';
  $('aiCard').style.display='none';
  $('aiText').textContent = '';
  $('aiReco').innerHTML = '';
  __STAR_STATE=null;
});

/* ===== äº¤äº’ï¼šç”Ÿæˆåˆ†æ ===== */
$('go').addEventListener('click', () => {
  const lang = getLang();
  const L = i18n[lang] || i18n["zh-CN"];
  const birthEl = $('birthdate');
  const date = (birthEl.value || '').trim();

  if (!date) {
    alert(L.please_birth || 'è¯·å…ˆé€‰æ‹©å‡ºç”Ÿæ—¥æœŸ');
    birthEl.focus();
    return;
  }

  const num = calcHonmei(date);
  if (!num) {
    alert(L.bad_date || 'æ—¥æœŸæ ¼å¼æœ‰è¯¯');
    return;
  }

  const topic    = $('topic').value;
  const question = $('question').value.trim();

  __STAR_STATE = { num, date, topic, question };

  // åªä¿ç•™ã€ä¸»æ˜Ÿã€‘ç»“æœ
  renderStar(num);

  // å®Œå…¨å…³é—­ AI åŒºå—ï¼šéšè—å¹¶æ¸…ç©º
  const aiCard = $('aiCard');
  const aiText = $('aiText');
  const aiReco = $('aiReco');
  if (aiCard) aiCard.style.display = 'none';
  if (aiText) aiText.textContent = '';
  if (aiReco) aiReco.innerHTML = '';
});

/* ===== è¯­è¨€åˆ‡æ¢åˆå§‹åŒ– ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = getLang();
  setLang(saved);

  const sel = $('langSelect');
  if (sel) {
    sel.value = saved;
    sel.addEventListener('change', e=>{
      const code = e.target.value || 'zh-CN';
      setLang(code);
      applyI18n();
      // å·²ç»ç®—è¿‡ä¸»æ˜Ÿæ—¶ï¼Œåˆ‡æ¢è¯­è¨€è¦é‡ç»˜å¡ç‰‡
      if (__STAR_STATE && __STAR_STATE.num) {
        renderStar(__STAR_STATE.num);
      }
      // èŠ¯ç‰‡æ–‡å­—ä¹Ÿéšè¯­è¨€æ›´æ–°
      renderChips();
    });
  }

  applyI18n();
  renderChips(); // åˆæ¬¡æ¸²æŸ“èŠ¯ç‰‡
});
</script>
<script>
  // ---- Basic helpers (self-contained) ----
  const TZ = 'Asia/Singapore';
  const $  = (id) => document.getElementById(id);

  // One-time birth defaults (your original logic, kept intact)
  function initBirthDefaults() {
    const bd  = $('birthdate');
    const bt  = $('birthtime');
    const unk = $('timeUnknown');

    const nowSG = new Date(
      new Date().toLocaleString('en-US', { timeZone: TZ })
    );

    // Default birth date to "today" in SG time if empty
    if (bd && !bd.value) {
      const y = nowSG.getFullYear();
      const m = String(nowSG.getMonth() + 1).padStart(2, '0');
      const d = String(nowSG.getDate()).padStart(2, '0');
      bd.value = `${y}-${m}-${d}`;
    }

    // Default birth time to "now" in SG time, unless unknown is checked
    if (bt) {
      const hh = String(nowSG.getHours()).padStart(2, '0');
      const mm = String(nowSG.getMinutes()).padStart(2, '0');

      if (!bt.value) bt.value = `${hh}:${mm}`;

      const setUnknownState = () => {
        const isUnknown = !!(unk && unk.checked);
        bt.disabled = isUnknown;
        if (isUnknown) bt.value = '';
      };

      setUnknownState();

      if (unk && !unk._wired) {
        unk._wired = true;
        unk.addEventListener('change', () => {
          if (unk.checked) {
            bt.disabled = true;
            bt.value = '';
          } else {
            bt.disabled = false;
            if (!bt.value) {
              const n = new Date(
                new Date().toLocaleString('en-US', { timeZone: TZ })
              );
              bt.value =
                `${String(n.getHours()).padStart(2, '0')}:` +
                `${String(n.getMinutes()).padStart(2, '0')}`;
            }
          }
        });
      }
    }
  }

  // ---- Auto-init on DOM ready ----
  document.addEventListener('DOMContentLoaded', () => {
    try {
      initBirthDefaults();
    } catch (e) {
      console.warn('[initBirthDefaults] failed:', e);
    }
  });
</script>
</body>
</html>




