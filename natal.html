
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="5XLiving æœ¬å‘½æ˜Ÿç›˜ï¼šè¾“å…¥å‡ºç”Ÿæ—¥æœŸã€æ—¶é—´å’Œåœ°ç‚¹ï¼Œè·å¾—ä¸ªæ€§åŒ–è§£è¯»ã€‚">
  <meta name="theme-color" content="#0b0f14">
  <link rel="preconnect" href="https://throbbing-lab-1440.hello5xliving.workers.dev" crossorigin>
  <title>æœ¬å‘½æ˜Ÿç›˜ Â· Natal Chart | 5XLiving</title>
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7; --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff; --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35) }
    html,body{height:100%}
    body{ margin:0; color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14); font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale }
    body::before{ content:""; position:fixed; inset:0; z-index:-2; background:#090d13 url('') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px) }
    .container{ max-width:1100px; margin:0 auto; padding:24px 16px 80px }

    /* â€”â€” ç»Ÿä¸€å¤´éƒ¨ â€”â€” */
    .site-header{ position:sticky; top:0; z-index:10; background:#0b0f14cc; border-bottom:1px solid #0f1622; backdrop-filter:saturate(140%) blur(12px) }
    .head-inner{ display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text) }
    .brand-badge{ display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084 }
    .title{ font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; letter-spacing:.02em; font-size:1.1rem; line-height:1.25 }
    .title a{ color:inherit; text-decoration:none }
    .title a:hover{ text-decoration:underline; text-underline-offset:3px }
    .now{ color:#9bb0c3; font-size:.9rem }
    .lang{ display:flex; align-items:center; gap:8px }
    .lang label{ white-space:nowrap; color:var(--muted) }
    .lang select{ appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:#e8edf3; padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50% }
    @media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

    /* â€”â€” é¡µé¢ç»“æ„ â€”â€” */
    .h1{ margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem }
    .sub{ color:var(--muted) }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:18px; margin:16px 0 }
    .row{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:760px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} }
    label.muted{ display:block; margin-bottom:4px }
    input,select{ width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:12px 12px; font-size:15px; outline:none }
    input::placeholder{ color:#6f8092 }
    .btn{ display:inline-grid; place-items:center; padding:12px 16px; border-radius:12px; border:1px solid #e6c76e; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; cursor:pointer }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .btn.ghost{ background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none }

    /* â€”â€” æŠ¥å‘Šæ ·å¼ â€”â€” */
    .report{ margin-top:12px; display:grid; gap:10px }
    .report .sec{ padding:12px; border:1px solid var(--line); background:#0e1520; border-radius:12px }
    .report .sec h3{ margin:0 0 6px; color:#f2d27a; font-size:1.05rem }
    .report p,.report li{ line-height:1.7 }

    /* â€”â€” Butler & Chat â€”â€” */
    .ss-chat-fab{ position:fixed; right:18px; bottom:18px; z-index:50; width:56px; height:56px; border-radius:50%; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; display:grid; place-items:center; font-weight:800; box-shadow:0 8px 30px rgba(0,0,0,.35); cursor:pointer; border:1px solid #e6c76e }
    .ss-chat-panel{ position:fixed; right:18px; bottom:88px; z-index:50; width:min(460px,92vw); display:none; background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow) }
    .ss-chat-head{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244 }
    .ss-chat-title{ font-weight:700 }
    .ss-close{ cursor:pointer; opacity:.8 }
    .ss-chat-body{ max-height:300px; overflow:auto; padding:10px 12px }
    .ss-msg{ padding:8px 10px; background:#0f1624; border:1px solid #243244; border-radius:10px; margin:6px 0; max-width:80% }
    .ss-msg.me{ margin-left:auto; background:#132033 }
    .ss-chat-input{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-top:1px solid #243244 }
    .ss-chat-input input{ flex:1 1 auto; min-width:0 }
    .ss-chat-input .btn,.ss-chat-input button{ flex:0 0 auto; width:auto !important; white-space:nowrap; padding:10px 14px }

    /* â€”â€” ä¼šå‘˜åŒº â€”â€” */
    .columns{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:900px){ .columns{ grid-template-columns:1fr 1fr } }
    .list-block{ border:1px solid #263448; background:#0e1520; border-radius:12px; padding:16px }
    .list-block ul{ margin:.2rem 0 0; padding-left:1.1rem }
    .group-title{ font-size:1.05rem; color:#ffe084; margin:6px 0 14px }
    .astro-auth{ max-width:980px; margin:28px auto; padding:20px 18px; background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35) }
    .auth-grid{ display:grid; gap:18px; grid-template-columns:1.2fr .8fr }
    @media(max-width:860px){ .auth-grid{ grid-template-columns:1fr } }
    .panel{ background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35) }
    .panel .head{ padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:.3px }
    .panel .body{ padding:18px }
    .spacer{ height:12px }
    footer{ color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0 }

    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{ display:none!important }
  </style>
</head>
<body>
  <!-- ç»Ÿä¸€å¤´éƒ¨ -->
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
        <span class="title">5xLiving Â· <span data-i18n="page_title">æœ¬å‘½æ˜Ÿç›˜è§£æ</span></span>
      </a>
      <div class="now" id="nowBox" aria-live="polite"></div>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" data-i18n="page_title">æœ¬å‘½æ˜Ÿç›˜è§£æ</h1>

    <!-- è¡¨å•åŒºåŸŸ -->
    <section class="card">
      <form id="chartForm" novalidate>
        <div class="row cols-3">
          <div>
            <label class="muted" for="name" data-i18n="label_name">å§“åï¼ˆå¯é€‰ï¼‰</label>
            <input id="name" type="text" data-i18n-ph="ph_name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
          </div>
          <div>
            <label class="muted" for="gender" data-i18n="gender_label">æ€§åˆ«</label>
            <select id="gender">
              <option value="u" data-i18n="opt_gender_confidential">ä¸é€éœ²</option>
              <option value="m" data-i18n="opt_gender_male">ç”·æ€§</option>
              <option value="f" data-i18n="opt_gender_female">å¥³æ€§</option>
            </select>
          </div>
          <div>
            <label class="muted" for="place" data-i18n="label_place">å‡ºç”Ÿåœ°ç‚¹ ï¼ˆå¿…å¡«ï¼‰</label>
            <input id="place" type="text" required placeholder="åŸå¸‚æˆ–åæ ‡ï¼Œå¦‚ï¼šTaipei / 25.03,121.56" pattern="^(.{2,}|-?\d{1,2}(\.\d+)?,\s*-?\d{1,3}(\.\d+)?)$" title="è¾“å…¥åŸå¸‚åæˆ–åæ ‡ï¼Œå¦‚ Taipei æˆ– 25.03,121.56"/>
          </div>
        </div>
        <div class="row cols-3" style="margin-top:10px">
          <div>
            <label class="muted" for="birthdate" data-i18n="label_birthdate">å‡ºç”Ÿæ—¥æœŸ</label>
            <input id="birthdate" type="date" required />
          </div>
          <div>
            <label class="muted" for="birthtime" data-i18n="label_birthtime">å‡ºç”Ÿæ—¶é—´</label>
            <input id="birthtime" type="time" value="12:00" step="60" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:10px">
            <button id="genBtn" class="btn" type="submit" data-i18n="btn_generate">ç”Ÿæˆæ˜Ÿç›˜</button>
          </div>
        </div>
      </form>
    </section>

    <!-- ç»“æœåŒºåŸŸ -->
    <section id="result" class="card" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="chart_title">ä½ çš„æœ¬å‘½æŠ¥å‘Š</h2>
      <div id="chartSummary" class="muted"></div>
      <div id="chartReport" class="report"></div>
    </section>

    <!-- ä¼šå‘˜ä¸“åŒº -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
            <div class="body">
              <div class="row" id="authFields" style="display:none">
                <label for="email" class="sr-only" data-i18n="ph_email">é‚®ç®± Email</label>
                <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email" />
                <label for="password" class="sr-only" data-i18n="ph_label_password">å¯†ç  Password</label>
                <input id="password" type="password" autocomplete="new-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" data-i18n-ph="ph_password" />
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
                <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">ä¼šå‘˜æœåŠ¡</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
  </main>

<script>
(function(){
  'use strict';

  /* ========================= å¸¸é‡ & i18n ========================= */
  const API_BASE = (window.API_BASE || 'https://throbbing-lab-1440.hello5xliving.workers.dev');
  const ENDPOINTS = [API_BASE + '/api/chat'];
  const OFFLINE_MODE = false; // éœ€è¦å¼ºåˆ¶ç¦»çº¿æµ‹è¯•æ—¶è®¾ true

  const I18N = {
    'zh-CN': {
      page_title:'æœ¬å‘½æ˜Ÿç›˜è§£æ',
      lang_label:'è¯­è¨€',
      /* è¡¨å• */
      label_name:'å§“åï¼ˆå¯é€‰ï¼‰',
      ph_name:'ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰',
      gender_label:'æ€§åˆ«',
      opt_gender_confidential:'ä¸é€éœ²',
      opt_gender_male:'ç”·æ€§',
      opt_gender_female:'å¥³æ€§',
      label_place:'å‡ºç”Ÿåœ°ç‚¹ ï¼ˆå¿…å¡«ï¼‰',
      label_birthdate:'å‡ºç”Ÿæ—¥æœŸ',
      label_birthtime:'å‡ºç”Ÿæ—¶é—´',
      btn_generate:'ç”Ÿæˆæ˜Ÿç›˜',
      chart_title:'ä½ çš„æœ¬å‘½æŠ¥å‘Š',
      /* Butler & Chat */
      butler_title:'å¿ƒæ€œç®¡å®¶ Â· æ™ºèƒ½è§£è¯»',
      butler_chat_title:'å¿ƒæ€œç®¡å®¶ Â· Chat',
      chat_fab:'é—®',
      chat_placeholder:'æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šåŠŸèƒ½ã€ä¼šå‘˜è¯´æ˜ï¼‰',
      chat_send:'å‘é€',
      alert_fill:'è¯·è¡¥å…¨â€œæ—¥æœŸ/åœ°ç‚¹â€ã€‚ï¼ˆæ—¶é—´ç•™ç©ºå°†é»˜è®¤ä¸º 12:00ï¼‰',
      err_network:'ç½‘ç»œå¼‚å¸¸',
      err_busy:'æœåŠ¡æš‚æ—¶ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•ã€‚',
      /* ä¼šå‘˜åŒºæ ‡é¢˜ */
      vip_title:'ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment',
      vip_mingli:'ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹',
      vip_love:'å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿',
      vip_career:'äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›',
      vip_wealth:'è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº',
      vip_pet:'å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†',
      vip_hepan:'åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶',
      vip_name:'æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿',
      vip_fengshui:'è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ',
      vip_xinlian:'ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹',
      vip_record:'çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·',
      vip_course:'å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾',
      vip_memorial:'å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­',
      vip_tasks:'æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡',
      vip_shop:'èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶',
      login_title:'ğŸ’ ç™»å…¥ VIP åŠŸèƒ½',
      panel_login_head:'è´¦æˆ·ç™»å½• / æ³¨å†Œ',
      ph_email:'é‚®ç®± Email',
      ph_label_password:'å¯†ç  Password',
      btn_login:'ç™»å…¥è´¦æˆ·',
      btn_reset:'ğŸ”‘ é‡è®¾å¯†ç ',
      btn_register:'æ³¨å†Œè´¦æˆ·',
      note_price:'æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ',
      panel_member_head:'ä¼šå‘˜æœåŠ¡',
      btn_upgrade:'ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰',
      btn_backshop:'â† è¿”å›å‘½ç†å•†åŸ',
      note_price1:'$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰',
      /* VIP é”å®šæç¤º */
      vip_tip:'ğŸ”’ VIP è§£é”åå¯æŸ¥çœ‹å®Œæ•´è§£è¯»',
      vip_sub:'åŒ…å«ã€Œäº‹ä¸š/è´¢å¯Œ/æ‰§è¡Œæ¸…å•/æ¸©æŸ”æé†’ã€å…¨éƒ¨ç« èŠ‚ä¸æŒç»­è¿½é—®',
      btn_unlock:'ç«‹å³è§£é”',
      ph_password:'å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰',
      offline_hint:'ï¼ˆæœ¬åœ°ç¦»çº¿è§£è¯»ï¼‰',
      butler_profile:'äººç‰©ç”»åƒ',
      butler_rel:'å…³ç³»ä¸æ²Ÿé€š',
      butler_career:'äº‹ä¸šä¸è‡ªæˆ‘å®ç°',
      butler_money:'é‡‘é’±ä¸ç‰©è´¨',
      butler_todo:'ä»Šæ—¥/æœ¬å‘¨å¯æ‰§è¡Œæ¸…å•',
      butler_soft:'æ¸©æŸ”æé†’',
      sun_title:'å¤ªé˜³æ˜Ÿåº§'
    },

    'zh-TW': {
      page_title:'æœ¬å‘½æ˜Ÿç›¤è§£æ',
      lang_label:'èªè¨€',
      label_name:'å§“åï¼ˆé¸å¡«ï¼‰',
      ph_name:'ä½ çš„ç¨±å‘¼ï¼ˆç”¨æ–¼å€‹äººåŒ–ï¼‰',
      gender_label:'æ€§åˆ¥',
      opt_gender_confidential:'ä¸é€éœ²',
      opt_gender_male:'ç”·æ€§',
      opt_gender_female:'å¥³æ€§',
      label_place:'å‡ºç”Ÿåœ°é»ï¼ˆå¿…å¡«ï¼‰',
      label_birthdate:'å‡ºç”Ÿæ—¥æœŸ',
      label_birthtime:'å‡ºç”Ÿæ™‚é–“',
      btn_generate:'ç”Ÿæˆæ˜Ÿç›¤',
      chart_title:'ä½ çš„æœ¬å‘½å ±å‘Š',
      butler_title:'å¿ƒæ†ç®¡å®¶ Â· æ™ºèƒ½è§£è®€',
      butler_chat_title:'å¿ƒæ†ç®¡å®¶ Â· Chat',
      chat_fab:'å•',
      chat_placeholder:'æƒ³äº†è§£ä»€éº¼ï¼Ÿï¼ˆå¦‚ï¼šåŠŸèƒ½ã€æœƒå“¡èªªæ˜ï¼‰',
      chat_send:'é€å‡º',
      alert_fill:'è«‹è£œå…¨ã€Œæ—¥æœŸï¼åœ°é»ã€ã€‚ï¼ˆæ™‚é–“ç•™ç©ºå°‡é è¨­ç‚º 12:00ï¼‰',
      err_network:'ç¶²è·¯ç•°å¸¸',
      err_busy:'æœå‹™æš«æ™‚ç¹å¿™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
      vip_title:'ğŸŒ™ æœƒå“¡å€åŸŸ VIP Segment',
      vip_mingli:'ğŸ— å‘½ç†ç©ºé–“å°ˆå±¬å…§å®¹',
      vip_love:'å§»ç·£æ–¹å‘ï¼šæˆ€æ„›ç·£åˆ†ã€å©šå§»èµ°å‹¢',
      vip_career:'äº‹æ¥­æ–¹å‘ï¼šè·å ´ç™¼å±•ã€å‰µæ¥­æ½›åŠ›',
      vip_wealth:'è²¡é‹æ–¹å‘ï¼šè²¡ä½åˆ†æã€ç†è²¡æ™‚æ©Ÿ',
      vip_pet:'å¯µç‰©å‘½ç†ï¼šä¼´ä¾¶å‹•ç‰©çš„æ€§æ ¼èˆ‡ç·£åˆ†',
      vip_hepan:'åˆç›¤åˆ†æï¼šå©šæœŸæ“‡æ—¥ã€æ–°ç”Ÿæ“‡æ™‚',
      vip_name:'æ¸¬ååˆ†æï¼šå…¬å¸åã€å¯¶å¯¶åã€æ”¹åè½‰é‹',
      vip_fengshui:'è²¡ä½åˆç›¤ï¼šä½å®¶ / è¾¦å…¬å®¤å‹•ç·šé…åˆ',
      vip_xinlian:'ğŸŒ™ å¿ƒæ†ç©ºé–“å°ˆå±¬å…§å®¹',
      vip_record:'éˆæ€§è¨˜éŒ„ï¼šç…§ç‰‡ã€å¤¢å¢ƒã€è²éŸ³ã€é¡˜æœ›ç¥ˆç¦±',
      vip_course:'å‘½ç†èª²ç¨‹ï¼šå…«å­— / å¡”ç¾… / å æ˜Ÿ / éˆæ•¸ / äººé¡åœ–',
      vip_memorial:'å®¶æ—ç´€å¿µç³»çµ±ï¼šè¦ªäººéˆæ€§ç´€å¿µ & å»¶çºŒ',
      vip_tasks:'æ¯é€±èƒ½é‡ç·´ç¿’ / ç¥æ˜å„€å¼ä»»å‹™',
      vip_shop:'èƒ½é‡å•†åŸå°ˆå±¬æŠ˜æ‰£ & å¾¡å®ˆè¨‚è£½',
      login_title:'ğŸ’ ç™»å…¥ VIP åŠŸèƒ½',
      panel_login_head:'å¸³è™Ÿç™»å…¥ / è¨»å†Š',
      ph_email:'ä¿¡ç®± Email',
      ph_label_password:'å¯†ç¢¼ Password',
      btn_login:'ç™»å…¥å¸³è™Ÿ',
      btn_reset:'ğŸ”‘ é‡è¨­å¯†ç¢¼',
      btn_register:'è¨»å†Šå¸³è™Ÿ',
      note_price:'è¨»å†Šå¸³è™Ÿè´ˆé€ä¸€æ¬¡å…è²»é«”é©—',
      panel_member_head:'æœƒå“¡æœå‹™',
      btn_upgrade:'ğŸ’ å‡ç´šç‚º VIPï¼ˆæœˆè²»ï¼‰',
      btn_backshop:'â† è¿”å›å‘½ç†å•†åŸ',
      note_price1:'$9.9 / æœˆè²» VIPï¼ˆå‘½ç†ç©ºé–“ + å¿ƒæ†ç©ºé–“ + éˆæ€§èª²ç¨‹ï¼‰',
      vip_tip:'ğŸ”’ VIP è§£é–å¾Œå¯æŸ¥çœ‹å®Œæ•´è§£è®€',
      vip_sub:'åŒ…å«ã€Œäº‹æ¥­ï¼è²¡å¯Œï¼åŸ·è¡Œæ¸…å–®ï¼æº«æŸ”æé†’ã€å…¨éƒ¨ç« ç¯€èˆ‡æŒçºŒè¿½å•',
      btn_unlock:'ç«‹å³è§£é–',
      ph_password:'å¯†ç¢¼ Passwordï¼ˆè‡³å°‘ 8 ä½ï¼Œå«å¤§å°å¯«æ•¸å­—ç¬¦è™Ÿï¼‰',
      offline_hint:'ï¼ˆæœ¬åœ°é›¢ç·šè§£è®€ï¼‰',
      butler_profile:'äººç‰©ç”»åƒ',
      butler_rel:'é—œä¿‚èˆ‡æºé€š',
      butler_career:'äº‹æ¥­èˆ‡è‡ªæˆ‘å¯¦ç¾',
      butler_money:'é‡‘éŒ¢èˆ‡ç‰©è³ª',
      butler_todo:'ä»Šæ—¥ï¼æœ¬é€±å¯åŸ·è¡Œæ¸…å–®',
      butler_soft:'æº«æŸ”æé†’',
      sun_title:'å¤ªé™½æ˜Ÿåº§'
    },

    'en': {
      page_title:'Natal Chart Insight',
      lang_label:'Language',
      label_name:'Name (optional)',
      ph_name:'Your name (for personalization)',
      gender_label:'Gender',
      opt_gender_confidential:'Prefer not to say',
      opt_gender_male:'Male',
      opt_gender_female:'Female',
      label_place:'Birth place (required)',
      label_birthdate:'Birth date',
      label_birthtime:'Birth time',
      btn_generate:'Generate chart',
      chart_title:'Your natal report',
      butler_title:'Xinlian Butler Â· Smart Reading',
      butler_chat_title:'Xinlian Butler Â· Chat',
      chat_fab:'Ask',
      chat_placeholder:'What would you like to know? (e.g. features, VIP info)',
      chat_send:'Send',
      alert_fill:'Please fill in both "Date" and "Place". (If time is empty, 12:00 will be used.)',
      err_network:'Network error',
      err_busy:'Service is busy, please try again later.',
      vip_title:'ğŸŒ™ VIP Area',
      vip_mingli:'ğŸ— Mingli Space Â· Exclusive',
      vip_love:'Love: relationship patterns, marriage trends',
      vip_career:'Career: work direction, business potential',
      vip_wealth:'Wealth: money flow, timing for investments',
      vip_pet:'Pet destiny: personality & bond with you',
      vip_hepan:'Synastry: marriage date, baby timing',
      vip_name:'Name reading: company, baby, renaming for luck',
      vip_fengshui:'Feng Shui: home / office flow & wealth sectors',
      vip_xinlian:'ğŸŒ™ Xinlian Space Â· Exclusive',
      vip_record:'Spiritual records: photos, dreams, voice, wishes',
      vip_course:'Courses: Bazi / Tarot / Astrology / Numerology / Human Design',
      vip_memorial:'Family memorial: soul archive for loved ones',
      vip_tasks:'Weekly energy practices / deity rituals',
      vip_shop:'Energy shop discounts & custom talismans',
      login_title:'ğŸ’ VIP Login',
      panel_login_head:'Account Login / Register',
      ph_email:'Email',
      ph_label_password:'Password',
      btn_login:'Log in',
      btn_reset:'ğŸ”‘ Reset password',
      btn_register:'Create account',
      note_price:'New account includes one free trial reading',
      panel_member_head:'Membership',
      btn_upgrade:'ğŸ’ Upgrade to VIP (monthly)',
      btn_backshop:'â† Back to store',
      note_price1:'$9.9 / month VIP (Mingli Space + Xinlian Space + Courses)',
      vip_tip:'ğŸ”’ Unlock VIP to see the full guidance',
      vip_sub:'Includes Career / Wealth / To-do List / Gentle Reminders and follow-up questions',
      btn_unlock:'Unlock now',
      ph_password:'Password (min 8 chars with upper/lowercase, number & symbol)',
      offline_hint:' (local offline reading)',
      butler_profile:'Profile',
      butler_rel:'Relationships & Communication',
      butler_career:'Career & Self-Realization',
      butler_money:'Money & Material Life',
      butler_todo:'This Weekâ€™s Action List',
      butler_soft:'Gentle Reminder',
      sun_title:'Sun sign'
    },

    'ja': {
      page_title:'æœ¬å‘½ãƒãƒ£ãƒ¼ãƒˆè§£æ',
      lang_label:'è¨€èª',
      label_name:'ãŠåå‰ï¼ˆä»»æ„ï¼‰',
      ph_name:'å€‹åˆ¥è¡¨ç¤ºã®ãŸã‚ã®ãŠåå‰',
      gender_label:'æ€§åˆ¥',
      opt_gender_confidential:'å›ç­”ã—ãªã„',
      opt_gender_male:'ç”·æ€§',
      opt_gender_female:'å¥³æ€§',
      label_place:'å‡ºç”Ÿåœ°ï¼ˆå¿…é ˆï¼‰',
      label_birthdate:'ç”Ÿå¹´æœˆæ—¥',
      label_birthtime:'å‡ºç”Ÿæ™‚åˆ»',
      btn_generate:'ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆ',
      chart_title:'ã‚ãªãŸã®æœ¬å‘½ãƒ¬ãƒãƒ¼ãƒˆ',
      butler_title:'å¿ƒæ†ãƒãƒˆãƒ©ãƒ¼ Â· ã‚¹ãƒãƒ¼ãƒˆè§£èª­',
      butler_chat_title:'å¿ƒæ†ãƒãƒˆãƒ©ãƒ¼ Â· ãƒãƒ£ãƒƒãƒˆ',
      chat_fab:'è³ªå•',
      chat_placeholder:'çŸ¥ã‚ŠãŸã„ã“ã¨ã¯ï¼Ÿï¼ˆæ©Ÿèƒ½ãƒ»VIP ãªã©ï¼‰',
      chat_send:'é€ä¿¡',
      alert_fill:'ã€Œæ—¥ä»˜ã€ã¨ã€Œå ´æ‰€ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆæ™‚åˆ»æœªå…¥åŠ›ã®å ´åˆã¯ 12:00 ã¨ã—ã¦æ‰±ã„ã¾ã™ï¼‰',
      err_network:'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼',
      err_busy:'ã‚µãƒ¼ãƒ“ã‚¹ãŒæ··ã¿åˆã£ã¦ã„ã¾ã™ã€‚å°‘ã—æ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚',
      vip_title:'ğŸŒ™ VIP ã‚¨ãƒªã‚¢',
      vip_mingli:'ğŸ— å‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ Â· ä¼šå“¡é™å®š',
      vip_love:'æ‹æ„›ãƒ»çµå©šï¼šã”ç¸ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³',
      vip_career:'ä»•äº‹ï¼šã‚­ãƒ£ãƒªã‚¢æ–¹å‘æ€§ãƒ»èµ·æ¥­ã®å¯èƒ½æ€§',
      vip_wealth:'é‡‘é‹ï¼šãŠé‡‘ã®æµã‚Œãƒ»æŠ•è³‡ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°',
      vip_pet:'ãƒšãƒƒãƒˆå‘½ç†ï¼šæ€§æ ¼ã¨ã‚ãªãŸã¨ã®ã”ç¸',
      vip_hepan:'ç›¸æ€§ãƒãƒ£ãƒ¼ãƒˆï¼šçµå©šæ—¥ãƒ»å‡ºç”£ã‚¿ã‚¤ãƒŸãƒ³ã‚°',
      vip_name:'å‘½åé‘‘å®šï¼šä¼šç¤¾åãƒ»èµ¤ã¡ã‚ƒã‚“ã®åãƒ»æ”¹å',
      vip_fengshui:'é¢¨æ°´ï¼šè‡ªå®…ï¼ã‚ªãƒ•ã‚£ã‚¹ã®å‹•ç·šã¨è²¡ä½',
      vip_xinlian:'ğŸŒ™ å¿ƒæ†ã‚¹ãƒšãƒ¼ã‚¹ Â· ä¼šå“¡é™å®š',
      vip_record:'ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¨˜éŒ²ï¼šå†™çœŸãƒ»å¤¢ãƒ»éŸ³å£°ãƒ»é¡˜ã„',
      vip_course:'è¬›åº§ï¼šå››æŸ±æ¨å‘½ / ã‚¿ãƒ­ãƒƒãƒˆ / å æ˜Ÿè¡“ / æ•°ç§˜ / äººé¡å›³',
      vip_memorial:'å®¶æ—ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ï¼šæ•…äººã®é­‚ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–',
      vip_tasks:'æ¯é€±ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¯ãƒ¼ã‚¯ï¼ç¥æ§˜ã¸ã®ãƒ¯ãƒ¼ã‚¯',
      vip_shop:'ã‚¨ãƒŠã‚¸ãƒ¼ã‚·ãƒ§ãƒƒãƒ—å‰²å¼• & ãŠå®ˆã‚Šã‚«ã‚¹ã‚¿ãƒ ',
      login_title:'ğŸ’ VIP ãƒ­ã‚°ã‚¤ãƒ³',
      panel_login_head:'ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²',
      ph_email:'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
      ph_label_password:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
      btn_login:'ãƒ­ã‚°ã‚¤ãƒ³',
      btn_reset:'ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š',
      btn_register:'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ',
      note_price:'æ–°è¦ç™»éŒ²ã§ä¸€å›åˆ†ã®ç„¡æ–™ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä»˜ã',
      panel_member_head:'ä¼šå“¡ã‚µãƒ¼ãƒ“ã‚¹',
      btn_upgrade:'ğŸ’ VIPï¼ˆæœˆé¡ï¼‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰',
      btn_backshop:'â† ã‚·ãƒ§ãƒƒãƒ—ã¸æˆ»ã‚‹',
      note_price1:'æœˆé¡ $9.9ï¼ˆå‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ï¼‹å¿ƒæ†ã‚¹ãƒšãƒ¼ã‚¹ï¼‹è¬›åº§ï¼‰',
      vip_tip:'ğŸ”’ VIP ã«ãªã‚‹ã¨å…¨æ–‡ã‚’é–²è¦§ã§ãã¾ã™',
      vip_sub:'ã‚­ãƒ£ãƒªã‚¢ï¼é‡‘é‹ï¼å®Ÿè¡Œãƒªã‚¹ãƒˆï¼å„ªã—ã„ãƒªãƒã‚¤ãƒ³ãƒ‰ãªã©ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨è¿½åŠ å…¥åŠ›ãŒè§£æ”¾ã•ã‚Œã¾ã™',
      btn_unlock:'ä»Šã™ãè§£æ”¾ã™ã‚‹',
      ph_password:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šã€å¤§å°è‹±å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ï¼‰',
      offline_hint:'ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è§£èª­ï¼‰',
      butler_profile:'äººç‰©åƒ',
      butler_rel:'é–¢ä¿‚ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
      butler_career:'ä»•äº‹ã¨è‡ªå·±å®Ÿç¾',
      butler_money:'ãŠé‡‘ã¨ç‰©è³ªé¢',
      butler_todo:'ä»Šé€±ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆ',
      butler_soft:'ã‚„ã•ã—ã„ãƒªãƒã‚¤ãƒ³ãƒ‰',
      sun_title:'å¤ªé™½æ˜Ÿåº§'
    },

    'th': {
      page_title:'à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸” Â· Natal Chart',
      lang_label:'à¸ à¸²à¸©à¸²',
      label_name:'à¸Šà¸·à¹ˆà¸­ (à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)',
      ph_name:'à¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¹ƒà¸™à¸£à¸²à¸¢à¸‡à¸²à¸™',
      gender_label:'à¹€à¸à¸¨',
      opt_gender_confidential:'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸',
      opt_gender_male:'à¸Šà¸²à¸¢',
      opt_gender_female:'à¸«à¸à¸´à¸‡',
      label_place:'à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸” (à¸ˆà¸³à¹€à¸›à¹‡à¸™)',
      label_birthdate:'à¸§à¸±à¸™à¹€à¸à¸´à¸”',
      label_birthtime:'à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”',
      btn_generate:'à¸ªà¸£à¹‰à¸²à¸‡à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸”',
      chart_title:'à¸£à¸²à¸¢à¸‡à¸²à¸™à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸”à¸‚à¸­à¸‡à¸„à¸¸à¸“',
      butler_title:'Xinlian Butler Â· à¸œà¸¹à¹‰à¸Šà¹ˆà¸§à¸¢à¸­à¹ˆà¸²à¸™à¸”à¸§à¸‡',
      butler_chat_title:'Xinlian Butler Â· à¹à¸Šà¸•',
      chat_fab:'à¸–à¸²à¸¡',
      chat_placeholder:'à¸­à¸¢à¸²à¸à¸£à¸¹à¹‰à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸­à¸°à¹„à¸£? (à¹€à¸Šà¹ˆà¸™ à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ à¸£à¸°à¸šà¸š VIP)',
      chat_send:'à¸ªà¹ˆà¸‡',
      alert_fill:'à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸ "à¸§à¸±à¸™" à¹à¸¥à¸° "à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ" (à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸à¸£à¸­à¸à¹€à¸§à¸¥à¸² à¸£à¸°à¸šà¸šà¸ˆà¸°à¹ƒà¸Šà¹‰ 12:00 à¹à¸—à¸™)',
      err_network:'à¹€à¸„à¸£à¸·à¸­à¸‚à¹ˆà¸²à¸¢à¸¡à¸µà¸›à¸±à¸à¸«à¸²',
      err_busy:'à¸£à¸°à¸šà¸šà¸à¸³à¸¥à¸±à¸‡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸«à¸™à¸²à¹à¸™à¹ˆà¸™ à¹‚à¸›à¸£à¸”à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡',
      vip_title:'ğŸŒ™ à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸¡à¸²à¸Šà¸´à¸ VIP',
      vip_mingli:'ğŸ— à¹‚à¸‹à¸™à¸”à¸§à¸‡à¸Šà¸°à¸•à¸² Â· à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸¡à¸²à¸Šà¸´à¸',
      vip_love:'à¸„à¸§à¸²à¸¡à¸£à¸±à¸à¹à¸¥à¸°à¸„à¸¹à¹ˆà¸„à¸£à¸­à¸‡ : à¸£à¸¹à¸›à¹à¸šà¸šà¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ à¹à¸™à¸§à¹‚à¸™à¹‰à¸¡à¹à¸•à¹ˆà¸‡à¸‡à¸²à¸™',
      vip_career:'à¸à¸²à¸£à¸‡à¸²à¸™ : à¸—à¸´à¸¨à¸—à¸²à¸‡à¸­à¸²à¸Šà¸µà¸ à¹à¸¥à¸°à¹‚à¸­à¸à¸²à¸ªà¸—à¸³à¸˜à¸¸à¸£à¸à¸´à¸ˆ',
      vip_wealth:'à¸à¸²à¸£à¹€à¸‡à¸´à¸™ : à¸à¸£à¸°à¹à¸ªà¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸²à¸­à¸­à¸ à¹à¸¥à¸°à¸ˆà¸±à¸‡à¸«à¸§à¸°à¸¥à¸‡à¸—à¸¸à¸™',
      vip_pet:'à¸”à¸§à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡ : à¸™à¸´à¸ªà¸±à¸¢à¹à¸¥à¸°à¸ªà¸²à¸¢à¹ƒà¸¢à¸à¸±à¸šà¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡',
      vip_hepan:'à¸”à¸§à¸‡à¸„à¸¹à¹ˆ : à¸§à¸±à¸™à¹à¸•à¹ˆà¸‡à¸‡à¸²à¸™ à¹à¸¥à¸°à¸ˆà¸±à¸‡à¸«à¸§à¸°à¸¡à¸µà¸šà¸¸à¸•à¸£',
      vip_name:'à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸Šà¸·à¹ˆà¸­ : à¸Šà¸·à¹ˆà¸­à¸šà¸£à¸´à¸©à¸±à¸— à¸Šà¸·à¹ˆà¸­à¹€à¸”à¹‡à¸ à¸›à¸£à¸±à¸šà¸Šà¸·à¹ˆà¸­à¹€à¸ªà¸£à¸´à¸¡à¸”à¸§à¸‡',
      vip_fengshui:'à¸®à¸§à¸‡à¸ˆà¸¸à¹‰à¸¢ : à¸—à¸´à¸¨à¸—à¸²à¸‡à¸šà¹‰à¸²à¸™/à¸­à¸­à¸Ÿà¸Ÿà¸´à¸¨à¹à¸¥à¸°à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸—à¸£à¸±à¸à¸¢à¹Œ',
      vip_xinlian:'ğŸŒ™ à¹‚à¸‹à¸™ Xinlian Â· à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸¡à¸²à¸Šà¸´à¸',
      vip_record:'à¸šà¸±à¸™à¸—à¸¶à¸à¸ˆà¸´à¸•à¸§à¸´à¸à¸à¸²à¸“ : à¸£à¸¹à¸›à¸ à¸²à¸ à¸„à¸§à¸²à¸¡à¸à¸±à¸™ à¹€à¸ªà¸µà¸¢à¸‡ à¸„à¸³à¸­à¸˜à¸´à¸©à¸à¸²à¸™',
      vip_course:'à¸„à¸­à¸£à¹Œà¸ªà¹€à¸£à¸µà¸¢à¸™ : à¸®à¸§à¸‡à¸ˆà¸¸à¹‰à¸¢ / à¹„à¸à¹ˆà¸—à¸²à¹‚à¸£à¸•à¹Œ / à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œ / à¹€à¸¥à¸‚à¸¨à¸²à¸ªà¸•à¸£à¹Œ / Human Design',
      vip_memorial:'à¸£à¸°à¸šà¸šà¸£à¸³à¸¥à¸¶à¸à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§ : à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸´à¸à¸à¸²à¸“à¸‚à¸­à¸‡à¸„à¸™à¸—à¸µà¹ˆà¸¥à¹ˆà¸§à¸‡à¸¥à¸±à¸š',
      vip_tasks:'à¹à¸šà¸šà¸à¸¶à¸à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ / à¸ à¸²à¸£à¸à¸´à¸ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸´à¹ˆà¸‡à¸¨à¸±à¸à¸”à¸´à¹Œà¸ªà¸´à¸—à¸˜à¸´à¹Œ',
      vip_shop:'à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸‡ à¹à¸¥à¸°à¸‚à¸­à¸‡à¸¡à¸‡à¸„à¸¥à¹€à¸‰à¸à¸²à¸°à¸ªà¸¡à¸²à¸Šà¸´à¸',
      login_title:'ğŸ’ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š VIP',
      panel_login_head:'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š / à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸',
      ph_email:'à¸­à¸µà¹€à¸¡à¸¥',
      ph_label_password:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™',
      btn_login:'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š',
      btn_reset:'ğŸ”‘ à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™',
      btn_register:'à¸ªà¸¡à¸±à¸„à¸£à¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆ',
      note_price:'à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸«à¸¡à¹ˆà¸£à¸±à¸šà¸ªà¸´à¸—à¸˜à¸´à¸­à¹ˆà¸²à¸™à¸”à¸§à¸‡à¸Ÿà¸£à¸µ 1 à¸„à¸£à¸±à¹‰à¸‡',
      panel_member_head:'à¸šà¸£à¸´à¸à¸²à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸',
      btn_upgrade:'ğŸ’ à¸­à¸±à¸›à¹€à¸à¸£à¸”à¹€à¸›à¹‡à¸™ VIP à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™',
      btn_backshop:'â† à¸à¸¥à¸±à¸šà¹„à¸›à¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²',
      note_price1:'VIP $9.9 / à¹€à¸”à¸·à¸­à¸™ (à¹‚à¸‹à¸™à¸”à¸§à¸‡ + Xinlian + à¸„à¸­à¸£à¹Œà¸ªà¹€à¸£à¸µà¸¢à¸™)',
      vip_tip:'ğŸ”’ à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„ VIP à¹€à¸à¸·à¹ˆà¸­à¸­à¹ˆà¸²à¸™à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
      vip_sub:'à¸£à¸§à¸¡à¸—à¸¸à¸à¸«à¸¡à¸§à¸” : à¸à¸²à¸£à¸‡à¸²à¸™ / à¸à¸²à¸£à¹€à¸‡à¸´à¸™ / To-Do / à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸šà¹‚à¸¢à¸™ à¹à¸¥à¸°à¸–à¸²à¸¡à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡à¹„à¸”à¹‰',
      btn_unlock:'à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„à¸•à¸­à¸™à¸™à¸µà¹‰',
      ph_password:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ (à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 8 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£ à¸£à¸§à¸¡à¸•à¸±à¸§à¸à¸´à¸¡à¸à¹Œà¹€à¸¥à¹‡à¸ à¸à¸´à¸¡à¸à¹Œà¹ƒà¸«à¸à¹ˆ à¸•à¸±à¸§à¹€à¸¥à¸‚ à¹à¸¥à¸°à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œ)',
      offline_hint:' (à¹‚à¸«à¸¡à¸”à¸­à¹ˆà¸²à¸™à¹à¸šà¸šà¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œà¹ƒà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡)',
      butler_profile:'à¸ à¸²à¸à¸£à¸§à¸¡à¸•à¸±à¸§à¸•à¸™',
      butler_rel:'à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¹à¸¥à¸°à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£',
      butler_career:'à¸‡à¸²à¸™à¹à¸¥à¸°à¸à¸²à¸£à¹€à¸•à¸´à¸¡à¹€à¸•à¹‡à¸¡à¸•à¸±à¸§à¹€à¸­à¸‡',
      butler_money:'à¸à¸²à¸£à¹€à¸‡à¸´à¸™à¹à¸¥à¸°à¹‚à¸¥à¸à¸§à¸±à¸•à¸–à¸¸',
      butler_todo:'à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³à¹„à¸”à¹‰à¸§à¸±à¸™à¸™à¸µà¹‰/à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰',
      butler_soft:'à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹€à¸•à¸·à¸­à¸™à¹ƒà¸ˆà¸­à¸¢à¹ˆà¸²à¸‡à¸­à¹ˆà¸­à¸™à¹‚à¸¢à¸™',
      sun_title:'à¸£à¸²à¸¨à¸µà¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ'
    },

    'ms': {
      page_title:'Carta Natal Â· Tafsiran',
      lang_label:'Bahasa',
      label_name:'Nama (pilihan)',
      ph_name:'Nama anda',
      gender_label:'Jantina',
      opt_gender_confidential:'Tidak mahu nyatakan',
      opt_gender_male:'Lelaki',
      opt_gender_female:'Perempuan',
      label_place:'Tempat lahir (wajib)',
      label_birthdate:'Tarikh lahir',
      label_birthtime:'Masa lahir',
      btn_generate:'Jana carta',
      chart_title:'Laporan carta natal anda',
      butler_title:'Xinlian Butler Â· Analisis Pintar',
      butler_chat_title:'Xinlian Butler Â· Chat',
      chat_fab:'Tanya',
      chat_placeholder:'Apa yang anda mahu tahu? (cth. fungsi, info VIP)',
      chat_send:'Hantar',
      alert_fill:'Sila lengkapkan "Tarikh" dan "Tempat". (Jika masa kosong, 12:00 akan digunakan)',
      err_network:'Ralat rangkaian',
      err_busy:'Perkhidmatan sedang sibuk, cuba lagi sebentar lagi.',
      vip_title:'ğŸŒ™ Zon Ahli VIP',
      vip_mingli:'ğŸ— Ruang Mingli Â· Eksklusif',
      vip_love:'Cinta & jodoh: corak hubungan, hala tuju perkahwinan',
      vip_career:'Kerjaya: hala tuju kerja, potensi bisnes',
      vip_wealth:'Kewangan: aliran wang & masa pelaburan',
      vip_pet:'Nasib haiwan peliharaan: personaliti & hubungan dengan anda',
      vip_hepan:'Carta jodoh: tarikh kahwin & masa mendapat anak',
      vip_name:'Analisis nama: nama syarikat, nama bayi, tukar nama untuk tuah',
      vip_fengshui:'Feng Shui: aliran rumah / pejabat & sudut kekayaan',
      vip_xinlian:'ğŸŒ™ Ruang Xinlian Â· Eksklusif',
      vip_record:'Rekod spiritual: gambar, mimpi, suara, doa',
      vip_course:'Kursus: Bazi / Tarot / Astrologi / Numerologi / Human Design',
      vip_memorial:'Sistem memorial keluarga: arkib roh orang tersayang',
      vip_tasks:'Latihan tenaga mingguan / tugasan ritual',
      vip_shop:'Diskaun kedai tenaga & jimat tempahan khas',
      login_title:'ğŸ’ Log masuk VIP',
      panel_login_head:'Log masuk / Daftar akaun',
      ph_email:'Emel',
      ph_label_password:'Kata laluan',
      btn_login:'Log masuk',
      btn_reset:'ğŸ”‘ Tetapkan semula kata laluan',
      btn_register:'Daftar akaun',
      note_price:'Pendaftaran baharu termasuk satu bacaan percuma',
      panel_member_head:'Perkhidmatan ahli',
      btn_upgrade:'ğŸ’ Naik taraf ke VIP (bulanan)',
      btn_backshop:'â† Kembali ke kedai',
      note_price1:'$9.9 / bulan VIP (Ruang Mingli + Xinlian + Kursus)',
      vip_tip:'ğŸ”’ Buka VIP untuk melihat tafsiran penuh',
      vip_sub:'Termasuk semua bahagian: kerjaya / kewangan / senarai tindakan / pesanan lembut dan soalan susulan',
      btn_unlock:'Buka sekarang',
      ph_password:'Kata laluan (min 8 aksara dengan huruf besar/kecil, nombor & simbol)',
      offline_hint:' (bacaan luar talian tempatan)',
      butler_profile:'Gambaran diri',
      butler_rel:'Hubungan & komunikasi',
      butler_career:'Kerjaya & pencapaian diri',
      butler_money:'Wang & kehidupan material',
      butler_todo:'Senarai tindakan minggu ini',
      butler_soft:'Peringatan lembut',
      sun_title:'Tanda matahari'
    }
  };

  function getLang(){
    const sel = document.getElementById('langSelect');
    return sel?.value || 'zh-CN';
  }
  function t(key){
    const lang = getLang();
    return (I18N[lang] && I18N[lang][key]) ||
           (I18N['zh-CN'][key] || key);
  }
  function getOutputLanguageName(code){
    switch(code){
      case 'en':   return 'English';
      case 'zh-TW':return 'Traditional Chinese';
      case 'ja':   return 'Japanese';
      case 'th':   return 'Thai';
      case 'ms':   return 'Malay';
      default:     return 'Simplified Chinese';
    }
  }

  /* ========================= å®ç”¨å‡½æ•° ========================= */
  const gid = (id)=>document.getElementById(id);
  const qs  = (s,root=document)=>root.querySelector(s);
  const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));

  function startNowClock(){
    const el = gid('nowBox'); if(!el) return;
    const fmt = (n)=> (n<10?('0'+n):n);
    function tick(){
      const now = new Date();
      const y=now.getFullYear(), m=fmt(now.getMonth()+1), d=fmt(now.getDate());
      const hh=fmt(now.getHours()), mm=fmt(now.getMinutes()), ss=fmt(now.getSeconds());
      el.textContent = `${y}-${m}-${d} ${hh}:${mm}:${ss} SGT`;
    }
    tick(); setInterval(tick, 1000);
  }

  function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  /* ========================= i18n åº”ç”¨ ========================= */
  function applyI18n(){
    // æ–‡æœ¬èŠ‚ç‚¹
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      if(!key) return;
      el.textContent = t(key);
    });
    // placeholder
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const key = el.getAttribute('data-i18n-ph');
      if(!key) return;
      const txt = t(key);
      if('placeholder' in el) el.placeholder = txt;
    });
  }

  /* ========================= æ˜Ÿåº§ä¸å…ƒç´ ï¼ˆè¿‘ä¼¼ï¼‰ ========================= */
  const SIGN_LIST = [
    {key:'Aries',start:[3,21],end:[4,19],el:'fire', name:{'zh-CN':'ç™½ç¾Šåº§','ms':'Aries'}},
    {key:'Taurus',start:[4,20],end:[5,20],el:'earth',name:{'zh-CN':'é‡‘ç‰›åº§','ms':'Taurus'}},
    {key:'Gemini',start:[5,21],end:[6,21],el:'air',  name:{'zh-CN':'åŒå­åº§','ms':'Gemini'}},
    {key:'Cancer',start:[6,22],end:[7,22],el:'water',name:{'zh-CN':'å·¨èŸ¹åº§','ms':'Cancer'}},
    {key:'Leo',start:[7,23],end:[8,22],el:'fire',   name:{'zh-CN':'ç‹®å­åº§','ms':'Leo'}},
    {key:'Virgo',start:[8,23],end:[9,22],el:'earth',name:{'zh-CN':'å¤„å¥³åº§','ms':'Virgo'}},
    {key:'Libra',start:[9,23],end:[10,23],el:'air', name:{'zh-CN':'å¤©ç§¤åº§','ms':'Libra'}},
    {key:'Scorpio',start:[10,24],end:[11,22],el:'water',name:{'zh-CN':'å¤©èåº§','ms':'Scorpio'}},
    {key:'Sagittarius',start:[11,23],end:[12,21],el:'fire',name:{'zh-CN':'å°„æ‰‹åº§','ms':'Sagittarius'}},
    {key:'Capricorn',start:[12,22],end:[1,19],el:'earth',name:{'zh-CN':'æ‘©ç¾¯åº§','ms':'Capricorn'}},
    {key:'Aquarius',start:[1,20],end:[2,18],el:'air', name:{'zh-CN':'æ°´ç“¶åº§','ms':'Aquarius'}},
    {key:'Pisces',start:[2,19],end:[3,20],el:'water',name:{'zh-CN':'åŒé±¼åº§','ms':'Pisces'}}
  ];
  function inRange(m,d,[sm,sd],[em,ed]){
    return (sm<em || (sm===em && sd<=ed))
      ? ((m>sm || (m===sm && d>=sd)) && (m<em || (m===em && d<=ed)))
      : ((m>sm || (m===sm && d>=sd)) || (m<em || (m===em && d<=ed)));
  }
  function getSunSign(dateStr){
    const dt=new Date(dateStr), m=dt.getMonth()+1, d=dt.getDate();
    return SIGN_LIST.find(s=>inRange(m,d,s.start,s.end)) || SIGN_LIST[11];
  }

  const EL_TIPS = {
    'zh-CN':{
      fire:['è¡ŒåŠ¨åŠ›å¼ºã€å…ˆåšåæƒ³ï¼›è®¾â€œåœé¡¿é”®â€æ›´å‡†ã€‚','ä»¥çŸ­å†²åˆºæ¨è¿›å¤§ç›®æ ‡ï¼Œåˆ«æ‹–æˆé•¿çº¿ã€‚'],
      earth:['åŠ¡å®ç»†è‡´ï¼›ç»™è‡ªå·±â€œå¥½å¤Ÿäº†â€çš„ä¸‹é™ã€‚','å…ˆä¸Šçº¿åä¼˜åŒ–ï¼Œåˆ«è¢«å®Œç¾ä¸»ä¹‰æ‹–æ…¢ã€‚'],
      air:['æƒ³æ³•å¤šã€å–„æ²Ÿé€šï¼›å†™è¡ŒåŠ¨æ¸…å•é¿å…æ¼‚ç§»ã€‚','å®šä¿¡æ¯æ‘„å…¥ä¸Šé™ï¼Œç•™ç©ºç™½ã€‚'],
      water:['æ„Ÿå—åŠ›å¼ºï¼›æƒ…ç»ªå†™ä¸‹/åŠ¨èµ·æ¥è®©èƒ½é‡æµåŠ¨ã€‚','æ¯å¤©10åˆ†é’Ÿèº«ä½“æ‰«æå‡å‹ã€‚']
    }
  };

  /* ========================= æŠ¥å‘Šæ¸²æŸ“ ========================= */
  function renderProNatalReport(model){
    const wrap = gid('chartReport'); if(!wrap) return;
    const lang = getLang();
    const sun = getSunSign(model.date);
    const sunName = sun.name[lang] || sun.name['zh-CN'];
    const el = sun.el;
    const elTips = (EL_TIPS[lang]||EL_TIPS['zh-CN'])[el] || [];

    const pro = [
      { title:'å‘½ç›˜æ€»è§ˆ', body:`${esc(model.name||'')}${model.name?' Â· ':''}${model.date} ${model.time}${model.place?(' @ '+esc(model.place)) : ''}<br>å¤ªé˜³æ˜Ÿåº§ï¼š<b>${sunName}</b>` },
      { title:'æ€§æ ¼ç”»åƒ', body:`åŸºè°ƒç”±å¤ªé˜³æ˜Ÿåº§å®šè°ƒï¼š<b>${sunName}</b>ï¼›ä½ æ›´å€¾å‘ä»¥â€œ${el==='fire'?'è¡ŒåŠ¨':'earth'===el?'ç¨³å®š':'air'===el?'æ€è€ƒ':'æ„Ÿå—'}â€æ¥å›åº”ä¸–ç•Œã€‚` },
      { title:'å…³ç³»ä¸æ²Ÿé€š', list:[ 'å…ˆç¡®è®¤å¯¹æ–¹æ„Ÿå—/éœ€æ±‚å†ç»™å»ºè®®','æŠŠâ€œæˆ‘è§‚å¯Ÿâ€”æˆ‘æ„Ÿå—â€”æˆ‘éœ€è¦â€”æˆ‘è¯·æ±‚â€å››å¥æ³•å†™å‡ºæ¥','æ¯å‘¨ä¸€æ¬¡å…³ç³»æ£€è§†ï¼šè¯´ä¸€å¥æ„Ÿè°¢ï¼Œæä¸€ä¸ªå°æœŸå¾…' ] },
      { title:'äº‹ä¸šä¸å¤©èµ‹', list:[ 'åªä¿ç•™ä¸€ä¸ªæœ¬å‘¨äº‹ä¸šä¼˜å…ˆé¡¹ï¼Œå¹¶å†™å‡ºã€Œå®Œæˆå®šä¹‰ã€','ä»¥â€œ3Ã—25 åˆ†é’Ÿâ€ç•ªèŒ„é’Ÿæ¨è¿›å…³é”®ä»»åŠ¡','æŠŠä½ æœ€æ‹¿æ‰‹çš„èƒ½åŠ›ç»‘å®šåˆ°å¯è§äº§å‡ºï¼ˆä½œå“/æ¡ˆä¾‹ï¼‰' ] },
      { title:'è´¢å¯Œä¸ç‰©è´¨', list:[ 'å»ºç«‹æ¯æ—¥ 5 åˆ†é’Ÿé‡‘é’±æ£€è§†ï¼ˆæ”¯å‡º/ä»·å€¼/æœºä¼šï¼‰','æŠŠé’±æµåˆ†ä¸‰æ¡¶ï¼šç”Ÿæ´»/ç§¯ç´¯/å°è¯•','ä»»ä½•æ”¯å‡ºå†™ä¸€å¥â€œä¸ºä»€ä¹ˆå€¼å¾—â€' ] },
      { title:'å¥åº·ä¸èŠ‚å¾‹', list:[ 'å›ºå®šç¡å‰ 30 åˆ†é’Ÿæ— å±æ—¶é—´','æ¯å‘¨ 2 æ¬¡æœ‰æ°§ + 1 æ¬¡åŠ›é‡','åˆå 5 åˆ†é’Ÿä¼¸å±• + é¥®æ°´ 300ml' ] },
      { title:'æœ¬å‘¨æ‰§è¡Œæ¸…å•', list:[ 'ä»Šå¤©å‘ç›®æ ‡ç›¸å…³çš„äººå‘ 1 æ¡ä¸»åŠ¨è®¯æ¯','å®‰æ’ 1 å°æ—¶ç”¨äºâ€œå®‰é™çš„æ·±åº¦å·¥ä½œâ€','æ¸…ç† 3 ä»¶ä½ä»·å€¼æ‰¿è¯º','ä¸ºæ˜å¤©å†™ 3 æ¡æœ€å°è¡ŒåŠ¨' ] },
      { title:'æ¸©æŸ”æé†’', body: elTips.map(x=>`â€¢ ${x}`).join('<br>') }
    ];

    const proHTML = pro.map(sec=>{
      const items = sec.list
        ? `<ul>${sec.list.map(li=>`<li>${esc(li)}</li>`).join('')}</ul>`
        : `<p>${sec.body||''}</p>`;
      return `<div class="sec"><h3>${esc(sec.title)}</h3>${items}</div>`;
    }).join('');

    const vipGate = `
      <div class="ai-lock-overlay" style="position:static;margin-top:8px;padding-top:8px;border-top:1px solid #233145;text-align:center">
        <div class="tip" style="color:#ffd88a;font-weight:700;margin-bottom:4px">${t('vip_tip')}</div>
        <div class="sub" style="color:#9aa8b9;margin-top:4px">${t('vip_sub')}</div>
        <a class="btn" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener">${t('btn_unlock')}</a>
      </div>`;

    const vip = (localStorage.getItem('vipStatus')==='active' || !!localStorage.getItem('vipEmail'));
    if(!vip){
      const tmp = document.createElement('div');
      tmp.innerHTML = proHTML;
      const openParts = Array.from(tmp.children).slice(0,3).map(n=>n.outerHTML).join('');
      const lockedParts = Array.from(tmp.children).slice(3).map(n=>n.outerHTML).join('');
      wrap.innerHTML = openParts + lockedParts + vipGate;
    }else{
      wrap.innerHTML = proHTML;
    }
  }

  /* ========================= Butlerï¼ˆAI è§£è¯»å¡ï¼‰ ========================= */
  function ensureAiCard(){
    if (gid('aiCard')) return;
    const wrap = gid('chartReport'); if(!wrap) return;
    const sec = document.createElement('div'); sec.className='sec'; sec.id='aiCard';
    sec.innerHTML = `
      <h3 id="butlerTitle">${t('butler_title')}</h3>
      <div id="aiContent" class="ai-content">
        <div class="skeleton"><div style="height:10px;border-radius:6px;background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);animation:sh 1.2s infinite"></div></div>
      </div>
      <div class="chips" id="aiChips"></div>`;
    wrap.appendChild(sec);
  }

  function buildButlerSystemPrompt(lang, topic=''){
    const headers = [
      t('butler_profile'),
      t('butler_rel'),
      t('butler_career'),
      t('butler_money'),
      t('butler_todo'),
      t('butler_soft')
    ];
    const langName = getOutputLanguageName(lang);
    return [
      `You are "Xinlian Butler". OUTPUT LANGUAGE: ${langName}. Reply strictly in that language.`,
      'Warm, practical, actionable. No medical/legal conclusions.',
      'Markdown structure:',
      `## ${headers[0]}`,
      `## ${headers[1]} (2â€“4 bullets)`,
      `## ${headers[2]} (2â€“4 bullets)`,
      `## ${headers[3]} (2â€“3 bullets)`,
      `## ${headers[4]} (3â€“5 bullets; start with verbs; quantify if possible)`,
      `## ${headers[5]}`,
      topic ? `Primary focus topic: ${topic}` : ''
    ].filter(Boolean).join('\n');
  }

  async function fetchWithRetry(endpoints, body, { retries=2, timeout=15000, backoffBase=700, signal }={}){
    let lastErr;
    for(const url of endpoints){
      for(let a=0; a<=retries; a++){
        const ctl = new AbortController();
        const timer = setTimeout(()=>ctl.abort('timeout'), timeout);
        const onAbort = ()=> ctl.abort('outer-abort');
        if(signal){
          if(signal.aborted){ clearTimeout(timer); throw new DOMException('Aborted','AbortError'); }
          signal.addEventListener('abort', onAbort, { once:true });
        }
        try{
          const res = await fetch(url, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(body),
            signal: ctl.signal,
            cache:'no-store',
            credentials:'omit',
            keepalive:true
          });
          clearTimeout(timer); signal?.removeEventListener('abort', onAbort);
          if(res.ok) return res;
          if(!(res.status>=500 || res.status===429 || res.status===408)) throw new Error('HTTP '+res.status);
          await sleep(backoffBase*(a+1));
        }catch(err){
          clearTimeout(timer); signal?.removeEventListener('abort', onAbort);
          lastErr=err;
          if(err?.name==='AbortError') throw err;
          if(a===retries) break;
          await sleep(backoffBase*(a+1));
        }
      }
    }
    throw lastErr || new Error('All endpoints failed');
  }

  async function safeJson(res){
    const ct=(res.headers.get('content-type')||'').toLowerCase();
    if(ct.includes('application/json')) return res.json();
    const txt=await res.text();
    console.warn('[Butler] Non-JSON:', txt.slice(0,180));
    throw new Error('Non-JSON response');
  }

  function mdToHtml(md){
    const safe = esc(md||'');
    return safe
      .replace(/^###?\s+(.*)$/gm,'<h3 style="margin:8px 0 4px;color:#f2d27a">$1<\/h3>')
      .replace(/^\s*[-*]\s+(.*)$/gm,'â€¢ $1')
      .replace(/\*\*(.+?)\*\*/g,'<b>$1<\/b>')
      .replace(/\n{2,}/g,'\n\n')
      .replace(/\n/g,'<br/>');
  }

  function isVIP(){ return localStorage.getItem('vipStatus')==='active' || !!localStorage.getItem('vipEmail'); }

function localButlerFallback(lang, sunName, el){
  const tips = (EL_TIPS[lang] || EL_TIPS['zh-CN'])[el] || [];
  return `
      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_profile')}</h3>
      <p>${t('sun_title')}ï¼š${sunName}</p>

      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_rel')}</h3>
      <p>â€¢ å…ˆç¡®è®¤å¯¹æ–¹æ„Ÿå—ï¼Œå†ç»™å»ºè®®ã€‚</p>

      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_career')}</h3>
      <p>â€¢ æœ¬å‘¨åªå®šä¸€ä¸ªäº‹ä¸šä¼˜å…ˆé¡¹ï¼Œå¹¶å†™å‡ºã€Œå®Œæˆå®šä¹‰ã€ã€‚</p>

      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_money')}</h3>
      <p>â€¢ å»ºç«‹æ¯æ—¥é‡‘é’±æ£€è§†å°ä»ªå¼ã€‚</p>

      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_todo')}</h3>
      <p>â€¢ ä»Šå¤©ä¸ºä¼˜å…ˆé¡¹é¢„ç•™ 25 åˆ†é’Ÿä¸“æ³¨æ—¶é—´ã€‚</p>

      <h3 style="margin:12px 0 6px;color:#f2d27a">${t('butler_soft')}</h3>
      <p>${tips.map(x=>'â€¢ '+x).join('<br>')}</p>`;
}

  let aiAbort = null;
  let lastModel = null;

  async function runAI(topic = ''){
    ensureAiCard();
    const out = gid('aiContent');

    const { name, place, date, time } = readForm();
    if (!date) {
      // no date yet â†’ donâ€™t render Butler
      if (out) out.innerHTML = '';
      return;
    }

    if (aiAbort) { aiAbort.abort(); aiAbort = null; }
    const controller = new AbortController();
    aiAbort = controller;
    const thisCall = controller;

    const lang = getLang();
    const sun = getSunSign(date);
    const sunName = (sun.name[lang] || sun.name['zh-CN']);
    const el = sun.el;

    if (out) {
      out.innerHTML = `
        <div class='skeleton'>
          <div style='height:10px;border-radius:6px;
                      background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);
                      animation:sh 1.2s infinite'></div>
        </div>`;
    }

    const sys = buildButlerSystemPrompt(lang, topic);
    const at = place ? (' @ ' + place) : '';
    const usr = [
      `Name: ${name || '-'}`,
      `Birth: ${date} ${time || '12:00'}${at}`,
      `Sun sign: ${sunName} (element: ${el})`,
      topic ? `Task: ${topic}` : `Task: äº‹ä¸šè§£è¯»`
    ].join('\n');

    try {
      if (OFFLINE_MODE) throw new Error('OFFLINE_MODE');

      const res = await fetchWithRetry(
        ENDPOINTS,
        { messages: [
            { role: 'system', content: sys },
            { role: 'user', content: usr }
          ]
        },
        { retries: 2, timeout: 15000, signal: thisCall.signal }
      );

      if (thisCall.signal.aborted) return;

      const data = await safeJson(res);

      if (data && data.ok === false) {
        console.warn('[Butler] Worker upstream error:', data.status, data.error || data.msg);
        throw new Error('Worker-upstream-error');
      }

      const raw =
        data?.reply ||
        data?.text ||
        data?.choices?.[0]?.message?.content ||
        '';

      if (!raw) throw new Error('Empty');

      let html = mdToHtml(raw);

      if (!isVIP()) {
        const parts = raw.split(/\n##\s+/);
        const header = parts.shift() || '';
        const kept = [header, ...(parts.slice(0, 2).map(p => '## ' + p))].join('\n\n');

        html = mdToHtml(kept) + `
          <div class='ai-lock-overlay'
               style='position:static;margin-top:8px;padding-top:8px;
                      border-top:1px solid #233145;text-align:center'>
            <div class='tip'
                 style='color:#ffd88a;font-weight:700;margin-bottom:4px'>
              ${t('vip_tip')}
            </div>
            <div class='sub'
                 style='color:#9aa8b9;margin-top:4px'>
              ${t('vip_sub')}
            </div>
            <a class='btn'
               href='https://yourshopifyshop.com/products/monthly-vip'
               target='_blank' rel='noopener'>
              ${t('btn_unlock')}
            </a>
          </div>`;
      }

      if (out) out.innerHTML = html;
    } catch (e) {
      if (e?.name === 'AbortError') return;
      console.warn('[Butler] fallback:', e);

      if (out) {
        out.innerHTML = `
          <div class='ai-content'>
            <div style='color:#ffd88a;font-weight:700;margin-bottom:6px'>
              ${t('err_network')} / ${t('err_busy')}${t('offline_hint')}
            </div>
            ${localButlerFallback(lang, sunName, el)}
          </div>`;
      }
    } finally {
      if (thisCall === aiAbort) { aiAbort = null; }
    }
  }

  /* ========================= è¡¨å•/æµç¨‹ ========================= */
  function readForm(){
    const name=(gid('name')?.value||'').trim();
    const place=(gid('place')?.value||'').trim();
    const date=gid('birthdate')?.value||'';
    const time=gid('birthtime')?.value||'12:00';
    return { name, place, date, time };
  }

  function renderHeaderSummary(model){
    const s = gid('chartSummary'); if(!s) return;
    const at = model.place?(' @ '+model.place):'';
    s.textContent = `${model.name?model.name+' Â· ':''}${model.date} ${model.time}${at}`;
  }

  function renderOverview(model){
    const wrap = gid('chartReport'); if(!wrap) return;
    const sign=getSunSign(model.date);
    const lang=getLang();
    const signName=sign.name[lang]||sign.name['zh-CN'];
    const disclaimer='ï¼Šå½“å‰ä»…å±•ç¤ºå¤ªé˜³æ˜Ÿåº§ç¤ºæ„ï¼›å®Œæ•´ç›˜éœ€ä½¿ç”¨å‡ºç”Ÿåœ°ä¸ç²¾ç¡®æ—¶åˆ»è®¡ç®—ã€‚';
    wrap.innerHTML =
      `<div class='sec'><h3>æ¦‚è§ˆ</h3><p>${esc(model.name||'')}${model.name?' Â· ':''}${model.date} ${model.time}${model.place?(' @ '+esc(model.place)) : ''}</p><p class='muted' style='opacity:.75'>${disclaimer}</p></div>`+
      `<div class='sec'><h3>å¤ªé˜³æ˜Ÿåº§</h3><p>ä½ çš„å¤ªé˜³åœ¨ã€Œ${signName}ã€ã€‚</p></div>`+
      `<div class='sec'><h3>èƒ½é‡æç¤º</h3><p>${(EL_TIPS[lang]||EL_TIPS['zh-CN'])[sign.el].map(x=>'â€¢ '+x).join('<br>')}</p></div>`;
  }

function generateChart(){
  const btn = gid('genBtn');
  if(btn){ btn.disabled = true; setTimeout(()=>btn.disabled=false, 800); }

  const model = readForm();
  if(!model.date || !model.place){
    alert(t('alert_fill'));
    return;
  }

  // Remember for language switching
  lastModel = model;

  gid('result').style.display = 'block';
  renderHeaderSummary(model);

  // ç”¨ AI ç”Ÿæ•´ä»½æŠ¥å‘Šï¼ˆå¤šè¯­è¨€ï¼‰
  runNatalReportAI(model)
    .then(()=>{
      // å†åœ¨æŠ¥å‘Šåé¢æŒ‚å¿ƒæ€œç®¡å®¶å¡ç‰‡
      ensureAiCard();
      runAI();
    })
    .catch(e=>{
      console.warn('[generateChart] natal AI error:', e);
      // å¤±è´¥æ—¶ä»ç„¶ç»™ä¸€ä¸ªæœ€åŸºæœ¬çš„ overview + Butler fallback
      renderOverview(model);
      ensureAiCard();
      runAI();
    });
}

  async function runNatalReportAI(model){
  const wrap = gid('chartReport');
  if (!wrap) return;

  const lang = getLang();
  const sun = getSunSign(model.date);
  const sunName = sun.name[lang] || sun.name['zh-CN'];
  const el = sun.el;

  // skeleton loading UI
  wrap.innerHTML = `
    <div class="sec">
      <h3 style="margin:0 0 8px;color:#f2d27a">Loading / ç”ŸæˆæŠ¥å‘Šä¸­...</h3>
      <div style="height:10px;border-radius:6px;
                  background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);
                  animation:sh 1.2s infinite"></div>
    </div>
  `;

  const langName = getOutputLanguageName(lang);
  const at = model.place ? (' @ ' + model.place) : '';

  const sys = [
    `You are an astrology consultant. OUTPUT LANGUAGE: ${langName}.`,
    'Write in a warm, practical tone. No medical or legal claims.',
    'Use Markdown headings with this structure:',
    '## Overview',
    '## Personality',
    '## Relationships',
    '## Career & Life Direction',
    '## Money & Material Life',
    '## Health & Rhythm',
    '## This Week\'s Action List',
    '## Gentle Reminder',
    'Each section: 2â€“4 short paragraphs or bullet points. Focus on concrete, actionable advice.',
    'This is a simplified natal reading based on Sun sign only. Do not invent other placements (Moon, Rising, houses, etc.).'
  ].join('\n');

  const usr = [
    `Name: ${model.name || '-'}`,
    `Birth: ${model.date} ${model.time || '12:00'}${at}`,
    `Sun sign: ${sunName} (element: ${el})`,
    '',
    'Context:',
    '- This is a simplified natal chart, we only know the Sun sign & element.',
    '- Adapt advice to daily life, work, relationships, money, and health.',
    '- Make the style gentle but clear and efficient.'
  ].join('\n');

  try{
    if (OFFLINE_MODE) throw new Error('OFFLINE_MODE');

    const res = await fetchWithRetry(
      ENDPOINTS,
      {
        messages: [
          { role: 'system', content: sys },
          { role: 'user',   content: usr }
        ]
      },
      { retries: 2, timeout: 15000 }
    );

    const data = await safeJson(res);

    // if Worker returns {ok:false,...}, treat as error
    if (data && data.ok === false){
      console.warn('[NatalReport] Worker upstream error:', data.status, data.error || data.msg);
      throw new Error('Worker-upstream-error');
    }

    const raw =
      data?.reply ||
      data?.text ||
      data?.choices?.[0]?.message?.content ||
      '';

    if (!raw) throw new Error('Empty');

    // VIP gate: only full markdown for VIP; partial for non-VIP
    let html;
    if (!isVIP()) {
      const parts = raw.split(/\n##\s+/);
      const header = parts.shift() || '';
      const kept = [header, ...(parts.slice(0, 2).map(p => '## ' + p))].join('\n\n');
      html = mdToHtml(kept) + `
        <div class='ai-lock-overlay'
             style='position:static;margin-top:8px;padding-top:8px;
                    border-top:1px solid #233145;text-align:center'>
          <div class='tip'
               style='color:#ffd88a;font-weight:700;margin-bottom:4px'>
            ${t('vip_tip')}
          </div>
          <div class='sub'
               style='color:#9aa8b9;margin-top:4px'>
            ${t('vip_sub')}
          </div>
          <a class='btn'
             href='https://yourshopifyshop.com/products/monthly-vip'
             target='_blank' rel='noopener'>
            ${t('btn_unlock')}
          </a>
        </div>`;
    } else {
      html = mdToHtml(raw);
    }

    wrap.innerHTML = html;
  } catch(e){
    console.warn('[NatalReport] fallback:', e);
    const lang = getLang();
    const tips = (EL_TIPS[lang] || EL_TIPS['zh-CN'])[el] || [];
    wrap.innerHTML = `
      <div class="sec">
        <h3 style="margin:0 0 8px;color:#f2d27a">
          ${t('err_network')} / ${t('err_busy')}ï¼ˆæœ¬åœ°ç¦»çº¿è§£è¯»ï¼‰
        </h3>
        <p>å¤ªé˜³æ˜Ÿåº§ï¼š${sunName}</p>
        <p>${tips.map(x => 'â€¢ ' + x).join('<br>')}</p>
      </div>
    `;
  }
}
  
  /* ========================= å³ä¸‹è§’ Chat æ‚¬æµ®çƒ ========================= */
  function mountChat(){
    if(gid('ssChatFab')) return;
    const chatFab=document.createElement('div');
    chatFab.className='ss-chat-fab';
    chatFab.id='ssChatFab';
    chatFab.title=t('butler_chat_title');

    const chatPanel=document.createElement('div');
    chatPanel.className='ss-chat-panel';
    chatPanel.id='ssChatPanel';
    chatPanel.setAttribute('role','dialog');
    chatPanel.setAttribute('aria-label',t('butler_chat_title'));
    chatPanel.setAttribute('aria-modal','true');
    chatPanel.innerHTML =
      `<div class='ss-chat-head'><div class='ss-chat-title'>${t('butler_chat_title')}</div><div class='ss-close' id='ssChatClose'>âœ•</div></div>`+
      `<div class='ss-chat-body' id='ssChatBody' aria-live='polite'></div>`+
      `<div class='ss-chat-input'><input id='ssChatInput' type='text' placeholder='${t('chat_placeholder')}'/><button id='ssChatSend' class='btn'>${t('chat_send')}</button></div>`;

    document.body.appendChild(chatFab);
    document.body.appendChild(chatPanel);

    const $body=gid('ssChatBody'),
          $input=gid('ssChatInput'),
          $send=gid('ssChatSend'),
          $close=gid('ssChatClose');

    const openPanel=()=>{ chatPanel.style.display='block'; $input&&$input.focus(); };
    const closePanel=()=>{ chatPanel.style.display='none'; };

    chatFab.textContent=t('chat_fab');
    chatFab.addEventListener('click',openPanel);
    $close&&$close.addEventListener('click',closePanel);

    function addMsg(text,me=false){
      const div=document.createElement('div');
      div.className='ss-msg'+(me?' me':'');
      div.textContent=text;
      $body.appendChild(div);
      $body.scrollTop=$body.scrollHeight;
    }

    let chatAbort=null;
    async function askChat(prompt){
      addMsg(prompt,true);
      if($input){ $input.value=''; $input.focus(); }
      if(chatAbort){ chatAbort.abort(); chatAbort=null; }
      chatAbort=new AbortController();
      const thisCall=chatAbort;
      const lang = getLang();
      const sys=[
        `You are "Xinlian Butler". OUTPUT LANGUAGE: ${getOutputLanguageName(lang)}.`,
        'Help visitors understand features, navigation and VIP. Tone: warm, concise, professional.'
      ].join('\n');

      try{
        if(OFFLINE_MODE) throw new Error('OFFLINE_MODE');
        const res = await fetchWithRetry(
          ENDPOINTS,
          { messages:[ {role:'system',content:sys},{role:'user',content:prompt} ] },
          { retries:2, timeout:15000, signal:thisCall.signal }
        );
        if(thisCall.signal.aborted) return;
        const data=await safeJson(res);
        const reply=data?.reply??data?.text??data?.choices?.[0]?.message?.content??'';
        addMsg(reply || t('err_busy'));
      }catch(e){
        if(e?.name==='AbortError') return;
        addMsg(`${t('err_network')}ï¼Œ${t('err_busy')}ï¼ˆæœ¬åœ°ç¦»çº¿æ¨¡å¼ï¼‰`);
      }finally{
        if(thisCall===chatAbort) chatAbort=null;
      }
    }

    $send&&$send.addEventListener('click',()=>{
      const v=$input?.value.trim();
      if(v) askChat(v);
    });
    $input&&$input.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'){
        const v=$input.value.trim();
        if(v) askChat(v);
      }
    });
  }

  /* ========================= ç™»å½•å­—æ®µæ˜¾ç¤ºæ§åˆ¶ ========================= */
  function setupAuthVisibility(){
    const fields=gid('authFields');
    const loginBtn=gid('loginBtn');
    const registerBtn=gid('registerBtn');
    const resetBtn=gid('resetBtn');
    if(!fields||!loginBtn||!registerBtn) return;
    function show(){ fields.style.display='grid'; }
    loginBtn.addEventListener('click', (e)=>{
      if(fields.style.display==='none'){ e.preventDefault(); show(); }
    });
    registerBtn.addEventListener('click', (e)=>{
      if(fields.style.display==='none'){ e.preventDefault(); show(); }
    });
    resetBtn?.addEventListener('click', ()=>{
      fields.style.display='grid';
      const err = gid('authError');
      if(err) err.style.display='none';
    });
  }

  /* ========================= åˆå§‹åŒ– ========================= */
  document.addEventListener('DOMContentLoaded', ()=>{
    // è®°ä½è¯­è¨€
    const $lang = gid('langSelect');
    const saved = localStorage.getItem('astro_lang');
    if($lang && saved && Array.from($lang.options).some(o=>o.value===saved)){
      $lang.value = saved;
    }

    if(gid('birthdate') && !gid('birthdate').value){
      gid('birthdate').value = new Date().toISOString().split('T')[0];
    }

    const form = gid('chartForm');
    if(form){
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        if(!form.reportValidity()) return;
        generateChart();
      });
    }

if($lang){
  $lang.addEventListener('change', ()=>{
    localStorage.setItem('astro_lang', $lang.value);
    applyI18n();

    // åˆ·æ–° Chat UI æ–‡æ¡ˆ
    gid('ssChatFab') && (gid('ssChatFab').textContent = t('chat_fab'));
    const ct = qs('.ss-chat-title');
    if(ct) ct.textContent = t('butler_chat_title');
    const ip = gid('ssChatInput');
    if(ip) ip.placeholder = t('chat_placeholder');

    // å¦‚æœå·²ç»ç”Ÿæˆè¿‡ä¸€æ¬¡ï¼Œå°±ç”¨æ–°è¯­è¨€é‡è·‘ AI æŠ¥å‘Š + Butler
    if(lastModel){
      renderHeaderSummary(lastModel);
      runNatalReportAI(lastModel).then(()=>{
        ensureAiCard();
        runAI();
      }).catch(e=>{
        console.warn('[lang change] natal AI error:', e);
        renderOverview(lastModel);
        ensureAiCard();
        runAI();
      });
    }
  });
}

    // å¤´éƒ¨æ—¶é’Ÿ
    startNowClock();
    // åˆå§‹å¤šè¯­è¨€æ¸²æŸ“
    applyI18n();
    // Butler Chat æ‚¬æµ®çƒ
    mountChat();
    // ç™»å½•å­—æ®µé»˜è®¤éšè—
    setupAuthVisibility();
  });
})();
</script>
</body>
</html>







