<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="5XLiving 本命星盘：输入出生日期、时间和地点，获得个性化解读。">
  <meta name="theme-color" content="#0b0f14">
  <link rel="preconnect" href="https://throbbing-lab-1440.hello5xliving.workers.dev" crossorigin>
  <title>本命星盘 · Natal Chart | 5XLiving</title>
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7; --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff; --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35) }
    html,body{height:100%}
    body{ margin:0; color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14); font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale }
    body::before{ content:""; position:fixed; inset:0; z-index:-2; background:#090d13 url('') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px) }
    .container{ max-width:1100px; margin:0 auto; padding:24px 16px 80px }

    /* —— 统一头部 —— */
    .site-header{ position:sticky; top:0; z-index:10; background:#0b0f14cc; border-bottom:1px solid #0f1622; backdrop-filter:saturate(140%) blur(12px) }
    .head-inner{ display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text) }
    .brand-badge{ display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084 }
    .title{ font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; letter-spacing:.02em; font-size:1.1rem; line-height:1.25 }
    .title a{ color:inherit; text-decoration:none }
    .title a:hover{ text-decoration:underline; text-underline-offset:3px }
    .now{ color:#9bb0c3; font-size:.9rem }
    .lang{ display:flex; align-items:center; gap:8px }
    .lang label{ white-space:nowrap; color:var(--muted) }
    .lang select{ appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:#e8edf3; padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50% }
    @media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

    /* —— 页面结构 —— */
    .h1{ margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem }
    .sub{ color:var(--muted) }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:18px; margin:16px 0 }
    .row{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:760px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} }
    label.muted{ display:block; margin-bottom:4px }
    input,select{ width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:12px 12px; font-size:15px; outline:none }
    input::placeholder{ color:#6f8092 }
    .btn{ display:inline-grid; place-items:center; padding:12px 16px; border-radius:12px; border:1px solid #e6c76e; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; cursor:pointer }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .btn.ghost{ background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none }

    /* —— 报告样式 —— */
    .report{ margin-top:12px; display:grid; gap:10px }
    .report .sec{ padding:12px; border:1px solid var(--line); background:#0e1520; border-radius:12px }
    .report .sec h3{ margin:0 0 6px; color:#f2d27a; font-size:1.05rem }
    .report p,.report li{ line-height:1.7 }

    /* —— Butler & Chat —— */
    .ss-chat-fab{ position:fixed; right:18px; bottom:18px; z-index:50; width:56px; height:56px; border-radius:50%; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; display:grid; place-items:center; font-weight:800; box-shadow:0 8px 30px rgba(0,0,0,.35); cursor:pointer; border:1px solid #e6c76e }
    .ss-chat-panel{ position:fixed; right:18px; bottom:88px; z-index:50; width:min(460px,92vw); display:none; background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow) }
    .ss-chat-head{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244 }
    .ss-chat-title{ font-weight:700 }
    .ss-close{ cursor:pointer; opacity:.8 }
    .ss-chat-body{ max-height:300px; overflow:auto; padding:10px 12px }
    .ss-msg{ padding:8px 10px; background:#0f1624; border:1px solid #243244; border-radius:10px; margin:6px 0; max-width:80% }
    .ss-msg.me{ margin-left:auto; background:#132033 }
    .ss-chat-input{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-top:1px solid #243244 }
    .ss-chat-input input{ flex:1 1 auto; min-width:0 }
    .ss-chat-input .btn,.ss-chat-input button{ flex:0 0 auto; width:auto !important; white-space:nowrap; padding:10px 14px }

    /* —— 会员区 —— */
    .columns{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:900px){ .columns{ grid-template-columns:1fr 1fr } }
    .list-block{ border:1px solid #263448; background:#0e1520; border-radius:12px; padding:16px }
    .list-block ul{ margin:.2rem 0 0; padding-left:1.1rem }
    .group-title{ font-size:1.05rem; color:#ffe084; margin:6px 0 14px }
    .astro-auth{ max-width:980px; margin:28px auto; padding:20px 18px; background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35) }
    .auth-grid{ display:grid; gap:18px; grid-template-columns:1.2fr .8fr }
    @media(max-width:860px){ .auth-grid{ grid-template-columns:1fr } }
    .panel{ background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35) }
    .panel .head{ padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:.3px }
    .panel .body{ padding:18px }
    .spacer{ height:12px }
    footer{ color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0 }

    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{ display:none!important }
  </style>
</head>
<body>
  <!-- 统一头部 -->
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
        <span class="title">5xLiving · <span data-i18n="page_title">本命星盘解析</span></span>
      </a>
      <div class="now" id="nowBox" aria-live="polite"></div>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">语言</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" data-i18n="page_title">本命星盘解析</h1>

    <!-- 表单区域 -->
    <section class="card">
      <form id="chartForm" novalidate>
        <div class="row cols-3">
          <div>
            <label class="muted" for="name" data-i18n="label_name">姓名（可选）</label>
            <input id="name" type="text" data-i18n-ph="ph_name" placeholder="你的称呼（用于个性化）" />
          </div>
          <div>
            <label class="muted" for="gender" data-i18n="gender_label">性别</label>
            <select id="gender">
              <option value="u" data-i18n="opt_gender_confidential">不透露</option>
              <option value="m" data-i18n="opt_gender_male">男性</option>
              <option value="f" data-i18n="opt_gender_female">女性</option>
            </select>
          </div>
          <div>
            <label class="muted" for="place" data-i18n="label_place">出生地点 （必填）</label>
            <input id="place" type="text" required placeholder="城市或坐标，如：Taipei / 25.03,121.56" pattern="^(.{2,}|-?\d{1,2}(\.\d+)?,\s*-?\d{1,3}(\.\d+)?)$" title="输入城市名或坐标，如 Taipei 或 25.03,121.56"/>
          </div>
        </div>
        <div class="row cols-3" style="margin-top:10px">
          <div>
            <label class="muted" for="birthdate" data-i18n="label_birthdate">出生日期</label>
            <input id="birthdate" type="date" required />
          </div>
          <div>
            <label class="muted" for="birthtime" data-i18n="label_birthtime">出生时间</label>
            <input id="birthtime" type="time" value="12:00" step="60" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:10px">
            <button id="genBtn" class="btn" type="submit" data-i18n="btn_generate">生成星盘</button>
          </div>
        </div>
      </form>
    </section>

    <!-- 结果区域 -->
    <section id="result" class="card" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="chart_title">你的本命报告</h2>
      <div id="chartSummary" class="muted"></div>
      <div id="chartReport" class="report"></div>
    </section>

    <!-- 会员专区 -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">🌙 会员区域 VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">🗝 命理空间专属内容</div>
          <ul>
            <li data-i18n="vip_love">姻缘方向：恋爱缘分、婚姻走势</li>
            <li data-i18n="vip_career">事业方向：职场发展、创业潜力</li>
            <li data-i18n="vip_wealth">财运方向：财位分析、理财时机</li>
            <li data-i18n="vip_pet">宠物命理：伴侣动物的性格与缘分</li>
            <li data-i18n="vip_hepan">合盘分析：婚期择日、新生择时</li>
            <li data-i18n="vip_name">测名分析：公司名、宝宝名、命名改运</li>
            <li data-i18n="vip_fengshui">财位合盘：住家 / 办公室动线配合</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">🌙 心怜空间专属内容</div>
          <ul>
            <li data-i18n="vip_record">灵性记录：照片、梦境、声音、愿望祈祷</li>
            <li data-i18n="vip_course">命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图</li>
            <li data-i18n="vip_memorial">家族纪念系统：亲人灵性纪念 & 延续</li>
            <li data-i18n="vip_tasks">每周能量练习 / 神明仪式任务</li>
            <li data-i18n="vip_shop">能量商城专属折扣 & 御守订制</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">💎 登入 VIP 功能</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">账户登录 / 注册</div>
            <div class="body">
              <div class="row" id="authFields" style="display:none">
                <label for="email" class="sr-only" data-i18n="ph_email">邮箱 Email</label>
                <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="邮箱 Email" />
                <label for="password" class="sr-only" data-i18n="ph_label_password">密码 Password</label>
                <input id="password" type="password" autocomplete="new-password" placeholder="密码 Password（至少8位，含大小写数字符号）" data-i18n-ph="ph_password" />
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">登入账户</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">🔑 重设密码</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">注册账户</button>
                <div class="muted" data-i18n="note_price">注册账号赠送一次免费体验</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">会员服务</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">💎 升级为 VIP（月费）</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">← 返回命理商城</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>© 5XLiving • Astro Sanctuary</footer>
  </main>

<script>
(function(){
  'use strict';

  /* ========================= i18n 文案 ========================= */
  const I18N = {
    'zh-CN':{
      page_title:'本命星盘解析',
      lang_label:'语言',

      label_name:'姓名（可选）',
      ph_name:'你的称呼（用于个性化）',
      gender_label:'性别',
      opt_gender_confidential:'不透露',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地点 （必填）',
      label_birthdate:'出生日期',
      label_birthtime:'出生时间',
      btn_generate:'生成星盘',
      chart_title:'你的本命报告',

      // 结果区
      section_overview:'概览',
      section_sun:'太阳星座',
      section_energy:'能量提示',
      section_action:'本周可执行清单',

      // VIP 区（保持中文为主）
      vip_title:'🌙 会员区域 VIP Segment',
      vip_mingli:'🗝 命理空间专属内容',
      vip_love:'姻缘方向：恋爱缘分、婚姻走势',
      vip_career:'事业方向：职场发展、创业潜力',
      vip_wealth:'财运方向：财位分析、理财时机',
      vip_pet:'宠物命理：伴侣动物的性格与缘分',
      vip_hepan:'合盘分析：婚期择日、新生择时',
      vip_name:'测名分析：公司名、宝宝名、命名改运',
      vip_fengshui:'财位合盘：住家 / 办公室动线配合',

      vip_xinlian:'🌙 心怜空间专属内容',
      vip_record:'灵性记录：照片、梦境、声音、愿望祈祷',
      vip_course:'命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图',
      vip_memorial:'家族纪念系统：亲人灵性纪念 & 延续',
      vip_tasks:'每周能量练习 / 神明仪式任务',
      vip_shop:'能量商城专属折扣 & 御守订制',

      login_title:'💎 登入 VIP 功能',
      panel_login_head:'账户登录 / 注册',
      ph_email:'邮箱 Email',
      ph_label_password:'密码 Password',
      ph_password:'密码 Password（至少8位，含大小写数字符号）',
      btn_login:'登入账户',
      btn_reset:'🔑 重设密码',
      btn_register:'注册账户',
      note_price:'注册账号赠送一次免费体验',
      panel_member_head:'会员服务',
      btn_upgrade:'💎 升级为 VIP（月费）',
      btn_backshop:'← 返回命理商城',
      note_price1:'$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）',

      // 其它
      alert_fill:'请补全「出生日期」与「出生地点」。',
      disclaimer:'＊当前仅示意太阳星座；完整命盘需使用出生地与精确时刻计算。',
      action_1:'今天为自己预留 25 分钟安静时间，回顾这一年的成长。',
      action_2:'写下 3 件你想在接下来 30 天逐步推进的小目标。',
      action_3:'挑一位重要的人，发一句真诚的感谢或问候。',

      // 星座标题
      sun_label:'你的太阳星座：'
    },

    'zh-TW':{
      page_title:'本命星盤解析',
      lang_label:'語言',

      label_name:'姓名（選填）',
      ph_name:'你的稱呼（用於個人化）',
      gender_label:'性別',
      opt_gender_confidential:'不透露',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地點（必填）',
      label_birthdate:'出生日期',
      label_birthtime:'出生時間',
      btn_generate:'生成星盤',
      chart_title:'你的本命報告',

      section_overview:'總覽',
      section_sun:'太陽星座',
      section_energy:'能量提示',
      section_action:'本週可行動清單',

      vip_title:'🌙 會員區域 VIP Segment',
      vip_mingli:'🗝 命理空間專屬內容',
      vip_love:'姻緣方向：戀愛緣分、婚姻走勢',
      vip_career:'事業方向：職場發展、創業潛力',
      vip_wealth:'財運方向：財位分析、理財時機',
      vip_pet:'寵物命理：伴侶動物的性格與緣分',
      vip_hepan:'合盤分析：婚期擇日、新生擇時',
      vip_name:'測名分析：公司名、寶寶名、改名開運',
      vip_fengshui:'財位合盤：住家 / 辦公室動線搭配',

      vip_xinlian:'🌙 心憐空間專屬內容',
      vip_record:'靈性紀錄：照片、夢境、聲音、願望祈禱',
      vip_course:'命理課程：八字 / 塔羅 / 占星 / 靈數 / 人類圖',
      vip_memorial:'家族紀念系統：親人靈性紀念與延續',
      vip_tasks:'每週能量練習 / 神明儀式任務',
      vip_shop:'能量商城專屬折扣與御守訂製',

      login_title:'💎 登入 VIP 功能',
      panel_login_head:'帳號登入 / 註冊',
      ph_email:'信箱 Email',
      ph_label_password:'密碼 Password',
      ph_password:'密碼 Password（至少 8 碼，含大小寫與數字符號）',
      btn_login:'登入帳號',
      btn_reset:'🔑 重設密碼',
      btn_register:'註冊帳號',
      note_price:'註冊帳號贈送一次免費體驗',
      panel_member_head:'會員服務',
      btn_upgrade:'💎 升級為 VIP（月費）',
      btn_backshop:'← 返回命理商城',
      note_price1:'$9.9 / 月費 VIP（命理空間 + 心憐空間 + 靈性課程）',

      alert_fill:'請先填寫「出生日期」與「出生地點」。',
      disclaimer:'＊目前僅顯示太陽星座示意；完整命盤需搭配出生地與精確時間計算。',
      action_1:'今天預留 25 分鐘安靜時間，回顧這一年的成長。',
      action_2:'寫下 3 件你想在接下來 30 天逐步完成的小目標。',
      action_3:'挑一位重要的人，傳一句真誠的感謝或問候。',

      sun_label:'你的太陽星座：'
    },

    'en':{
      page_title:'Natal Chart Reading',
      lang_label:'Language',

      label_name:'Name (optional)',
      ph_name:'Your name (for personalization)',
      gender_label:'Gender',
      opt_gender_confidential:'Prefer not to say',
      opt_gender_male:'Male',
      opt_gender_female:'Female',
      label_place:'Birth place (required)',
      label_birthdate:'Date of birth',
      label_birthtime:'Time of birth',
      btn_generate:'Generate chart',
      chart_title:'Your natal report',

      section_overview:'Overview',
      section_sun:'Sun sign',
      section_energy:'Energy notes',
      section_action:'Action checklist',

      vip_title:'🌙 VIP Area',
      vip_mingli:'🗝 Destiny Space · Members only',
      vip_love:'Love & marriage: patterns and timing',
      vip_career:'Career: development & entrepreneurship potential',
      vip_wealth:'Wealth: money flow & timing',
      vip_pet:'Pets: soul companions & bonding',
      vip_hepan:'Synastry: relationship & newborn timing',
      vip_name:'Naming: business / baby / rename for luck',
      vip_fengshui:'Wealth + feng shui: home / office flow',

      vip_xinlian:'🌙 Xinlian Space · Members only',
      vip_record:'Soul records: photos, dreams, voice notes, wishes',
      vip_course:'Courses: Bazi / Tarot / Astrology / Numerology / Human Design',
      vip_memorial:'Family memorial: honoring loved ones',
      vip_tasks:'Weekly practices / ritual tasks',
      vip_shop:'Energy shop discounts & custom charms',

      login_title:'💎 VIP Login',
      panel_login_head:'Account login / Sign up',
      ph_email:'Email',
      ph_label_password:'Password',
      ph_password:'Password (min 8 chars, mixed case & symbols)',
      btn_login:'Log in',
      btn_reset:'🔑 Reset password',
      btn_register:'Create account',
      note_price:'Sign up to receive one free reading credit',
      panel_member_head:'Membership',
      btn_upgrade:'💎 Upgrade to VIP (monthly)',
      btn_backshop:'← Back to metaphysics shop',
      note_price1:'$9.9 / month VIP (Destiny Space + Xinlian Space + courses)',

      alert_fill:'Please fill in both "date of birth" and "birth place".',
      disclaimer:'*Currently shows Sun sign only; a full chart needs exact birth place and precise time.',
      action_1:'Block 25 minutes of quiet time today to reflect on your past year.',
      action_2:'Write down 3 small goals you want to move in the next 30 days.',
      action_3:'Send one genuine thank-you or check-in message to someone important.',

      sun_label:'Your Sun sign:'
    },

    'ja':{
      page_title:'本命チャート鑑定',
      lang_label:'言語',

      label_name:'お名前（任意）',
      ph_name:'表示用のお名前',
      gender_label:'性別',
      opt_gender_confidential:'回答しない',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地（必須）',
      label_birthdate:'生年月日',
      label_birthtime:'出生時刻',
      btn_generate:'チャートを作成',
      chart_title:'あなたの本命レポート',

      section_overview:'概要',
      section_sun:'太陽星座',
      section_energy:'エネルギーメモ',
      section_action:'今週の行動リスト',

      vip_title:'🌙 会員エリア VIP Segment',
      vip_mingli:'🗝 命理スペース会員専用コンテンツ',
      vip_love:'恋愛・結婚の流れとタイミング',
      vip_career:'仕事・キャリア・起業の可能性',
      vip_wealth:'お金の流れとチャンス',
      vip_pet:'ペットとの縁と性格',
      vip_hepan:'相性・結婚日・出産タイミング',
      vip_name:'会社名・命名・改名の鑑定',
      vip_fengshui:'住居 / オフィス動線と財位',

      vip_xinlian:'🌙 心憐スペース会員専用',
      vip_record:'写真・夢・音声・願いごとの記録',
      vip_course:'命理講座：四柱推命 / タロット / 占星術 など',
      vip_memorial:'家族メモリアル・先祖供養',
      vip_tasks:'毎週のエネルギーワーク / 儀式タスク',
      vip_shop:'エナジーグッズ割引・お守り',

      login_title:'💎 VIP ログイン',
      panel_login_head:'ログイン / 新規登録',
      ph_email:'メールアドレス',
      ph_label_password:'パスワード',
      ph_password:'パスワード（8文字以上・英数記号）',
      btn_login:'ログイン',
      btn_reset:'🔑 パスワード再設定',
      btn_register:'アカウント登録',
      note_price:'登録で無料セッション 1 回分をプレゼント',
      panel_member_head:'会員サービス',
      btn_upgrade:'💎 VIP（月額）にアップグレード',
      btn_backshop:'← ショップに戻る',
      note_price1:'月額 $9.9（命理スペース + 心憐スペース + 講座）',

      alert_fill:'「生年月日」と「出生地」を入力してください。',
      disclaimer:'＊現在は太陽星座のイメージのみ表示しています。正確な鑑定には出生地と正確な時刻が必要です。',
      action_1:'今日は 25 分だけ静かな時間をとり、この一年をふり返ってみましょう。',
      action_2:'今後 30 日で少しずつ進めたい小さな目標を 3 つ書き出してみましょう。',
      action_3:'大切な人に、感謝や近況のメッセージを 1 通送ってみましょう。',

      sun_label:'あなたの太陽星座：'
    },

    'th':{
      page_title:'ดวงกำเนิด · Natal Chart',
      lang_label:'ภาษา',

      label_name:'ชื่อ (ไม่บังคับ)',
      ph_name:'ชื่อสำหรับใช้ในรายงาน',
      gender_label:'เพศ',
      opt_gender_confidential:'ไม่ระบุ',
      opt_gender_male:'ชาย',
      opt_gender_female:'หญิง',
      label_place:'สถานที่เกิด (จำเป็น)',
      label_birthdate:'วันเกิด',
      label_birthtime:'เวลาเกิด',
      btn_generate:'สร้างดวงกำเนิด',
      chart_title:'รายงานดวงกำเนิดของคุณ',

      section_overview:'ภาพรวม',
      section_sun:'ราศีอาทิตย์',
      section_energy:'พลังงานประจำตัว',
      section_action:'เช็กลิสต์การลงมือทำ',

      vip_title:'🌙 พื้นที่สมาชิก VIP',
      vip_mingli:'🗝 เนื้อหาพิเศษด้านโหราศาสตร์',
      vip_love:'ความรักและการแต่งงาน',
      vip_career:'การงานและศักยภาพในการสร้างธุรกิจ',
      vip_wealth:'การเงินและจังหวะโอกาส',
      vip_pet:'ดวงสัตว์เลี้ยงและสายสัมพันธ์',
      vip_hepan:'ดวงคู่ / วันแต่งงาน / เวลาเกิดบุตร',
      vip_name:'ตั้งชื่อบริษัท / เด็ก / เปลี่ยนชื่อ',
      vip_fengshui:'ฮวงจุ้ยบ้านและที่ทำงานเกี่ยวกับโชคลาภ',

      vip_xinlian:'🌙 พื้นที่จิตวิญญาณ Xinlian',
      vip_record:'บันทึกรูป ความฝัน เสียง และคำอธิษฐาน',
      vip_course:'คอร์ส: ดวงจีน, แทโรต์, โหราศาสตร์ ฯลฯ',
      vip_memorial:'พื้นที่ระลึกถึงคนที่ล่วงลับ',
      vip_tasks:'ภารกิจพลังงานประจำสัปดาห์ / พิธีกรรม',
      vip_shop:'ส่วนลดพิเศษและเครื่องรางเฉพาะสมาชิก',

      login_title:'💎 เข้าสู่ระบบ VIP',
      panel_login_head:'เข้าสู่ระบบ / สมัครสมาชิก',
      ph_email:'อีเมล',
      ph_label_password:'รหัสผ่าน',
      ph_password:'รหัสผ่าน (อย่างน้อย 8 ตัวอักษร)',
      btn_login:'เข้าสู่ระบบ',
      btn_reset:'🔑 รีเซ็ตรหัสผ่าน',
      btn_register:'สมัครสมาชิก',
      note_price:'สมัครใหม่รับสิทธิ์ดูดวงฟรี 1 ครั้ง',
      panel_member_head:'บริการสมาชิก',
      btn_upgrade:'💎 อัปเกรดเป็น VIP (รายเดือน)',
      btn_backshop:'← กลับไปยังร้านค้า',
      note_price1:'VIP รายเดือน $9.9 (ดวง + Xinlian + คอร์ส)',

      alert_fill:'กรุณากรอกทั้ง "วันเกิด" และ "สถานที่เกิด"',
      disclaimer:'*ขณะนี้แสดงเพียงราศีอาทิตย์ ตัวอย่างคร่าว ๆ เท่านั้น ดวงเต็มต้องใช้สถานที่และเวลาเกิดที่แม่นยำ',
      action_1:'กันเวลาเงียบ ๆ 25 นาทีวันนี้เพื่อทบทวนปีที่ผ่านมา',
      action_2:'เขียนเป้าหมายเล็ก ๆ 3 ข้อที่อยากขยับภายใน 30 วัน',
      action_3:'ส่งข้อความขอบคุณหรือทักทายจริงใจให้ใครสักคนหนึ่ง',

      sun_label:'ราศีอาทิตย์ของคุณคือ:'
    },

    'ms':{
      page_title:'Carta Natal',
      lang_label:'Bahasa',

      label_name:'Nama (pilihan)',
      ph_name:'Nama anda (untuk laporan)',
      gender_label:'Jantina',
      opt_gender_confidential:'Tidak mahu nyatakan',
      opt_gender_male:'Lelaki',
      opt_gender_female:'Perempuan',
      label_place:'Tempat lahir (wajib)',
      label_birthdate:'Tarikh lahir',
      label_birthtime:'Masa lahir',
      btn_generate:'Jana carta',
      chart_title:'Laporan carta natal anda',

      section_overview:'Ringkasan',
      section_sun:'Tanda Matahari',
      section_energy:'Nota tenaga',
      section_action:'Senarai tindakan',

      vip_title:'🌙 Ruang Ahli VIP',
      vip_mingli:'🗝 Kandungan khas ruang takdir',
      vip_love:'Cinta & perkahwinan: corak dan masa',
      vip_career:'Kerjaya: perkembangan & potensi bisnes',
      vip_wealth:'Wang & peluang kewangan',
      vip_pet:'Haiwan peliharaan & ikatan jiwa',
      vip_hepan:'Synastry: hubungan & masa kelahiran anak',
      vip_name:'Nama syarikat / bayi / tukar nama untuk tuah',
      vip_fengshui:'Feng shui rezeki: rumah / pejabat',

      vip_xinlian:'🌙 Ruang Xinlian',
      vip_record:'Rekod jiwa: gambar, mimpi, audio, doa',
      vip_course:'Kursus: Bazi / Tarot / Astrologi / Numerologi / Human Design',
      vip_memorial:'Sistem memorial keluarga',
      vip_tasks:'Latihan tenaga mingguan / tugasan ritual',
      vip_shop:'Diskaun kedai tenaga & azimat khas',

      login_title:'💎 Log masuk VIP',
      panel_login_head:'Log masuk / Daftar akaun',
      ph_email:'Emel',
      ph_label_password:'Kata laluan',
      ph_password:'Kata laluan (min 8 aksara, campuran)',
      btn_login:'Log masuk',
      btn_reset:'🔑 Tetap semula kata laluan',
      btn_register:'Daftar akaun',
      note_price:'Daftar dan dapatkan satu sesi bacaan percuma',
      panel_member_head:'Perkhidmatan ahli',
      btn_upgrade:'💎 Naik taraf ke VIP (bulanan)',
      btn_backshop:'← Kembali ke kedai',
      note_price1:'VIP $9.9 / bulan (Ruang Takdir + Xinlian + Kursus)',

      alert_fill:'Sila lengkapkan "tarikh lahir" dan "tempat lahir".',
      disclaimer:'*Buat masa ini hanya menunjukkan tanda Matahari; carta penuh memerlukan tempat dan masa lahir yang tepat.',
      action_1:'Peruntukkan 25 minit waktu tenang hari ini untuk menilai kembali setahun yang lalu.',
      action_2:'Tulis 3 matlamat kecil yang ingin digerakkan dalam 30 hari akan datang.',
      action_3:'Hantar satu mesej terima kasih atau sapaan jujur kepada seseorang yang penting.',

      sun_label:'Tanda Matahari anda:'
    }
  };

  /* ========================= 工具函数 ========================= */
  const gid = id => document.getElementById(id);
  const qs  = (sel, root=document) => root.querySelector(sel);

  function getLang(){
    const sel = gid('langSelect');
    return sel?.value || 'zh-CN';
  }

  function t(key){
    const lang = getLang();
    return (I18N[lang] && I18N[lang][key]) || (I18N['zh-CN'][key] || key);
  }

  function esc(s){
    return String(s ?? '')
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
  }

  function applyI18n(){
    const lang = getLang();
    document.documentElement.lang = lang;

    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      const val = t(key);
      if(val != null) el.textContent = val;
    });

    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const key = el.getAttribute('data-i18n-ph');
      const val = t(key);
      if(val != null) el.setAttribute('placeholder', val);
    });

    // 同时更新 <title>
    const baseTitle = '5XLiving';
    document.title = t('page_title') + ' | ' + baseTitle;
  }

  /* ========================= 头部时钟 ========================= */
  function startNowClock(){
    const box = gid('nowBox');
    if(!box) return;
    const pad = n => (n<10 ? '0'+n : ''+n);
    function tick(){
      const now = new Date();
      const y = now.getFullYear();
      const m = pad(now.getMonth()+1);
      const d = pad(now.getDate());
      const hh = pad(now.getHours());
      const mm = pad(now.getMinutes());
      const ss = pad(now.getSeconds());
      box.textContent = `${y}-${m}-${d} ${hh}:${mm}:${ss} SGT`;
    }
    tick();
    setInterval(tick, 1000);
  }

  /* ========================= 星座 & 元素 ========================= */
  const SIGN_LIST = [
    { key:'Aries',       start:[3,21], end:[4,19],  el:'fire',
      name:{'zh-CN':'白羊座','zh-TW':'牡羊座','en':'Aries','ja':'牡羊座','th':'เมษ','ms':'Aries'} },
    { key:'Taurus',      start:[4,20], end:[5,20],  el:'earth',
      name:{'zh-CN':'金牛座','zh-TW':'金牛座','en':'Taurus','ja':'牡牛座','th':'พฤษภ','ms':'Taurus'} },
    { key:'Gemini',      start:[5,21], end:[6,21],  el:'air',
      name:{'zh-CN':'双子座','zh-TW':'雙子座','en':'Gemini','ja':'双子座','th':'เมถุน','ms':'Gemini'} },
    { key:'Cancer',      start:[6,22], end:[7,22],  el:'water',
      name:{'zh-CN':'巨蟹座','zh-TW':'巨蟹座','en':'Cancer','ja':'蟹座','th':'กรกฎ','ms':'Cancer'} },
    { key:'Leo',         start:[7,23], end:[8,22],  el:'fire',
      name:{'zh-CN':'狮子座','zh-TW':'獅子座','en':'Leo','ja':'獅子座','th':'สิงห์','ms':'Leo'} },
    { key:'Virgo',       start:[8,23], end:[9,22],  el:'earth',
      name:{'zh-CN':'处女座','zh-TW':'處女座','en':'Virgo','ja':'乙女座','th':'กันย์','ms':'Virgo'} },
    { key:'Libra',       start:[9,23], end:[10,23], el:'air',
      name:{'zh-CN':'天秤座','zh-TW':'天秤座','en':'Libra','ja':'天秤座','th':'ตุล','ms':'Libra'} },
    { key:'Scorpio',     start:[10,24],end:[11,22], el:'water',
      name:{'zh-CN':'天蝎座','zh-TW':'天蠍座','en':'Scorpio','ja':'蠍座','th':'พิจิก','ms':'Scorpio'} },
    { key:'Sagittarius', start:[11,23],end:[12,21], el:'fire',
      name:{'zh-CN':'射手座','zh-TW':'射手座','en':'Sagittarius','ja':'射手座','th':'ธนู','ms':'Sagittarius'} },
    { key:'Capricorn',   start:[12,22],end:[1,19],  el:'earth',
      name:{'zh-CN':'摩羯座','zh-TW':'魔羯座','en':'Capricorn','ja':'山羊座','th':'มังกร','ms':'Capricorn'} },
    { key:'Aquarius',    start:[1,20], end:[2,18],  el:'air',
      name:{'zh-CN':'水瓶座','zh-TW':'水瓶座','en':'Aquarius','ja':'水瓶座','th':'กุมภ์','ms':'Aquarius'} },
    { key:'Pisces',      start:[2,19], end:[3,20],  el:'water',
      name:{'zh-CN':'双鱼座','zh-TW':'雙魚座','en':'Pisces','ja':'魚座','th':'มีน','ms':'Pisces'} }
  ];

  function inRange(m,d,[sm,sd],[em,ed]){
    // 处理跨年区间（摩羯）
    if (sm < em || (sm === em && sd <= ed)) {
      return (m > sm || (m === sm && d >= sd)) &&
             (m < em || (m === em && d <= ed));
    } else {
      return (m > sm || (m === sm && d >= sd)) ||
             (m < em || (m === em && d <= ed));
    }
  }

  function getSunSign(dateStr){
    const dt = new Date(dateStr);
    if (Number.isNaN(dt.getTime())) return SIGN_LIST[11];
    const m = dt.getMonth() + 1;
    const d = dt.getDate();
    return SIGN_LIST.find(s => inRange(m,d,s.start,s.end)) || SIGN_LIST[11];
  }

  const EL_TIPS = {
    fire:{
      'zh-CN':[
        '你的火象能量很强，适合先行动再微调方向。',
        '把目标拆成一小步一小步，避免一次冲太猛而耗尽体力。'
      ],
      'zh-TW':[
        '你帶有強烈的火象能量，適合先行動再微調方向。',
        '把目標切成小步驟，避免一次衝太猛反而消耗殆盡。'
      ],
      'en':[
        'You carry strong fire energy: movement first, then fine-tuning.',
        'Break big goals into short sprints so you don’t burn out.'
      ],
      'ja':[
        'あなたには火のエネルギーが強く、まず動きながら方向を調整するタイプです。',
        '大きな目標は、小さなステップに分けて進めると燃え尽きにくくなります。'
      ],
      'th':[
        'คุณมีพลังธาตุไฟค่อนข้างแรง เหมาะกับ “ลงมือก่อน ค่อยปรับทีหลัง”。',
        'แบ่งเป้าหมายใหญ่ให้เป็นสเต็ปเล็ก ๆ จะช่วยไม่ให้หมดไฟง่ายเกินไป.'
      ],
      'ms':[
        'Anda membawa tenaga api yang kuat: bergerak dulu, kemudian halakan semula.',
        'Pecahkan matlamat besar kepada beberapa pecutan kecil supaya tidak cepat letih.'
      ]
    },
    earth:{
      'zh-CN':[
        '土象能量让你务实、重视安全感，但也容易卡在完美主义。',
        '给自己设一个「好够了就可以上线」的标准，再慢慢优化。'
      ],
      'zh-TW':[
        '土象能量讓你務實、重視安全感，也可能容易陷入完美主義。',
        '替自己設定一個「好到這裡就可以先上線」的標準，之後再微調。'
      ],
      'en':[
        'Earth energy makes you practical and security-focused, but perfectionism can slow you down.',
        'Set a “good enough to ship” line, then improve after you launch.'
      ],
      'ja':[
        '地のエネルギーは、現実的で安定志向ですが、完璧主義になりやすい面もあります。',
        '「ここまでできたら一旦出す」というラインを決め、その後に少しずつ改善していきましょう。'
      ],
      'th':[
        'พลังธาตุดินทำให้คุณเน้นความมั่นคงและความปลอดภัย แต่งานอาจช้าเพราะอยากให้เป๊ะทุกอย่าง.',
        'ลองกำหนดระดับว่า “แค่นี้ก็ส่งงานได้แล้ว” แล้วค่อยปรับรายละเอียดภายหลัง.'
      ],
      'ms':[
        'Tenaga bumi menjadikan anda praktikal dan sukakan rasa selamat, tetapi mudah terperangkap dalam perfeksionisme.',
        'Tetapkan tahap “cukup baik untuk dihantar”, kemudian perbaiki sedikit demi sedikit.'
      ]
    },
    air:{
      'zh-CN':[
        '风象能量带来很多灵感和点子，也容易分心、想太多。',
        '把想法写下来、排出优先顺序，就比较不会被信息淹没。'
      ],
      'zh-TW':[
        '風象能量帶來許多靈感與點子，但也容易分心、想太多。',
        '把想法寫下來並排出優先順序，就比較不會被資訊淹沒。'
      ],
      'en':[
        'Air energy gives you plenty of ideas, but also mental noise.',
        'Write down your ideas and prioritise them so your mind can rest.'
      ],
      'ja':[
        '風のエネルギーは、ひらめきやアイデアが多い反面、考えすぎや気の散りやすさもあります。',
        '思いついたことは書き出して優先順位をつけると、頭の中がスッキリしやすくなります。'
      ],
      'th':[
        'พลังธาตุลมทำให้คุณคิดเก่ง ไอเดียเยอะ แต่ก็วุ่นวายในหัวได้ง่าย.',
        'ลองเขียนไอเดียออกมาและจัดลำดับความสำคัญ จะช่วยให้จิตใจโล่งขึ้น.'
      ],
      'ms':[
        'Tenaga udara memberi anda banyak idea, tetapi juga mudah berserabut.',
        'Tulis semua idea dan susun ikut keutamaan supaya minda lebih tenang.'
      ]
    },
    water:{
      'zh-CN':[
        '水象能量让你感受细腻、共情力强，但情绪也容易被环境牵动。',
        '每天给自己一点时间写下感受，或用身体运动把情绪流动出去。'
      ],
      'zh-TW':[
        '水象能量讓你感受細膩、共感能力強，但情緒也容易被環境牽動。',
        '每天留一點時間寫下感受，或透過身體活動讓情緒流動出去。'
      ],
      'en':[
        'Water energy makes you deeply sensitive and empathic, but moods can be easily swayed.',
        'Give yourself a small daily ritual to name your feelings or move your body to let them flow.'
      ],
      'ja':[
        '水のエネルギーは、繊細さと共感力を与えてくれますが、環境に感情が揺さぶられやすい面もあります。',
        '毎日少しだけでも感情を書き出したり、体を動かしてエネルギーを流してあげましょう。'
      ],
      'th':[
        'พลังธาตุน้ำทำให้คุณอ่อนไหว รับความรู้สึกของคนอื่นได้ดี แต่อารมณ์ก็ขึ้นลงง่าย.',
        'ให้เวลาตัวเองทุกวันนิดหน่อย เพื่อเขียนหรือระบายความรู้สึกออกมาผ่านการเคลื่อนไหวของร่างกาย.'
      ],
      'ms':[
        'Tenaga air menjadikan anda sangat peka dan empati, tetapi emosi juga mudah terpengaruh.',
        'Setiap hari, luangkan sedikit masa untuk menulis perasaan atau menggerakkan badan agar emosi mengalir dengan sihat.'
      ]
    }
  };

  function getElementTips(el, lang){
    const pack = EL_TIPS[el];
    if(!pack) return [];
    return pack[lang] || pack['zh-CN'] || [];
  }

  /* ========================= 表单 & 报告 ========================= */
  let lastModel = null;

  function readForm(){
    const name  = (gid('name')?.value || '').trim();
    const place = (gid('place')?.value || '').trim();
    const date  = gid('birthdate')?.value || '';
    const time  = gid('birthtime')?.value || '';
    const gender = gid('gender')?.value || 'u';
    return { name, place, date, time, gender };
  }

  function renderHeaderSummary(model){
    const box = gid('chartSummary');
    if(!box) return;
    const namePart = model.name ? (model.name + ' · ') : '';
    const timePart = model.time || '';
    const placePart = model.place ? (' @ ' + model.place) : '';
    box.textContent = `${namePart}${model.date} ${timePart}${placePart}`;
  }

function renderReport(model){
  const result = gid('result');
  const wrap   = gid('chartReport');
  if(!wrap || !result) return;

  const lang = getLang();
  const sign = getSunSign(model.date);
  const signName = sign.name[lang] || sign.name['zh-CN'];
  const element = sign.el;
  const tips = getElementTips(element, lang);
  const L = key => t(key);

  const overviewTitle = esc(L('section_overview'));
  const sunTitle      = esc(L('section_sun'));
  const energyTitle   = esc(L('section_energy'));
  const actionTitle   = esc(L('section_action'));

  const sunLabel = esc(L('sun_label'));
  const disclaimer = esc(L('disclaimer'));

  // —— 性别文字 —— 
  const genderMap = {
    'zh-CN':{m:'男性',f:'女性',u:'—'},
    'zh-TW':{m:'男性',f:'女性',u:'—'},
    'en':{m:'Male',f:'Female',u:'—'},
    'ja':{m:'男性',f:'女性',u:'—'},
    'th':{m:'ชาย',f:'หญิง',u:'—'},
    'ms':{m:'Lelaki',f:'Perempuan',u:'—'}
  };
  const gPack = genderMap[lang] || genderMap['zh-CN'];
  const genderLabel = gPack[model.gender] || gPack.u;

  // —— 标题（根据语言切换）——
  const hPersona = (
    lang === 'en' ? 'Personality Portrait' :
    lang === 'ja' ? '性格画像' :
    lang === 'th' ? 'ภาพรวมบุคลิก' :
    lang === 'ms' ? 'Potret keperibadian' :
    '性格画像'
  );

  const hRelation = (
    lang === 'en' ? 'Relationships & Communication' :
    lang === 'ja' ? '人間関係とコミュニケーション' :
    lang === 'th' ? 'ความสัมพันธ์และการสื่อสาร' :
    lang === 'ms' ? 'Hubungan & komunikasi' :
    '关系与沟通'
  );

  const hCareer = (
    lang === 'en' ? 'Career & Wealth Direction' :
    lang === 'ja' ? '仕事と豊かさの方向性' :
    lang === 'th' ? 'ทิศทางงานและทรัพย์' :
    lang === 'ms' ? 'Arah kerjaya & kewangan' :
    '事业与财富走向'
  );

  // —— 按元素给比较“大师风”一点的文案 —— 
  let personaLines = [];
  let relationLines = [];
  let careerLines = [];

  if (lang === 'zh-CN' || lang === 'zh-TW') {
    if (element === 'water') {
      personaLines = [
        `这是一个以「感受」为起点的命格。太阳在${signName}，意味着你很多决定来自直觉与心里的隐隐感觉，而不是冰冷的逻辑。`,
        `你天生带着同理心，容易读懂别人没说出口的东西，也因此更需要学会分清「自己的情绪」与「别人的情绪」。`
      ];
      relationLines = [
        `在人际上，你重视安全感和信任，一旦真正认定一个人，会愿意默默守在身边很久。但外界只看到你的温柔，不一定看得见你内心的界线。`,
        `建议：重要关系中，把「我真正需要什么」说清楚，不要只顾着照顾别人，最后心里累积委屈。`,
        `一句简单的「其实这件事我会有点难过」比冷战更有力量。`
      ];
      careerLines = [
        `工作上，你适合做「把混乱变成秩序、把抽象变成具体」的角色：例如顾问、陪伴者、创作者、服务导向的工作者。`,
        `赚钱的关键在于：不要小看自己看人的直觉，你对人性、对氛围的敏感，其实是可以转成专业价值的。`,
        `当你允许自己收合理的费用、并设定清楚的界线，财运才会稳定，而不是靠情绪起伏在撑。`
      ];
    } else if (element === 'fire') {
      personaLines = [
        `这是一个以「行动」为起点的命格。你不喜欢原地打转，更擅长在实作中摸索答案。`,
        `内在有一团火，驱动你去挑战、去开路；但也要学会照顾好自己的体力与情绪界线。`
      ];
      relationLines = [
        `你在关系中不怕表达，只是有时节奏过快，会让比较慢热的人跟不上。`,
        `练习在关键对话前，多停一口气，先确认对方的准备程度，再丢出自己的真实。`
      ];
      careerLines = [
        `事业上适合扮演「点火的人」——启动项目、带氛围、打头阵。`,
        `财运来自你敢承担风险、也愿意为目标付出实际行动，而不是只停在想。`
      ];
    } else if (element === 'earth') {
      personaLines = [
        `这是一个以「现实与结构」为起点的命格。你习惯先评估风险，再踏出一步。`,
        `你可靠、重视承诺，也因此容易背太多责任在身上。`
      ];
      relationLines = [
        `在关系中，你不会轻易开口说爱，但会用很实际的方式在照顾对方。`,
        `建议：适度说出你的在意，不要只用「帮忙」来表达爱，否则别人未必能读懂你的用心。`
      ];
      careerLines = [
        `事业上适合稳扎稳打的领域：需要耐心、需要专业累积的工作，你会越做越有价值。`,
        `财运上，最忌「为了安全感而抓太紧」，学会让钱流动在真正对你重要的事物上，会比单纯存钱更有力量。`
      ];
    } else if (element === 'air') {
      personaLines = [
        `这是一个以「思考与交流」为起点的命格。你天生就容易收到很多资讯、很多点子。`,
        `你擅长用语言、文字、概念来连结世界，只是也容易陷在大脑里，忘了照顾身体。`
      ];
      relationLines = [
        `在人际间，你喜欢对话、喜欢跟聪明的人互相碰撞观点。`,
        `建议：关键时刻，多讲一点内心感受，而不仅是观点，这样关系才会更有温度。`
      ];
      careerLines = [
        `工作上，你适合写作、沟通、企划、教学、顾问等需要「传递资讯」的角色。`,
        `财运来自你的脑袋与表达能力：当你愿意把脑中的洞见整理成结构化的内容，价值就会被看见。`
      ];
    }
  } else {
    // 非中文语言：给相对中性的英文/多语说明
    personaLines = [
      `Your Sun in ${signName} suggests that your core way of being is coloured by ${element}-energy.`,
      `This chart wants you to honour both your instincts and your sensitivity, instead of forcing yourself to fit into someone else’s template.`
    ];
    relationLines = [
      `In relationships, your growth theme is to communicate needs clearly instead of waiting for others to guess.`,
      `A simple “this is how I feel and this is what I need” said calmly is often more powerful than silence.`
    ];
    careerLines = [
      `In career, you are invited to build a path that reflects your natural strengths, not just what is “safe” on paper.`,
      `Money tends to flow more steadily when your work is aligned with your values and when you respect your own boundaries.`
    ];
  }

  const personaHtml = `
    <div class="sec">
      <h3>${esc(hPersona)}</h3>
      <p>${personaLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const relationHtml = `
    <div class="sec">
      <h3>${esc(hRelation)}</h3>
      <p>${relationLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const careerHtml = `
    <div class="sec">
      <h3>${esc(hCareer)}</h3>
      <p>${careerLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const overviewHtml = `
    <div class="sec">
      <h3>${overviewTitle}</h3>
      <p>${esc(model.name || '')}${model.name?' · ':''}${esc(model.date)} ${esc(model.time || '')}${model.place?(' @ '+esc(model.place)) : ''}</p>
      <p class="muted" style="opacity:.8">${disclaimer}</p>
    </div>`;

  const sunHtml = `
    <div class="sec">
      <h3>${sunTitle}</h3>
      <p>${sunLabel} <b>${esc(signName)}</b></p>
      <p class="muted">${genderLabel !== '—' ? ('Gender / 性别：'+esc(genderLabel)) : ''}</p>
    </div>`;

  const energyHtml = `
    <div class="sec">
      <h3>${energyTitle}</h3>
      <p>${tips.map(line=>'• '+esc(line)).join('<br>')}</p>
    </div>`;

  const actionHtml = `
    <div class="sec">
      <h3>${actionTitle}</h3>
      <ul>
        <li>${esc(L('action_1'))}</li>
        <li>${esc(L('action_2'))}</li>
        <li>${esc(L('action_3'))}</li>
      </ul>
    </div>`;

  // —— 最终组合：结构更像完整报告 —— 
  wrap.innerHTML =
    overviewHtml +
    sunHtml +
    personaHtml +
    relationHtml +
    careerHtml +
    energyHtml +
    actionHtml;

  result.style.display = 'block';
}

  /* ========================= IP → 出生地点预填 ========================= */
  async function fillBirthPlaceFromIP(){
    const input = gid('place');
    if(!input || input.value) return;
    try{
      const res = await fetch('https://ipapi.co/json/');
      if(!res.ok) return;
      const data = await res.json();
      const country = data.country_name || data.country;
      const city = data.city;
      const guess = (city && country) ? `${city}, ${country}` : (country || '');
      if(guess && !input.value){
        input.value = guess;
      }
    }catch(e){
      console.warn('[geo] failed:', e);
    }
  }

  /* ========================= 初始化 ========================= */
  document.addEventListener('DOMContentLoaded', ()=>{
    // 恢复语言
    const langSel = gid('langSelect');
    if(langSel){
      const saved = localStorage.getItem('natal_lang');
      if(saved && Array.from(langSel.options).some(o=>o.value===saved)){
        langSel.value = saved;
      }
      langSel.addEventListener('change', ()=>{
        localStorage.setItem('natal_lang', langSel.value);
        applyI18n();
        if(lastModel){
          renderHeaderSummary(lastModel);
          renderReport(lastModel);
        }
      });
    }

    // 初始化文案
    applyI18n();

    // 头部时钟
    startNowClock();

    // 默认日期：今天；时间：当前 HH:MM
    const dateInput = gid('birthdate');
    const timeInput = gid('birthtime');
    const now = new Date();
    const pad = n => (n<10 ? '0'+n : ''+n);
    if(dateInput && !dateInput.value){
      dateInput.value = now.toISOString().split('T')[0];
    }
    if(timeInput && !timeInput.value){
      const hh = pad(now.getHours());
      const mm = pad(now.getMinutes());
      timeInput.value = `${hh}:${mm}`;
    }

    // 出生地点：尝试用 IP 国家 / 城市预填
    fillBirthPlaceFromIP();

    // 表单提交
    const form = gid('chartForm');
    if(form){
      form.addEventListener('submit', handleGenerate);
    }
  });

})();
</script>
</body>
</html>




