<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>æœ¬å‘½æ˜Ÿç›˜ Â· Natal Chart | 5XLiving</title>
  <link rel="icon" href="data:," />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@600&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

    /* â€”â€” ç»Ÿä¸€å¤´éƒ¨ â€”â€” */
    .site-header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084}
    .title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em}
    .title a{ color: inherit; text-decoration: none; }
    .title a:hover{ text-decoration: underline; text-underline-offset: 3px; }
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{white-space:nowrap; color:var(--muted)}
    .lang select{appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}
    .auth-btn{margin-left:10px; padding:10px 12px; border-radius:10px; border:1px solid rgba(212,175,55,.45); background:#0e1520; color:#ffe084; cursor:pointer}
    @media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

    /* â€”â€” é¡µé¢ç»“æ„ â€”â€” */
    .h1{margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem}
    .sub{color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .row{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:760px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} }
    label.muted{display:block;margin-bottom:4px}
    input,select{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);padding:12px 12px;font-size:15px;outline:none}
    input::placeholder{color:#6f8092}
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}

    /* â€”â€” GPT/å¿ƒæ€œç®¡å®¶ â€”â€” */
    .ss-chat-fab{position:fixed; right:18px; bottom:18px; z-index:50; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; padding:12px 16px; border-radius:999px; border:1px solid #e6c76e; box-shadow:var(--shadow); cursor:pointer}
    .ss-chat-panel{position:fixed; right:18px; bottom:88px; width:min(460px,92vw); max-height:70vh; background:#0e1520; border:1px solid #243244; border-radius:16px; display:none; flex-direction:column; overflow:hidden; box-shadow:var(--shadow); z-index:50}
    .ss-chat-panel[aria-hidden="false"]{display:flex}
    .ss-chat-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244}
    .ss-chat-title{font-weight:700}
    .ss-close{cursor:pointer; opacity:.8}
    .ss-chat-body{padding:12px; overflow:auto; display:flex; flex-direction:column; gap:10px}
    .ss-msg{background:#11161dcc; border:1px solid #243244; padding:10px; border-radius:10px; font-size:.95rem; max-width:80%}
    .ss-msg .meta{font-size:.8rem; color:var(--muted); margin-bottom:4px}
    .ss-msg.me{margin-left:auto; background:#132033}
    .ss-chat-input{display:flex; gap:8px; padding:10px; border-top:1px solid #243244}
    .ss-chat-input input{flex:1; padding:10px; border-radius:10px; border:1px solid #273245; background:#0b0f14; color:var(--text)}

    /* â€”â€” ç™»å½•å¼¹çª— â€”â€” */
    .auth-mask{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:60}
    .auth-mask[aria-hidden="false"]{display:flex}
    .auth-box{width:min(520px,92vw); background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow)}
    .auth-head{padding:12px 14px; border-bottom:1px solid #243244; font-weight:700}
    .auth-body{padding:14px}
    .auth-actions{display:flex; gap:10px; justify-content:flex-end; padding:0 14px 14px}

    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}
  </style>
</head>
<body>
  <!-- ç»Ÿä¸€å¤´éƒ¨ -->
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self" aria-label="5xLiving Home">
        <span class="brand-badge">5X</span>
        <span class="title">5xLiving Â· å‘½ç†å¿ƒæ€œç©ºé—´ Â· Soul Sanctuary</span>
      </a>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
        <button id="openAuth" class="auth-btn" type="button" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" data-i18n="page_title">æœ¬å‘½æ˜Ÿç›˜è§£æ Â· Natal Birth Chart</h1>
    <p class="sub" data-i18n="page_sub">è¯·è¾“å…¥å‡ºç”Ÿèµ„æ–™ï¼Œæˆ‘ä»¬å°†ä¸ºä½ ç»˜åˆ¶ä¸“å±çš„æœ¬å‘½æ˜Ÿå›¾ï¼ˆæ¼”ç¤ºç‰ˆï¼‰ã€‚</p>

    <!-- è¡¨å•åŒºåŸŸ -->
    <section class="card">
      <div class="row cols-3">
        <div>
          <label class="muted" for="name" data-i18n="label_name">å§“åï¼ˆå¯é€‰ï¼‰</label>
          <input id="name" type="text" data-i18n-ph="ph_name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
        </div>
        <div>
          <label class="muted" for="gender" data-i18n="gender_label">æ€§åˆ«</label>
          <select id="gender">
            <option value="u" data-i18n="opt_gender_confidential">ä¸é€éœ²</option>
            <option value="m" data-i18n="opt_gender_male">ç”·æ€§</option>
            <option value="f" data-i18n="opt_gender_female">å¥³æ€§</option>
          </select>
        </div>
        <div>
          <label class="muted" for="place" data-i18n="label_place">å‡ºç”Ÿåœ°ç‚¹</label>
          <input id="place" type="text" data-i18n-ph="ph_place" placeholder="åŸå¸‚æˆ–åæ ‡ï¼Œå¦‚ï¼šTaipei / 25.03,121.56" />
        </div>
      </div>
      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted" for="birthdate" data-i18n="label_birthdate">å‡ºç”Ÿæ—¥æœŸ</label>
          <input id="birthdate" type="date" />
        </div>
        <div>
          <label class="muted" for="birthtime" data-i18n="label_birthtime">å‡ºç”Ÿæ—¶é—´</label>
          <input id="birthtime" type="time" />
        </div>
        <div style="display:flex;align-items:flex-end;gap:10px">
          <button id="genBtn" class="btn" type="button" data-i18n="btn_generate">ç”Ÿæˆæ˜Ÿç›˜</button>
          <button id="demoBtn" class="btn ghost" type="button" data-i18n="btn_demo">ç¤ºä¾‹</button>
        </div>
      </div>
      <div id="formNote" class="muted" style="margin-top:8px" data-i18n="note_privacy">æç¤ºï¼šä»…åœ¨æœ¬åœ°æ¼”ç¤ºç”¨ï¼Œä¸ä¼šä¸Šä¼ ä½ çš„ä¸ªäººä¿¡æ¯ã€‚</div>
    </section>

    <!-- ç»“æœåŒºåŸŸï¼ˆå ä½ï¼‰ -->
    <section id="result" class="card" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="chart_title">ä½ çš„æœ¬å‘½æ˜Ÿç›˜</h2>
      <div id="chartSummary" class="muted"></div>
      <div style="margin-top:12px" id="chartCanvasWrap">
        <div class="muted" data-i18n="chart_placeholder">ï¼ˆå¯åœ¨æ­¤å¤„æ¥å…¥åç«¯ç»˜å›¾æˆ–å‰ç«¯ Canvas æ¸²æŸ“Â·å½“å‰ä¸ºå ä½ï¼‰</div>
      </div>
    </section>

    <footer>Â© 5XLiving â€¢ Astro & Soul Sanctuary</footer>
  </main>

  <!-- ç™»å½•å¼¹çª— -->
  <div id="authMask" class="auth-mask" aria-hidden="true">
    <div class="auth-box" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="auth-head" id="authTitle" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
      <div class="auth-body">
        <div class="row">
          <div>
            <label class="muted" for="email" data-i18n="ph_email">é‚®ç®± Email</label>
            <input id="email" type="email" autocomplete="username" />
          </div>
          <div>
            <label class="muted" for="password" data-i18n="ph_label_password">å¯†ç  Password</label>
            <input id="password" type="password" autocomplete="current-password" data-i18n-ph="ph_password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" />
          </div>
        </div>
        <div id="authError" class="card" style="display:none;color:#ffb4b4;border-color:#ff6a6a;background:rgba(255,90,95,.08)"></div>
      </div>
      <div class="auth-actions">
        <button id="loginBtn" class="btn" type="button" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
        <button id="registerBtn" class="btn ghost" type="button" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
        <button id="resetBtn" class="btn ghost" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
        <button id="closeAuth" class="btn ghost" type="button">âœ•</button>
      </div>
    </div>
  </div>

  <!-- GPT / å¿ƒæ€œç®¡å®¶æµ®çª— -->
  <div class="ss-chat-fab" id="chatFab">å¿ƒæ€œç®¡å®¶</div>
  <div class="ss-chat-panel" id="chatPanel" aria-hidden="true">
    <div class="ss-chat-head">
      <div class="ss-chat-title" id="chatTitle">å¿ƒæ€œç®¡å®¶ Â· GPT</div>
      <div class="ss-close" id="chatClose">âœ•</div>
    </div>
    <div class="ss-chat-body" id="chatBody">
      <div class="ss-msg"><div class="meta">Demo</div>å½“å‰ä¸ºå‰ç«¯ç¤ºä¾‹ã€‚æ¥å…¥åç«¯ï¼šåœ¨ <code>sendGPT()</code> ä¸­è°ƒç”¨ä½ çš„ APIã€‚</div>
    </div>
    <div class="ss-chat-input">
      <input id="chatInput" placeholder="è¾“å…¥é—®é¢˜â€¦"/>
      <button class="btn" id="chatSend">å‘é€</button>
    </div>
  </div>

  <script>
  'use strict';
  const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';
  const LANG_KEY = 'site_lang';

  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  /* ===== i18nï¼ˆäº”è¯­ï¼‰ ===== */
  const I18N = {
    'zh-CN': {
      lang_label:'è¯­è¨€',
      btn_login:'ç™»å…¥è´¦æˆ·', btn_register:'æ³¨å†Œè´¦æˆ·', btn_reset:'ğŸ”‘ é‡è®¾å¯†ç ',
      page_title:'æœ¬å‘½æ˜Ÿç›˜è§£æ Â· Natal Birth Chart',
      page_sub:'è¯·è¾“å…¥å‡ºç”Ÿèµ„æ–™ï¼Œæˆ‘ä»¬å°†ä¸ºä½ ç»˜åˆ¶ä¸“å±çš„æœ¬å‘½æ˜Ÿå›¾ï¼ˆæ¼”ç¤ºç‰ˆï¼‰ã€‚',
      label_name:'å§“åï¼ˆå¯é€‰ï¼‰', ph_name:'ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰',
      gender_label:'æ€§åˆ«', opt_gender_confidential:'ä¸é€éœ²', opt_gender_male:'ç”·æ€§', opt_gender_female:'å¥³æ€§',
      label_place:'å‡ºç”Ÿåœ°ç‚¹', ph_place:'åŸå¸‚æˆ–åæ ‡ï¼Œå¦‚ï¼šTaipei / 25.03,121.56',
      label_birthdate:'å‡ºç”Ÿæ—¥æœŸ', label_birthtime:'å‡ºç”Ÿæ—¶é—´',
      btn_generate:'ç”Ÿæˆæ˜Ÿç›˜', btn_demo:'å¡«å…¥ç¤ºä¾‹', note_privacy:'æç¤ºï¼šä»…åœ¨æœ¬åœ°æ¼”ç¤ºç”¨ï¼Œä¸ä¼šä¸Šä¼ ä½ çš„ä¸ªäººä¿¡æ¯ã€‚',
      chart_title:'ä½ çš„æœ¬å‘½æ˜Ÿç›˜', chart_placeholder:'ï¼ˆå¯åœ¨æ­¤å¤„æ¥å…¥åç«¯ç»˜å›¾æˆ–å‰ç«¯ Canvas æ¸²æŸ“Â·å½“å‰ä¸ºå ä½ï¼‰',
      panel_login_head:'è´¦æˆ·ç™»å½• / æ³¨å†Œ', ph_email:'é‚®ç®± Email', ph_password:'å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰', ph_label_password:'å¯†ç  Password',
      chat_fab:'é—®', chat_placeholder:'è¯·é—®æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šåŠŸèƒ½ã€ä¼šå‘˜è¯´æ˜ï¼‰', chat_send:'å‘é€',
      err_need_ep:'è¯·è¾“å…¥é‚®ç®±ä¸å¯†ç ', err_pwd_rule:'å¯†ç è‡³å°‘8ä½ï¼Œéœ€åŒ…å«å¤§å†™/å°å†™/æ•°å­—/ç‰¹æ®Šç¬¦å·', err_email_empty:'é‚®ç®±ä¸èƒ½ä¸ºç©º', err_pwd_empty:'å¯†ç ä¸èƒ½ä¸ºç©º', err_login_fail:'ç™»å…¥å¤±è´¥ï¼š', err_register_fail:'æ³¨å†Œå¤±è´¥ï¼š', err_reset_fail:'é‡è®¾å¯†ç å¤±è´¥ï¼š', err_no_account:'è´¦æˆ·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œ', err_wrong_pwd:'å¯†ç é”™è¯¯', err_expired:'ä¼šå‘˜å·²è¿‡æœŸï¼Œè¯·ç»­è´¹', msg_reset_ok:'å¯†ç å·²æˆåŠŸæ›´æ–°ï¼Œè¯·ç”¨æ–°å¯†ç é‡æ–°ç™»å…¥ã€‚'
    },
    'zh-TW': {
      lang_label:'èªè¨€',
      btn_login:'ç™»å…¥å¸³æˆ¶', btn_register:'è¨»å†Šå¸³æˆ¶', btn_reset:'ğŸ”‘ é‡è¨­å¯†ç¢¼',
      page_title:'æœ¬å‘½æ˜Ÿç›¤è§£æ Â· Natal Birth Chart',
      page_sub:'è«‹è¼¸å…¥å‡ºç”Ÿè³‡æ–™ï¼Œæˆ‘å€‘å°‡ç‚ºä½ ç¹ªè£½å°ˆå±¬çš„æœ¬å‘½æ˜Ÿåœ–ï¼ˆç¤ºç¯„ç‰ˆï¼‰ã€‚',
      label_name:'å§“åï¼ˆé¸å¡«ï¼‰', ph_name:'ä½ çš„ç¨±å‘¼ï¼ˆç”¨æ–¼å€‹äººåŒ–ï¼‰',
      gender_label:'æ€§åˆ¥', opt_gender_confidential:'ä¸é€éœ²', opt_gender_male:'ç”·æ€§', opt_gender_female:'å¥³æ€§',
      label_place:'å‡ºç”Ÿåœ°é»', ph_place:'åŸå¸‚æˆ–åº§æ¨™ï¼Œå¦‚ï¼šTaipei / 25.03,121.56',
      label_birthdate:'å‡ºç”Ÿæ—¥æœŸ', label_birthtime:'å‡ºç”Ÿæ™‚é–“',
      btn_generate:'ç”¢ç”Ÿæ˜Ÿç›¤', btn_demo:'ç¤ºä¾‹', note_privacy:'æç¤ºï¼šåƒ…æœ¬åœ°ç¤ºç¯„ï¼Œç„¡ä¸Šå‚³å€‹è³‡ã€‚',
      chart_title:'ä½ çš„æœ¬å‘½æ˜Ÿç›¤', chart_placeholder:'ï¼ˆæ­¤è™•å¯æ¥å¾Œç«¯ç¹ªåœ–æˆ–å‰ç«¯ Canvasï¼Œç•¶å‰ç‚ºä½”ä½ï¼‰',
      panel_login_head:'å¸³æˆ¶ç™»å…¥ / è¨»å†Š', ph_email:'é›»å­éƒµä»¶ Email', ph_password:'å¯†ç¢¼ Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å¯«æ•¸å­—ç¬¦è™Ÿï¼‰', ph_label_password:'å¯†ç¢¼ Password',
      chat_fab:'å•', chat_placeholder:'æƒ³äº†è§£ä»€éº¼ï¼Ÿï¼ˆå¦‚ï¼šåŠŸèƒ½ã€æœƒå“¡èªªæ˜ï¼‰', chat_send:'ç™¼é€',
      err_need_ep:'è«‹è¼¸å…¥éƒµä»¶èˆ‡å¯†ç¢¼', err_pwd_rule:'å¯†ç¢¼è‡³å°‘8ä½ï¼Œéœ€å«å¤§å°å¯«/æ•¸å­—/ç¬¦è™Ÿ', err_email_empty:'éƒµä»¶ä¸èƒ½ç‚ºç©º', err_pwd_empty:'å¯†ç¢¼ä¸èƒ½ç‚ºç©º', err_login_fail:'ç™»å…¥å¤±æ•—ï¼š', err_register_fail:'è¨»å†Šå¤±æ•—ï¼š', err_reset_fail:'é‡è¨­å¤±æ•—ï¼š', err_no_account:'å¸³æˆ¶ä¸å­˜åœ¨ï¼Œè«‹å…ˆè¨»å†Š', err_wrong_pwd:'å¯†ç¢¼éŒ¯èª¤', err_expired:'æœƒå“¡å·²åˆ°æœŸï¼Œè«‹çºŒè²»', msg_reset_ok:'å¯†ç¢¼å·²æ›´æ–°ï¼Œè«‹ä»¥æ–°å¯†ç¢¼ç™»å…¥ã€‚'
    },
    'en': {
      lang_label:'Language',
      btn_login:'Log in', btn_register:'Create Account', btn_reset:'ğŸ”‘ Reset Password',
      page_title:'Natal Birth Chart', page_sub:'Enter your birth data and we will draw your natal chart (demo).',
      label_name:'Name (optional)', ph_name:'Your name (for personalization)',
      gender_label:'Gender', opt_gender_confidential:'Prefer not to say', opt_gender_male:'Male', opt_gender_female:'Female',
      label_place:'Place of Birth', ph_place:'City or coordinates, e.g. Taipei / 25.03,121.56',
      label_birthdate:'Birth Date', label_birthtime:'Time of Birth',
      btn_generate:'Generate Chart', btn_demo:'Demo', note_privacy:'Note: demo runs locally; no personal data is uploaded.',
      chart_title:'Your Natal Chart', chart_placeholder:'(Hook up backend rendering or Canvas here Â· placeholder)',
      panel_login_head:'Account Login / Sign-up', ph_email:'Email', ph_password:'Password (8+, upper/lower/digit/symbol)', ph_label_password:'Password',
      chat_fab:'Chat', chat_placeholder:'What would you like to know? (features, membership, etc.)', chat_send:'Send',
      err_need_ep:'Enter email and password', err_pwd_rule:'Password must be 8+ and include upper/lowercase, number, symbol', err_email_empty:'Email cannot be empty', err_pwd_empty:'Password cannot be empty', err_login_fail:'Login failed: ', err_register_fail:'Registration failed: ', err_reset_fail:'Reset failed: ', err_no_account:'Account not found. Please register first.', err_wrong_pwd:'Incorrect password', err_expired:'Membership expired. Please renew.', msg_reset_ok:'Password updated. Please log in with the new one.'
    },
    'th': {
      lang_label:'à¸ à¸²à¸©à¸²',
      btn_login:'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š', btn_register:'à¸ªà¸¡à¸±à¸„à¸£à¸šà¸±à¸à¸Šà¸µ', btn_reset:'ğŸ”‘ à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™',
      page_title:'à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸” Â· Natal Birth Chart', page_sub:'à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¹€à¸à¸´à¸”à¹€à¸à¸·à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸” (à¹€à¸”à¹‚à¸¡).',
      label_name:'à¸Šà¸·à¹ˆà¸­ (à¹„à¸¡à¹ˆà¸šà¸±à¸‡à¸„à¸±à¸š)', ph_name:'à¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“',
      gender_label:'à¹€à¸à¸¨', opt_gender_confidential:'à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸', opt_gender_male:'à¸Šà¸²à¸¢', opt_gender_female:'à¸«à¸à¸´à¸‡',
      label_place:'à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”', ph_place:'à¹€à¸¡à¸·à¸­à¸‡à¸«à¸£à¸·à¸­à¸à¸´à¸à¸±à¸” à¹€à¸Šà¹ˆà¸™ Taipei / 25.03,121.56',
      label_birthdate:'à¸§à¸±à¸™à¹€à¸à¸´à¸”', label_birthtime:'à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”',
      btn_generate:'à¸ªà¸£à¹‰à¸²à¸‡à¸”à¸§à¸‡', btn_demo:'à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡', note_privacy:'à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¹€à¸”à¹‚à¸¡à¸—à¸³à¸‡à¸²à¸™à¸šà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ à¹„à¸¡à¹ˆà¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§',
      chart_title:'à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸”à¸‚à¸­à¸‡à¸„à¸¸à¸“', chart_placeholder:'(à¹€à¸Šà¸·à¹ˆà¸­à¸¡ backend à¸«à¸£à¸·à¸­ Canvas à¸—à¸µà¹ˆà¸™à¸µà¹ˆ Â· à¸•à¸±à¸§à¸¢à¸¶à¸”à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡)',
      panel_login_head:'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š / à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸', ph_email:'à¸­à¸µà¹€à¸¡à¸¥', ph_password:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ (â‰¥8 à¸•à¸±à¸§ à¸•à¸±à¸§à¸à¸´à¸¡à¸à¹Œà¹ƒà¸«à¸à¹ˆ/à¹€à¸¥à¹‡à¸ à¸•à¸±à¸§à¹€à¸¥à¸‚ à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œ)', ph_label_password:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™',
      chat_fab:'à¸–à¸²à¸¡', chat_placeholder:'à¸­à¸¢à¸²à¸à¸—à¸£à¸²à¸šà¸­à¸°à¹„à¸£ (à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ à¸ªà¸¡à¸²à¸Šà¸´à¸ à¸¯à¸¥à¸¯)', chat_send:'à¸ªà¹ˆà¸‡',
      err_need_ep:'à¸à¸£à¸­à¸à¸­à¸µà¹€à¸¡à¸¥à¹à¸¥à¸°à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™', err_pwd_rule:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ â‰¥8 à¹à¸¥à¸°à¸¡à¸µà¸•à¸±à¸§à¸à¸´à¸¡à¸à¹Œà¹ƒà¸«à¸à¹ˆ/à¹€à¸¥à¹‡à¸ à¸•à¸±à¸§à¹€à¸¥à¸‚ à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œ', err_email_empty:'à¸­à¸µà¹€à¸¡à¸¥à¸«à¹‰à¸²à¸¡à¸§à¹ˆà¸²à¸‡', err_pwd_empty:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸«à¹‰à¸²à¸¡à¸§à¹ˆà¸²à¸‡', err_login_fail:'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§: ', err_register_fail:'à¸ªà¸¡à¸±à¸„à¸£à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ', err_reset_fail:'à¸£à¸µà¹€à¸‹à¹‡à¸•à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: ', err_no_account:'à¹„à¸¡à¹ˆà¸à¸šà¸šà¸±à¸à¸Šà¸µ à¸à¸£à¸¸à¸“à¸²à¸ªà¸¡à¸±à¸„à¸£', err_wrong_pwd:'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡', err_expired:'à¸ªà¸¡à¸²à¸Šà¸´à¸à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ à¸à¸£à¸¸à¸“à¸²à¸•à¹ˆà¸­à¸­à¸²à¸¢à¸¸', msg_reset_ok:'à¸­à¸±à¸›à¹€à¸”à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹à¸¥à¹‰à¸§ à¸à¸£à¸¸à¸“à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸”à¹‰à¸§à¸¢à¸£à¸«à¸±à¸ªà¹ƒà¸«à¸¡à¹ˆ'
    },
    'ms': {
      lang_label:'Bahasa',
      btn_login:'Log Masuk', btn_register:'Daftar Akaun', btn_reset:'ğŸ”‘ Tetapkan Semula',
      page_title:'Carta Kelahiran Â· Natal Chart', page_sub:'Masukkan data kelahiran untuk jana carta (demo).',
      label_name:'Nama (pilihan)', ph_name:'Nama anda',
      gender_label:'Jantina', opt_gender_confidential:'Rahsia', opt_gender_male:'Lelaki', opt_gender_female:'Perempuan',
      label_place:'Tempat Lahir', ph_place:'Bandar atau koordinat, cth: Taipei / 25.03,121.56',
      label_birthdate:'Tarikh Lahir', label_birthtime:'Masa Lahir',
      btn_generate:'Jana Carta', btn_demo:'Demo', note_privacy:'Nota: demo berjalan secara setempat; tiada data dihantar.',
      chart_title:'Carta Kelahiran Anda', chart_placeholder:'(Sambung rendering backend atau Canvas di sini Â· placeholder)',
      panel_login_head:'Log Masuk / Daftar', ph_email:'Emel', ph_password:'Kata Laluan (8+, huruf besar/kecil/nombor/simbol)', ph_label_password:'Kata Laluan',
      chat_fab:'Chat', chat_placeholder:'Apa yang ingin anda tahu? (ciri, keahlian, dsb.)', chat_send:'Hantar',
      err_need_ep:'Masukkan emel dan kata laluan', err_pwd_rule:'Kata laluan 8+ dgn huruf besar/kecil, nombor, simbol', err_email_empty:'Emel tidak boleh kosong', err_pwd_empty:'Kata laluan tidak boleh kosong', err_login_fail:'Gagal log masuk: ', err_register_fail:'Gagal daftar: ', err_reset_fail:'Gagal tetapan semula: ', err_no_account:'Akaun tidak ditemui. Sila daftar dahulu.', err_wrong_pwd:'Kata laluan salah', err_expired:'Keahlian tamat tempoh. Sila perbaharui.', msg_reset_ok:'Kata laluan dikemas kini. Sila log masuk semula.'
    }
  };

  function getLang(){ return localStorage.getItem(LANG_KEY) || (navigator.language||'zh-CN').replace('_','-'); }
  function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
  function t(key){ const L = I18N[getLang()] || I18N['zh-CN']; return L[key] || (I18N['zh-CN'][key] || key); }
  function applyI18n(){
    $('[data-i18n="lang_label"]').textContent = t('lang_label');
    $$('#langSelect option').forEach(o=>{ /* keep values */ });
    $$('#langSelect').forEach(sel=> sel.value = getLang());
    $$('#openAuth').forEach(btn=> btn.textContent = t('btn_login'));
    $$('#chatFab').forEach(btn=> btn.textContent = t('chat_fab'));
    $('[data-i18n="page_title"]').textContent = t('page_title');
    $('[data-i18n="page_sub"]').textContent = t('page_sub');
    $('[data-i18n="label_name"]').textContent = t('label_name');
    $('#name')?.setAttribute('placeholder', t('ph_name'));
    $('[data-i18n="gender_label"]').textContent = t('gender_label');
    $('#gender option[value="u"]').textContent = t('opt_gender_confidential');
    $('#gender option[value="m"]').textContent = t('opt_gender_male');
    $('#gender option[value="f"]').textContent = t('opt_gender_female');
    $('[data-i18n="label_place"]').textContent = t('label_place');
    $('#place')?.setAttribute('placeholder', t('ph_place'));
    $('[data-i18n="label_birthdate"]').textContent = t('label_birthdate');
    $('[data-i18n="label_birthtime"]').textContent = t('label_birthtime');
    $('#genBtn').textContent = t('btn_generate');
    $('#demoBtn').textContent = t('btn_demo');
    $('#formNote').textContent = t('note_privacy');
    $('[data-i18n="chart_title"]').textContent = t('chart_title');
    $('[data-i18n="chart_placeholder"]').textContent = t('chart_placeholder');

    // Auth modal
    $('#authTitle').textContent = t('panel_login_head');
    $('label[for="email"]').textContent = t('ph_email');
    $('label[for="password"]').textContent = t('ph_label_password');
    $('#password').setAttribute('placeholder', t('ph_password'));
    $('#loginBtn').textContent = t('btn_login');
    $('#registerBtn').textContent = t('btn_register');
    $('#resetBtn').textContent = t('btn_reset');

    // Chat panel
    $('#chatTitle').textContent = 'å¿ƒæ€œç®¡å®¶ Â· GPT';
    $('#chatInput').setAttribute('placeholder', t('chat_placeholder'));
    $('#chatSend').textContent = t('chat_send');
  }

  /* ===== é¡µé¢é€»è¾‘ ===== */
  document.addEventListener('DOMContentLoaded', ()=>{
    // init lang
    const sel = $('#langSelect');
    const cur = getLang();
    if(I18N[cur]) { sel.value = cur; document.documentElement.lang = cur; } else { sel.value = 'zh-CN'; setLang('zh-CN'); }
    applyI18n();
    sel.addEventListener('change', ()=>{ setLang(sel.value); applyI18n(); });

    // Auth modal open/close
    const mask = $('#authMask');
    $('#openAuth').addEventListener('click', ()=>{ mask.setAttribute('aria-hidden','false'); });
    $('#closeAuth').addEventListener('click', ()=>{ mask.setAttribute('aria-hidden','true'); });

    // Chat
    const chatFab = $('#chatFab'); const chatPanel = $('#chatPanel');
    chatFab.addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','false'));
    $('#chatClose').addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','true'));
    $('#chatSend').addEventListener('click', sendGPT);
    $('#chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter') sendGPT(); });

    // Buttons
    $('#genBtn').addEventListener('click', generateChart);
    $('#demoBtn').addEventListener('click', fillDemo);

    // Default birthdate today
    const today=new Date().toISOString().split('T')[0];
    if($('#birthdate') && !$('#birthdate').value) $('#birthdate').value = today;
  });

  function showAuthErr(msg){ const e=$('#authError'); e.textContent = msg; e.style.display='block'; setTimeout(()=> e.style.display='none', 6000); }
  function strongPwd(pw){ return pw.length>=8 && /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /[0-9]/.test(pw) && /[^A-Za-z0-9]/.test(pw); }

  // â€”â€” ç™»å½•/æ³¨å†Œ/é‡è®¾ï¼ˆåç«¯é’©å­ä¿ç•™ï¼‰ â€”â€”
  async function login(){
    const email=$('#email').value.trim(); const password=$('#password').value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    try{
      const r=await fetch(API_BASE+'/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const data=await r.json().catch(()=>({}));
      if(data?.ok){ localStorage.setItem('vipEmail', email); alert('OK'); $('#authMask').setAttribute('aria-hidden','true'); return; }
      if(data?.msg==='wrong_pwd') return showAuthErr(t('err_wrong_pwd'));
      if(data?.msg==='no_account') return showAuthErr(t('err_no_account'));
      showAuthErr(t('err_login_fail') + (data?.msg||''));
    }catch(e){ showAuthErr(t('err_login_fail') + e.message); }
  }
  async function register(){
    const email=$('#email').value.trim(); const password=$('#password').value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    if(!strongPwd(password)) return showAuthErr(t('err_pwd_rule'));
    try{
      const r=await fetch(API_BASE+'/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const data=await r.json().catch(()=>({}));
      if(data?.ok){ localStorage.setItem('vipEmail', email); alert('OK'); $('#authMask').setAttribute('aria-hidden','true'); return; }
      showAuthErr(t('err_register_fail') + (data?.msg||''));
    }catch(e){ showAuthErr(t('err_register_fail') + e.message); }
  }
  async function resetPwd(){
    const email=prompt(t('ph_email'))||''; if(!email) return showAuthErr(t('err_email_empty'));
    const newPassword=prompt(t('ph_password'))||''; if(!newPassword) return showAuthErr(t('err_pwd_empty'));
    if(!strongPwd(newPassword)) return showAuthErr(t('err_pwd_rule'));
    try{
      const r=await fetch(API_BASE+'/api/reset',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,newPassword})});
      const data=await r.json().catch(()=>({}));
      if(!data?.ok) return showAuthErr(t('err_reset_fail') + (data?.msg||''));
      alert(t('msg_reset_ok'));
    }catch(e){ showAuthErr(t('err_reset_fail') + e.message); }
  }
  $('#loginBtn')?.addEventListener('click', login);
  $('#registerBtn')?.addEventListener('click', register);
  $('#resetBtn')?.addEventListener('click', resetPwd);

  // â€”â€” GPT demo â€”â€”
  async function sendGPT(){
    const input=$('#chatInput'); const txt=(input.value||'').trim(); if(!txt) return; addMsg(txt,true); input.value='';
    try{
      const r=await fetch(API_BASE+'/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'system',content:'ä½ æ˜¯å¿ƒæ€œç®¡å®¶ï¼Œå›ç­”è®¿å®¢å…³äºç½‘ç«™åŠŸèƒ½ã€ä¼šå‘˜ã€ä»¥åŠå æ˜Ÿ/å‘½ç†äº§å“å¯¼èˆªçš„é—®é¢˜ã€‚'}, {role:'user',content:txt}]})});
      const data=await r.json().catch(()=>({}));
      addMsg(data?.reply || data?.text || data?.choices?.[0]?.message?.content || 'â€¦');
    }catch(e){ addMsg('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚'); }
  }
  function addMsg(text,me=false){ const div=document.createElement('div'); div.className='ss-msg'+(me?' me':''); div.textContent=text; $('#chatBody').appendChild(div); $('#chatBody').scrollTop=$('#chatBody').scrollHeight; }

  // â€”â€” ç¤ºä¾‹ä¸ç”Ÿæˆï¼ˆå ä½ï¼‰ â€”â€”
  function fillDemo(){ $('#name').value='Avery'; $('#gender').value='u'; $('#place').value='Taipei'; $('#birthdate').value='1992-08-15'; $('#birthtime').value='13:45'; }
  function generateChart(){
    const name=$('#name').value.trim(); const place=$('#place').value.trim(); const d=$('#birthdate').value; const t=$('#birthtime').value;
    if(!d||!t||!place){ alert('è¯·è¡¥å…¨â€œæ—¥æœŸ/æ—¶é—´/åœ°ç‚¹â€ã€‚'); return; }
    const summary = `${name?name+' Â· ':''}${d} ${t} @ ${place}`;
    $('#chartSummary').textContent = summary;
    $('#result').style.display = 'block';
    // TODO: è¿™é‡Œæ¥å…¥åç«¯æ˜Ÿç›˜ç»˜åˆ¶æˆ–æœ¬åœ°ç®—æ³•
  }
  </script>
</body>
</html>
