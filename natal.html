<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
  <title>本命星盘 · Natal Chart | 5XLiving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
  --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
  --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
  --card-w:128px; --card-h:212px; --gap:14px;
}
@media (max-width:640px){ :root{ --card-w:100px; --card-h:168px; --gap:10px; } }

html,body{height:100%}
body{
  margin:0; color:var(--text);
  background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
              linear-gradient(180deg,#0b0f14,#0b0f14);
  font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overflow-x: hidden;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:-2;
  background: linear-gradient(rgba(11, 15, 20, 0.85), rgba(11, 15, 20, 0.9)), 
              radial-gradient(circle at 20% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
              radial-gradient(circle at 80% 20%, rgba(88, 185, 255, 0.05) 0%, transparent 50%);
}
.container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

  /* —— 头部（Tarot 同款） —— */
  .site-header{
    position:sticky;
    top:0;
    z-index:10;
    background:#0b0f14cc;
    border-bottom:1px solid #0f1622;
    backdrop-filter:saturate(140%) blur(12px);
    transition: all 0.3s ease;
  }
  .site-header.scrolled {
    background: rgba(11, 15, 20, 0.95);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  .head-inner{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    padding:14px 16px;
  }
  
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; 
  place-items:center; 
  width:34px; 
  height:34px; 
  border-radius:8px; 
  background:linear-gradient(180deg,#0e1520,#0b1018); 
  border:1px solid #2a3546; 
  box-shadow:0 4px 14px rgba(0,0,0,.35); 
  font-weight:800; 
  color:#ffe084;
  transition: all 0.3s ease;
}
.brand:hover .brand-badge {
  transform: rotate(15deg);
  box-shadow: 0 6px 20px rgba(212, 175, 55, 0.3);
}
.title{
  font-family:"Noto Serif SC","Noto Serif",serif !important;
  font-weight:600 !important;
  letter-spacing:.02em;
  font-size:1.1rem !important;
  line-height:1.25;
}

.title{
  font-family:"Noto Serif SC","Noto Serif",serif !important;
  font-weight:600 !important;
  letter-spacing:.02em;
  font-size:1.1rem !important;
  line-height:1.25;
}

/* 新增：鼠标在整条 brand 上时，高亮标题 */
.brand:hover .title {
  color: var(--gold);
}
.lang{display:flex; align-items:center; gap:8px}
.lang label{white-space:nowrap; color:var(--muted); margin-right:4px}
.lang select{
  appearance:none; 
  min-width:170px; 
  border-radius:10px; 
  border:1px solid #243244; 
  background:#0e1520; 
  color:var(--text); 
  padding:10px 34px 10px 12px; 
  font-size:.95rem; 
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); 
  background-repeat:no-repeat; 
  background-position:calc(100% - 12px) 50%;
  transition: all 0.3s ease;
}
.lang select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
}
@media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

    /* —— 页面结构 —— */
    .h1{ margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem }
    .sub{ color:var(--muted) }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:18px; margin:16px 0 }
    .row{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:760px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} }
    label.muted{ display:block; margin-bottom:4px }
    input,select{ width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:12px 12px; font-size:15px; outline:none }
    input::placeholder{ color:#6f8092 }
    .btn{ display:inline-grid; place-items:center; padding:12px 16px; border-radius:12px; border:1px solid #e6c76e; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; cursor:pointer }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .btn.ghost{ background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none }

    /* —— 报告样式 —— */
    .report{ margin-top:12px; display:grid; gap:10px }
    .report .sec{ padding:12px; border:1px solid var(--line); background:#0e1520; border-radius:12px }
    .report .sec h3{ margin:0 0 6px; color:#f2d27a; font-size:1.05rem }
    .report p,.report li{ line-height:1.7 }

    /* —— Butler & Chat —— */
    .ss-chat-fab{ position:fixed; right:18px; bottom:18px; z-index:50; width:56px; height:56px; border-radius:50%; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; display:grid; place-items:center; font-weight:800; box-shadow:0 8px 30px rgba(0,0,0,.35); cursor:pointer; border:1px solid #e6c76e }
    .ss-chat-panel{ position:fixed; right:18px; bottom:88px; z-index:50; width:min(460px,92vw); display:none; background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow) }
    .ss-chat-head{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244 }
    .ss-chat-title{ font-weight:700 }
    .ss-close{ cursor:pointer; opacity:.8 }
    .ss-chat-body{ max-height:300px; overflow:auto; padding:10px 12px }
    .ss-msg{ padding:8px 10px; background:#0f1624; border:1px solid #243244; border-radius:10px; margin:6px 0; max-width:80% }
    .ss-msg.me{ margin-left:auto; background:#132033 }
    .ss-chat-input{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-top:1px solid #243244 }
    .ss-chat-input input{ flex:1 1 auto; min-width:0 }
    .ss-chat-input .btn,.ss-chat-input button{ flex:0 0 auto; width:auto !important; white-space:nowrap; padding:10px 14px }

    /* —— 会员区 —— */
    .columns{ display:grid; gap:12px; grid-template-columns:1fr }
    @media(min-width:900px){ .columns{ grid-template-columns:1fr 1fr } }
    .list-block{ border:1px solid #263448; background:#0e1520; border-radius:12px; padding:16px }
    .list-block ul{ margin:.2rem 0 0; padding-left:1.1rem }
    .group-title{ font-size:1.05rem; color:#ffe084; margin:6px 0 14px }
    .astro-auth{ max-width:980px; margin:28px auto; padding:20px 18px; background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35) }
    .auth-grid{ display:grid; gap:18px; grid-template-columns:1.2fr .8fr }
    @media(max-width:860px){ .auth-grid{ grid-template-columns:1fr } }
    .panel{ background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35) }
    .panel .head{ padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:.3px }
    .panel .body{ padding:18px }
    .spacer{ height:12px }
    footer{ color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0 }

    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{ display:none!important }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com" target="_self" rel="nofollow">
        <span class="brand-badge">5X</span>
        <span class="title">
        <span data-i18n="brand">5xLiving · Soul Sanctuary</span>
        </span>
      </a>

    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="lang_label">语言</label>
      <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

  <main class="container">
    <h1 class="h1" data-i18n="page_title">本命星盘解析</h1>

    <!-- 表单区域 -->
    <section class="card">
      <form id="chartForm" novalidate>
        <div class="row cols-3">
          <div>
            <label class="muted" for="name" data-i18n="label_name">姓名（可选）</label>
            <input id="name" type="text" data-i18n-ph="ph_name" placeholder="你的称呼（用于个性化）" />
          </div>
          <div>
            <label class="muted" for="gender" data-i18n="gender_label">性别</label>
            <select id="gender">
              <option value="u" data-i18n="opt_gender_confidential">不透露</option>
              <option value="m" data-i18n="opt_gender_male">男性</option>
              <option value="f" data-i18n="opt_gender_female">女性</option>
            </select>
          </div>
          <div>
            <label class="muted" for="place" data-i18n="label_place">出生地点 （必填）</label>
            <input id="place" type="text" required placeholder="城市或坐标，如：Taipei / 25.03,121.56" pattern="^(.{2,}|-?\d{1,2}(\.\d+)?,\s*-?\d{1,3}(\.\d+)?)$" title="输入城市名或坐标，如 Taipei 或 25.03,121.56"/>
          </div>
        </div>
        <div class="row cols-3" style="margin-top:10px">
          <div>
            <label class="muted" for="birthdate" data-i18n="label_birthdate">出生日期</label>
            <input id="birthdate" type="date" required />
          </div>
          <div>
            <label class="muted" for="birthtime" data-i18n="label_birthtime">出生时间</label>
            <input id="birthtime" type="time" value="12:00" step="60" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:10px">
            <button id="genBtn" class="btn" type="submit" data-i18n="btn_generate">生成星盘</button>
          </div>
        </div>
      </form>
    </section>

    <!-- 结果区域 -->
    <section id="result" class="card" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="chart_title">你的本命报告</h2>
      <div id="chartSummary" class="muted"></div>
      <div id="chartReport" class="report"></div>
    </section>

    <!-- 会员专区 -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">🌙 会员区域 VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">🗝 命理空间专属内容</div>
          <ul>
            <li data-i18n="vip_love">姻缘方向：恋爱缘分、婚姻走势</li>
            <li data-i18n="vip_career">事业方向：职场发展、创业潜力</li>
            <li data-i18n="vip_wealth">财运方向：财位分析、理财时机</li>
            <li data-i18n="vip_pet">宠物命理：伴侣动物的性格与缘分</li>
            <li data-i18n="vip_hepan">合盘分析：婚期择日、新生择时</li>
            <li data-i18n="vip_name">测名分析：公司名、宝宝名、命名改运</li>
            <li data-i18n="vip_fengshui">财位合盘：住家 / 办公室动线配合</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">🌙 心怜空间专属内容</div>
          <ul>
            <li data-i18n="vip_record">灵性记录：照片、梦境、声音、愿望祈祷</li>
            <li data-i18n="vip_course">命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图</li>
            <li data-i18n="vip_memorial">家族纪念系统：亲人灵性纪念 & 延续</li>
            <li data-i18n="vip_tasks">每周能量练习 / 神明仪式任务</li>
            <li data-i18n="vip_shop">能量商城专属折扣 & 御守订制</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">💎 登入 VIP 功能</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">账户登录 / 注册</div>
            <div class="body">
              <div class="row" id="authFields" style="display:none">
                <label for="email" class="sr-only" data-i18n="ph_email">邮箱 Email</label>
                <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="邮箱 Email" />
                <label for="password" class="sr-only" data-i18n="ph_label_password">密码 Password</label>
                <input id="password" type="password" autocomplete="new-password" placeholder="密码 Password（至少8位，含大小写数字符号）" data-i18n-ph="ph_password" />
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">登入账户</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">🔑 重设密码</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">注册账户</button>
                <div class="muted" data-i18n="note_price">注册账号赠送一次免费体验</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">会员服务</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">💎 升级为 VIP（月费）</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">← 返回命理商城</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>© 5XLiving • Astro Sanctuary</footer>
  </main>

    <!-- Xinlian Butler · 浮动聊天窗 -->
  <div class="ss-chat-fab" id="ssChatFab" role="button" aria-label="Chat with Xinlian Butler">
    AI
  </div>

  <div class="ss-chat-panel" id="ssChatPanel" aria-label="Xinlian Butler Chat">
    <div class="ss-chat-head">
      <div class="ss-chat-title">心怜管家 · Xinlian Butler</div>
      <div class="ss-close" id="ssChatClose" aria-label="Close chat">✕</div>
    </div>
    <div class="ss-chat-body" id="ssChatBody">
      <div class="ss-msg">
        嗨，我是心怜管家。<br>
        你可以把刚刚生成的星盘问题、感情/事业/财富方向，或是你现在最在意的一件事打给我，我们一起看一看。
      </div>
    </div>
    <div class="ss-chat-input">
      <input
        id="ssChatInput"
        type="text"
        placeholder="想问什麼？例如：帮我看一下我这张星盘的感情方向"
      />
      <button class="btn" id="ssChatSend" type="button">发送</button>
    </div>
  </div>

<script>
(function(){
  'use strict';

  /* ========================= i18n 文案 ========================= */
  const I18N = {
    'zh-CN':{
      brand:'5xLiving · Soul Sanctuary', 
      page_title:'本命星盘解析',
      lang_label:'语言',

      label_name:'姓名（可选）',
      ph_name:'你的称呼（用于个性化）',
      gender_label:'性别',
      opt_gender_confidential:'不透露',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地点 （必填）',
      label_birthdate:'出生日期',
      label_birthtime:'出生时间',
      btn_generate:'生成星盘',
      chart_title:'你的本命报告',

      section_overview:'概览',
      section_sun:'太阳星座',
      section_energy:'能量提示',
      section_action:'本周可执行清单',

      vip_title:'🌙 会员区域 VIP Segment',
      vip_mingli:'🗝 命理空间专属内容',
      vip_love:'姻缘方向：恋爱缘分、婚姻走势',
      vip_career:'事业方向：职场发展、创业潜力',
      vip_wealth:'财运方向：财位分析、理财时机',
      vip_pet:'宠物命理：伴侣动物的性格与缘分',
      vip_hepan:'合盘分析：婚期择日、新生择时',
      vip_name:'测名分析：公司名、宝宝名、命名改运',
      vip_fengshui:'财位合盘：住家 / 办公室动线配合',

      vip_xinlian:'🌙 心怜空间专属内容',
      vip_record:'灵性记录：照片、梦境、声音、愿望祈祷',
      vip_course:'命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图',
      vip_memorial:'家族纪念系统：亲人灵性纪念 & 延续',
      vip_tasks:'每周能量练习 / 神明仪式任务',
      vip_shop:'能量商城专属折扣 & 御守订制',

      login_title:'💎 登入 VIP 功能',
      panel_login_head:'账户登录 / 注册',
      ph_email:'邮箱 Email',
      ph_label_password:'密码 Password',
      ph_password:'密码 Password（至少8位，含大小写数字符号）',
      btn_login:'登入账户',
      btn_reset:'🔑 重设密码',
      btn_register:'注册账户',
      note_price:'注册账号赠送一次免费体验',
      panel_member_head:'会员服务',
      btn_upgrade:'💎 升级为 VIP（月费）',
      btn_backshop:'← 返回命理商城',
      note_price1:'$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）',

      alert_fill:'请补全「出生日期」与「出生地点」。',
      disclaimer:'＊以下为根据你提供的出生日期、时间与地点生成的本命星盘概览，仅作为个人参考与自我觉察之用。',
      action_1:'今天为自己预留 25 分钟安静时间，回顾这一年的成长。',
      action_2:'写下 3 件你想在接下来 30 天逐步推进的小目标。',
      action_3:'挑一位重要的人，发一句真诚的感谢或问候。',

      sun_label:'你的太阳星座：'
    },

    'zh-TW':{
      brand:'5xLiving · 命理心怜空间 · Soul Sanctuary', 
      page_title:'本命星盤解析',
      lang_label:'語言',

      label_name:'姓名（選填）',
      ph_name:'你的稱呼（用於個人化）',
      gender_label:'性別',
      opt_gender_confidential:'不透露',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地點（必填）',
      label_birthdate:'出生日期',
      label_birthtime:'出生時間',
      btn_generate:'生成星盤',
      chart_title:'你的本命報告',

      section_overview:'總覽',
      section_sun:'太陽星座',
      section_energy:'能量提示',
      section_action:'本週可行動清單',

      vip_title:'🌙 會員區域 VIP Segment',
      vip_mingli:'🗝 命理空間專屬內容',
      vip_love:'姻緣方向：戀愛緣分、婚姻走勢',
      vip_career:'事業方向：職場發展、創業潛力',
      vip_wealth:'財運方向：財位分析、理財時機',
      vip_pet:'寵物命理：伴侶動物的性格與緣分',
      vip_hepan:'合盤分析：婚期擇日、新生擇時',
      vip_name:'測名分析：公司名、寶寶名、改名開運',
      vip_fengshui:'財位合盤：住家 / 辦公室動線搭配',

      vip_xinlian:'🌙 心憐空間專屬內容',
      vip_record:'靈性紀錄：照片、夢境、聲音、願望祈禱',
      vip_course:'命理課程：八字 / 塔羅 / 占星 / 靈數 / 人類圖',
      vip_memorial:'家族紀念系統：親人靈性紀念與延續',
      vip_tasks:'每週能量練習 / 神明儀式任務',
      vip_shop:'能量商城專屬折扣與御守訂製',

      login_title:'💎 登入 VIP 功能',
      panel_login_head:'帳號登入 / 註冊',
      ph_email:'信箱 Email',
      ph_label_password:'密碼 Password',
      ph_password:'密碼 Password（至少 8 碼，含大小寫與數字符號）',
      btn_login:'登入帳號',
      btn_reset:'🔑 重設密碼',
      btn_register:'註冊帳號',
      note_price:'註冊帳號贈送一次免費體驗',
      panel_member_head:'會員服務',
      btn_upgrade:'💎 升級為 VIP（月費）',
      btn_backshop:'← 返回命理商城',
      note_price1:'$9.9 / 月費 VIP（命理空間 + 心憐空間 + 靈性課程）',

      alert_fill:'請先填寫「出生日期」與「出生地點」。',
      disclaimer:'＊以下內容是依照你提供的出生日期、時間與地點所生成的本命星盤總覽，僅供自我覺察與參考使用。',
      action_1:'今天預留 25 分鐘安靜時間，回顧這一年的成長。',
      action_2:'寫下 3 件你想在接下來 30 天逐步完成的小目標。',
      action_3:'挑一位重要的人，傳一句真誠的感謝或問候。',

      sun_label:'你的太陽星座：'
    },

    'en':{
      brand:'5xLiving · Soul Sanctuary', 
      page_title:'Natal Chart Reading',
      lang_label:'Language',

      label_name:'Name (optional)',
      ph_name:'Your name (for personalization)',
      gender_label:'Gender',
      opt_gender_confidential:'Prefer not to say',
      opt_gender_male:'Male',
      opt_gender_female:'Female',
      label_place:'Birth place (required)',
      label_birthdate:'Date of birth',
      label_birthtime:'Time of birth',
      btn_generate:'Generate chart',
      chart_title:'Your natal report',

      section_overview:'Overview',
      section_sun:'Sun sign',
      section_energy:'Energy notes',
      section_action:'Action checklist',

      vip_title:'🌙 VIP Area',
      vip_mingli:'🗝 Destiny Space · Members only',
      vip_love:'Love & marriage: patterns and timing',
      vip_career:'Career: development & entrepreneurship potential',
      vip_wealth:'Wealth: money flow & timing',
      vip_pet:'Pets: soul companions & bonding',
      vip_hepan:'Synastry: relationship & newborn timing',
      vip_name:'Naming: business / baby / rename for luck',
      vip_fengshui:'Wealth + feng shui: home / office flow',

      vip_xinlian:'🌙 Xinlian Space · Members only',
      vip_record:'Soul records: photos, dreams, voice notes, wishes',
      vip_course:'Courses: Bazi / Tarot / Astrology / Numerology / Human Design',
      vip_memorial:'Family memorial: honoring loved ones',
      vip_tasks:'Weekly practices / ritual tasks',
      vip_shop:'Energy shop discounts & custom charms',

      login_title:'💎 VIP Login',
      panel_login_head:'Account login / Sign up',
      ph_email:'Email',
      ph_label_password:'Password',
      ph_password:'Password (min 8 chars, mixed case & symbols)',
      btn_login:'Log in',
      btn_reset:'🔑 Reset password',
      btn_register:'Create account',
      note_price:'Sign up to receive one free reading credit',
      panel_member_head:'Membership',
      btn_upgrade:'💎 Upgrade to VIP (monthly)',
      btn_backshop:'← Back to metaphysics shop',
      note_price1:'$9.9 / month VIP (Destiny Space + Xinlian Space + courses)',

      alert_fill:'Please fill in both "date of birth" and "birth place".',
      disclaimer:'*This is a natal chart overview generated from your birth date, time and place. It is meant for personal reflection and spiritual insight only, not as professional advice.*',
      action_1:'Block 25 minutes of quiet time today to reflect on your past year.',
      action_2:'Write down 3 small goals you want to move in the next 30 days.',
      action_3:'Send one genuine thank-you or check-in message to someone important.',

      sun_label:'Your Sun sign:'
    },

    'ja':{
      brand:'5xLiving · Soul Sanctuary', 
      page_title:'本命チャート鑑定',
      lang_label:'言語',

      label_name:'お名前（任意）',
      ph_name:'表示用のお名前',
      gender_label:'性別',
      opt_gender_confidential:'回答しない',
      opt_gender_male:'男性',
      opt_gender_female:'女性',
      label_place:'出生地（必須）',
      label_birthdate:'生年月日',
      label_birthtime:'出生時刻',
      btn_generate:'チャートを作成',
      chart_title:'あなたの本命レポート',

      section_overview:'概要',
      section_sun:'太陽星座',
      section_energy:'エネルギーメモ',
      section_action:'今週の行動リスト',

      vip_title:'🌙 会員エリア VIP Segment',
      vip_mingli:'🗝 命理スペース会員専用コンテンツ',
      vip_love:'恋愛・結婚の流れとタイミング',
      vip_career:'仕事・キャリア・起業の可能性',
      vip_wealth:'お金の流れとチャンス',
      vip_pet:'ペットとの縁と性格',
      vip_hepan:'相性・結婚日・出産タイミング',
      vip_name:'会社名・命名・改名の鑑定',
      vip_fengshui:'住居 / オフィス動線と財位',

      vip_xinlian:'🌙 心憐スペース会員専用',
      vip_record:'写真・夢・音声・願いごとの記録',
      vip_course:'命理講座：四柱推命 / タロット / 占星術 など',
      vip_memorial:'家族メモリアル・先祖供養',
      vip_tasks:'毎週のエネルギーワーク / 儀式タスク',
      vip_shop:'エナジーグッズ割引・お守り',

      login_title:'💎 VIP ログイン',
      panel_login_head:'ログイン / 新規登録',
      ph_email:'メールアドレス',
      ph_label_password:'パスワード',
      ph_password:'パスワード（8文字以上・英数記号）',
      btn_login:'ログイン',
      btn_reset:'🔑 パスワード再設定',
      btn_register:'アカウント登録',
      note_price:'登録で無料セッション 1 回分をプレゼント',
      panel_member_head:'会員サービス',
      btn_upgrade:'💎 VIP（月額）にアップグレード',
      btn_backshop:'← ショップに戻る',
      note_price1:'月額 $9.9（命理スペース + 心憐スペース + 講座）',

      alert_fill:'「生年月日」と「出生地」を入力してください。',
      disclaimer:'＊以下は、あなたが入力した生年月日・出生時刻・出生地にもとづいて作成した本命チャートの概要です。自分を見つめ直すための参考としてお使いください。',
      action_1:'今日は 25 分だけ静かな時間をとり、この一年をふり返ってみましょう。',
      action_2:'今後 30 日で少しずつ進めたい小さな目標を 3 つ書き出してみましょう。',
      action_3:'大切な人に、感謝や近況のメッセージを 1 通送ってみましょう。',

      sun_label:'あなたの太陽星座：'
    },

    'th':{
      brand:'5xLiving · Soul Sanctuary', 
      page_title:'ดวงกำเนิด · Natal Chart',
      lang_label:'ภาษา',

      label_name:'ชื่อ (ไม่บังคับ)',
      ph_name:'ชื่อสำหรับใช้ในรายงาน',
      gender_label:'เพศ',
      opt_gender_confidential:'ไม่ระบุ',
      opt_gender_male:'ชาย',
      opt_gender_female:'หญิง',
      label_place:'สถานที่เกิด (จำเป็น)',
      label_birthdate:'วันเกิด',
      label_birthtime:'เวลาเกิด',
      btn_generate:'สร้างดวงกำเนิด',
      chart_title:'รายงานดวงกำเนิดของคุณ',

      section_overview:'ภาพรวม',
      section_sun:'ราศีอาทิตย์',
      section_energy:'พลังงานประจำตัว',
      section_action:'เช็กลิสต์การลงมือทำ',

      vip_title:'🌙 พื้นที่สมาชิก VIP',
      vip_mingli:'🗝 เนื้อหาพิเศษด้านโหราศาสตร์',
      vip_love:'ความรักและการแต่งงาน',
      vip_career:'การงานและศักยภาพในการสร้างธุรกิจ',
      vip_wealth:'การเงินและจังหวะโอกาส',
      vip_pet:'ดวงสัตว์เลี้ยงและสายสัมพันธ์',
      vip_hepan:'ดวงคู่ / วันแต่งงาน / เวลาเกิดบุตร',
      vip_name:'ตั้งชื่อบริษัท / เด็ก / เปลี่ยนชื่อ',
      vip_fengshui:'ฮวงจุ้ยบ้านและที่ทำงานเกี่ยวกับโชคลาภ',

      vip_xinlian:'🌙 พื้นที่จิตวิญญาณ Xinlian',
      vip_record:'บันทึกรูป ความฝัน เสียง และคำอธิษฐาน',
      vip_course:'คอร์ส: ดวงจีน, แทโรต์, โหราศาสตร์ ฯลฯ',
      vip_memorial:'พื้นที่ระลึกถึงคนที่ล่วงลับ',
      vip_tasks:'ภารกิจพลังงานประจำสัปดาห์ / พิธีกรรม',
      vip_shop:'ส่วนลดพิเศษและเครื่องรางเฉพาะสมาชิก',

      login_title:'💎 เข้าสู่ระบบ VIP',
      panel_login_head:'เข้าสู่ระบบ / สมัครสมาชิก',
      ph_email:'อีเมล',
      ph_label_password:'รหัสผ่าน',
      ph_password:'รหัสผ่าน (อย่างน้อย 8 ตัวอักษร)',
      btn_login:'เข้าสู่ระบบ',
      btn_reset:'🔑 รีเซ็ตรหัสผ่าน',
      btn_register:'สมัครสมาชิก',
      note_price:'สมัครใหม่รับสิทธิ์ดูดวงฟรี 1 ครั้ง',
      panel_member_head:'บริการสมาชิก',
      btn_upgrade:'💎 อัปเกรดเป็น VIP (รายเดือน)',
      btn_backshop:'← กลับไปยังร้านค้า',
      note_price1:'VIP รายเดือน $9.9 (ดวง + Xinlian + คอร์ส)',

      alert_fill:'กรุณากรอกทั้ง "วันเกิด" และ "สถานที่เกิด"',
      disclaimer:'*รายงานด้านล่างนี้สร้างจากวัน เวลา และสถานที่เกิดที่คุณกรอกไว้ เป็นภาพรวมดวงกำเนิดสำหรับใช้ทบทวนตนเองและด้านจิตวิญญาณ ไม่ใช่คำแนะนำทางการแพทย์ / กฎหมาย*',
      action_1:'กันเวลาเงียบ ๆ 25 นาทีวันนี้เพื่อทบทวนปีที่ผ่านมา',
      action_2:'เขียนเป้าหมายเล็ก ๆ 3 ข้อที่อยากขยับภายใน 30 วัน',
      action_3:'ส่งข้อความขอบคุณหรือทักทายจริงใจให้ใครสักคนหนึ่ง',

      sun_label:'ราศีอาทิตย์ของคุณคือ:'
    },

    'ms':{
      brand:'5xLiving · Soul Sanctuary', 
      page_title:'Carta Natal',
      lang_label:'Bahasa',

      label_name:'Nama (pilihan)',
      ph_name:'Nama anda (untuk laporan)',
      gender_label:'Jantina',
      opt_gender_confidential:'Tidak mahu nyatakan',
      opt_gender_male:'Lelaki',
      opt_gender_female:'Perempuan',
      label_place:'Tempat lahir (wajib)',
      label_birthdate:'Tarikh lahir',
      label_birthtime:'Masa lahir',
      btn_generate:'Jana carta',
      chart_title:'Laporan carta natal anda',

      section_overview:'Ringkasan',
      section_sun:'Tanda Matahari',
      section_energy:'Nota tenaga',
      section_action:'Senarai tindakan',

      vip_title:'🌙 Ruang Ahli VIP',
      vip_mingli:'🗝 Kandungan khas ruang takdir',
      vip_love:'Cinta & perkahwinan: corak dan masa',
      vip_career:'Kerjaya: perkembangan & potensi bisnes',
      vip_wealth:'Wang & peluang kewangan',
      vip_pet:'Haiwan peliharaan & ikatan jiwa',
      vip_hepan:'Synastry: hubungan & masa kelahiran anak',
      vip_name:'Nama syarikat / bayi / tukar nama untuk tuah',
      vip_fengshui:'Feng shui rezeki: rumah / pejabat',

      vip_xinlian:'🌙 Ruang Xinlian',
      vip_record:'Rekod jiwa: gambar, mimpi, audio, doa',
      vip_course:'Kursus: Bazi / Tarot / Astrologi / Numerologi / Human Design',
      vip_memorial:'Sistem memorial keluarga',
      vip_tasks:'Latihan tenaga mingguan / tugasan ritual',
      vip_shop:'Diskaun kedai tenaga & azimat khas',

      login_title:'💎 Log masuk VIP',
      panel_login_head:'Log masuk / Daftar akaun',
      ph_email:'Emel',
      ph_label_password:'Kata laluan',
      ph_password:'Kata laluan (min 8 aksara, campuran)',
      btn_login:'Log masuk',
      btn_reset:'🔑 Tetap semula kata laluan',
      btn_register:'Daftar akaun',
      note_price:'Daftar dan dapatkan satu sesi bacaan percuma',
      panel_member_head:'Perkhidmatan ahli',
      btn_upgrade:'💎 Naik taraf ke VIP (bulanan)',
      btn_backshop:'← Kembali ke kedai',
      note_price1:'VIP $9.9 / bulan (Ruang Takdir + Xinlian + Kursus)',

      alert_fill:'Sila lengkapkan "tarikh lahir" dan "tempat lahir".',
      disclaimer:'*Laporan di bawah ialah gambaran carta natal yang dijana daripada tarikh, masa dan tempat lahir anda; bertujuan untuk renungan diri dan panduan rohani, bukan nasihat profesional.*',
      action_1:'Peruntukkan 25 minit waktu tenang hari ini untuk menilai kembali setahun yang lalu.',
      action_2:'Tulis 3 matlamat kecil yang ingin digerakkan dalam 30 hari akan datang.',
      action_3:'Hantar satu mesej terima kasih atau sapaan jujur kepada seseorang yang penting.',

      sun_label:'Tanda Matahari anda:'
    }
  };

  /* ========================= 工具函数 ========================= */
  const gid = id => document.getElementById(id);
  const qs  = (sel, root=document) => root.querySelector(sel);

  function getLang(){
    const sel = gid('langSelect');
    return sel?.value || 'zh-CN';
  }

  function t(key){
    const lang = getLang();
    return (I18N[lang] && I18N[lang][key]) || (I18N['zh-CN'][key] || key);
  }

  function esc(s){
    return String(s ?? '')
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
  }

  function applyI18n(){
    const lang = getLang();
    document.documentElement.lang = lang;

    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      const val = t(key);
      if(val != null) el.textContent = val;
    });

    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const key = el.getAttribute('data-i18n-ph');
      const val = t(key);
      if(val != null) el.setAttribute('placeholder', val);
    });

    const baseTitle = '5XLiving';
    document.title = t('page_title') + ' | ' + baseTitle;
  }

  /* ========================= 头部时钟 ========================= */
  function startNowClock(){
    const box = gid('nowBox');
    if(!box) return;
    const pad = n => (n<10 ? '0'+n : ''+n);
    function tick(){
      const now = new Date();
      const y = now.getFullYear();
      const m = pad(now.getMonth()+1);
      const d = pad(now.getDate());
      const hh = pad(now.getHours());
      const mm = pad(now.getMinutes());
      const ss = pad(now.getSeconds());
      box.textContent = `${y}-${m}-${d} ${hh}:${mm}:${ss} SGT`;
    }
    tick();
    setInterval(tick, 1000);
  }

/* ========================= 星座 & 元素 ========================= */
const SIGN_LIST = [
  { key:'Aries',       start:[3,21], end:[4,19],  el:'fire',
    name:{
      'zh-CN':'白羊座','zh-TW':'牡羊座','en':'Aries',
      'ja':'おひつじ座','th':'เมษ','ms':'Aries'
    } },
  { key:'Taurus',      start:[4,20], end:[5,20],  el:'earth',
    name:{
      'zh-CN':'金牛座','zh-TW':'金牛座','en':'Taurus',
      'ja':'おうし座','th':'พฤษภ','ms':'Taurus'
    } },
  { key:'Gemini',      start:[5,21], end:[6,21],  el:'air',
    name:{
      'zh-CN':'双子座','zh-TW':'雙子座','en':'Gemini',
      'ja':'ふたご座','th':'เมถุน','ms':'Gemini'
    } },
  { key:'Cancer',      start:[6,22], end:[7,22],  el:'water',
    name:{
      'zh-CN':'巨蟹座','zh-TW':'巨蟹座','en':'Cancer',
      'ja':'かに座','th':'กรกฎ','ms':'Cancer'
    } },
  { key:'Leo',         start:[7,23], end:[8,22],  el:'fire',
    name:{
      'zh-CN':'狮子座','zh-TW':'獅子座','en':'Leo',
      'ja':'しし座','th':'สิงห์','ms':'Leo'
    } },
  { key:'Virgo',       start:[8,23], end:[9,22],  el:'earth',
    name:{
      'zh-CN':'处女座','zh-TW':'處女座','en':'Virgo',
      'ja':'おとめ座','th':'กันย์','ms':'Virgo'
    } },
  { key:'Libra',       start:[9,23], end:[10,23], el:'air',
    name:{
      'zh-CN':'天秤座','zh-TW':'天秤座','en':'Libra',
      'ja':'てんびん座','th':'ตุล','ms':'Libra'
    } },
  { key:'Scorpio',     start:[10,24],end:[11,22], el:'water',
    name:{
      'zh-CN':'天蝎座','zh-TW':'天蠍座','en':'Scorpio',
      'ja':'さそり座','th':'พิจิก','ms':'Scorpio'
    } },
  { key:'Sagittarius', start:[11,23],end:[12,21], el:'fire',
    name:{
      'zh-CN':'射手座','zh-TW':'射手座','en':'Sagittarius',
      'ja':'いて座','th':'ธนู','ms':'Sagittarius'
    } },
  { key:'Capricorn',   start:[12,22],end:[1,19],  el:'earth',
    name:{
      'zh-CN':'摩羯座','zh-TW':'魔羯座','en':'Capricorn',
      'ja':'やぎ座','th':'มังกร','ms':'Capricorn'
    } },
  { key:'Aquarius',    start:[1,20], end:[2,18],  el:'air',
    name:{
      'zh-CN':'水瓶座','zh-TW':'水瓶座','en':'Aquarius',
      'ja':'みずがめ座','th':'กุมภ์','ms':'Aquarius'
    } },
  { key:'Pisces',      start:[2,19], end:[3,20],  el:'water',
    name:{
      'zh-CN':'双鱼座','zh-TW':'雙魚座','en':'Pisces',
      'ja':'うお座','th':'มีน','ms':'Pisces'
    } }
];

  function inRange(m,d,[sm,sd],[em,ed]){
    // 处理跨年区间（摩羯）
    if (sm < em || (sm === em && sd <= ed)) {
      return (m > sm || (m === sm && d >= sd)) &&
             (m < em || (m === em && d <= ed));
    } else {
      return (m > sm || (m === sm && d >= sd)) ||
             (m < em || (m === em && d <= ed));
    }
  }

  function getSunSign(dateStr){
    const dt = new Date(dateStr);
    if (Number.isNaN(dt.getTime())) return SIGN_LIST[11];
    const m = dt.getMonth() + 1;
    const d = dt.getDate();
    return SIGN_LIST.find(s => inRange(m,d,s.start,s.end)) || SIGN_LIST[11];
  }

  const EL_TIPS = {
    fire:{
      'zh-CN':[
        '你的火象能量很强，适合先行动再微调方向。',
        '把目标拆成一小步一小步，避免一次冲太猛而耗尽体力。'
      ],
      'zh-TW':[
        '你帶有強烈的火象能量，適合先行動再微調方向。',
        '把目標切成小步驟，避免一次衝太猛反而消耗殆盡。'
      ],
      'en':[
        'You carry strong fire energy: movement first, then fine-tuning.',
        'Break big goals into short sprints so you don’t burn out.'
      ],
      'ja':[
        'あなたには火のエネルギーが強く、まず動きながら方向を調整するタイプです。',
        '大きな目標は、小さなステップに分けて進めると燃え尽きにくくなります。'
      ],
      'th':[
        'คุณมีพลังธาตุไฟค่อนข้างแรง เหมาะกับ “ลงมือก่อน ค่อยปรับทีหลัง”。',
        'แบ่งเป้าหมายใหญ่ให้เป็นสเต็ปเล็ก ๆ จะช่วยไม่ให้หมดไฟง่ายเกินไป.'
      ],
      'ms':[
        'Anda membawa tenaga api yang kuat: bergerak dulu, kemudian halakan semula.',
        'Pecahkan matlamat besar kepada beberapa pecutan kecil supaya tidak cepat letih.'
      ]
    },
    earth:{
      'zh-CN':[
        '土象能量让你务实、重视安全感，但也容易卡在完美主义。',
        '给自己设一个「好够了就可以上线」的标准，再慢慢优化。'
      ],
      'zh-TW':[
        '土象能量讓你務實、重視安全感，也可能容易陷入完美主義。',
        '替自己設定一個「好到這裡就可以先上線」的標準，之後再微調。'
      ],
      'en':[
        'Earth energy makes you practical and security-focused, but perfectionism can slow you down.',
        'Set a “good enough to ship” line, then improve after you launch.'
      ],
      'ja':[
        '地のエネルギーは、現実的で安定志向ですが、完璧主義になりやすい面もあります。',
        '「ここまでできたら一旦出す」というラインを決め、その後に少しずつ改善していきましょう。'
      ],
      'th':[
        'พลังธาตุดินทำให้คุณเน้นความมั่นคงและความปลอดภัย แต่งานอาจช้าเพราะอยากให้เป๊ะทุกอย่าง.',
        'ลองกำหนดระดับว่า “แค่นี้ก็ส่งงานได้แล้ว” แล้วค่อยปรับรายละเอียดภายหลัง.'
      ],
      'ms':[
        'Tenaga bumi menjadikan anda praktikal dan sukakan rasa selamat, tetapi mudah terperangkap dalam perfeksionisme.',
        'Tetapkan tahap “cukup baik untuk dihantar”, kemudian perbaiki sedikit demi sedikit.'
      ]
    },
    air:{
      'zh-CN':[
        '风象能量带来很多灵感和点子，也容易分心、想太多。',
        '把想法写下来、排出优先顺序，就比较不会被信息淹没。'
      ],
      'zh-TW':[
        '風象能量帶來許多靈感與點子，但也容易分心、想太多。',
        '把想法寫下來並排出優先順序，就比較不會被資訊淹沒。'
      ],
      'en':[
        'Air energy gives you plenty of ideas, but also mental noise.',
        'Write down your ideas and prioritise them so your mind can rest.'
      ],
      'ja':[
        '風のエネルギーは、ひらめきやアイデアが多い反面、考えすぎや気の散りやすさもあります。',
        '思いついたことは書き出して優先順位をつけると、頭の中がスッキリしやすくなります。'
      ],
      'th':[
        'พลังธาตุลมทำให้คุณคิดเก่ง ไอเดียเยอะ แต่ก็วุ่นวายในหัวได้ง่าย.',
        'ลองเขียนไอเดียออกมาและจัดลำดับความสำคัญ จะช่วยให้จิตใจโล่งขึ้น.'
      ],
      'ms':[
        'Tenaga udara memberi anda banyak idea, tetapi juga mudah berserabut.',
        'Tulis semua idea dan susun ikut keutamaan supaya minda lebih tenang.'
      ]
    },
    water:{
      'zh-CN':[
        '水象能量让你感受细腻、共情力强，但情绪也容易被环境牵动。',
        '每天给自己一点时间写下感受，或用身体运动把情绪流动出去。'
      ],
      'zh-TW':[
        '水象能量讓你感受細膩、共感能力強，但情緒也容易被環境牽動。',
        '每天留一點時間寫下感受，或透過身體活動讓情緒流動出去。'
      ],
      'en':[
        'Water energy makes you deeply sensitive and empathic, but moods can be easily swayed.',
        'Give yourself a small daily ritual to name your feelings or move your body to let them flow.'
      ],
      'ja':[
        '水のエネルギーは、繊細さと共感力を与えてくれますが、環境に感情が揺さぶられやすい面もあります。',
        '毎日少しだけでも感情を書き出したり、体を動かしてエネルギーを流してあげましょう。'
      ],
      'th':[
        'พลังธาตุน้ำทำให้คุณอ่อนไหว รับความรู้สึกของคนอื่นได้ดี แต่อารมณ์ก็ขึ้นลงง่าย.',
        'ให้เวลาตัวเองทุกวันนิดหน่อย เพื่อเขียนหรือระบายความรู้สึกออกมาผ่านการเคลื่อนไหวของร่างกาย.'
      ],
      'ms':[
        'Tenaga air menjadikan anda sangat peka dan empati, tetapi emosi juga mudah terpengaruh.',
        'Setiap hari, luangkan sedikit masa untuk menulis perasaan atau menggerakkan badan agar emosi mengalir dengan sihat.'
      ]
    }
  };

  function getElementTips(el, lang){
    const pack = EL_TIPS[el];
    if(!pack) return [];
    return pack[lang] || pack['zh-CN'] || [];
  }

  /* ========================= 表单 & 报告 ========================= */
  let lastModel = null;

  function readForm(){
    const name  = (gid('name')?.value || '').trim();
    const place = (gid('place')?.value || '').trim();
    const date  = gid('birthdate')?.value || '';
    const time  = gid('birthtime')?.value || '';
    const gender = gid('gender')?.value || 'u';
    return { name, place, date, time, gender };
  }

  function renderHeaderSummary(model){
    const box = gid('chartSummary');
    if(!box) return;
    const namePart = model.name ? (model.name + ' · ') : '';
    const timePart = model.time || '';
    const placePart = model.place ? (' @ ' + model.place) : '';
    box.textContent = `${namePart}${model.date} ${timePart}${placePart}`;
  }

function renderReport(model){
  const result = gid('result');
  const wrap   = gid('chartReport');
  if(!wrap || !result) return;

  const lang = getLang();
  const sign = getSunSign(model.date);

  const signNameCn    = sign.name['zh-CN'] || sign.key;
  const signNameEn    = sign.name['en']    || sign.key;
  const signNameLocal = sign.name[lang]    || signNameEn || signNameCn;
  const element       = sign.el;
  const energyTips    = getElementTips(element, lang);  // ← rename here
  const L = key => t(key);

  const tips = getElementTips(element, lang); // 能量提示多语言

  const overviewTitle = esc(L('section_overview'));
  const sunTitle      = esc(L('section_sun'));
  const energyTitle   = esc(L('section_energy'));
  const actionTitle   = esc(L('section_action'));

  const sunLabel   = esc(L('sun_label'));
  const disclaimer = esc(L('disclaimer'));

  // —— 元素名称 —— 
  const EL_NAME = {
    'zh-CN': { fire:'火象', earth:'土象', air:'风象', water:'水象' },
    'zh-TW': { fire:'火象', earth:'土象', air:'風象', water:'水象' },
    'en':    { fire:'fire', earth:'earth', air:'air', water:'water' },
    'ja':    { fire:'火のエレメント', earth:'地のエレメント', air:'風のエレメント', water:'水のエレメント' },
    'th':    { fire:'ธาตุไฟ', earth:'ธาตุดิน', air:'ธาตุลม', water:'ธาตุน้ำ' },
    'ms':    { fire:'api', earth:'bumi', air:'udara', water:'air' }
  };
  const elPack = EL_NAME[lang] || EL_NAME['en'];
  const elName = elPack[element] || element;

  // —— 性别文字 —— 
  const genderMap = {
    'zh-CN':{m:'男性',f:'女性',u:'—'},
    'zh-TW':{m:'男性',f:'女性',u:'—'},
    'en':   {m:'Male',f:'Female',u:'—'},
    'ja':   {m:'男性',f:'女性',u:'—'},
    'th':   {m:'ชาย',f:'หญิง',u:'—'},
    'ms':   {m:'Lelaki',f:'Perempuan',u:'—'}
  };
  const gPack       = genderMap[lang] || genderMap['zh-CN'];
  const genderLabel = gPack[model.gender] || gPack.u;

  // —— 三个 section 的标题（随语言变）——
  const hPersona = (
    lang === 'en' ? 'Personality Portrait' :
    lang === 'ja' ? '性格画像' :
    lang === 'th' ? 'ภาพรวมบุคลิก' :
    lang === 'ms' ? 'Potret keperibadian' :
    lang === 'zh-TW' ? '性格画像' :
    '性格画像'
  );

  const hRelation = (
    lang === 'en' ? 'Relationships & Communication' :
    lang === 'ja' ? '人間関係とコミュニケーション' :
    lang === 'th' ? 'ความสัมพันธ์และการสื่อสาร' :
    lang === 'ms' ? 'Hubungan & komunikasi' :
    lang === 'zh-TW' ? '關係與溝通' :
    '关系与沟通'
  );

  const hCareer = (
    lang === 'en' ? 'Career & Wealth Direction' :
    lang === 'ja' ? '仕事と豊かさの方向性' :
    lang === 'th' ? 'ทิศทางงานและทรัพย์' :
    lang === 'ms' ? 'Arah kerjaya & kewangan' :
    lang === 'zh-TW' ? '事業與財富走向' :
    '事业与财富走向'
  );

  // =========================
  // 这里补上三组文案：性格 / 关系 / 事业
  // =========================
  let personaLines  = [];
  let relationLines = [];
  let careerLines   = [];

  if (lang === 'en') {
    const elLabel = (element === 'fire' ? 'fire sign'
                     : element === 'earth' ? 'earth sign'
                     : element === 'air' ? 'air sign'
                     : 'water sign');

    personaLines = [
      `Your Sun is in ${signNameEn}, a ${elLabel}. This gives you a very ${elLabel.includes('fire') ? 'direct and spontaneous' : elLabel.includes('earth') ? 'grounded and practical' : elLabel.includes('air') ? 'curious and mental' : 'sensitive and intuitive'} flavour in how you approach life.`,
      `You tend to protect what matters to you in your own way, and you prefer to move at a rhythm that fits your inner timing rather than other people’s expectations.`
    ];

    relationLines = [
      `In relationships, your ${elLabel} nature makes you ${element === 'fire' ? 'warm but a bit impatient' :
                          element === 'earth' ? 'reliable but sometimes slow to express feelings' :
                          element === 'air' ? 'communicative but easily distracted' :
                          'caring but sometimes overwhelmed by emotion'}.`,
      `The more you learn to say clearly what you need — instead of testing or guessing — the easier it becomes for people to meet you halfway.`
    ];

    careerLines = [
      `At work, Sun in ${signNameEn} pushes you to look for ${element === 'fire' ? 'challenge and growth' :
                         element === 'earth' ? 'stability and tangible results' :
                         element === 'air' ? 'ideas, conversations and change' :
                         'meaning, connection and healing'}.`,
      `If you align your daily tasks with something you truly care about, your energy lasts much longer and money tends to follow more naturally.`
    ];

  } else if (lang === 'ja') {
    personaLines = [
      `あなたの太陽星座は${signNameCn}で、${elName}の性質を強く持っています。`,
      `自分なりのペースやこだわりがあり、人からどう見られるかよりも「自分が納得できるか」を大切にしやすいタイプです。`
    ];
    relationLines = [
      `人間関係では、この${elName}らしさがそのまま出ます。距離感の取り方や本音の出し方に、少しクセが出やすいところもあります。`,
      `「本当はどうしてほしいのか」「どこまで踏み込んでほしいのか」を自分で言葉にしていくほど、誤解は減っていきます。`
    ];
    careerLines = [
      `仕事面では、${signNameCn}の太陽らしく、自分の世界観や価値観を活かせるフィールドで力を発揮しやすいでしょう。`,
      `安定だけでなく「やりがい」「成長」「人の役に立てている感覚」など、心が満たされる条件を少しずつ整えていくことがポイントです。`
    ];

  } else if (lang === 'th') {
    personaLines = [
      `ดวงอาทิตย์ของคุณอยู่ที่ราศี${signNameCn} ซึ่งเชื่อมโยงกับพลังของ${elName}.`,
      `โดยพื้นฐานแล้วคุณมีสไตล์เป็นของตัวเอง ชอบใช้ชีวิตตามจังหวะและมาตรฐานที่ตัวเองยอมรับ มากกว่าจะทำตามสิ่งที่คนอื่นคาดหวัง.`
    ];
    relationLines = [
      `เรื่องความสัมพันธ์ พลังของ${elName} ทำให้คุณมีวิธีเข้าใกล้คนอื่นแบบเฉพาะตัว บางครั้งคนรอบข้างอาจอ่านใจคุณไม่ออกง่าย ๆ.`,
      `ยิ่งคุณบอกความต้องการของตัวเองตรง ๆ มากขึ้นเท่าไร ทั้งเรื่องระยะห่าง เวลา หรือความคาดหวัง ความสัมพันธ์ก็จะยิ่งชัดและสบายใจขึ้น.`
    ];
    careerLines = [
      `ในงานและการเงิน ราศี${signNameCn} ทำให้คุณมองหาเส้นทางที่ทั้งพอเลี้ยงชีพได้ และยังให้ความรู้สึกมีคุณค่าในแบบของตัวเองด้วย.`,
      `ลองค่อย ๆ ขยับงานไปในทิศทางที่สอดคล้องกับสิ่งที่คุณเชื่อและเก่งจริง ๆ จะช่วยให้พลังงานไม่หมดเร็ว และโอกาสด้านรายได้ก็เปิดมากขึ้น.`
    ];

  } else if (lang === 'ms') {
    personaLines = [
      `Matahari anda berada dalam tanda ${signNameEn} (${signNameCn}), yang membawa sifat ${elName} yang jelas.`,
      `Secara semula jadi anda cenderung mengikut ritma sendiri; apa yang membuat anda rasa betul dan tulen lebih penting daripada memenuhi jangkaan orang lain.`
    ];
    relationLines = [
      `Dalam hubungan, tenaga ${elName} ini membuat cara anda rapat dengan orang lain agak unik — kadang-kadang orang sukar meneka apa yang anda rasa sebenarnya.`,
      `Lebih banyak anda berani menyatakan keperluan dan had anda dengan jelas, lebih mudah hubungan menjadi jujur dan stabil.`
    ];
    careerLines = [
      `Dalam kerjaya, Matahari di ${signNameEn} mendorong anda mencari kerja yang selari dengan nilai peribadi, bukan sekadar “gaji cukup”.`,
      `Apabila pekerjaan menyokong rasa makna dan potensi anda, tenaga anda tahan lama dan rezeki kewangan pun cenderung mengikut.`
    ];

  } else if (lang === 'zh-TW') {
    personaLines = [
      `你的太陽星座是${signNameCn}，帶有明顯的${elName}特質。`,
      `你在意「活得像自己」，常常寧可花時間慢慢調整，也不想勉強配合別人的期待。`
    ];
    relationLines = [
      `在人際與感情相處上，這份${elName}氣質會直接反映在你的表達方式與距離感上。`,
      `越能坦白說出自己的需要與界線，越不容易陷入「對方應該要懂我」卻又失望的循環。`
    ];
    careerLines = [
      `在工作與財富上，${signNameCn}的太陽通常需要一份既能養活自己、又不背離內心價值的路。`,
      `當你一步步靠近真正在乎的領域時，專注力與耐力會自然提升，財富也比較容易穩定累積。`
    ];

  } else { // 默认 zh-CN
    personaLines = [
      `你的太阳星座是${signNameCn}，带有明显的${elName}特质。`,
      `你重视「活得像自己」，不太喜欢被标准答案绑住，更倾向用自己的节奏去安排人生。`
    ];
    relationLines = [
      `在人际与感情互动中，这份${elName}能量会体现在你的表达方式、亲密距离感与安全感需求上。`,
      `当你愿意更清楚说出自己的需要、界线与不安，对方就更有机会真正理解你，而不是靠猜。`
    ];
    careerLines = [
      `在事业与财富方向上，${signNameCn}的太阳需要一条既能维持基本稳定、又不违背内心价值的路。`,
      `越能把工作拉向你真正擅长与在乎的领域，你的耐力越强，赚钱也会变得更顺手。`
    ];
  }

  // ===== HTML 结构（保持你原来的风格） =====
  const overviewHtml = `
    <div class="sec">
      <h3>${overviewTitle}</h3>
      <p>${esc(model.name || '')}${model.name ? ' · ' : ''}${esc(model.date)} ${esc(model.time || '')}${model.place ? (' @ ' + esc(model.place)) : ''}</p>
      <p class="muted" style="opacity:.8">${disclaimer}</p>
    </div>`;

const sunHtml = `
  <div class="sec">
    <h3>${sunTitle}</h3>
    <p>${sunLabel} <b>${esc(signNameLocal)}</b></p>
    <p class="muted">${genderLabel !== '—' ? ('Gender / 性别：' + esc(genderLabel)) : ''}</p>
  </div>`;

  const personaHtml = `
    <div class="sec">
      <h3>${esc(hPersona)}</h3>
      <p>${personaLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const relationHtml = `
    <div class="sec">
      <h3>${esc(hRelation)}</h3>
      <p>${relationLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const careerHtml = `
    <div class="sec">
      <h3>${esc(hCareer)}</h3>
      <p>${careerLines.map(line => esc(line)).join('<br>')}</p>
    </div>`;

  const energyHtml = `
    <div class="sec">
      <h3>${energyTitle}</h3>
      <p>${energyTips.map(line => '• ' + esc(line)).join('<br>')}</p>
    </div>`;

  const actionHtml = `
    <div class="sec">
      <h3>${actionTitle}</h3>
      <ul>
        <li>${esc(L('action_1'))}</li>
        <li>${esc(L('action_2'))}</li>
        <li>${esc(L('action_3'))}</li>
      </ul>
    </div>`;

  wrap.innerHTML =
    overviewHtml +
    sunHtml +
    personaHtml +
    relationHtml +
    careerHtml +
    energyHtml +
    actionHtml;

  result.style.display = 'block';
}

  /* ========================= IP → 出生地点预填 ========================= */
  async function fillBirthPlaceFromIP(){
    const input = gid('place');
    if(!input || input.value) return; // 有值就不动
    try{
      // ⚠️ ipapi 有 CORS + 429 风险，如不想看到 network error，可直接不用这个函数
      const res = await fetch('https://ipapi.co/json/');
      if(!res.ok) return;
      const data = await res.json();
      const country = data.country_name || data.country;
      const city = data.city;
      const guess = (city && country) ? `${city}, ${country}` : (country || '');
      if(guess && !input.value){
        input.value = guess;
      }
    }catch(e){
      // 静默失败
    }
  }

  /* ========================= 心怜管家 · 聊天浮窗 ========================= */
  function initButlerChat(){
    const fab    = gid('ssChatFab');
    const panel  = gid('ssChatPanel');
    const close  = gid('ssChatClose');
    const input  = gid('ssChatInput');
    const send   = gid('ssChatSend');
    const body   = gid('ssChatBody');

    if(!fab || !panel || !input || !send || !body) return;

    function showPanel(){
      panel.style.display = 'block';
      fab.style.display = 'none';
      input.focus();
    }
    function hidePanel(){
      panel.style.display = 'none';
      fab.style.display = 'grid';
    }

    fab.addEventListener('click', showPanel);
    close.addEventListener('click', hidePanel);

    function appendMsg(text, isMe){
      const div = document.createElement('div');
      div.className = 'ss-msg' + (isMe ? ' me' : '');
      div.innerHTML = esc(text).replace(/\n/g,'<br>');
      body.appendChild(div);
      body.scrollTop = body.scrollHeight;
    }

    async function fakeReply(userText){
      const ctx = lastModel || readForm();
      const sign = ctx.date ? getSunSign(ctx.date) : null;
      const lang = getLang();

      let intro = '';
      if (sign) {
        const signName = sign.name[lang] || sign.name['zh-CN'];
        intro = `（基于你现在的太阳星座 ${signName} 给你一个简单方向）\n\n`;
      }

      const reply =
        intro +
        '我先用「整体能量」的角度帮你看：\n' +
        '· 把你刚刚问的问题拆成 1～2 个重点（例如：感情中的担心点 / 工作中最想突破的卡点）。\n' +
        '· 然后我们可以继续往下聊，你也可以告诉我：你现在最想先调整的是哪一块？';

      await new Promise(r => setTimeout(r, 500));
      appendMsg(reply, false);
    }

    async function handleSend(){
      const val = (input.value || '').trim();
      if(!val) return;
      appendMsg(val, true);
      input.value = '';

      try{
        await fakeReply(val);
      }catch(e){
        appendMsg('目前连线有一点不稳定，你可以稍后再试一次，或先把重点写下来当作自我整理。', false);
      }
    }

    send.addEventListener('click', handleSend);
    input.addEventListener('keydown', e=>{
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        handleSend();
      }
    });
  }

  /* ========================= 表单提交处理 ========================= */
  function handleGenerate(evt){
    if (evt && evt.preventDefault) evt.preventDefault();

    const model = readForm();
    if (!model.date || !model.place) {
      alert(t('alert_fill'));
      return;
    }

    lastModel = model;
    renderHeaderSummary(model);
    renderReport(model);
  }

  /* ========================= 初始化 ========================= */
  document.addEventListener('DOMContentLoaded', ()=>{
    const langSel = gid('langSelect');
    if(langSel){
      const saved = localStorage.getItem('natal_lang');
      if(saved && Array.from(langSel.options).some(o=>o.value===saved)){
        langSel.value = saved;
      }
      langSel.addEventListener('change', ()=>{
        localStorage.setItem('natal_lang', langSel.value);
        applyI18n();
        if(lastModel){
          renderHeaderSummary(lastModel);
          renderReport(lastModel);
        }
      });
    }

    applyI18n();
    startNowClock();

    const dateInput = gid('birthdate');
    const timeInput = gid('birthtime');
    const now = new Date();
    const pad = n => (n<10 ? '0'+n : ''+n);
    if(dateInput && !dateInput.value){
      dateInput.value = now.toISOString().split('T')[0];
    }
    if(timeInput && !timeInput.value){
      const hh = pad(now.getHours());
      const mm = pad(now.getMinutes());
      timeInput.value = `${hh}:${mm}`;
    }

    // 如果你现在不想看到 ipapi 的 CORS 报错，可以先注释掉这一行：
    // fillBirthPlaceFromIP();

    const form = gid('chartForm');
    if(form){
      form.addEventListener('submit', handleGenerate);
    }

    initButlerChat();
  });
})();
</script>
</body>
</html>

























