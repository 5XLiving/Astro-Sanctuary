<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>本命星盘 · Natal Chart | 5XLiving</title>
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

    /* —— 统一头部 —— */
    .site-header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084}
    .title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em}
    .title a{ color: inherit; text-decoration: none; }
    .title a:hover{ text-decoration: underline; text-underline-offset: 3px; }
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{white-space:nowrap; color:var(--muted)}
    .lang select{appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}
    .auth-btn{margin-left:10px; padding:10px 12px; border-radius:10px; border:1px solid rgba(212,175,55,.45); background:#0e1520; color:#ffe084; cursor:pointer}
    @media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

    /* —— 页面结构 —— */
    .h1{margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem}
    .sub{color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .row{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:760px){ .row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr} }
    label.muted{display:block;margin-bottom:4px}
    input,select{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);padding:12px 12px;font-size:15px;outline:none}
    input::placeholder{color:#6f8092}
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}

    /* —— GPT/心怜管家 —— */
    .ss-chat-fab{position:fixed; right:18px; bottom:18px; z-index:50; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; padding:12px 16px; border-radius:999px; border:1px solid #e6c76e; box-shadow:var(--shadow); cursor:pointer}
    .ss-chat-panel{position:fixed; right:18px; bottom:88px; width:min(460px,92vw); max-height:70vh; background:#0e1520; border:1px solid #243244; border-radius:16px; display:none; flex-direction:column; overflow:hidden; box-shadow:var(--shadow); z-index:50}
    .ss-chat-panel[aria-hidden="false"]{display:flex}
    .ss-chat-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244}
    .ss-chat-title{font-weight:700}
    .ss-close{cursor:pointer; opacity:.8}
    .ss-chat-body{padding:12px; overflow:auto; display:flex; flex-direction:column; gap:10px}
    .ss-msg{background:#11161dcc; border:1px solid #243244; padding:10px; border-radius:10px; font-size:.95rem; max-width:80%}
    .ss-msg .meta{font-size:.8rem; color:var(--muted); margin-bottom:4px}
    .ss-msg.me{margin-left:auto; background:#132033}
    .ss-chat-input{display:flex; gap:8px; padding:10px; border-top:1px solid #243244}
    .ss-chat-input input{flex:1; padding:10px; border-radius:10px; border:1px solid #273245; background:#0b0f14; color:var(--text)}

    /* —— 会员区布局 —— */
    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}
    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}
  </style>
</head>
<body>
  <!-- 统一头部 -->
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
        <span class="title">
          5xLiving · <span data-i18n="page_title">本命星盘解析</span>
        </span>
      </a>

      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">语言</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" data-i18n="page_title">本命星盘解析</h1>
    <p class="sub" data-i18n="page_sub">请输入出生资料，我们将为你绘制专属的本命星图（演示版）。</p>

    <!-- 表单区域 -->
    <section class="card">
      <div class="row cols-3">
        <div>
          <label class="muted" for="name" data-i18n="label_name">姓名（可选）</label>
          <input id="name" type="text" data-i18n-ph="ph_name" placeholder="你的称呼（用于个性化）" />
        </div>
        <div>
          <label class="muted" for="gender" data-i18n="gender_label">性别</label>
          <select id="gender">
            <option value="u" data-i18n="opt_gender_confidential">不透露</option>
            <option value="m" data-i18n="opt_gender_male">男性</option>
            <option value="f" data-i18n="opt_gender_female">女性</option>
          </select>
        </div>
        <div>
          <label class="muted" for="place" data-i18n="label_place">出生地点</label>
          <input id="place" type="text" data-i18n-ph="ph_place" placeholder="城市或坐标，如：Taipei / 25.03,121.56" />
        </div>
      </div>
      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted" for="birthdate" data-i18n="label_birthdate">出生日期</label>
          <input id="birthdate" type="date" />
        </div>
        <div>
          <label class="muted" for="birthtime" data-i18n="label_birthtime">出生时间</label>
          <input id="birthtime" type="time" />
        </div>
        <div style="display:flex;align-items:flex-end;gap:10px">
          <button id="genBtn" class="btn" type="button" data-i18n="btn_generate">生成星盘</button>
          <button id="demoBtn" class="btn ghost" type="button" data-i18n="btn_demo">示例</button>
        </div>
      </div>
      <div id="formNote" class="muted" style="margin-top:8px" data-i18n="note_privacy">提示：仅在本地演示用，不会上传你的个人信息。</div>
    </section>

    <!-- 结果区域（占位） -->
    <section id="result" class="card" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="chart_title">你的本命星盘</h2>
      <div id="chartSummary" class="muted"></div>
      <div style="margin-top:12px" id="chartCanvasWrap">
        <div class="muted" data-i18n="chart_placeholder">（可在此处接入后端绘图或前端 Canvas 渲染·当前为占位）</div>
      </div>
    </section>

    <!-- 会员专区 -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">🌙 会员区域 VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">🗝 命理空间专属内容</div>
          <ul>
            <li data-i18n="vip_love">姻缘方向：恋爱缘分、婚姻走势</li>
            <li data-i18n="vip_career">事业方向：职场发展、创业潜力</li>
            <li data-i18n="vip_wealth">财运方向：财位分析、理财时机</li>
            <li data-i18n="vip_pet">宠物命理：伴侣动物的性格与缘分</li>
            <li data-i18n="vip_hepan">合盘分析：婚期择日、新生择时</li>
            <li data-i18n="vip_name">测名分析：公司名、宝宝名、命名改运</li>
            <li data-i18n="vip_fengshui">财位合盘：住家 / 办公室动线配合</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">🌙 心怜空间专属内容</div>
          <ul>
            <li data-i18n="vip_record">灵性记录：照片、梦境、声音、愿望祈祷</li>
            <li data-i18n="vip_course">命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图</li>
            <li data-i18n="vip_memorial">家族纪念系统：亲人灵性纪念 & 延续</li>
            <li data-i18n="vip_tasks">每周能量练习 / 神明仪式任务</li>
            <li data-i18n="vip_shop">能量商城专属折扣 & 御守订制</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">💎 登入 VIP 功能</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- 左侧：输入 + 注册/登录 -->
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">账户登录 / 注册</div>
            <div class="body">
              <div class="row" id="authFields">
                <label for="email" class="sr-only" data-i18n="ph_email">邮箱 Email</label>
                <input
                  id="email"
                  name="email"
                  type="email"
                  inputmode="email"
                  autocomplete="username"
                  placeholder="邮箱 Email"
                  data-i18n-ph="ph_email"
                  required />

                <label for="password" class="sr-only" data-i18n="ph_label_password">密码 Password</label>
                <input 
                  id="password" 
                  type="password" 
                  autocomplete="new-password" 
                  placeholder="密码 Password（至少8位，含大小写数字符号）" data-i18n-ph="ph_password" required />
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one" onsubmit="return false;">
                <button class="btn block" id="loginBtn" type="button" data-i18n="btn_login">登入账户</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">🔑 重设密码</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm" onsubmit="return false;">
                <button class="btn block" id="registerBtn" type="button" data-i18n="btn_register">注册账户</button>
                <div class="muted" data-i18n="note_price">注册账号赠送一次免费体验</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- 右侧：会员与返回 -->
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">会员服务</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">💎 升级为 VIP（月费）</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">← 返回命理商城</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>© 5XLiving • Astro Sanctuary</footer>
  </main>

  <!-- GPT / 心怜管家浮窗 -->
  <div class="ss-chat-fab" id="chatFab" data-i18n="chat_fab">心怜管家</div>
  <div class="ss-chat-panel" id="chatPanel" aria-hidden="true">
    <div class="ss-chat-head">
      <div class="ss-chat-title" id="chatTitle">心怜管家</div>
      <div class="ss-close" id="chatClose">✕</div>
    </div>
    <div class="ss-chat-body" id="chatBody">
      <div class="ss-msg">
        <div class="meta">心怜管家</div>
        <p data-i18n="chat_greeting">你好，我是心怜管家。有什么我可以帮你？</p>
      </div>
    </div>
    <div class="ss-chat-input">
      <input id="chatInput" placeholder="输入问题…"/>
      <button class="btn" id="chatSend" data-i18n="chat_send">发送</button>
    </div>
  </div>

  <script>
  'use strict';
  const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';
  const LANG_KEY = 'site_lang';

  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  /* ===== i18n（五语） ===== */
  const natalI18n = {
    /* ——— zh-CN ——— */
    'zh-CN': {
      lang_label: '语言',
      btn_login: '登录账户',
      btn_register: '注册账户',
      btn_reset: '🔑 重设密码',

      page_title: '本命星盘｜Natal Chart',
      page_sub: '请输入出生资料，我们将为你绘制专属的本命星盘（演示版）。',

      label_name: '姓名（可选）',
      ph_name: '你的称呼（用于个性化）',
      gender_label: '性别',
      opt_gender_confidential: '不透露',
      opt_gender_male: '男性',
      opt_gender_female: '女性',

      label_place: '出生地点',
      ph_place: '城市或坐标，例如：Beijing／39.90, 116.40',

      label_birthdate: '出生日期',
      label_birthtime: '出生时间',

      btn_generate: '生成星盘',
      btn_demo: '示例',
      note_privacy: '说明：仅为本地示范，不会上传任何个人数据。',

      chart_title: '你的本命星盘',
      chart_placeholder: '（此处可接后端绘图或前端 Canvas，当前为占位）',

      panel_login_head: '账户登录／注册',
      ph_email: '邮箱 Email',
      ph_password: '密码 Password（至少 8 位，需包含大小写字母、数字与符号）',
      ph_label_password: '密码 Password',

      chat_fab: '问',
      chat_placeholder: '想了解什么？（如：功能、会员说明）',
      chat_send: '发送',

      err_need_ep: '请输入邮箱与密码',
      err_pwd_rule: '密码至少 8 位，需包含大写/小写/数字/符号',
      err_email_empty: '邮箱不能为空',
      err_pwd_empty: '密码不能为空',
      err_login_fail: '登录失败：',
      err_register_fail: '注册失败：',
      err_reset_fail: '重设失败：',
      err_no_account: '账户不存在，请先注册',
      err_wrong_pwd: '密码错误',
      err_expired: '会员已到期，请续费',
      msg_reset_ok: '已更新密码，请用新密码登录。',

      chat_greeting: '你好，我是心怜管家，需要我怎么协助你？'
    },
    /* ——— zh-TW ——— */
    'zh-TW': {
      lang_label: '語言',
      btn_login: '登入帳號',
      btn_register: '註冊帳號',
      btn_reset: '🔑 重設密碼',

      page_title: '本命星盤｜Natal Chart',
      page_sub: '請輸入出生資料，我們將為你繪製專屬的本命星盤（示範版）。',

      label_name: '姓名（選填）',
      ph_name: '你的稱呼（用於個人化）',
      gender_label: '性別',
      opt_gender_confidential: '不透露',
      opt_gender_male: '男性',
      opt_gender_female: '女性',

      label_place: '出生地點',
      ph_place: '城市或座標，例如：Taipei／25.03, 121.56',

      label_birthdate: '出生日期',
      label_birthtime: '出生時間',

      btn_generate: '產生星盤',
      btn_demo: '範例',
      note_privacy: '提醒：僅為本機示範，不會上傳任何個資。',

      chart_title: '你的本命星盤',
      chart_placeholder: '（此區可串接後端繪圖或前端 Canvas，現為佔位）',

      panel_login_head: '帳號登入／註冊',
      ph_email: '電子郵件 Email',
      ph_password: '密碼 Password（至少 8 碼，需包含大小寫字母、數字與符號）',
      ph_label_password: '密碼 Password',

      chat_fab: '問',
      chat_placeholder: '想了解什麼？（例如：功能、會員說明）',
      chat_send: '傳送',

      err_need_ep: '請輸入電子郵件與密碼',
      err_pwd_rule: '密碼至少 8 碼，需包含大小寫字母、數字與符號',
      err_email_empty: '電子郵件不能為空',
      err_pwd_empty: '密碼不能為空',
      err_login_fail: '登入失敗：',
      err_register_fail: '註冊失敗：',
      err_reset_fail: '重設失敗：',
      err_no_account: '查無帳號，請先註冊',
      err_wrong_pwd: '密碼不正確',
      err_expired: '會員已到期，請續費',
      msg_reset_ok: '已更新密碼，請以新密碼登入。',

      chat_greeting: '嗨，我是心怜管家。有什麼需要我協助？'
    },
    /* ——— en ——— */
    'en': {
      lang_label: 'Language',
      btn_login: 'Log in',
      btn_register: 'Create Account',
      btn_reset: '🔑 Reset Password',

      page_title: 'Natal Chart',
      page_sub: 'Enter your birth data to generate your personal natal chart (demo).',

      label_name: 'Name (optional)',
      ph_name: 'Your name (for personalization)',
      gender_label: 'Gender',
      opt_gender_confidential: 'Prefer not to say',
      opt_gender_male: 'Male',
      opt_gender_female: 'Female',

      label_place: 'Place of Birth',
      ph_place: 'City or coordinates, e.g., London / 51.50, -0.12',

      label_birthdate: 'Birth Date',
      label_birthtime: 'Birth Time',

      btn_generate: 'Generate Chart',
      btn_demo: 'Demo',
      note_privacy: 'Note: local demo only — no personal data is uploaded.',

      chart_title: 'Your Natal Chart',
      chart_placeholder: '(Hook up a backend renderer or draw via Canvas; placeholder for now)',

      panel_login_head: 'Account Login / Sign-up',
      ph_email: 'Email',
      ph_password: 'Password (min 8 chars with upper/lowercase, number & symbol)',
      ph_label_password: 'Password',

      chat_fab: 'Chat',
      chat_placeholder: 'What would you like to know? (e.g., features, membership)',
      chat_send: 'Send',

      err_need_ep: 'Enter email and password',
      err_pwd_rule: 'Password must be 8+ and include upper/lowercase, number, and symbol',
      err_email_empty: 'Email cannot be empty',
      err_pwd_empty: 'Password cannot be empty',
      err_login_fail: 'Login failed: ',
      err_register_fail: 'Registration failed: ',
      err_reset_fail: 'Reset failed: ',
      err_no_account: 'Account not found. Please sign up first.',
      err_wrong_pwd: 'Incorrect password',
      err_expired: 'Membership expired. Please renew.',
      msg_reset_ok: 'Password updated. Please log in with the new one.',

      chat_greeting: 'Hi, I’m Xinlian Butler. How can I help?'
    },
    /* ——— ja ——— */
    'ja': {
      lang_label: '言語',
      btn_login: 'アカウントにログイン',
      btn_register: 'アカウント登録',
      btn_reset: '🔑 パスワードをリセット',

      page_title: '出生ホロスコープ｜Natal Chart',
      page_sub: '生年月日などを入力すると、あなただけの出生ホロスコープを作成します（デモ）。',

      label_name: '名前（任意）',
      ph_name: 'お名前（パーソナライズ用）',
      gender_label: '性別',
      opt_gender_confidential: '非公開',
      opt_gender_male: '男性',
      opt_gender_female: '女性',

      label_place: '出生地',
      ph_place: '都市または座標 例：Tokyo／35.68, 139.76',

      label_birthdate: '生年月日',
      label_birthtime: '出生時刻',

      btn_generate: 'チャートを生成',
      btn_demo: 'デモ',
      note_privacy: '注意：ローカルデモのみ。個人情報は送信されません。',

      chart_title: 'あなたの出生ホロスコープ',
      chart_placeholder: '（バックエンド連携または Canvas 描画を想定したプレースホルダー）',

      panel_login_head: 'ログイン／新規登録',
      ph_email: 'メールアドレス',
      ph_password: 'パスワード（8文字以上・英大小／数字／記号を含む）',
      ph_label_password: 'パスワード',

      chat_fab: '問',
      chat_placeholder: '何を知りたいですか？（例：機能・会員案内）',
      chat_send: '送信',

      err_need_ep: 'メールアドレスとパスワードを入力してください',
      err_pwd_rule: 'パスワードは8文字以上で、英大小・数字・記号を含めてください',
      err_email_empty: 'メールアドレスは必須です',
      err_pwd_empty: 'パスワードは必須です',
      err_login_fail: 'ログイン失敗：',
      err_register_fail: '登録失敗：',
      err_reset_fail: 'リセットに失敗：',
      err_no_account: 'アカウントが見つかりません。先に登録してください。',
      err_wrong_pwd: 'パスワードが正しくありません',
      err_expired: '会員期限が切れています。更新してください。',
      msg_reset_ok: 'パスワードを更新しました。新しい情報でログインしてください。',

      chat_greeting: 'こんにちは、心怜バトラーです。どうお手伝いできますか？'
    },
    /* ——— th ——— */
    'th': {
      lang_label: 'ภาษา',
      btn_login: 'เข้าสู่ระบบ',
      btn_register: 'สมัครบัญชี',
      btn_reset: '🔑 รีเซ็ตรหัสผ่าน',

      page_title: 'ดวงกำเนิด｜Natal Chart',
      page_sub: 'กรอกข้อมูลวัน เวลา และสถานที่เกิด เพื่อสร้างดวงกำเนิดเฉพาะตัว (เดโม)',

      label_name: 'ชื่อ (ไม่บังคับ)',
      ph_name: 'ชื่อของคุณ (เพื่อปรับให้เหมาะส่วนบุคคล)',
      gender_label: 'เพศ',
      opt_gender_confidential: 'ไม่ระบุ',
      opt_gender_male: 'ชาย',
      opt_gender_female: 'หญิง',

      label_place: 'สถานที่เกิด',
      ph_place: 'เมืองหรือพิกัด เช่น Bangkok / 13.75, 100.50',

      label_birthdate: 'วันเกิด',
      label_birthtime: 'เวลาเกิด',

      btn_generate: 'สร้างแผนภูมิ',
      btn_demo: 'เดโม',
      note_privacy: 'หมายเหตุ: เดโมภายในเครื่องเท่านั้น ไม่มีการอัปโหลดข้อมูลส่วนตัว',

      chart_title: 'ดวงกำเนิดของคุณ',
      chart_placeholder: '(สามารถเชื่อมเรนเดอร์ฝั่งเซิร์ฟเวอร์หรือวาดด้วย Canvas — พื้นที่ตัวอย่าง)',

      panel_login_head: 'เข้าสู่ระบบ／สมัครสมาชิก',
      ph_email: 'อีเมล',
      ph_password: 'รหัสผ่าน (อย่างน้อย 8 ตัว รวมตัวพิมพ์ใหญ่/เล็ก ตัวเลข และสัญลักษณ์)',
      ph_label_password: 'รหัสผ่าน',

      chat_fab: 'ถาม',
      chat_placeholder: 'อยากทราบเรื่องใด? (เช่น ฟีเจอร์หรือระบบสมาชิก)',
      chat_send: 'ส่ง',

      err_need_ep: 'กรุณากรอกอีเมลและรหัสผ่าน',
      err_pwd_rule: 'รหัสผ่านอย่างน้อย 8 ตัว และต้องมีตัวพิมพ์ใหญ่/เล็ก ตัวเลข และสัญลักษณ์',
      err_email_empty: 'อีเมลห้ามว่าง',
      err_pwd_empty: 'รหัสผ่านห้ามว่าง',
      err_login_fail: 'เข้าสู่ระบบไม่สำเร็จ: ',
      err_register_fail: 'สมัครสมาชิกไม่สำเร็จ: ',
      err_reset_fail: 'รีเซ็ตรหัสผ่านไม่สำเร็จ: ',
      err_no_account: 'ไม่พบบัญชี กรุณาสมัครก่อน',
      err_wrong_pwd: 'รหัสผ่านไม่ถูกต้อง',
      err_expired: 'สมาชิกหมดอายุ กรุณาต่ออายุ',
      msg_reset_ok: 'อัปเดตรหัสผ่านแล้ว โปรดเข้าสู่ระบบด้วยรหัสใหม่',

      chat_greeting: 'สวัสดีครับ/ค่ะ ฉันคือผู้ช่วยซินเหลียน มีอะไรให้ช่วยไหม'
    },
    /* ——— ms ——— */
    'ms': {
      lang_label: 'Bahasa',
      btn_login: 'Log Masuk',
      btn_register: 'Daftar Akaun',
      btn_reset: '🔑 Tetapkan Semula Kata Laluan',

      page_title: 'Carta Kelahiran｜Natal Chart',
      page_sub: 'Masukkan data kelahiran anda untuk jana carta kelahiran peribadi (demo).',

      label_name: 'Nama (pilihan)',
      ph_name: 'Nama anda (untuk personalisasi)',
      gender_label: 'Jantina',
      opt_gender_confidential: 'Rahsia',
      opt_gender_male: 'Lelaki',
      opt_gender_female: 'Perempuan',

      label_place: 'Tempat Lahir',
      ph_place: 'Bandar atau koordinat, cth: Kuala Lumpur / 3.14, 101.69',

      label_birthdate: 'Tarikh Lahir',
      label_birthtime: 'Masa Lahir',

      btn_generate: 'Jana Carta',
      btn_demo: 'Demo',
      note_privacy: 'Nota: demo setempat sahaja — tiada data peribadi dihantar.',

      chart_title: 'Carta Kelahiran Anda',
      chart_placeholder: '(Boleh sambung renderer belakang atau lukis melalui Canvas — tempat letak sementara)',

      panel_login_head: 'Log Masuk／Daftar',
      ph_email: 'Emel',
      ph_password: 'Kata Laluan (≥8 aksara, huruf besar/kecil, nombor & simbol)',
      ph_label_password: 'Kata Laluan',

      chat_fab: 'Chat',
      chat_placeholder: 'Apa yang anda ingin tahu? (cth: fungsi, keahlian)',
      chat_send: 'Hantar',

      err_need_ep: 'Masukkan emel dan kata laluan',
      err_pwd_rule: 'Kata laluan mesti ≥8 dan mengandungi huruf besar/kecil, nombor dan simbol',
      err_email_empty: 'Emel tidak boleh kosong',
      err_pwd_empty: 'Kata laluan tidak boleh kosong',
      err_login_fail: 'Gagal log masuk: ',
      err_register_fail: 'Gagal mendaftar: ',
      err_reset_fail: 'Gagal tetapkan semula: ',
      err_no_account: 'Akaun tidak ditemui. Sila daftar dahulu.',
      err_wrong_pwd: 'Kata laluan tidak sah',
      err_expired: 'Keahlian tamat tempoh. Sila perbaharui.',
      msg_reset_ok: 'Kata laluan dikemas kini. Log masuk dengan yang baharu.',

      chat_greeting: 'Hai, saya Xinlian Butler. Bagaimana saya boleh bantu?'
    }
  };

  function getLang(){ return localStorage.getItem(LANG_KEY) || (navigator.language||'zh-CN').replace('_','-'); }
  function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
  function t(key){ const L = natalI18n[getLang()] || natalI18n['zh-CN']; return L[key] || (natalI18n['zh-CN'][key] || key); }
  function applyI18n(){
    // 批量替换 data-i18n 文本
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n');
      el.textContent = t(k);
    });
    // 批量替换 placeholder
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const k = el.getAttribute('data-i18n-ph');
      el.setAttribute('placeholder', t(k));
    });
    // 特殊：聊天输入框占位
    $('#chatInput')?.setAttribute('placeholder', t('chat_placeholder'));
  }

  /* ===== 页面逻辑 ===== */
  document.addEventListener('DOMContentLoaded', ()=>{
    // init lang
    const sel = $('#langSelect');
    const cur = getLang();
    if(natalI18n[cur]) { sel.value = cur; document.documentElement.lang = cur; } else { sel.value = 'zh-CN'; setLang('zh-CN'); }
    applyI18n();
    sel.addEventListener('change', ()=>{ setLang(sel.value); applyI18n(); });

    // Chat
    $('#chatFab')?.addEventListener('click', ()=> $('#chatPanel')?.setAttribute('aria-hidden','false'));
    $('#chatClose')?.addEventListener('click', ()=> $('#chatPanel')?.setAttribute('aria-hidden','true'));
    $('#chatSend')?.addEventListener('click', sendGPT);
    $('#chatInput')?.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendGPT(); }});

    // Buttons
    $('#genBtn')?.addEventListener('click', generateChart);
    $('#demoBtn')?.addEventListener('click', fillDemo);

    // Default birthdate today
    const today=new Date().toISOString().split('T')[0];
    if($('#birthdate') && !$('#birthdate').value) $('#birthdate').value = today;
  });

  function showAuthErr(msg){ const e=$('#authError'); if(!e) return; e.textContent = msg; e.style.display='block'; setTimeout(()=> e.style.display='none', 6000); }
  function strongPwd(pw){ return pw.length>=8 && /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /[0-9]/.test(pw) && /[^A-Za-z0-9]/.test(pw); }

  // —— 登录/注册/重设（后端钩子保留） ——
  async function login(){
    const email=$('#email')?.value.trim(); const password=$('#password')?.value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    try{
      const r=await fetch(API_BASE+'/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const data=await r.json().catch(()=>({}));
      if(data?.ok){ localStorage.setItem('vipEmail', email); alert('OK'); return; }
      if(data?.msg==='wrong_pwd') return showAuthErr(t('err_wrong_pwd'));
      if(data?.msg==='no_account') return showAuthErr(t('err_no_account'));
      showAuthErr(t('err_login_fail') + (data?.msg||''));
    }catch(e){ showAuthErr(t('err_login_fail') + e.message); }
  }
  async function register(){
    const email=$('#email')?.value.trim(); const password=$('#password')?.value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    if(!strongPwd(password)) return showAuthErr(t('err_pwd_rule'));
    try{
      const r=await fetch(API_BASE+'/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const data=await r.json().catch(()=>({}));
      if(data?.ok){ localStorage.setItem('vipEmail', email); alert('OK'); return; }
      showAuthErr(t('err_register_fail') + (data?.msg||''));
    }catch(e){ showAuthErr(t('err_register_fail') + e.message); }
  }
  async function resetPwd(){
    const email=prompt(t('ph_email'))||''; if(!email) return showAuthErr(t('err_email_empty'));
    const newPassword=prompt(t('ph_password'))||''; if(!newPassword) return showAuthErr(t('err_pwd_empty'));
    if(!strongPwd(newPassword)) return showAuthErr(t('err_pwd_rule'));
    try{
      const r=await fetch(API_BASE+'/api/reset',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,newPassword})});
      const data=await r.json().catch(()=>({}));
      if(!data?.ok) return showAuthErr(t('err_reset_fail') + (data?.msg||''));
      alert(t('msg_reset_ok'));
    }catch(e){ showAuthErr(t('err_reset_fail') + e.message); }
  }
  $('#loginBtn')?.addEventListener('click', login);
  $('#registerBtn')?.addEventListener('click', register);
  $('#resetBtn')?.addEventListener('click', resetPwd);

  // —— GPT demo ——
  async function sendGPT(){
    const input=$('#chatInput'); const txt=(input?.value||'').trim(); if(!txt) return; addMsg(txt,true); input.value='';
    try{
      const r=await fetch(API_BASE+'/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'system',content:'你是心怜管家，回答访客关于网站功能、会员、以及占星/命理产品导航的问题。'}, {role:'user',content:txt}]})});
      const data=await r.json().catch(()=>({}));
      addMsg(data?.reply || data?.text || data?.choices?.[0]?.message?.content || '…');
    }catch(e){ addMsg('网络异常，请稍后再试。'); }
  }
  function addMsg(text,me=false){ const wrap=$('#chatBody'); if(!wrap) return; const div=document.createElement('div'); div.className='ss-msg'+(me?' me':''); div.textContent=text; wrap.appendChild(div); wrap.scrollTop=wrap.scrollHeight; }

  // —— 示例与生成（占位） ——
  function fillDemo(){ $('#name').value='Avery'; $('#gender').value='u'; $('#place').value='Taipei'; $('#birthdate').value='1992-08-15'; $('#birthtime').value='13:45'; }
  function generateChart(){
    const name=$('#name').value.trim(); const place=$('#place').value.trim(); const d=$('#birthdate').value; const t=$('#birthtime').value;
    if(!d||!t||!place){ alert('请补全“日期/时间/地点”。'); return; }
    const summary = `${name?name+' · ':''}${d} ${t} @ ${place}`;
    $('#chartSummary').textContent = summary;
    $('#result').style.display = 'block';
    // TODO: 接入后端星盘绘制或本地算法
  }
  </script>
</body>
</html>
