<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="page_title">命理心怜空间 · Index</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="命理心怜空间 · 免费体验区与VIP专区：八字、占星、灵数、塔罗、九星气学、能量类型等，一站式灵性与命理体验。">
  <meta property="og:title" content="命理心怜空间 · Soul Sanctuary">
  <meta property="og:description" content="免费体验区与VIP专区：八字、占星、灵数、塔罗、九星气学、能量类型等。">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14; --card:#11161dCC; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --accent:#58b9ff; --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35); --blur:10px;
    }
    html,body{height:100%} html{font-size:16px}
    @media(min-width:768px){ html{font-size:17px} } @media(min-width:1200px){ html{font-size:18px} }
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans SC", Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:url('assets/images/gate.jpg') center/cover no-repeat;
      filter:brightness(.45) saturate(.9) blur(2px);
    }
    .glow{position:fixed; inset:auto auto 10% -10%; width:45vw; height:45vw; max-width:700px; max-height:700px;
      background:radial-gradient(closest-side, #2a98ff33, transparent 70%); filter:blur(30px); z-index:-1; pointer-events:none;}
    .container{width:100%; max-width:1100px; padding:24px 16px 80px; margin:0 auto;}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(12px);
      background:#0b0f14cc; border-bottom:1px solid #0f1622;}
    .head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:16px}
    .brand{display:flex; align-items:center; gap:12px}
    .brand-badge{width:36px; height:36px; border-radius:10px; background:linear-gradient(145deg,#273243,#0e141c);
      display:grid; place-items:center; color:var(--brand); font-weight:700; box-shadow:var(--shadow)}
    .title{font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; letter-spacing:.02em; font-size:1.1rem}
    .subtitle{color:var(--muted); font-size:.9rem}

    /* 语言选择器 */
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{color:var(--muted); font-size:.9rem}
    .lang select{
      appearance:none; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text);
      padding:10px 34px 10px 12px; font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
    }

    .section{margin-top:18px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(var(--blur)); padding:18px;}
    .grid-links{display:grid; gap:12px; grid-template-columns:repeat(1,1fr)}
    @media(min-width:640px){ .grid-links{grid-template-columns:repeat(2,1fr)} }
    @media(min-width:980px){ .grid-links{grid-template-columns:repeat(3,1fr)} }
    .link-card{display:flex; align-items:center; justify-content:center; text-align:center; padding:16px 12px;
      border:1px solid #263448; background:#0e1520; border-radius:12px; text-decoration:none; color:var(--text);
      transition:transform .05s ease, box-shadow .2s ease;}
    .link-card:hover{box-shadow:0 6px 18px rgba(88,185,255,.15)}
    .group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

    .row{display:grid; gap:12px}
    @media(min-width:640px){ .row{grid-template-columns:1fr 1fr 1fr} }
    input,button{
      width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244;
      background:#0e1520; color:var(--text); padding:14px 13px; font-size:1rem; outline:none;
    }
    input::placeholder{color:#6f8092}
    .btn{background:linear-gradient(180deg,#1d2a3a,#101723); border:1px solid #28364a; font-weight:600; letter-spacing:.02em; cursor:pointer}
    .btn:hover{box-shadow:0 6px 18px rgba(88,185,255,.15), inset 0 1px 0 #2e3c50}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .btn-gold{background:linear-gradient(180deg,#f7e7a8,#d4af37); color:#191919; border:1px solid #d4af37}

    .columns{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448; background:#0e1520; border-radius:12px; padding:16px}
    .list-block ul{margin:.2rem 0 0; padding-left:1.1rem}
    .muted{color:var(--muted)} .error{color:#ff8f8f; margin-top:8px}
    footer{color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0}

    /* Chat 浮窗 */
    .ss-chat-fab{
      position: fixed; right: 18px; bottom: 18px; z-index: 50;
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(180deg,#f7e7a8,#d4af37); color:#191919;
      display:grid; place-items:center; font-weight:800; box-shadow:0 8px 30px rgba(0,0,0,.35); cursor:pointer;
      border:1px solid #d4af37;
    }
    .ss-chat-panel{
      position: fixed; right: 18px; bottom: 90px; z-index: 50;
      width: min(380px, 92vw); max-height: 70vh; display:none; flex-direction: column;
      background: #0e1520f2; backdrop-filter: blur(12px);
      border:1px solid #263448; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    .ss-chat-head{
      padding: 12px 14px; border-bottom:1px solid #1f2a36; display:flex; align-items:center; justify-content:space-between;
    }
    .ss-chat-title{ color:#ffe084; font-weight:700 }
    .ss-chat-body{ padding: 12px; overflow:auto; display:flex; flex-direction:column; gap:10px }
    .ss-msg{ padding:10px 12px; border:1px solid #243244; border-radius: 12px; background:#0b1018; color:#e8edf3; max-width: 85% }
    .ss-msg.me{ margin-left:auto; background:#111a2a; border-color:#2f3e53 }
    .ss-chat-input{ display:flex; gap:8px; padding:12px; border-top:1px solid #1f2a36 }
    .ss-chat-input input{ flex:1; border-radius:12px; border:1px solid #243244; background:#0e1520; color:#e8edf3; padding:12px }
    .ss-chat-input button{ border-radius:12px; padding:12px 14px; background:linear-gradient(180deg,#1d2a3a,#101723); color:#e8edf3; border:1px solid #28364a; cursor:pointer }
    .ss-close{ color:#98a7b7; cursor:pointer }
  </style>
</head>
<body>
  <div class="glow"></div>
  <header>
    <div class="head-inner container">
      <div class="brand">
        <div class="brand-badge">5X</div>
        <div>
          <div class="title" data-i18n="site_title">命理心怜空间 · Soul Sanctuary</div>
          <div class="subtitle" data-i18n="site_subtitle">免费体验 & 会员专区 · 统一风格版</div>
        </div>
      </div>
      <!-- 语言选择器 -->
      <div class="lang">
        <label for="langSelect" data-i18n="lang_label">语言</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- 内容省略，保持你的原版免费区 + VIP区 ... -->
    <section class="card section">
      <div class="group-title">示例：这里保持你原来的内容</div>
    </section>
  </main>

  <footer>© 5XLiving • Astro Sanctuary</footer>

  <!-- Chat 浮窗脚本 -->
  <script>
    // 1) Worker 地址
    const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';

    // 2) 安装 Chat 按钮和面板
    document.addEventListener("DOMContentLoaded", () => {
      const chatFab = document.createElement('div');
      chatFab.className = 'ss-chat-fab';
      chatFab.id = 'ssChatFab';
      chatFab.title = '心怜管家';
      chatFab.textContent = '问';
      document.body.appendChild(chatFab);

      const chatPanel = document.createElement('div');
      chatPanel.className = 'ss-chat-panel';
      chatPanel.id = 'ssChatPanel';
      chatPanel.innerHTML = `
        <div class="ss-chat-head">
          <div class="ss-chat-title">心怜管家 · Chat</div>
          <div class="ss-close" id="ssChatClose">✕</div>
        </div>
        <div class="ss-chat-body" id="ssChatBody"></div>
        <div class="ss-chat-input">
          <input id="ssChatInput" type="text" placeholder="请问您想了解什么？" />
          <button id="ssChatSend">发送</button>
        </div>`;
      document.body.appendChild(chatPanel);

      const $body = document.getElementById('ssChatBody');
      const $input = document.getElementById('ssChatInput');
      const $send = document.getElementById('ssChatSend');
      const $close = document.getElementById('ssChatClose');

      const openPanel = () => { chatPanel.style.display = 'flex'; $input.focus(); };
      const closePanel = () => { chatPanel.style.display = 'none'; };
      chatFab.addEventListener('click', openPanel);
      $close.addEventListener('click', closePanel);

      function addMsg(text, me=false){
        const div = document.createElement('div');
        div.className = 'ss-msg' + (me ? ' me' : '');
        div.textContent = text;
        $body.appendChild(div);
        $body.scrollTop = $body.scrollHeight;
      }

      async function askChat(prompt){
        addMsg(prompt, true);
        $input.value = '';
        try{
          const r = await fetch(`${API_BASE}/api/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: [
                { role:'system', content:'你是“心怜管家”，帮助访客了解命理心怜空间的功能，语气温暖专业、简洁有条理。' },
                { role:'user', content: prompt }
              ]
            })
          });
          const data = await r.json();
          if (!data.ok) return addMsg('抱歉，服务繁忙，请稍后再试。');
          addMsg(data.reply || '（无回复内容）');
        }catch(e){
          addMsg('网络异常，请稍后再试。');
        }
      }

      $send.addEventListener('click', ()=>{ const v=$input.value.trim(); if(v) askChat(v); });
      $input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ const v=$input.value.trim(); if(v) askChat(v); }});
    });
  </script>
</body>
</html>
