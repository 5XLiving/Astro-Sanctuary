<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="page_title">å‘½ç†å¿ƒæ€œç©ºé—´ Â· Index</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="å‘½ç†å¿ƒæ€œç©ºé—´ Â· å…è´¹ä½“éªŒåŒºä¸VIPä¸“åŒºï¼šå…«å­—ã€å æ˜Ÿã€çµæ•°ã€å¡”ç½—ã€ä¹æ˜Ÿæ°”å­¦ã€èƒ½é‡ç±»å‹ç­‰ï¼Œä¸€ç«™å¼çµæ€§ä¸å‘½ç†ä½“éªŒã€‚">
  <meta property="og:title" content="å‘½ç†å¿ƒæ€œç©ºé—´ Â· Soul Sanctuary">
  <meta property="og:description" content="å…è´¹ä½“éªŒåŒºä¸VIPä¸“åŒºï¼šå…«å­—ã€å æ˜Ÿã€çµæ•°ã€å¡”ç½—ã€ä¹æ˜Ÿæ°”å­¦ã€èƒ½é‡ç±»å‹ç­‰ã€‚">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14; --card:#11161dCC; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --accent:#58b9ff; --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35); --blur:10px;
    }
    html,body{height:100%} html{font-size:16px}
    @media(min-width:768px){ html{font-size:17px} } @media(min-width:1200px){ html{font-size:18px} }
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans SC", Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:url('assets/images/gate.jpg') center/cover no-repeat;
      filter:brightness(.45) saturate(.9) blur(2px);
    }
    .glow{position:fixed; inset:auto auto 10% -10%; width:45vw; height:45vw; max-width:700px; max-height:700px;
      background:radial-gradient(closest-side, #2a98ff33, transparent 70%); filter:blur(30px); z-index:-1; pointer-events:none;}
    .container{width:100%; max-width:1100px; padding:24px 16px 80px; margin:0 auto;}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(12px);
      background:#0b0f14cc; border-bottom:1px solid #0f1622;}
    .head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:16px}
    .brand{display:flex; align-items:center; gap:12px}
    .brand-badge{width:36px; height:36px; border-radius:10px; background:linear-gradient(145deg,#273243,#0e141c);
      display:grid; place-items:center; color:var(--brand); font-weight:700; box-shadow:var(--shadow)}
    .title{font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; letter-spacing:.02em; font-size:1.1rem}
    .subtitle{color:var(--muted); font-size:.9rem}

    /* è¯­è¨€é€‰æ‹©å™¨ */
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{color:var(--muted); font-size:.9rem}
    .lang select{
      appearance:none; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text);
      padding:10px 34px 10px 12px; font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
    }

    .section{margin-top:18px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(var(--blur)); padding:18px;}
    .grid-links{display:grid; gap:12px; grid-template-columns:repeat(1,1fr)}
    @media(min-width:640px){ .grid-links{grid-template-columns:repeat(2,1fr)} }
    @media(min-width:980px){ .grid-links{grid-template-columns:repeat(3,1fr)} }
    .link-card{display:flex; align-items:center; justify-content:center; text-align:center; padding:16px 12px;
      border:1px solid #263448; background:#0e1520; border-radius:12px; text-decoration:none; color:var(--text);
      transition:transform .05s ease, box-shadow .2s ease;}
    .link-card:hover{box-shadow:0 6px 18px rgba(88,185,255,.15)}
    .group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

    .row{display:grid; gap:12px}
    @media(min-width:640px){ .row{grid-template-columns:1fr 1fr 1fr} }
    input,button{
      width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244;
      background:#0e1520; color:var(--text); padding:14px 13px; font-size:1rem; outline:none;
    }
    input::placeholder{color:#6f8092}
    .btn{background:linear-gradient(180deg,#1d2a3a,#101723); border:1px solid #28364a; font-weight:600; letter-spacing:.02em; cursor:pointer}
    .btn:hover{box-shadow:0 6px 18px rgba(88,185,255,.15), inset 0 1px 0 #2e3c50}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .btn-gold{background:linear-gradient(180deg,#f7e7a8,#d4af37); color:#191919; border:1px solid #d4af37}

    .columns{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448; background:#0e1520; border-radius:12px; padding:16px}
    .list-block ul{margin:.2rem 0 0; padding-left:1.1rem}
    .muted{color:var(--muted)} .error{color:#ff8f8f; margin-top:8px}
    footer{color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0}

    /* Chat æµ®çª— */
    .ss-chat-fab{
      position: fixed; right: 18px; bottom: 18px; z-index: 50;
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(180deg,#f7e7a8,#d4af37); color:#191919;
      display:grid; place-items:center; font-weight:800; box-shadow:0 8px 30px rgba(0,0,0,.35); cursor:pointer;
      border:1px solid #d4af37;
    }
    .ss-chat-panel{
      position: fixed; right: 18px; bottom: 90px; z-index: 50;
      width: min(380px, 92vw); max-height: 70vh; display:none; flex-direction: column;
      background: #0e1520f2; backdrop-filter: blur(12px);
      border:1px solid #263448; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    .ss-chat-head{
      padding: 12px 14px; border-bottom:1px solid #1f2a36; display:flex; align-items:center; justify-content:space-between;
    }
    .ss-chat-title{ color:#ffe084; font-weight:700 }
    .ss-chat-body{ padding: 12px; overflow:auto; display:flex; flex-direction:column; gap:10px }
    .ss-msg{ padding:10px 12px; border:1px solid #243244; border-radius: 12px; background:#0b1018; color:#e8edf3; max-width: 85% }
    .ss-msg.me{ margin-left:auto; background:#111a2a; border-color:#2f3e53 }
    .ss-chat-input{ display:flex; gap:8px; padding:12px; border-top:1px solid #1f2a36 }
    /* Fix: override global 100% widths just for chat controls */
    .ss-chat-input input, .ss-chat-input button { width:auto; }
    .ss-chat-input input{
      flex:1; min-height:44px; font-size:1rem; color:#e8edf3; caret-color:#e8edf3;
      border-radius:12px; border:1px solid #243244; background:#0e1520; padding:12px;
    }
    .ss-chat-input input::placeholder{ color:#8ea0b5 }
    .ss-chat-input button{
      min-height:44px; border-radius:12px; padding:0 14px;
      background:linear-gradient(180deg,#1d2a3a,#101723); color:#e8edf3; border:1px solid #28364a; cursor:pointer;
      white-space:nowrap;
    }
    .ss-close{ color:#98a7b7; cursor:pointer }
  </style>
</head>
<body>
  <div class="glow"></div>
  <header>
    <div class="head-inner container">
      <div class="brand">
        <div class="brand-badge">5X</div>
        <div>
          <div class="title" data-i18n="site_title">å‘½ç†å¿ƒæ€œç©ºé—´ Â· Soul Sanctuary</div>
          <div class="subtitle" data-i18n="site_subtitle">å…è´¹ä½“éªŒ & ä¼šå‘˜ä¸“åŒº Â· ç»Ÿä¸€é£æ ¼ç‰ˆ</div>
        </div>
      </div>
      <!-- è¯­è¨€é€‰æ‹©å™¨ -->
      <div class="lang">
        <label for="langSelect" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- å…è´¹ä½“éªŒåŒº -->
    <section class="card section">
      <div class="group-title" data-i18n="free_title">ğŸŒ€ å…è´¹ä½“éªŒåŒº Free Segment</div>
      <div class="grid-links">
        <a class="link-card" href="bazi.html" data-i18n="link_bazi" aria-label="å‰å¾€ å…«å­—å‘½ç†åˆ†æ">å…«å­—å‘½ç†åˆ†æ</a>
        <a class="link-card" href="natal.html" data-i18n="link_natal" aria-label="å‰å¾€ æœ¬å‘½æ˜Ÿç›˜åˆ†æ">æœ¬å‘½æ˜Ÿç›˜åˆ†æ</a>
        <a class="link-card" href="life_path.html" data-i18n="link_life" aria-label="å‰å¾€ çµæ•°åˆ†æ">çµæ•°åˆ†æ</a>
        <a class="link-card" href="tarot.html" data-i18n="link_tarot" aria-label="å‰å¾€ å¡”ç½—æŒ‡å¼•åˆ†æ">å¡”ç½—æŒ‡å¼•åˆ†æ</a>
        <a class="link-card" href="kyuusei.html" data-i18n="link_kyuusei" aria-label="å‰å¾€ ä¹æ˜Ÿæ°”å­¦åˆ†æ">ä¹æ˜Ÿæ°”å­¦åˆ†æ</a>
        <a class="link-card" href="energy.html" data-i18n="link_energy" aria-label="å‰å¾€ èƒ½é‡ç±»å‹åˆ†æ">èƒ½é‡ç±»å‹åˆ†æ</a>
        <a class="link-card" href="vedic_astrology.html" data-i18n="link_vedic" aria-label="å‰å¾€ å°åº¦å‘½ç†å é™€å æ˜Ÿ">å°åº¦å‘½ç†å é™€å æ˜Ÿ</a>
      </div>
    </section>

    <!-- ä¼šå‘˜ä¸“åŒº -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

      <!-- ç™»å½•/æ³¨å†Œè¡¨å•ï¼Œæ”¯æŒå›è½¦æäº¤ -->
      <form class="row" id="registerForm">
        <label for="email" class="sr-only" style="position:absolute;left:-9999px">Email</label>
        <input id="email" placeholder="é‚®ç®± Email" type="email" inputmode="email" autocomplete="email" data-i18n-ph="ph_email" required/>
        <label for="password" class="sr-only" style="position:absolute;left:-9999px">Password</label>
        <input id="password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" type="password" autocomplete="new-password" data-i18n-ph="ph_password" required/>
        <button class="btn" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
      </form>

      <div class="row" style="margin-top:8px">
        <form id="loginForm" class="row" onsubmit="return false;">
          <button class="btn" id="loginBtn" data-i18n="btn_login" type="submit">ç™»å…¥è´¦æˆ·</button>
        </form>

        <a class="btn btn-gold" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" style="display:grid; place-items:center; text-decoration:none;" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
        <a class="btn" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" style="display:grid; place-items:center; text-decoration:none;" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="resetBtn" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
      </div>
      <div class="muted" style="margin-top:6px" data-i18n="note_price">
        $9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰ Â· æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ
      </div>
      <div class="error" id="error" style="display:none"></div>
    </section>
  </main>

  <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>

  <!-- åŠŸèƒ½è„šæœ¬ï¼šåç«¯ä»£ç† + å¤šè¯­è¨€ + Chat æµ®çª— -->
  <script>
    // ============== ç»Ÿä¸€é…ç½®ï¼ˆæ›¿æ¢ä¸ºä½ çš„ Worker åŸŸåï¼‰ ==============
    const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev'; // âœ… your Worker

    // å·¥å…·å‡½æ•°
    const $ = id => document.getElementById(id);
    function showErr(msg){ const e=$("error"); e.textContent=msg; e.style.display="block"; setTimeout(()=>{e.style.display='none'},5000); }
    function hideErr(){ const e=$("error"); e.style.display="none"; e.textContent=""; }
    function lock(el, v){ if(el) el.disabled = v; }
    function strongPwd(pw){
      return pw.length>=8 && /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /[0-9]/.test(pw) && /[^A-Za-z0-9]/.test(pw);
    }

    // ============== æ³¨å†Œ / ç™»å½• / é‡è®¾ï¼ˆèµ° Worker åç«¯ï¼‰ ==============
    const LANG_KEY = "site_lang";
    function getLang(){ return localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN"; }

    function map(msgCode){
      const L = translations[getLang()] || translations["zh-CN"];
      const codeMap = {
        'need_email/password': L.err_need_ep,
        'exists': L.err_exists,
        'no_account': L.err_no_account,
        'wrong_pwd': L.err_wrong_pwd,
        'expired': L.err_expired,
        'upstream_error': L.err_login_fail
      };
      return codeMap[msgCode] || msgCode;
    }

    async function api(path, payload){
      const r = await fetch(`${API_BASE}${path}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload || {})
      });
      return r.json();
    }

    // æ³¨å†Œ
    $("registerForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      hideErr();
      const email = $("email").value.trim();
      const password = $("password").value.trim();
      if (!email || !password) return showErr(t('err_need_ep'));
      if (!strongPwd(password)) return showErr(t('err_pwd_rule'));

      lock($("registerBtn"), true);
      try{
        const res = await api('/api/register', { email, password });
        if (!res.ok) return showErr((map(res.msg) || t('err_register_fail')) + (res.msg ? ` [${res.msg}]` : ''));
        localStorage.setItem("vipEmail", email);
        location.href = "vip_trial.html";
      } catch(err){
        showErr(t('err_register_fail') + (err?.message || ''));
      } finally{
        lock($("registerBtn"), false);
      }
    });

    // ç™»å½•
    $("loginForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      hideErr();
      const email = $("email").value.trim();
      const password = $("password").value.trim();
      if (!email || !password) return showErr(t('err_need_ep'));

      lock($("loginBtn"), true);
      try{
        const res = await api('/api/login', { email, password });
        if (!res.ok) return showErr((map(res.msg) || t('err_login_fail')) + (res.msg ? ` [${res.msg}]` : ''));
        localStorage.setItem("vipEmail", res.email || email);
        location.href = "https://astro.5xliving.com/vip_soul_sanctuary.html";
      } catch(err){
        showErr(t('err_login_fail') + (err?.message || ''));
      } finally{
        lock($("loginBtn"), false);
      }
    });

    // é‡è®¾å¯†ç 
    $("resetBtn").addEventListener("click", async ()=>{
      hideErr();
      let email = prompt(t('prompt_email'));
      if (email === null) return; email = email.trim();
      if (!email) return showErr(t('err_email_empty'));

      let newPassword = prompt(t('prompt_newpwd'));
      if (newPassword === null) return; newPassword = newPassword.trim();
      if (!newPassword) return showErr(t('err_pwd_empty'));
      if (!strongPwd(newPassword)) return showErr(t('err_pwd_rule'));

      lock($("resetBtn"), true);
      try{
        const res = await api('/api/reset', { email, newPassword });
        if (!res.ok) return showErr((map(res.msg) || t('err_reset_fail')) + (res.msg ? ` [${res.msg}]` : ''));
        alert(t('msg_reset_ok'));
      } catch(err){
        showErr(t('err_reset_fail') + (err?.message || ''));
      } finally{
        lock($("resetBtn"), false);
      }
    });

    // ============== å¤šè¯­è¨€ï¼ˆåŠ å…¥ Chat æ–‡å­—ï¼‰ ==============
    const translations = {
      "zh-CN": {
        page_title:"å‘½ç†å¿ƒæ€œç©ºé—´ Â· Index",
        site_title:"å‘½ç†å¿ƒæ€œç©ºé—´ Â· Soul Sanctuary",
        site_subtitle:"å…è´¹ä½“éªŒ & ä¼šå‘˜ä¸“åŒº Â· ç»Ÿä¸€é£æ ¼ç‰ˆ",
        lang_label:"è¯­è¨€",
        free_title:"ğŸŒ€ å…è´¹ä½“éªŒåŒº Free Segment",
        link_bazi:"å…«å­—å‘½ç†åˆ†æ", link_natal:"æœ¬å‘½æ˜Ÿç›˜åˆ†æ", link_life:"çµæ•°åˆ†æ",
        link_tarot:"å¡”ç½—æŒ‡å¼•åˆ†æ", link_kyuusei:"ä¹æ˜Ÿæ°”å­¦åˆ†æ", link_energy:"èƒ½é‡ç±»å‹åˆ†æ", link_vedic:"å°åº¦å‘½ç†å é™€å æ˜Ÿ",
        vip_title:"ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment",
        vip_mingli:"ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹",
        vip_love:"å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿",
        vip_career:"äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›",
        vip_wealth:"è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº",
        vip_pet:"å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†",
        vip_hepan:"åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶",
        vip_name:"æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿",
        vip_fengshui:"è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ",
        vip_xinlian:"ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹",
        vip_record:"çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·",
        vip_course:"å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾",
        vip_memorial:"å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­",
        vip_tasks:"æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡",
        vip_shop:"èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
        login_title:"ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",
        ph_email:"é‚®ç®± Email",
        ph_password:"å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰",
        btn_register:"æ³¨å†Œè´¦æˆ·",
        btn_login:"ç™»å…¥è´¦æˆ·",
        btn_upgrade:"ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰",
        btn_backshop:"â† è¿”å›å‘½ç†å•†åŸ",
        btn_reset:"ğŸ”‘ é‡è®¾å¯†ç ",
        note_price:"$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰ Â· æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ",
        err_need_ep:"è¯·è¾“å…¥é‚®ç®±ä¸å¯†ç ",
        err_pwd_rule:"å¯†ç è‡³å°‘8ä½ï¼Œéœ€åŒ…å«å¤§å†™/å°å†™/æ•°å­—/ç‰¹æ®Šç¬¦å·",
        err_exists:"æ­¤é‚®ç®±å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å…¥",
        err_register_fail:"æ³¨å†Œå¤±è´¥ï¼š",
        err_no_account:"è´¦æˆ·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œ",
        err_wrong_pwd:"å¯†ç é”™è¯¯",
        err_expired:"ä¼šå‘˜å·²è¿‡æœŸï¼Œè¯·ç»­è´¹",
        err_login_fail:"ç™»å…¥å¤±è´¥ï¼š",
        prompt_email:"è¯·è¾“å…¥æ³¨å†Œé‚®ç®±ï¼š",
        err_email_empty:"é‚®ç®±ä¸èƒ½ä¸ºç©º",
        prompt_newpwd:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™ã€æ•°å­—ã€ç¬¦å·ï¼‰ï¼š",
        err_pwd_empty:"å¯†ç ä¸èƒ½ä¸ºç©º",
        err_reset_fail:"é‡è®¾å¤±è´¥ï¼š",
        msg_reset_ok:"å¯†ç å·²æˆåŠŸæ›´æ–°ï¼Œè¯·ç”¨æ–°å¯†ç é‡æ–°ç™»å…¥ã€‚",
        /* Chat */
        chat_fab:"é—®",
        chat_placeholder:"è¯·é—®æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šå¦‚ä½•å¼€å§‹å…è´¹ä½“éªŒï¼‰",
        chat_send:"å‘é€"
      },
      "zh-TW": {
        /* ...existing keys... */
        chat_fab:"å•", chat_placeholder:"æƒ³äº†è§£ä»€éº¼ï¼Ÿï¼ˆä¾‹å¦‚ï¼šå¦‚ä½•é–‹å§‹å…è²»é«”é©—ï¼‰", chat_send:"ç™¼é€"
      },
      "en": {
        /* ...existing keys... */
        chat_fab:"Chat", chat_placeholder:"What would you like to know? (e.g., how to start the free trial)", chat_send:"Send"
      },
      "ja": {
        /* ...existing keys... */
        chat_fab:"å•", chat_placeholder:"ä½•ã‚’çŸ¥ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿï¼ˆä¾‹ï¼šç„¡æ–™ä½“é¨“ã®å§‹ã‚æ–¹ï¼‰", chat_send:"é€ä¿¡"
      },
      "th": {
        /* ...existing keys... */
        chat_fab:"à¸–à¸²à¸¡", chat_placeholder:"à¸­à¸¢à¸²à¸à¸£à¸¹à¹‰à¸­à¸°à¹„à¸£ (à¹€à¸Šà¹ˆà¸™ à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸¥à¸­à¸‡à¸Ÿà¸£à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£)", chat_send:"à¸ªà¹ˆà¸‡"
      },
      "ms": {
        /* ...existing keys... */
        chat_fab:"Tanya", chat_placeholder:"Anda mahu tahu apa? (cth: cara mula percubaan)", chat_send:"Hantar"
      }
    };

    function t(key){
      const L = translations[getLang()] || translations["zh-CN"];
      return L[key] || (translations["zh-CN"][key] || key);
    }
    function applyI18n(){
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        el.textContent = t(key);
      });
      document.querySelectorAll("[data-i18n-ph]").forEach(el=>{
        const key = el.getAttribute("data-i18n-ph");
        el.setAttribute("placeholder", t(key));
      });
      const titleEl = document.querySelector("title[data-i18n]");
      if (titleEl) titleEl.textContent = t(titleEl.getAttribute("data-i18n"));
      applyChatI18n(); // update chat labels too
    }
    function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }

    // ============== Chat æµ®çª—ï¼ˆèµ° /api/chatï¼‰ ==============
    // UI å…ƒç´ 
    const chatFab = document.createElement('div');
    chatFab.className = 'ss-chat-fab'; chatFab.id = 'ssChatFab'; chatFab.title = 'å¿ƒæ€œç®¡å®¶';

    const chatPanel = document.createElement('div');
    chatPanel.className = 'ss-chat-panel'; chatPanel.id = 'ssChatPanel'; chatPanel.setAttribute('role','dialog'); chatPanel.setAttribute('aria-label','å¿ƒæ€œç®¡å®¶');
    chatPanel.innerHTML = `
      <div class="ss-chat-head">
        <div class="ss-chat-title">å¿ƒæ€œç®¡å®¶ Â· Chat</div>
        <div class="ss-close" id="ssChatClose">âœ•</div>
      </div>
      <div class="ss-chat-body" id="ssChatBody" aria-live="polite"></div>
      <div class="ss-chat-input">
        <input id="ssChatInput" type="text" />
        <button id="ssChatSend"></button>
      </div>`;

    document.addEventListener('DOMContentLoaded', ()=>{
      document.body.appendChild(chatFab);
      document.body.appendChild(chatPanel);
      applyI18n(); // set initial language texts

      const $body  = document.getElementById('ssChatBody');
      const $input = document.getElementById('ssChatInput');
      const $send  = document.getElementById('ssChatSend');
      const $close = document.getElementById('ssChatClose');

      const openPanel  = () => { chatPanel.style.display = 'flex'; $input.focus(); };
      const closePanel = () => { chatPanel.style.display = 'none'; };
      chatFab.addEventListener('click', openPanel);
      $close.addEventListener('click', closePanel);

      function addMsg(text, me=false){
        const div = document.createElement('div');
        div.className = 'ss-msg' + (me ? ' me' : '');
        div.textContent = text;
        $body.appendChild(div);
        $body.scrollTop = $body.scrollHeight;
      }

      async function askChat(prompt){
        addMsg(prompt, true);
        $input.value = '';
        $input.focus();
        try{
          const r = await fetch(`${API_BASE}/api/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: [
                { role:'system', content:'ä½ æ˜¯â€œå¿ƒæ€œç®¡å®¶â€ï¼Œå¸®åŠ©è®¿å®¢äº†è§£å‘½ç†å¿ƒæ€œç©ºé—´çš„åŠŸèƒ½ã€å¯¼èˆªä¸ä¼šå‘˜è¯´æ˜ï¼Œè¯­æ°”æ¸©æš–ä¸“ä¸šã€ç®€æ´æœ‰æ¡ç†ã€‚' },
                { role:'user', content: prompt }
              ]
            })
          });
          const data = await r.json();
          if (!data.ok) return addMsg('æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•ã€‚');
          addMsg(data.reply || 'ï¼ˆæ— å›å¤å†…å®¹ï¼‰');
        }catch(e){
          addMsg('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚');
        }
      }
      $send.addEventListener('click', ()=>{ const v=$input.value.trim(); if(v) askChat(v); });
      $input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ const v=$input.value.trim(); if(v) askChat(v); }});

      // ç›‘å¬è¯­è¨€åˆ‡æ¢ï¼ŒåŒæ­¥æ›´æ–° Chat æ–‡å­—
      document.getElementById("langSelect").addEventListener("change", ()=>{
        setLang(document.getElementById("langSelect").value);
        applyI18n();
      });

      function applyChatI18n(){
        chatFab.textContent = t('chat_fab');
        const inp = document.getElementById('ssChatInput');
        const btn = document.getElementById('ssChatSend');
        if (inp) inp.placeholder = t('chat_placeholder');
        if (btn) btn.textContent  = t('chat_send');
      }
      // make available outside
      window.applyChatI18n = applyChatI18n;
    });

    // åˆå§‹å¤šè¯­è¨€æ¸²æŸ“
    (function initLang(){
      const select = document.getElementById("langSelect");
      const current = getLang();
      select.value = current;
    })();
  </script>
</body>
</html>
