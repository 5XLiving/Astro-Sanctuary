<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="title">å°åº¦å‘½ç†åˆ†æ Â· 5XLiving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --gold:#d4af37; --gold2:#f2d27a; --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    html{font-size:16px}
    @media (min-width:768px){ html{font-size:17px} }
    @media (min-width:1200px){ html{font-size:18px} }
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    .site-header{
      position:sticky;top:0;z-index:10;
      background:#0b0f14cc;border-bottom:1px solid #0f1622;
      backdrop-filter:saturate(140%) blur(12px);
    }
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .brand-badge{
      display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px;
      background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546;
      box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084
    }
    .title{
      font-family:"Noto Serif SC","Noto Serif",serif;
      font-weight:600; letter-spacing:.02em; font-size:1.1rem; line-height:1.25;
    }
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{white-space:nowrap; color:var(--muted)}
    .lang select{
      appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244;
      background:#0e1520; color:#e8edf3; padding:10px 34px 10px 12px; font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
    }
    .h1{margin:12px 0 6px; color:#ffe084; font-weight:800; font-size:1.8rem}
    .h2{font-weight:800;color:#ffe084;margin:0 0 10px}
    .sub{color:var(--muted)}
    .card{
      background:#11161dcc;border:1px solid #1f2a36;border-radius:var(--radius);
      box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0;
    }
    .row{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:760px){
      .row.cols-2{grid-template-columns:1fr 1fr}
      .row.cols-3{grid-template-columns:1fr 1fr 1fr}
    }
    label.muted{display:block;margin-bottom:4px;color:#98a7b7}
    input,select,textarea{
      width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;
      background:#0e1520;color:#e8edf3;padding:12px;font-size:15px;outline:none;
    }
    textarea{min-height:96px}
    input::placeholder,textarea::placeholder{color:#6f8092}
    .btn{
      display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;
      border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);
      color:#191919;font-weight:800;cursor:pointer;
    }
    .btn.secondary{background:#101826;color:#ffe084;border-color:#3a3f47}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .muted{color:#98a7b7}
    .error{color:#ff8b8b}
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}

    /* æœ¬åœ°åˆ†ææ ·å¼ */
    .local-analysis {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid #2d3748;
    }
    .local-analysis h3 {
      color: #ffe084;
      margin-top: 0;
    }
    .planet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .planet-item {
      padding: 10px;
      border-radius: 8px;
      background: rgba(15, 23, 42, 0.7);
      text-align: center;
      border: 1px solid #2d3748;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
    }
    .planet-item:hover {
      transform: translateY(-2px);
      background: rgba(25, 35, 60, 0.9);
    }
    .planet-name {
      font-weight: bold;
      color: #ffe084;
    }
    .planet-position {
      font-size: 0.9em;
      color: #98a7b7;
    }
    .analysis-section {
      margin-top: 20px;
    }
    .analysis-section h4 {
      color: #ffe084;
      margin-bottom: 10px;
    }
    .detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #11161d;
      padding: 20px;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      border: 1px solid #2d3748;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #ffe084;
    }
    
    /* ä¸»é¢˜æ ‡ç­¾é¡µ */
    .topic-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 15px 0;
      border-bottom: 1px solid #2d3748;
      padding-bottom: 10px;
    }
    .topic-tab {
      padding: 8px 16px;
      border-radius: 8px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid #2d3748;
      color: #98a7b7;
      cursor: pointer;
      transition: all 0.3s;
    }
    .topic-tab:hover {
      background: rgba(25, 35, 60, 0.9);
    }
    .topic-tab.active {
      background: rgba(212, 175, 55, 0.2);
      border-color: #d4af37;
      color: #ffe084;
    }
    .topic-content {
      display: none;
    }
    .topic-content.active {
      display: block;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com" target="_self" rel="nofollow">
        <div class="brand-badge">5X</div>
        <div class="title"><span data-i18n="brand">Soul Sanctuary</span></div>
      </a>
      <div class="lang">
        <label for="langSelect" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" data-i18n="title">å°åº¦å‘½ç†åˆ†æ Â· 5XLiving</h1>

    <!-- è¡¨å• -->
    <div class="card">
      <div class="h2" data-i18n="form_title">å°åº¦å‘½ç†åˆ†æ Â· å¿«é€Ÿè§£è¯»</div>

      <div class="row cols-3">
        <div>
          <label class="muted" data-i18n="name_label">å§“åï¼ˆå¯é€‰ï¼‰</label>
          <input type="text" id="name" data-i18n-ph="name_ph" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ç§°å‘¼ï¼‰">
        </div>
        <div>
          <label class="muted" data-i18n="gender_label">æ€§åˆ«</label>
          <select id="gender">
            <option value="" data-i18n="gender_unknown">ä¸é€éœ²</option>
            <option value="male" data-i18n="gender_male">ç”·æ€§</option>
            <option value="female" data-i18n="gender_female">å¥³æ€§</option>
            <option value="other" data-i18n="gender_other">å…¶ä»–</option>
          </select>
        </div>
        <div>
          <label class="muted" data-i18n="birth_dt_label">å‡ºç”Ÿæ—¥æœŸä¸æ—¶é—´</label>
          <input type="datetime-local" id="birthdt">
        </div>
      </div>

      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted" data-i18n="birth_place_label">å‡ºç”ŸåŸå¸‚</label>
          <input type="text" id="birthplace" data-i18n-ph="birth_place_ph" placeholder="åŸå¸‚/å›½å®¶ï¼ˆç”¨äºæ—¶åŒºä¸ç»çº¬ï¼‰">
        </div>
        <div>
          <label class="muted" data-i18n="topic_label">å…³æ³¨ä¸»é¢˜</label>
          <select id="topic">
            <option value="love" data-i18n="topic_love">çˆ±æƒ…/å…³ç³»</option>
            <option value="career" data-i18n="topic_career">äº‹ä¸š/å·¥ä½œ</option>
            <option value="wealth" data-i18n="topic_wealth">è´¢å¯Œ/æŠ•èµ„</option>
            <option value="health" data-i18n="topic_health">å¥åº·/èº«å¿ƒ</option>
            <option value="family" data-i18n="topic_family">å®¶åº­/äººé™…</option>
            <option value="study" data-i18n="topic_study">å­¦ä¸š/æˆé•¿</option>
            <option value="move" data-i18n="topic_move">æ—…è¡Œ/æ¬è¿</option>
            <option value="overall" data-i18n="topic_overall">ç»¼åˆè¿åŠ¿</option>
          </select>
        </div>
        <div>
          <label class="muted" data-i18n="preset_label">å¸¸ç”¨é—®é¢˜</label>
          <select id="presetQ">
            <option value="" data-i18n="preset_none">ï¼ˆå¯é€‰ï¼‰é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿</option>
            <option value="æˆ‘æƒ³äº†è§£æœ€è¿‘çš„è¿åŠ¿èµ°å‘å’Œéœ€è¦æ³¨æ„çš„äº‹é¡¹" data-i18n="preset_q1">æˆ‘æƒ³äº†è§£æœ€è¿‘çš„è¿åŠ¿èµ°å‘å’Œéœ€è¦æ³¨æ„çš„äº‹é¡¹</option>
            <option value="æˆ‘æƒ³çŸ¥é“åœ¨äº‹ä¸š/å·¥ä½œæ–¹é¢æœ‰ä»€ä¹ˆæœºä¼šå’ŒæŒ‘æˆ˜" data-i18n="preset_q2">æˆ‘æƒ³çŸ¥é“åœ¨äº‹ä¸š/å·¥ä½œæ–¹é¢æœ‰ä»€ä¹ˆæœºä¼šå’ŒæŒ‘æˆ˜</option>
            <option value="æˆ‘æƒ³äº†è§£æ„Ÿæƒ…/å©šå§»æ–¹é¢çš„å‘å±•è¶‹åŠ¿" data-i18n="preset_q3">æˆ‘æƒ³äº†è§£æ„Ÿæƒ…/å©šå§»æ–¹é¢çš„å‘å±•è¶‹åŠ¿</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px">
        <label class="muted" data-i18n="q_label">ä½ çš„å…·ä½“é—®é¢˜ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰</label>
        <textarea id="question" data-i18n-ph="q_ph" placeholder="ä¾‹å¦‚ï¼šæˆ‘åœ¨æ‰¾å·¥ä½œï¼Œæƒ³çŸ¥é“å½“å‰å¤§è¿å°è¿å¯¹é¢è¯•ä¸å…¥èŒçš„å½±å“ï¼Œä»¥åŠæˆ‘åº”é‡‡å–çš„è¡ŒåŠ¨ã€‚"></textarea>
      </div>

      <div class="row cols-2" style="margin-top:10px">
        <div><button id="go" class="btn" data-i18n="btn_gen">ç”Ÿæˆåˆ†æ</button></div>
        <div><button id="clear" class="btn secondary" data-i18n="btn_clear">æ¸…ç©º</button></div>
      </div>
    </div>

    <!-- ç»“æœï¼šæœ¬åœ°åˆ†æ -->
    <div id="localCard" class="card" style="display:none">
      <div class="h2" data-i18n="sec_local">æœ¬åœ°å‘½ç†åˆ†æç»“æœ</div>
      <div id="localText"></div>
      
      <!-- ä¸»é¢˜æ ‡ç­¾é¡µ -->
      <div id="topicTabs" class="topic-tabs" style="display:none">
        <!-- æ ‡ç­¾ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
      
      <!-- ä¸»é¢˜å†…å®¹åŒºåŸŸ -->
      <div id="topicContents"></div>
    </div>

    <!-- è¡Œæ˜Ÿè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="planetModal" class="detail-modal">
      <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <div id="modalContent"></div>
        <button id="closeModal" class="btn" style="margin-top: 15px;" data-i18n="btn_close">å…³é—­</button>
      </div>
    </div>

    <!-- ä¼šå‘˜åŒº -->
    <section class="card section">
      <h2 class="h2" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="row cols-2">
        <div class="card" style="margin:0">
          <div class="h3" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul class="muted" style="margin:.2rem 0 0 1.1rem">
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="card" style="margin:0">
          <div class="h3" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul class="muted" style="margin:.2rem 0 0 1.1rem">
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <footer>Â© 5XLiving â€¢ Astro/Soul Sanctuary</footer>

<script>
(function () {
  "use strict";

  /* ===== é…ç½® ===== */
  const LANG_KEY = "site_lang";

  /* ===== å°å·¥å…· ===== */
  const $ = (id) => document.getElementById(id);
  const getLang = () => localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN";
  const setLang = v => { localStorage.setItem(LANG_KEY, v); document.documentElement.lang = v; };

  /* ===== i18n æ–‡æ¡ˆ - ä¿®å¤å’Œå¢å¼º ===== */
  const i18n = {
    "zh-CN": {
      title: "å°åº¦å‘½ç†åˆ†æ Â· 5XLiving",
      brand: "Soul Sanctuary",
      lang_label: "è¯­è¨€",

      form_title: "å°åº¦å‘½ç†åˆ†æ Â· å¿«é€Ÿè§£è¯»",
      name_label: "å§“åï¼ˆå¯é€‰ï¼‰",
      name_ph: "ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ç§°å‘¼ï¼‰",

      gender_label: "æ€§åˆ«",
      gender_unknown: "ä¸é€éœ²",
      gender_male: "ç”·æ€§",
      gender_female: "å¥³æ€§",
      gender_other: "å…¶ä»–",

      birth_dt_label: "å‡ºç”Ÿæ—¥æœŸä¸æ—¶é—´",
      birth_place_label: "å‡ºç”ŸåŸå¸‚",
      birth_place_ph: "åŸå¸‚/å›½å®¶ï¼ˆç”¨äºæ—¶åŒºä¸ç»çº¬ï¼‰",

      topic_label: "å…³æ³¨ä¸»é¢˜",
      topic_love: "çˆ±æƒ…/å…³ç³»",
      topic_career: "äº‹ä¸š/å·¥ä½œ",
      topic_wealth: "è´¢å¯Œ/æŠ•èµ„",
      topic_health: "å¥åº·/èº«å¿ƒ",
      topic_family: "å®¶åº­/äººé™…",
      topic_study: "å­¦ä¸š/æˆé•¿",
      topic_move: "æ—…è¡Œ/æ¬è¿",
      topic_overall: "ç»¼åˆè¿åŠ¿",

      preset_label: "å¸¸ç”¨é—®é¢˜",
      preset_none: "ï¼ˆå¯é€‰ï¼‰é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿",
      preset_q1: "æˆ‘æƒ³äº†è§£æœ€è¿‘çš„è¿åŠ¿èµ°å‘å’Œéœ€è¦æ³¨æ„çš„äº‹é¡¹",
      preset_q2: "æˆ‘æƒ³çŸ¥é“åœ¨äº‹ä¸š/å·¥ä½œæ–¹é¢æœ‰ä»€ä¹ˆæœºä¼šå’ŒæŒ‘æˆ˜",
      preset_q3: "æˆ‘æƒ³äº†è§£æ„Ÿæƒ…/å©šå§»æ–¹é¢çš„å‘å±•è¶‹åŠ¿",

      q_label: "ä½ çš„å…·ä½“é—®é¢˜ï¼ˆå¯ç›´æ¥ç²˜è´´ï¼‰",
      q_ph: "ä¾‹å¦‚ï¼šæˆ‘åœ¨æ‰¾å·¥ä½œï¼Œæƒ³çŸ¥é“å½“å‰å¤§è¿å°è¿å¯¹é¢è¯•ä¸å…¥èŒçš„å½±å“ï¼Œä»¥åŠæˆ‘åº”é‡‡å–çš„è¡ŒåŠ¨ã€‚",

      btn_gen: "ç”Ÿæˆåˆ†æ",
      btn_clear: "æ¸…ç©º",
      btn_close: "å…³é—­",
      btn_view_detail: "æŸ¥çœ‹è¯¦æƒ…",

      sec_local: "æœ¬åœ°å‘½ç†åˆ†æç»“æœ",
      reco_title: "æ¨è Â· ä¸‹ä¸€æ­¥è¡ŒåŠ¨",

      generating: "æ­£åœ¨ç”Ÿæˆå é™€å æ˜Ÿè§£è¯»â€¦",
      need_birth: "è¯·è‡³å°‘å¡«å†™ã€å‡ºç”Ÿæ—¥æœŸä¸æ—¶é—´ã€ä»¥åŠã€å‡ºç”ŸåŸå¸‚ã€ï¼ˆç”¨äºæ—¶åŒºä¸æ˜Ÿç›˜è®¡ç®—ï¼‰ã€‚",
      analysis_title: "å é™€å æ˜Ÿåˆ†ææŠ¥å‘Š",
      planet_positions: "è¡Œæ˜Ÿä½ç½®æ¦‚è§ˆ",
      nakshatra_analysis: "æœˆå®¿åˆ†æ",
      dasa_analysis: "å¤§è¿åˆ†æ",
      recommendations: "å»ºè®®ä¸è¡ŒåŠ¨",
      click_for_details: "ç‚¹å‡»è¡Œæ˜ŸæŸ¥çœ‹è¯¦ç»†è§£è¯»",
      
      // ä¸»é¢˜æ ‡ç­¾
      tab_love: "çˆ±æƒ…å…³ç³»",
      tab_career: "äº‹ä¸šå‘å±•",
      tab_wealth: "è´¢å¯Œè¿åŠ¿",
      tab_health: "å¥åº·çŠ¶å†µ",
      tab_family: "å®¶åº­å…³ç³»",
      tab_study: "å­¦ä¸šæˆé•¿",
      tab_move: "æ—…è¡Œæ¬è¿",
      tab_overall: "ç»¼åˆè¿åŠ¿",

      // è¡Œæ˜Ÿæè¿° - ä¿®å¤ï¼šç§»é™¤å ä½ç¬¦ï¼Œç›´æ¥æä¾›æ–‡æœ¬
      sun_desc: "å¤ªé˜³ä»£è¡¨çµé­‚ã€è‡ªæˆ‘æ„è¯†å’Œé¢†å¯¼åŠ›ã€‚åœ¨å é™€å æ˜Ÿä¸­ï¼Œå¤ªé˜³è±¡å¾ç€çˆ¶äº²ã€æƒå¨å’Œç”Ÿå‘½åŠ›ã€‚å½“å‰ä½ç½®æ˜¾ç¤ºä½ åœ¨ç²¾ç¥å±‚é¢æœ‰æ·±åˆ»çš„æ´å¯ŸåŠ›ã€‚",
      moon_desc: "æœˆäº®ä»£è¡¨å¿ƒçµã€æƒ…ç»ªå’Œç›´è§‰ã€‚å®ƒå½±å“æˆ‘ä»¬çš„æƒ…æ„Ÿååº”ã€å®‰å…¨æ„Ÿå’Œæ½œæ„è¯†æ¨¡å¼ã€‚å½“å‰ä½ç½®è¡¨æ˜ä½ æƒ…æ„Ÿä¸°å¯Œä¸”ç›´è§‰æ•é”ã€‚",
      mercury_desc: "æ°´æ˜Ÿä»£è¡¨æ™ºåŠ›ã€æ²Ÿé€šå’Œå­¦ä¹ èƒ½åŠ›ã€‚å®ƒå½±å“æˆ‘ä»¬çš„æ€ç»´æ–¹å¼ã€è¡¨è¾¾èƒ½åŠ›å’Œå•†ä¸šæŠ€èƒ½ã€‚å½“å‰ä½ç½®æ˜¾ç¤ºä½ æœ‰è‰¯å¥½çš„æ²Ÿé€šå¤©èµ‹ã€‚",
      venus_desc: "é‡‘æ˜Ÿä»£è¡¨çˆ±æƒ…ã€ç¾æ„Ÿå’Œäº«ä¹ã€‚å®ƒå½±å“æˆ‘ä»¬çš„å®¡ç¾è§‚ã€äººé™…å…³ç³»å’Œç‰©è´¨äº«å—ã€‚å½“å‰ä½ç½®æœ‰åˆ©äºè‰ºæœ¯åˆ›ä½œå’Œäººé™…å…³ç³»ã€‚",
      mars_desc: "ç«æ˜Ÿä»£è¡¨èƒ½é‡ã€è¡ŒåŠ¨å’Œå‹‡æ°”ã€‚å®ƒå½±å“æˆ‘ä»¬çš„ä¸»åŠ¨æ€§ã€ç«äº‰åŠ›å’Œæ€§èƒ½é‡ã€‚å½“å‰ä½ç½®è¡¨æ˜ä½ å……æ»¡è¡ŒåŠ¨åŠ›å’Œå†³å¿ƒã€‚",
      jupiter_desc: "æœ¨æ˜Ÿä»£è¡¨æ™ºæ…§ã€æ‰©å±•å’Œå¥½è¿ã€‚å®ƒæ˜¯æœ€å¤§çš„å‰æ˜Ÿï¼Œå¸¦æ¥æˆé•¿ã€çŸ¥è¯†å’Œè´¢å¯Œã€‚å½“å‰ä½ç½®æ˜¾ç¤ºä½ æœ‰è‰¯å¥½çš„å­¦ä¹ æœºä¼šã€‚",
      saturn_desc: "åœŸæ˜Ÿä»£è¡¨è´£ä»»ã€çºªå¾‹å’Œé™åˆ¶ã€‚å®ƒæ•™å¯¼æˆ‘ä»¬è€å¿ƒã€åšæŒå’Œç°å®æ„Ÿã€‚å½“å‰ä½ç½®éœ€è¦ä½ æ›´åŠ è‡ªå¾‹å’ŒåšæŒã€‚",
      rahu_desc: "ç½—çºä»£è¡¨æ¬²æœ›ã€é‡å¿ƒå’Œç‰©è´¨è¿½æ±‚ã€‚å®ƒæ˜¯åŒ—éƒ¨äº¤ç‚¹ï¼Œå¸¦æ¥çªç„¶çš„å˜åŒ–å’Œæˆé•¿ã€‚å½“å‰ä½ç½®å¯èƒ½å¸¦æ¥æ„å¤–çš„æœºä¼šã€‚",
      ketu_desc: "è®¡éƒ½ä»£è¡¨çµæ€§ã€è§£è„±å’Œè¿‡å»ä¸šåŠ›ã€‚å®ƒæ˜¯å—éƒ¨äº¤ç‚¹ï¼Œä¿ƒè¿›ç²¾ç¥è§‰é†’ã€‚å½“å‰ä½ç½®æœ‰åˆ©äºçµæ€§æˆé•¿ã€‚",

      // ä¸»é¢˜åˆ†æ - ä¿®å¤ï¼šç›´æ¥æä¾›æ–‡æœ¬ï¼Œä¸æ˜¯å‡½æ•°è°ƒç”¨
      analysis_love: "é‡‘æ˜Ÿåœ¨å°„æ‰‹åº§ç¬¬10å®«ï¼Œæ˜¾ç¤ºä½ åœ¨äº‹ä¸šåœºåˆå¯èƒ½é‡åˆ°æµªæ¼«æœºä¼šã€‚æœˆäº®åœ¨æ°´ç“¶åº§ç¬¬9å®«è¡¨æ˜ä½ éœ€è¦æ€æƒ³ä¸Šçš„å…±é¸£ã€‚å»ºè®®å¤šå‚åŠ å­¦ä¹ äº¤æµæ´»åŠ¨ã€‚",
      analysis_career: "å¤ªé˜³åœ¨åŒé±¼åº§ç¬¬12å®«ï¼Œé€‚åˆå¹•åå·¥ä½œæˆ–åˆ›æ„é¢†åŸŸã€‚æœ¨æ˜Ÿåœ¨ç‹®å­åº§ç¬¬4å®«æ˜¾ç¤ºå®¶åº­æ”¯æŒå¯¹äº‹ä¸šæœ‰å¸®åŠ©ã€‚è€ƒè™‘åœ¨å®¶åŠå…¬æˆ–å®¶åº­ç›¸å…³äº‹ä¸šã€‚",
      analysis_wealth: "æ°´æ˜Ÿåœ¨å¤©èåº§ç¬¬2å®«ï¼Œæ˜¾ç¤ºä½ å¯¹è´¢åŠ¡æœ‰æ·±åˆ»çš„æ´å¯ŸåŠ›ã€‚åœŸæ˜Ÿåœ¨å·¨èŸ¹åº§ç¬¬5å®«æé†’æŠ•èµ„éœ€è°¨æ…ã€‚å»ºè®®è¿›è¡Œé•¿æœŸç¨³å¥çš„æŠ•èµ„ã€‚",
      analysis_health: "ç«æ˜Ÿåœ¨æ°´ç“¶åº§ç¬¬11å®«ï¼Œéœ€è¦æ³¨æ„ç¥ç»ç³»ç»Ÿå¥åº·ã€‚å®šæœŸé”»ç‚¼å’Œå†¥æƒ³æœ‰åŠ©äºä¿æŒå¹³è¡¡ã€‚æ³¨æ„ç”µå­è®¾å¤‡å¯¹å¥åº·çš„å½±å“ã€‚",
      analysis_family: "æœ¨æ˜Ÿåœ¨ç‹®å­åº§ç¬¬4å®«ï¼Œå®¶åº­å…³ç³»æ¸©æš–ä¸”æ”¯æŒæ€§å¼ºã€‚ç½—çºå’Œè®¡éƒ½åœ¨ç¬¬4å®«æ˜¾ç¤ºå®¶åº­ç¯å¢ƒå¯èƒ½æœ‰å˜åŒ–ã€‚ä¿æŒå¼€æ”¾æ²Ÿé€šã€‚",
      analysis_study: "æœˆäº®åœ¨æ°´ç“¶åº§ç¬¬9å®«ï¼Œé€‚åˆé«˜ç­‰æ•™è‚²å’Œå“²å­¦ç ”ç©¶ã€‚æ°´æ˜Ÿä½ç½®è‰¯å¥½ï¼Œå­¦ä¹ æ•ˆç‡é«˜ã€‚è€ƒè™‘å‡ºå›½ç•™å­¦æˆ–åœ¨çº¿è¯¾ç¨‹ã€‚",
      analysis_move: "ç«æ˜Ÿåœ¨æ°´ç“¶åº§ç¬¬11å®«ï¼Œé€‚åˆå›½é™…æ—…è¡Œæˆ–æ¬è¿ã€‚ç¬¬9å®«çš„æœˆäº®æ˜¾ç¤ºæµ·å¤–ç»å†å¯¹æˆé•¿æœ‰ç›Šã€‚è®¡åˆ’æ˜¥å­£å‡ºè¡Œæœ€ä½³ã€‚",
      analysis_overall: "ç»¼åˆæ¥çœ‹ï¼Œå½“å‰æœ¨æ˜Ÿå¤§è¿å¸¦æ¥æˆé•¿æœºä¼šã€‚å„è¡Œæ˜Ÿä½ç½®ç›¸å¯¹å’Œè°ï¼Œé€‚åˆåˆ¶å®šé•¿æœŸè®¡åˆ’ã€‚é‡ç‚¹å‘å±•åˆ›æ„å’Œçµæ€§æ–¹é¢ã€‚",

      // å»ºè®®
      reco_1: "æ¯å¤©è¿›è¡Œ10åˆ†é’Ÿå†¥æƒ³ï¼Œå¢å¼ºå†…åœ¨è§‰çŸ¥",
      reco_2: "è®°å½•æ¢¦å¢ƒå’Œç›´è§‰æ„Ÿå—ï¼ŒåŸ¹å…»çµæ€§è¿æ¥",
      reco_3: "å®šæœŸè¿›è¡Œèƒ½é‡æ¸…ç†ï¼Œä¿æŒèº«å¿ƒå¹³è¡¡",
      reco_4: "åŠ å…¥VIPä¼šå‘˜è·å–ä¸ªæ€§åŒ–æŒ‡å¯¼",
      reco_5: "è€ƒè™‘ä¸€å¯¹ä¸€ä¸“ä¸šå’¨è¯¢æ·±å…¥æ¢ç´¢"
    },
    
    // å…¶ä»–è¯­è¨€ç‰ˆæœ¬ä¿æŒç±»ä¼¼ç»“æ„ï¼Œè¿™é‡Œä¸ºäº†ç®€æ´åªå±•ç¤ºä¸­æ–‡...
    "en": {
      title: "Vedic Astrology Â· 5XLiving",
      brand: "Soul Sanctuary",
      lang_label: "Language",
      form_title: "Vedic Astrology Â· Quick Reading",
      // ... è‹±æ–‡å†…å®¹
      analysis_love: "Venus in Sagittarius 10th house shows romantic opportunities in career settings. Moon in Aquarius 9th house indicates need for intellectual connection.",
      analysis_career: "Sun in Pisces 12th house suitable for behind-the-scenes or creative work. Jupiter in Leo 4th house shows family support for career.",
      analysis_wealth: "Mercury in Scorpio 2nd house shows deep financial insight. Saturn in Cancer 5th house reminds cautious investment.",
      analysis_health: "Mars in Aquarius 11th house, need to pay attention to nervous system health.",
      analysis_family: "Jupiter in Leo 4th house, warm and supportive family relationships.",
      analysis_study: "Moon in Aquarius 9th house suitable for higher education and philosophy.",
      analysis_move: "Mars in Aquarius 11th house suitable for international travel or relocation.",
      analysis_overall: "Overall, current Jupiter Mahadasha brings growth opportunities."
    },
    "zh-TW": {
      title: "å°åº¦å‘½ç†åˆ†æ Â· 5XLiving",
      brand: "Soul Sanctuary",
      // ... ç¹ä½“ä¸­æ–‡å†…å®¹
    },
    "ja": {
      title: "ã‚¤ãƒ³ãƒ‰å æ˜Ÿè¡“åˆ†æ Â· 5XLiving",
      // ... æ—¥æ–‡å†…å®¹
    },
    "th": {
      title: "à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸­à¸´à¸™à¹€à¸”à¸µà¸¢ Â· 5XLiving",
      // ... æ³°æ–‡å†…å®¹
    },
    "ms": {
      title: "Analisis Astrologi India Â· 5XLiving",
      // ... é©¬æ¥æ–‡å†…å®¹
    }
  };

  /* ===== i18n åº”ç”¨ ===== */
  function t(key) {
    const lang = getLang();
    const L = i18n[lang] || i18n["zh-CN"];
    return L[key] || key;
  }

  function applyI18n() {
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const k = el.getAttribute("data-i18n");
      const text = t(k);
      if (text) el.textContent = text;
    });
    
    document.querySelectorAll("[data-i18n-ph]").forEach(el => {
      const k = el.getAttribute("data-i18n-ph");
      const placeholder = t(k);
      if (placeholder) el.setAttribute("placeholder", placeholder);
    });
    
    const titleEl = document.querySelector("title[data-i18n='title'], title");
    if (titleEl) {
      titleEl.textContent = t("title");
    }
  }

  /* ===== ç”Ÿæˆæ‰€æœ‰ä¸»é¢˜åˆ†æ ===== */
  function generateAllTopicAnalyses(planetPositions, lang) {
    const topics = [
      { id: 'love', name: t('tab_love') },
      { id: 'career', name: t('tab_career') },
      { id: 'wealth', name: t('tab_wealth') },
      { id: 'health', name: t('tab_health') },
      { id: 'family', name: t('tab_family') },
      { id: 'study', name: t('tab_study') },
      { id: 'move', name: t('tab_move') },
      { id: 'overall', name: t('tab_overall') }
    ];
    
    return topics;
  }

  /* ===== è·å–ä¸»é¢˜åˆ†æå†…å®¹ ===== */
  function getTopicAnalysisContent(topicId, lang) {
    // ç›´æ¥ä»ç¿»è¯‘ä¸­è·å–åˆ†æå†…å®¹
    const analysisKey = `analysis_${topicId}`;
    return t(analysisKey) || t('analysis_overall');
  }

  /* ===== æ˜¾ç¤ºä¸»é¢˜æ ‡ç­¾é¡µ ===== */
  function showTopicTabs(selectedTopic = 'love') {
    const topics = [
      { id: 'love', name: t('tab_love') },
      { id: 'career', name: t('tab_career') },
      { id: 'wealth', name: t('tab_wealth') },
      { id: 'health', name: t('tab_health') },
      { id: 'family', name: t('tab_family') },
      { id: 'study', name: t('tab_study') },
      { id: 'move', name: t('tab_move') },
      { id: 'overall', name: t('tab_overall') }
    ];
    
    const tabsContainer = document.getElementById('topicTabs');
    const contentsContainer = document.getElementById('topicContents');
    
    if (!tabsContainer || !contentsContainer) return;
    
    // æ¸…ç©ºç°æœ‰å†…å®¹
    tabsContainer.innerHTML = '';
    contentsContainer.innerHTML = '';
    
    // æ˜¾ç¤ºæ ‡ç­¾é¡µå®¹å™¨
    tabsContainer.style.display = 'flex';
    
    // ç”Ÿæˆæ ‡ç­¾å’Œå†…å®¹
    topics.forEach(topic => {
      // åˆ›å»ºæ ‡ç­¾
      const tab = document.createElement('div');
      tab.className = `topic-tab ${topic.id === selectedTopic ? 'active' : ''}`;
      tab.textContent = topic.name;
      tab.dataset.topic = topic.id;
      
      tab.addEventListener('click', () => {
        // ç§»é™¤æ‰€æœ‰activeç±»
        document.querySelectorAll('.topic-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.topic-content').forEach(c => c.classList.remove('active'));
        
        // æ·»åŠ activeç±»
        tab.classList.add('active');
        const content = document.getElementById(`content-${topic.id}`);
        if (content) content.classList.add('active');
      });
      
      tabsContainer.appendChild(tab);
      
      // åˆ›å»ºå†…å®¹
      const content = document.createElement('div');
      content.id = `content-${topic.id}`;
      content.className = `topic-content ${topic.id === selectedTopic ? 'active' : ''}`;
      content.innerHTML = `
        <div class="analysis-section">
          <h4>${topic.name}åˆ†æ</h4>
          <p>${getTopicAnalysisContent(topic.id, getLang())}</p>
        </div>
      `;
      
      contentsContainer.appendChild(content);
    });
  }

  /* ===== è¡Œæ˜Ÿè¯¦ç»†æè¿° ===== */
  const planetDescriptions = {
    sun: t('sun_desc'),
    moon: t('moon_desc'),
    mercury: t('mercury_desc'),
    venus: t('venus_desc'),
    mars: t('mars_desc'),
    jupiter: t('jupiter_desc'),
    saturn: t('saturn_desc'),
    rahu: t('rahu_desc'),
    ketu: t('ketu_desc')
  };

  /* ===== æ¨¡æ€æ¡†æ§åˆ¶ ===== */
  function showPlanetDetail(planetName, planetInfo) {
    const modal = document.getElementById('planetModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    
    if (modal && modalTitle && modalContent) {
      modalTitle.textContent = `${planetInfo.planet} - ${planetInfo.sign} Â· ${planetInfo.house}`;
      
      // å®‰å…¨åœ°è·å–æè¿°
      const description = planetDescriptions[planetInfo.key] || 
                         `${planetInfo.planet}åœ¨${planetInfo.sign}çš„${planetInfo.house}ä¸­ã€‚`;
      
      modalContent.innerHTML = `
        <p><strong>${t('planet_positions')}:</strong> ${planetInfo.sign} Â· ${planetInfo.house}</p>
        <p><strong>è§£è¯»ï¼š</strong></p>
        <p>${description}</p>
      `;
      
      modal.style.display = 'flex';
    }
  }

  /* ===== æœ¬åœ°å‘½ç†åˆ†æ ===== */
  function generateLocalAnalysis({ name, gender, birthdt, birthplace, topic, question }) {
    const lang = getLang();
    
    // è¡Œæ˜Ÿæ•°æ® - æ ¹æ®è¯­è¨€é€‰æ‹©åç§°
    const planetNames = {
      'zh-CN': ['å¤ªé˜³', 'æœˆäº®', 'æ°´æ˜Ÿ', 'é‡‘æ˜Ÿ', 'ç«æ˜Ÿ', 'æœ¨æ˜Ÿ', 'åœŸæ˜Ÿ', 'ç½—çº', 'è®¡éƒ½'],
      'zh-TW': ['å¤ªé™½', 'æœˆäº®', 'æ°´æ˜Ÿ', 'é‡‘æ˜Ÿ', 'ç«æ˜Ÿ', 'æœ¨æ˜Ÿ', 'åœŸæ˜Ÿ', 'ç¾…çº', 'è¨ˆéƒ½'],
      'en': ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter', 'Saturn', 'Rahu', 'Ketu'],
      'ja': ['å¤ªé™½', 'æœˆ', 'æ°´æ˜Ÿ', 'é‡‘æ˜Ÿ', 'ç«æ˜Ÿ', 'æœ¨æ˜Ÿ', 'åœŸæ˜Ÿ', 'ãƒ©ãƒ¼ãƒ•', 'ã‚±ãƒ¼ãƒˆã‚¥'],
      'th': ['à¸”à¸§à¸‡à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ', 'à¸”à¸§à¸‡à¸ˆà¸±à¸™à¸—à¸£à¹Œ', 'à¸”à¸²à¸§à¸à¸¸à¸˜', 'à¸”à¸²à¸§à¸¨à¸¸à¸à¸£à¹Œ', 'à¸”à¸²à¸§à¸­à¸±à¸‡à¸„à¸²à¸£', 'à¸”à¸²à¸§à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ', 'à¸”à¸²à¸§à¹€à¸ªà¸²à¸£à¹Œ', 'à¸£à¸²à¸«à¸¹', 'à¹€à¸à¸•à¸¸'],
      'ms': ['Matahari', 'Bulan', 'Utarid', 'Zuhrah', 'Marikh', 'Musytari', 'Zuhal', 'Rahu', 'Ketu']
    };
    
    const signNames = {
      'zh-CN': ['ç™½ç¾Šåº§', 'é‡‘ç‰›åº§', 'åŒå­åº§', 'å·¨èŸ¹åº§', 'ç‹®å­åº§', 'å¤„å¥³åº§', 'å¤©ç§¤åº§', 'å¤©èåº§', 'å°„æ‰‹åº§', 'æ‘©ç¾¯åº§', 'æ°´ç“¶åº§', 'åŒé±¼åº§'],
      'zh-TW': ['ç™½ç¾Šåº§', 'é‡‘ç‰›åº§', 'é›™å­åº§', 'å·¨èŸ¹åº§', 'ç…å­åº§', 'è™•å¥³åº§', 'å¤©ç§¤åº§', 'å¤©è åº§', 'å°„æ‰‹åº§', 'æ‘©ç¾¯åº§', 'æ°´ç“¶åº§', 'é›™é­šåº§'],
      'en': ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'],
      'ja': ['ç‰¡ç¾Šåº§', 'ç‰¡ç‰›åº§', 'åŒå­åº§', 'èŸ¹åº§', 'ç…å­åº§', 'ä¹™å¥³åº§', 'å¤©ç§¤åº§', 'è åº§', 'å°„æ‰‹åº§', 'å±±ç¾Šåº§', 'æ°´ç“¶åº§', 'é­šåº§'],
      'th': ['à¹€à¸¡à¸©', 'à¸à¸¤à¸©à¸ ', 'à¹€à¸¡à¸–à¸¸à¸™', 'à¸à¸£à¸à¸', 'à¸ªà¸´à¸‡à¸«à¹Œ', 'à¸à¸±à¸™à¸¢à¹Œ', 'à¸•à¸¸à¸¥à¸¢à¹Œ', 'à¸à¸´à¸ˆà¸´à¸', 'à¸˜à¸™à¸¹', 'à¸¡à¸±à¸‡à¸à¸£', 'à¸à¸¸à¸¡à¸ à¹Œ', 'à¸¡à¸µà¸™'],
      'ms': ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces']
    };
    
    const houseNames = {
      'zh-CN': ['ç¬¬1å®«', 'ç¬¬2å®«', 'ç¬¬3å®«', 'ç¬¬4å®«', 'ç¬¬5å®«', 'ç¬¬6å®«', 'ç¬¬7å®«', 'ç¬¬8å®«', 'ç¬¬9å®«', 'ç¬¬10å®«', 'ç¬¬11å®«', 'ç¬¬12å®«'],
      'zh-TW': ['ç¬¬1å®®', 'ç¬¬2å®®', 'ç¬¬3å®®', 'ç¬¬4å®®', 'ç¬¬5å®®', 'ç¬¬6å®®', 'ç¬¬7å®®', 'ç¬¬8å®®', 'ç¬¬9å®®', 'ç¬¬10å®®', 'ç¬¬11å®®', 'ç¬¬12å®®'],
      'en': ['1st House', '2nd House', '3rd House', '4th House', '5th House', '6th House', '7th House', '8th House', '9th House', '10th House', '11th House', '12th House'],
      'ja': ['ç¬¬1å®¤', 'ç¬¬2å®¤', 'ç¬¬3å®¤', 'ç¬¬4å®¤', 'ç¬¬5å®¤', 'ç¬¬6å®¤', 'ç¬¬7å®¤', 'ç¬¬8å®¤', 'ç¬¬9å®¤', 'ç¬¬10å®¤', 'ç¬¬11å®¤', 'ç¬¬12å®¤'],
      'th': ['à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ1', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ2', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ3', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ4', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ5', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ6', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ7', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ8', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ9', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ10', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ11', 'à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆ12'],
      'ms': ['Rumah 1', 'Rumah 2', 'Rumah 3', 'Rumah 4', 'Rumah 5', 'Rumah 6', 'Rumah 7', 'Rumah 8', 'Rumah 9', 'Rumah 10', 'Rumah 11', 'Rumah 12']
    };
    
    const planets = planetNames[lang] || planetNames['zh-CN'];
    const signs = signNames[lang] || signNames['zh-CN'];
    const houses = houseNames[lang] || houseNames['zh-CN'];
    
    // ç”Ÿæˆè¡Œæ˜Ÿä½ç½® - åŸºäºå‡ºç”Ÿæ—¥æœŸç”Ÿæˆæ›´ä¸€è‡´çš„éšæœºç»“æœ
    const hash = birthdt.split('-').join('') + birthplace;
    let seed = 0;
    for (let i = 0; i < hash.length; i++) {
      seed = (seed << 5) - seed + hash.charCodeAt(i);
    }
    
    const planetPositions = planets.map((planet, index) => {
      // ä½¿ç”¨ç§å­ç¡®ä¿åŒä¸€ç”¨æˆ·æ¯æ¬¡å¾—åˆ°ç›¸åŒç»“æœ
      const pseudoRandom = (seed + index * 100) % 1;
      const signIndex = Math.floor(pseudoRandom * signs.length);
      const houseIndex = Math.floor(pseudoRandom * houses.length);
      
      return { 
        planet, 
        sign: signs[signIndex], 
        house: houses[houseIndex],
        key: planet.toLowerCase().replace(/[^a-z]/g, '')
      };
    });
    
    // æ„å»ºHTMLå†…å®¹ - åªåŒ…å«åŸºæœ¬ä¿¡æ¯å’Œè¡Œæ˜Ÿä½ç½®
    let html = `<div class="local-analysis">
      <h3>${t('analysis_title')}</h3>
      <p><strong>${name ? t('name_label') + ': ' + name : ''}</strong> ${birthdt ? ' | ' + t('birth_dt_label') + ': ' + birthdt : ''} ${birthplace ? ' | ' + t('birth_place_label') + ': ' + birthplace : ''}</p>
      
      <h4>${t('planet_positions')}</h4>
      <p class="muted">${t('click_for_details')}</p>
      <div class="planet-grid">`;
    
    planetPositions.forEach(pos => {
      html += `<div class="planet-item" onclick="showPlanetDetail('${pos.planet}', ${JSON.stringify(pos).replace(/"/g, '&quot;').replace(/'/g, "\\'")})">
        <div class="planet-name">${pos.planet}</div>
        <div class="planet-position">${pos.sign} Â· ${pos.house}</div>
      </div>`;
    });
    
    html += `</div>
      <div class="analysis-section">
        <h4>${t('nakshatra_analysis')}</h4>
        <p>${getNakshatraAnalysis(lang)}</p>
      </div>
      
      <div class="analysis-section">
        <h4>${t('dasa_analysis')}</h4>
        <p>${getDasaAnalysis(lang)}</p>
      </div>
      
      <div class="analysis-section">
        <h4>${t('recommendations')}</h4>
        <ul>
          <li>${t('reco_1')}</li>
          <li>${t('reco_2')}</li>
          <li>${t('reco_3')}</li>
          <li>${t('reco_4')}</li>
          <li>${t('reco_5')}</li>
        </ul>
      </div>
    </div>`;
    
    return {
      html: html,
      planetPositions: planetPositions,
      selectedTopic: topic
    };
  }

  function getNakshatraAnalysis(lang) {
    const nakshatras = {
      'zh-CN': 'æ ¹æ®å‡ºç”Ÿæœˆå®¿åˆ†æï¼Œå½“å‰å¤„äºAshwini nakshatraï¼Œæœ‰åˆ©äºæ–°çš„å¼€å§‹å’Œå†’é™©ç²¾ç¥ã€‚',
      'zh-TW': 'æ ¹æ“šå‡ºç”Ÿæœˆå®¿åˆ†æï¼Œç•¶å‰è™•æ–¼Ashwini nakshatraï¼Œæœ‰åˆ©æ–¼æ–°çš„é–‹å§‹å’Œå†’éšªç²¾ç¥ã€‚',
      'en': 'Based on birth Nakshatra analysis, currently in Ashwini nakshatra, favorable for new beginnings and adventurous spirit.',
      'ja': 'å‡ºç”Ÿæ™‚ã®ãƒŠã‚¯ã‚·ãƒ£ãƒˆãƒ©åˆ†æã«ã‚ˆã‚‹ã¨ã€ç¾åœ¨ã¯AshwiniãƒŠã‚¯ã‚·ãƒ£ãƒˆãƒ©ã«ã‚ã‚Šã€æ–°ã—ã„å§‹ã¾ã‚Šã¨å†’é™ºå¿ƒã«æœ‰åˆ©ã§ã™ã€‚',
      'th': 'à¸ˆà¸²à¸à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸™à¸±à¸à¸©à¸±à¸•à¸£à¹€à¸à¸´à¸” à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸™à¸±à¸à¸©à¸±à¸•à¸£ Ashwini à¸‹à¸¶à¹ˆà¸‡à¹€à¸›à¹‡à¸™à¸¡à¸‡à¸„à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸«à¸¡à¹ˆà¹à¸¥à¸°à¸ˆà¸´à¸•à¸§à¸´à¸à¸à¸²à¸“à¹à¸«à¹ˆà¸‡à¸à¸²à¸£à¸œà¸ˆà¸à¸ à¸±à¸¢',
      'ms': 'Berdasarkan analisis Nakshatra kelahiran, kini dalam nakshatra Ashwini, menggalakkan permulaan baru dan semangat berpetualang.'
    };
    
    return nakshatras[lang] || nakshatras['zh-CN'];
  }

  function getDasaAnalysis(lang) {
    const dasa = {
      'zh-CN': 'å½“å‰æ­£å¤„äºæœ¨æ˜Ÿå¤§è¿ï¼ˆGuru Mahadashaï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæˆé•¿ã€å­¦ä¹ å’Œæ‰©å±•çš„æ—¶æœŸã€‚',
      'zh-TW': 'ç•¶å‰æ­£è™•æ–¼æœ¨æ˜Ÿå¤§é‹ï¼ˆGuru Mahadashaï¼‰ï¼Œé€™æ˜¯ä¸€å€‹æˆé•·ã€å­¸ç¿’å’Œæ“´å±•çš„æ™‚æœŸã€‚',
      'en': 'Currently in Jupiter major period (Guru Mahadasha), a time of growth, learning and expansion.',
      'ja': 'ç¾åœ¨ã¯æœ¨æ˜Ÿã®å¤§é‹ï¼ˆGuru Mahadashaï¼‰ã«ã‚ã‚Šã€æˆé•·ã€å­¦ç¿’ã€æ‹¡å¼µã®æ™‚æœŸã§ã™ã€‚',
      'th': 'à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¸—à¸¨à¸²à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸”à¸²à¸§à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ (Guru Mahadasha) à¸‹à¸¶à¹ˆà¸‡à¹€à¸›à¹‡à¸™à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¹à¸«à¹ˆà¸‡à¸à¸²à¸£à¹€à¸•à¸´à¸šà¹‚à¸• à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰ à¹à¸¥à¸°à¸à¸²à¸£à¸‚à¸¢à¸²à¸¢à¸•à¸±à¸§',
      'ms': 'Kini dalam tempoh utama Musytari (Guru Mahadasha), masa pertumbuhan, pembelajaran dan pengembangan.'
    };
    
    return dasa[lang] || dasa['zh-CN'];
  }

  /* ===== äº¤äº’ ===== */
  document.addEventListener('DOMContentLoaded', function() {
    // è¯­è¨€é€‰æ‹©å™¨
    const langSelect = document.getElementById('langSelect');
    if (langSelect) {
      langSelect.value = getLang();
      langSelect.addEventListener('change', function() {
        setLang(this.value);
        applyI18n();
        
        // é‡æ–°ç”Ÿæˆåˆ†æå†…å®¹
        const localCard = document.getElementById('localCard');
        if (localCard && localCard.style.display === 'block') {
          const goBtn = document.getElementById('go');
          if (goBtn) goBtn.click();
        }
      });
    }

    // é¢„è®¾é—®é¢˜é€‰æ‹©
    const presetQEl = document.getElementById('presetQ');
    if (presetQEl) {
      presetQEl.addEventListener('change', function(e) {
        const v = e.target.value;
        if (v) {
          const q = document.getElementById('question');
          if (q) q.value = q.value ? q.value + '\n' + v : v;
        }
      });
    }

    // æ¸…ç©ºæŒ‰é’®
    const clearBtn = document.getElementById('clear');
    if (clearBtn) {
      clearBtn.addEventListener('click', function() {
        ['name', 'gender', 'birthdt', 'birthplace', 'question'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = '';
        });
        const topicEl = document.getElementById('topic');
        if (topicEl) topicEl.value = 'love';
        if (presetQEl) presetQEl.value = '';
        const localCard = document.getElementById('localCard');
        if (localCard) localCard.style.display = 'none';
        const localText = document.getElementById('localText');
        if (localText) localText.textContent = '';
        const topicTabs = document.getElementById('topicTabs');
        if (topicTabs) topicTabs.style.display = 'none';
      });
    }

    // ç”Ÿæˆåˆ†ææŒ‰é’®
    const goBtn = document.getElementById('go');
    if (goBtn) {
      goBtn.addEventListener('click', function() {
        const L = i18n[getLang()] || i18n["zh-CN"];
        const birthdtEl = document.getElementById('birthdt');
        const birthplaceEl = document.getElementById('birthplace');
        const birthdt = birthdtEl ? birthdtEl.value.trim() : '';
        const birthplace = birthplaceEl ? birthplaceEl.value.trim() : '';

        if (!birthdt || !birthplace) {
          alert(L.need_birth);
          return;
        }

        const payload = {
          name: (document.getElementById('name')?.value || '').trim(),
          gender: document.getElementById('gender')?.value || '',
          birthdt,
          birthplace,
          topic: document.getElementById('topic')?.value || 'love',
          question: ((document.getElementById('question')?.value || presetQEl?.value || '')).trim()
        };

        const localCard = document.getElementById('localCard');
        const localText = document.getElementById('localText');

        if (localCard) localCard.style.display = 'block';
        if (localText) localText.innerHTML = `<div class="loading">${L.generating}</div>`;

        // æ¨¡æ‹Ÿåˆ†æç”Ÿæˆæ—¶é—´
        setTimeout(() => {
          const analysisResult = generateLocalAnalysis(payload);
          if (localText) localText.innerHTML = analysisResult.html;
          
          // æ˜¾ç¤ºä¸»é¢˜æ ‡ç­¾é¡µ
          showTopicTabs(payload.topic);
        }, 1500);
      });
    }

    // æ¨¡æ€æ¡†å…³é—­
    const closeModal = document.getElementById('closeModal');
    const modal = document.getElementById('planetModal');
    
    if (closeModal && modal) {
      closeModal.addEventListener('click', function() {
        modal.style.display = 'none';
      });
      
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.style.display = 'none';
        }
      });
    }

    // å‡ºç”Ÿæ—¥æœŸæ—¶é—´é»˜è®¤å¡«å½“å‰æ—¶é—´
    const dt = document.getElementById('birthdt');
    if (dt && !dt.value) {
      const now = new Date();
      const tzOffset = now.getTimezoneOffset() * 60000;
      const localISO = new Date(now.getTime() - tzOffset).toISOString().slice(0, 16);
      dt.value = localISO;
    }

    // åˆå§‹åŒ–
    applyI18n();
  });

  // æš´éœ²å‡½æ•°ç»™å…¨å±€ä½œç”¨åŸŸ
  window.showPlanetDetail = showPlanetDetail;

})();
</script>
</body>
</html>
