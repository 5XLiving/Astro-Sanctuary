<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>хЕлхнЧхС╜чРЖ ┬╖ 5XLiving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:16px}
    .title{font-family:"Noto Serif SC",serif;font-weight:700;letter-spacing:.02em}
    .subtitle{color:var(--muted);font-size:.9rem}
    .lang{display:flex;align-items:center;gap:8px}
    .lang select{
      appearance:none;border-radius:10px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:10px 34px 10px 12px;font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat;background-position:calc(100% - 12px) 50%;
    }

    .section{margin-top:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .h2{font-size:1.2rem;margin:0 0 12px;font-weight:800;color:#ffe084;display:flex;gap:8px;align-items:center}
    .h2::before{content:"";width:4px;height:18px;background:var(--brand);border-radius:2px}

    .row{display:grid;gap:12px}
    @media(min-width:760px){.row.cols-3{grid-template-columns:1fr 1fr 1fr}.row.cols-2{grid-template-columns:1fr 1fr}}

    input,select,button{
      width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:12px 12px;font-size:15px;outline:none;
    }
    input::placeholder{color:#6f8092}
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}
    .btn.block{display:block;width:100%}

    .pillars{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .pillar{background:#0f1624;border:1px solid #253245;border-radius:12px;padding:14px 10px;text-align:center}
    .pillar .tit{color:#9aa3b2;font-size:.85rem;margin-bottom:6px}
    .pillar .gz{font-size:1.5rem;font-weight:800;color:var(--gold2)}

    .bazi-table{width:100%;border-collapse:collapse;margin-top:12px;background:#0f1624;border-radius:8px;overflow:hidden}
    .bazi-table th,.bazi-table td{padding:10px 12px;border:1px solid #253245;text-align:center}
    .bazi-table th{background:rgba(212,175,55,.1);color:var(--gold2)}

    .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0}
    .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
    .error-message{background:rgba(255,90,95,.1);border:1px solid #ff5a5f;border-radius:8px;padding:10px;display:none}
    .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
    .muted{color:var(--muted)}

    /* тАФтАФ хЗ║чФЯцЧ╢щЧ┤я╝ЪцЧ╢щЧ┤ш╛УхЕе + тАЬф╕НшпжтАЭхРМф╕АшбМ тАФтАФ */
    .time-row{display:flex;align-items:center;gap:10px}
    .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
    .btn-mini{padding:8px 10px;border-radius:10px}
    /* тАФтАФ щЪРшЧПтАЬф╝░цЧ╢щЧ┤тАЭцМЙщТоя╝Ъф╗ЕхЛ╛щАЙф╕НшпжцЧ╢х╝╣чкЧ тАФтАФ */
    #guessTimeBtn{display:none !important; visibility:hidden !important;}

    /* тАФтАФ хП│ф╕ЛшзТх┐ГцАЬчобхо╢я╝ИщЧоя╝Й тАФтАФ */
    .ss-chat-fab{
      position:fixed;right:18px;bottom:18px;z-index:50;width:56px;height:56px;border-radius:50%;
      background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;display:grid;place-items:center;font-weight:800;
      box-shadow:0 8px 30px rgba(0,0,0,.35);cursor:pointer;border:1px solid #e6c76e
    }
    .ss-chat-panel{
      position:fixed;right:18px;bottom:88px;z-index:50;width:min(460px,92vw);display:none;
      background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)
    }
    .ss-chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #243244}
    .ss-chat-title{font-weight:700}
    .ss-close{cursor:pointer;opacity:.8}
    .ss-chat-body{max-height:300px;overflow:auto;padding:10px 12px}
    .ss-msg{padding:8px 10px;background:#0f1624;border:1px solid #243244;border-radius:10px;margin:6px 0;max-width:80%}
    .ss-msg.me{margin-left:auto;background:#132033}
    .ss-chat-input{display:flex;gap:8px;padding:10px 12px;border-top:1px solid #243244}
    .ss-chat-input input{flex:1}

    /* тАФтАФ ф╝ЪхСШхМ║х╕Гх▒А тАФтАФ */
    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}
    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}

    /* тАФтАФ хПкф┐ЭчХЩф╕Аф╕к GPT чкЧхПгя╝ЪщЪРшЧПч╗УцЮЬхМ║чЪД GPT цК╜х▒Й тАФтАФ */
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{display:none !important}

    /* тАФтАФ ф╝░цЧ╢щЧ┤х╝╣чкЧ тАФтАФ */
    .tw-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:60}
    .tw-box{width:min(560px,94vw);background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)}
    .tw-head{padding:12px 14px;border-bottom:1px solid #243244;font-weight:700}
    .tw-body{padding:14px}
    .tw-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .tw-btn{padding:10px;border:1px solid #243244;border-radius:12px;background:#0f1624;color:var(--text);cursor:pointer}
    .tw-btn.active{border-color:var(--gold2);box-shadow:0 0 0 2px rgba(212,175,55,.25) inset}
    .tw-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #243244}
    /* ф┐охдНя╝ЪGrid хнРщб╣хЕБшо╕цФ╢ч╝йя╝МщБ┐хЕНхЖЕхо╣цККщЭвцЭ┐цТСча┤ */
.auth-grid > * { min-width: 0; }
.panel .body .row.one > * { min-width: 0; }

/* шойф╝ЪхСШцМЙщТохЬичкДхо╜х║жф╕ЛшГ╜цНвшбМуАБх▒Еф╕нф╕Фф╕Нц║вхЗ║ */
.panel .body .btn {
  display: flex;               /* цФ╣ф╕║ flex цЫ┤чи│ */
  align-items: center;
  justify-content: center;
  text-align: center;
  white-space: normal;         /* хЕБшо╕цНвшбМ */
  line-height: 1.2;
  word-break: break-word;      /* хдЪшпншиА/щХ┐шпНхПпцЦншбМ */
}

/* хЭЧч║зцМЙщТочбоф┐ЭхНац╗бхо╣хЩиф╕Фф╕Нш╢ЕхЗ║ */
.btn.block { display:block; width:100%; box-sizing:border-box; }

/* хПпщАЙя╝ЪхжВцЮЬф╗НцЬЙш╜╗х╛оф╜Нчз╗я╝МщЩРхИ╢ц║вхЗ║ */
.panel .body { overflow: hidden; }

.panel .body .btn { padding: 10px 14px; }    
  </style>
</head>
<body>
  <header>
    <div class="head-inner container">
      <div class="title">хС╜чРЖф╛ЫщЧи ┬╖ хЕлхнЧчоАшпД</div>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">шпншиА</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">чоАф╜Уф╕нцЦЗ</option>
          <option value="zh-TW">ч╣БщлФф╕нцЦЗ</option>
          <option value="en">English</option>
          <option value="ja">цЧецЬмшкЮ</option>
          <option value="th">р╣Др╕Чр╕в</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="h2">хЕлхнЧхС╜чРЖ ┬╖ х┐лщАЯцОТчЫШ</div>

      <div class="row cols-3">
        <div>
          <label class="muted">хзУхРНя╝ИхПпщАЙя╝Й</label>
          <input id="name" placeholder="ф╜ачЪДчз░хС╝я╝ИчФиф║Оф╕кцАзхМЦя╝Й">
        </div>
        <div>
          <label class="muted">цАзхИл</label>
          <select id="gender">
            <option value="">ф╕НщАПщЬ▓</option>
            <option value="male">чФ╖цАз</option>
            <option value="female">хе│цАз</option>
          </select>
        </div>
        <div>
          <label class="muted">хОЖц│Х</label>
          <select id="calendar">
            <option value="gregorian">щШ│хОЖ / Gregorian</option>
            <option value="lunar">хЖЬхОЖ / Lunar</option>
          </select>
        </div>
      </div>

      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted">хЗ║чФЯцЧецЬЯ</label>
          <input type="date" id="birthdate">
        </div>
        <div>
          <label class="muted">хЗ║чФЯцЧ╢щЧ┤</label>
          <div class="time-row">
            <input type="time" id="birthtime" value="12:00">
            <label class="muted time-unknown"><input type="checkbox" id="timeUnknown"> хЗ║чФЯцЧ╢щЧ┤ф╕Ншпж</label>
            <!-- шзжхПСцМЙщТох╖▓щЪРшЧПя╝Мф╗Еф┐ЭчХЩф╗ехЕ╝хо╣шДЪцЬм -->
            <button class="btn btn-mini ghost" id="guessTimeBtn" type="button" title="чФих░Пц╡ЛшпХф╝░ф╕Аф╕ЛцЧ╢щЧ┤">ЁЯзн ф╝░цЧ╢щЧ┤</button>
          </div>
        </div>
        <div style="display:flex;align-items:flex-end">
          <button class="btn" id="genBtn">
            <span id="genBtnText">чФЯцИРхЕлхнЧ</span>
            <span id="genBtnLoading" style="display:none">шобчоЧф╕н...</span>
          </button>
        </div>
      </div>

      <div id="error" class="error-message"></div>
    </section>

    <section id="result" style="display:none;">
      <div class="card">
        <div class="h2">цВичЪДчФЯш╛░хЕлхнЧхС╜чЫШ</div>
        <div class="pillars" id="bazi-pillars"></div>
        <div class="muted" id="bazi-date" style="margin-top:6px"></div>

        <table class="bazi-table">
          <thead><tr><th></th><th>х╣┤цЯ▒</th><th>цЬИцЯ▒</th><th>цЧецЯ▒</th><th>цЧ╢цЯ▒</th></tr></thead>
          <tbody>
            <tr><td>хдйх╣▓</td><td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td></tr>
            <tr><td>хЬ░цФп</td><td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td></tr>
            <tr><td>ф║ФшбМ</td><td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td></tr>
            <tr><td>ч║│щЯ│</td><td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td></tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="h2">ф║ФшбМшГ╜щЗПхИЖцЮР</div>
        <div class="bar-row"><span>цЬи</span><div class="bar"><i id="bar-цЬи"></i></div><span id="pct-цЬи">0%</span></div>
        <div class="bar-row"><span>чБл</span><div class="bar"><i id="bar-чБл"></i></div><span id="pct-чБл">0%</span></div>
        <div class="bar-row"><span>хЬЯ</span><div class="bar"><i id="bar-хЬЯ"></i></div><span id="pct-хЬЯ">0%</span></div>
        <div class="bar-row"><span>щЗС</span><div class="bar"><i id="bar-щЗС"></i></div><span id="pct-щЗС">0%</span></div>
        <div class="bar-row"><span>ц░┤</span><div class="bar"><i id="bar-ц░┤"></i></div><span id="pct-ц░┤">0%</span></div>
        <div id="bazi-elements-balance" class="muted" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- ф╝ЪхСШф╕УхМ║ -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ЁЯМЩ ф╝ЪхСШхМ║хЯЯ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ЁЯЧЭ хС╜чРЖчй║щЧ┤ф╕Ух▒ЮхЖЕхо╣</div>
          <ul>
            <li data-i18n="vip_love">хз╗ч╝ШцЦ╣хРСя╝ЪцБЛчИ▒ч╝ШхИЖуАБхйЪхз╗ш╡░хК┐</li>
            <li data-i18n="vip_career">ф║Лф╕ЪцЦ╣хРСя╝ЪшБМхЬ║хПСх▒ХуАБхИЫф╕Ъц╜ЬхКЫ</li>
            <li data-i18n="vip_wealth">ш┤вш┐РцЦ╣хРСя╝Ъш┤вф╜НхИЖцЮРуАБчРЖш┤вцЧ╢цЬ║</li>
            <li data-i18n="vip_pet">хоачЙйхС╜чРЖя╝Ъф╝┤ф╛гхКичЙйчЪДцАзца╝ф╕Оч╝ШхИЖ</li>
            <li data-i18n="vip_hepan">хРИчЫШхИЖцЮРя╝ЪхйЪцЬЯцЛйцЧеуАБцЦ░чФЯцЛйцЧ╢</li>
            <li data-i18n="vip_name">ц╡ЛхРНхИЖцЮРя╝ЪхЕмхП╕хРНуАБхоЭхоЭхРНуАБхС╜хРНцФ╣ш┐Р</li>
            <li data-i18n="vip_fengshui">ш┤вф╜НхРИчЫШя╝Ъф╜Пхо╢ / хКЮхЕмходхКич║┐щЕНхРИ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ЁЯМЩ х┐ГцАЬчй║щЧ┤ф╕Ух▒ЮхЖЕхо╣</div>
          <ul>
            <li data-i18n="vip_record">чБ╡цАзшо░х╜Хя╝ЪчЕзчЙЗуАБцвжхвГуАБхг░щЯ│уАБцД┐цЬЫчеИче╖</li>
            <li data-i18n="vip_course">хС╜чРЖшп╛чиЛя╝ЪхЕлхнЧ / хбФч╜Ч / хНацШЯ / чБ╡цХ░ / ф║║ч▒╗хЫ╛</li>
            <li data-i18n="vip_memorial">хо╢цЧПч║кх┐╡ч│╗ч╗Яя╝Ъф║▓ф║║чБ╡цАзч║кх┐╡ & х╗╢ч╗н</li>
            <li data-i18n="vip_tasks">цпПхСишГ╜щЗПч╗Гф╣а / чеЮцШОф╗кх╝Пф╗╗хКб</li>
            <li data-i18n="vip_shop">шГ╜щЗПхХЖхЯОф╕Ух▒ЮцКШцЙг & х╛бхоИшовхИ╢</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ЁЯТО чЩ╗хЕе VIP хКЯшГ╜</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- х╖жф╛зя╝Ъш╛УхЕе + ц│ихЖМ/чЩ╗х╜Х -->
          <div class="panel">
            <div class="head">ш┤жцИ╖чЩ╗х╜Х / ц│ихЖМ</div>
            <div class="body">
              <div class="row" id="authFields">
                <label for="email" class="sr-only">Email</label>
                <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="щВочо▒ Email" data-i18n-ph="ph_email" required/>
                <input id="password" type="password" autocomplete="new-password" placeholder="хпЖчаБ Passwordя╝ИшЗ│х░С8ф╜Ня╝МхРлхдзх░ПхЖЩцХ░хнЧчмжхП╖я╝Й" data-i18n-ph="ph_password" required/>
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">чЩ╗хЕеш┤жцИ╖</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ЁЯФС щЗНшо╛хпЖчаБ</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">ц│ихЖМш┤жцИ╖</button>
                <div class="muted" data-i18n="note_price">ц│ихЖМш┤жхП╖ш╡ащАБф╕АцмбхЕНш┤╣ф╜УщкМ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- хП│ф╛зя╝Ъф╝ЪхСШф╕Ош┐ФхЫЮ -->
          <div class="panel">
            <div class="head">ф╝ЪхСШцЬНхКб</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ЁЯТО хНЗч║зф╕║ VIPя╝ИцЬИш┤╣я╝Й</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">тЖР ш┐ФхЫЮхС╜чРЖхХЖхЯО</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / цЬИш┤╣ VIPя╝ИхС╜чРЖчй║щЧ┤ + х┐ГцАЬчй║щЧ┤ + чБ╡цАзшп╛чиЛя╝Й</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>┬й 5XLiving тАв Astro Sanctuary</footer>
  </main>

  <!-- ф╝░цЧ╢щЧ┤х╝╣чкЧ -->
  <div class="tw-mask" id="twMask" aria-hidden="true">
    <div class="tw-box" role="dialog" aria-modal="true" aria-labelledby="twTitle">
      <div class="tw-head" id="twTitle">ЁЯзн ф╝░ф╕Аф╕кхдзшЗ┤хЗ║чФЯцЧ╢щЧ┤</div>
      <div class="tw-body">
        <div class="muted" style="margin-bottom:8px">щАЙцЛйф╜ашо░х╛ЧчЪД<strong>хдзцжВцЧ╢цо╡</strong>я╝ИхЬ░цФпхПМх░ПцЧ╢цо╡я╝Й</div>
        <div class="tw-grid" id="twGrid"></div>
        <div class="muted" style="margin-top:10px;font-size:.9em">
          щАЙцЛйхРОчВ╣тАЬхблхЕецЧ╢щЧ┤тАЭя╝Мф╝ЪчФишпецЧ╢цо╡чЪДф╕нф╜НцЧ╢щЧ┤хЖЩхИ░ф╕КцЦ╣цЧ╢щЧ┤ш╛УхЕецбЖя╝Мх╣╢шЗкхКихПЦц╢ИтАЬцЧ╢щЧ┤ф╕НшпжтАЭуАВ
        </div>
      </div>
      <div class="tw-foot">
        <button class="btn ghost" id="twCancel" type="button">хПЦц╢И</button>
        <button class="btn" id="twApply" type="button" disabled>хблхЕецЧ╢щЧ┤</button>
      </div>
    </div>
  </div>

  <script>
  'use strict';

  /* ================== щЕНч╜о & х╖ехЕ╖ ================== */
  const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';

  const $ = id => document.getElementById(id);
  function showErr(msg){ const e=$("error"); if(!e) return; e.textContent=msg; e.style.display="block"; setTimeout(()=>{e.style.display='none'},5000); }
  function hideErr(){ const e=$("error"); if(!e) return; e.style.display="none"; e.textContent=""; }
  function showAuthErr(msg){ const e=$("authError"); if(!e) return; e.textContent=msg; e.style.display="block"; setTimeout(()=>{e.style.display='none'},5000); }
  function hideAuthErr(){ const e=$("authError"); if(!e) return; e.style.display="none"; e.textContent=""; }
  function lock(el, v){ if(el) el.disabled = v; }
  function strongPwd(pw){ return pw.length>=8 && /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /[0-9]/.test(pw) && /[^A-Za-z0-9]/.test(pw); }
  function setText(id, v){ const el=$(id); if(el) el.textContent=v; }
  function setBar(el, pct){ if(el) el.style.width = Math.max(0, Math.min(100, pct)) + '%'; }

  /* ================== хдЪшпншиАя╝Ич▓╛чоАя╝Й ================== */
  const LANG_KEY="site_lang";
  function getLang(){ return localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN"; }
  function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
  const translations = {
    "zh-CN": { lang_label:"шпншиА", btn_register:"ц│ихЖМш┤жцИ╖", btn_login:"чЩ╗хЕеш┤жцИ╖", btn_reset:"ЁЯФС щЗНшо╛хпЖчаБ",
      note_price:"ц│ихЖМш┤жхП╖ш╡ащАБф╕АцмбхЕНш┤╣ф╜УщкМ", note_price1:"$9.9 / цЬИш┤╣ VIPя╝ИхС╜чРЖчй║щЧ┤ + х┐ГцАЬчй║щЧ┤ + чБ╡цАзшп╛чиЛя╝Й",
      err_need_ep:"шп╖ш╛УхЕещВочо▒ф╕ОхпЖчаБ", err_pwd_rule:"хпЖчаБшЗ│х░С8ф╜Ня╝МщЬАхМЕхРлхдзхЖЩ/х░ПхЖЩ/цХ░хнЧ/чЙ╣цоКчмжхП╖",
      err_no_account:"ш┤жцИ╖ф╕НхнШхЬия╝Мшп╖хЕИц│ихЖМ", err_wrong_pwd:"хпЖчаБщФЩшпп", err_expired:"ф╝ЪхСШх╖▓ш┐ЗцЬЯя╝Мшп╖ч╗нш┤╣",
      err_login_fail:"чЩ╗хЕехд▒ш┤ея╝Ъ", err_register_fail:"ц│ихЖМхд▒ш┤ея╝Ъ", err_email_empty:"щВочо▒ф╕НшГ╜ф╕║чй║", err_pwd_empty:"хпЖчаБф╕НшГ╜ф╕║чй║",
      prompt_email:"шп╖ш╛УхЕец│ихЖМщВочо▒я╝Ъ", prompt_newpwd:"шп╖ш╛УхЕецЦ░хпЖчаБя╝ИшЗ│х░С8ф╜Ня╝МхРлхдзх░ПхЖЩуАБцХ░хнЧуАБчмжхП╖я╝Йя╝Ъ",
      btn_upgrade:"ЁЯТО хНЗч║зф╕║ VIPя╝ИцЬИш┤╣я╝Й", btn_backshop:"тЖР ш┐ФхЫЮхС╜чРЖхХЖхЯО",
      vip_title:"ЁЯМЩ ф╝ЪхСШхМ║хЯЯ VIP Segment", vip_mingli:"ЁЯЧЭ хС╜чРЖчй║щЧ┤ф╕Ух▒ЮхЖЕхо╣", vip_xinlian:"ЁЯМЩ х┐ГцАЬчй║щЧ┤ф╕Ух▒ЮхЖЕхо╣",
      vip_love:"хз╗ч╝ШцЦ╣хРСя╝ЪцБЛчИ▒ч╝ШхИЖуАБхйЪхз╗ш╡░хК┐", vip_career:"ф║Лф╕ЪцЦ╣хРСя╝ЪшБМхЬ║хПСх▒ХуАБхИЫф╕Ъц╜ЬхКЫ", vip_wealth:"ш┤вш┐РцЦ╣хРСя╝Ъш┤вф╜НхИЖцЮРуАБчРЖш┤вцЧ╢цЬ║",
      vip_pet:"хоачЙйхС╜чРЖя╝Ъф╝┤ф╛гхКичЙйчЪДцАзца╝ф╕Оч╝ШхИЖ", vip_hepan:"хРИчЫШхИЖцЮРя╝ЪхйЪцЬЯцЛйцЧеуАБцЦ░чФЯцЛйцЧ╢", vip_name:"ц╡ЛхРНхИЖцЮРя╝ЪхЕмхП╕хРНуАБхоЭхоЭхРНуАБхС╜хРНцФ╣ш┐Р",
      vip_fengshui:"ш┤вф╜НхРИчЫШя╝Ъф╜Пхо╢ / хКЮхЕмходхКич║┐щЕНхРИ", vip_record:"чБ╡цАзшо░х╜Хя╝ЪчЕзчЙЗуАБцвжхвГуАБхг░щЯ│уАБцД┐цЬЫчеИче╖", vip_course:"хС╜чРЖшп╛чиЛя╝ЪхЕлхнЧ / хбФч╜Ч / хНацШЯ / чБ╡цХ░ / ф║║ч▒╗хЫ╛",
      vip_memorial:"хо╢цЧПч║кх┐╡ч│╗ч╗Яя╝Ъф║▓ф║║чБ╡цАзч║кх┐╡ & х╗╢ч╗н", vip_tasks:"цпПхСишГ╜щЗПч╗Гф╣а / чеЮцШОф╗кх╝Пф╗╗хКб", vip_shop:"шГ╜щЗПхХЖхЯОф╕Ух▒ЮцКШцЙг & х╛бхоИшовхИ╢",
      login_title:"ЁЯТО чЩ╗хЕе VIP хКЯшГ╜",
      chat_fab:"щЧо", chat_placeholder:"шп╖щЧоцВицГ│ф║Жшзгф╗Аф╣Ия╝Яя╝ИхжВя╝ЪхжВф╜Хх╝АхзЛхЕНш┤╣ф╜УщкМя╝Й", chat_send:"хПСщАБ",
      msg_reset_ok:"хпЖчаБх╖▓цИРхКЯцЫ┤цЦ░я╝Мшп╖чФицЦ░хпЖчаБщЗНцЦ░чЩ╗хЕеуАВ"
    },
    "zh-TW": { lang_label:"шкЮшиА", btn_register:"ши╗хЖКх╕│цИ╢", btn_login:"чЩ╗хЕех╕│цИ╢", btn_reset:"ЁЯФС щЗНшинхпЖчв╝",
      note_price:"ши╗хЖКш┤Иф╕АцмбхЕНш▓╗щлФщйЧ", note_price1:"$9.9 / цЬИш▓╗ VIPя╝ИхС╜чРЖчй║щЦУ + х┐ГцЖРчй║щЦУ + щЭИцАзшк▓чиЛя╝Й",
      err_need_ep:"шлЛш╝╕хЕещЫ╗хнРщГ╡ф╗╢шИЗхпЖчв╝", err_pwd_rule:"хпЖчв╝шЗ│х░С8ф╜Ня╝МщЬАхМЕхРлхдзх░Пхпл/цХ╕хнЧ/чЙ╣цоКчмжшЩЯ",
      err_no_account:"х╕│цИ╢ф╕НхнШхЬия╝МшлЛхЕИши╗хЖК", err_wrong_pwd:"хпЖчв╝щМпшкд", err_expired:"цЬГхУбх╖▓щБОцЬЯя╝МшлЛч║Мш▓╗",
      err_login_fail:"чЩ╗хЕехд▒цХЧя╝Ъ", err_register_fail:"ши╗хЖКхд▒цХЧя╝Ъ", err_email_empty:"щГ╡чо▒ф╕НшГ╜чВ║чй║", err_pwd_empty:"хпЖчв╝ф╕НшГ╜чВ║чй║",
      prompt_email:"шлЛш╝╕хЕеши╗хЖКщГ╡чо▒я╝Ъ", prompt_newpwd:"шлЛш╝╕хЕецЦ░хпЖчв╝я╝ИшЗ│х░С8ф╜Ня╝МхРлхдзх░ПхплуАБцХ╕хнЧуАБчмжшЩЯя╝Йя╝Ъ",
      btn_upgrade:"ЁЯТО хНЗч┤ЪчВ║ VIPя╝ИцЬИш▓╗я╝Й", btn_backshop:"тЖР ш┐ФхЫЮхС╜чРЖхХЖхЯО",
      vip_title:"ЁЯМЩ цЬГхУбхНАхЯЯ VIP Segment", vip_mingli:"ЁЯЧЭ хС╜чРЖчй║щЦУх░Их▒мхЕзхо╣", vip_xinlian:"ЁЯМЩ х┐ГцЖРчй║щЦУх░Их▒мхЕзхо╣",
      vip_love:"хз╗ч╖гцЦ╣хРСя╝ЪцИАцДЫч╖гхИЖуАБхйЪхз╗ш╡░хЛв", vip_career:"ф║ЛценцЦ╣хРСя╝ЪшБ╖ха┤чЩ╝х▒ХуАБхЙ╡ценц╜ЫхКЫ", vip_wealth:"ш▓бщБЛцЦ╣хРСя╝Ъш▓бф╜НхИЖцЮРуАБчРЖш▓бцЩВцйЯ",
      vip_pet:"хп╡чЙйхС╜чРЖя╝Ъф╝┤ф╛╢хЛХчЙйчЪДцАзца╝шИЗч╖гхИЖ", vip_hepan:"хРИчЫдхИЖцЮРя╝ЪхйЪцЬЯцУЗцЧеуАБцЦ░чФЯцУЗцЩВ", vip_name:"ц╕мхРНхИЖцЮРя╝ЪхЕмхП╕хРНуАБхп╢хп╢хРНуАБхС╜хРНцФ╣щБЛ",
      vip_fengshui:"ш▓бф╜НхРИчЫдя╝Ъф╜Пхо╢ / ш╛жхЕмходхЛХч╖ЪщЕНхРИ", vip_record:"щЭИцАзшиШщМДя╝ЪчЕзчЙЗуАБхдвхвГуАБшБ▓щЯ│уАБщбШцЬЫчеИчж▒", vip_course:"хС╜чРЖшк▓чиЛя╝ЪхЕлхнЧ / хбФч╛Е / хНацШЯ / щЭИцХ╕ / ф║║щбЮхЬЦ",
      vip_memorial:"хо╢цЧПч┤Ах┐╡ч│╗ч╡▒я╝Ъшжкф║║щЭИцАзч┤Ах┐╡ & х╗╢ч║М", vip_tasks:"цпПщА▒шГ╜щЗПч╖┤ч┐Т / чеЮцШОхДАх╝Пф╗╗хЛЩ", vip_shop:"шГ╜щЗПхХЖхЯОх░Их▒мцКШцЙг & х╛бхоИшиВшг╜",
      login_title:"ЁЯТО чЩ╗хЕе VIP хКЯшГ╜",
      chat_fab:"хХП", chat_placeholder:"цГ│ф║Жшзгф╗Ащ║╝я╝Яя╝Иф╛ЛхжВя╝ЪхжВф╜ХщЦЛхзЛхЕНш▓╗щлФщйЧя╝Й", chat_send:"чЩ╝щАБ",
      msg_reset_ok:"хпЖчв╝х╖▓цИРхКЯцЫ┤цЦ░я╝МшлЛчФицЦ░хпЖчв╝щЗНцЦ░чЩ╗хЕеуАВ"
    },
    "en": { lang_label:"Language", btn_register:"Create Account", btn_login:"Log in", btn_reset:"ЁЯФС Reset Password",
      note_price:"New account gets one free trial.", note_price1:"$9.9 / month ┬╖ VIP (Astro + Soul + Courses)",
      err_need_ep:"Enter email and password", err_pwd_rule:"Password must be 8+ and include upper/lowercase, number, symbol",
      err_no_account:"Account not found. Please register first.", err_wrong_pwd:"Incorrect password", err_expired:"Membership expired. Please renew.",
      err_login_fail:"Login failed: ", err_register_fail:"Registration failed: ", err_email_empty:"Email cannot be empty", err_pwd_empty:"Password cannot be empty",
      prompt_email:"Enter your registered email:", prompt_newpwd:"Enter a new password (8+, upper/lower/digit/symbol):",
      btn_upgrade:"ЁЯТО Upgrade to VIP (Monthly)", btn_backshop:"тЖР Back to Store",
      vip_title:"ЁЯМЩ VIP Segment", vip_mingli:"ЁЯЧЭ Astro Sanctuary ┬╖ Exclusive", vip_xinlian:"ЁЯМЩ Soul Sanctuary ┬╖ Exclusive",
      vip_love:"Love: Dating Fate, Marriage Trend", vip_career:"Career: Workplace, Entrepreneurship", vip_wealth:"Wealth: Wealth Position, Timing",
      vip_pet:"Pet Destiny: Temperament & Bond", vip_hepan:"Synastry: Wedding Dates, Birthtime", vip_name:"Name Reading: Company/Baby/Renaming",
      vip_fengshui:"Wealth & Layout: Home / Office", vip_record:"Spiritual Logs: Photos, Dreams, Voice, Prayers", vip_course:"Courses: Bazi / Tarot / Astrology / Numerology / Human Design",
      vip_memorial:"Family Memorial: Spiritual Archive & Legacy", vip_tasks:"Weekly Energy Practices / Divine Ritual Tasks", vip_shop:"Store Discounts & Omamori",
      login_title:"ЁЯТО VIP Login",
      chat_fab:"Chat", chat_placeholder:"What would you like to know? (e.g., how to start the free trial)", chat_send:"Send",
      msg_reset_ok:"Password updated. Please log in with the new one."
    }
  };
  function t(key){ const L = translations[getLang()] || translations["zh-CN"]; return L[key] || (translations["zh-CN"][key] || key); }  
  /***** i18n PATCH: хНаф╜Нчмж & чобхо╢чФихИ░чЪД key тАФтАФ хЕИшбечО░цЬЙф╕Йшпн *****/
Object.assign(translations["zh-CN"], {
  ph_email:"щВочо▒ Email",
  ph_password:"хпЖчаБ Passwordя╝ИшЗ│х░С8ф╜Ня╝МхРлхдзх░ПхЖЩцХ░хнЧчмжхП╖я╝Й",
  err_reset_fail:"щЗНшо╛хд▒ш┤ея╝Ъ",

  // тАФ х┐ГцАЬчобхо╢я╝ИхИЖцЮРхЩия╝ЙхдЪшпншиАщФо
  butler_title:"х┐ГцАЬчобхо╢ ┬╖ цЩ║шГ╜шзгшп╗",
  day_master:"цЧеф╕╗",
  chart_strength:"хС╜х▒А",
  season:"хнгшКВ",
  wuxing_distribution:"ф║ФшбМхИЖх╕Г",
  note:"ц│ицДП",
  time_unknown_checked:"х╖▓хЛ╛щАЙтАЬхЗ║чФЯцЧ╢щЧ┤ф╕НшпжтАЭ",
  hour_pillar_excluded:"цЬкч║│хЕецЧ╢цЯ▒",
  hint:"цПРчд║",
  no_hour_tip:"цЧацЧ╢цЯ▒я╝Мх╗║шооф╗Еф╜ЬхПВшАГуАВ",
  dev_strategy:"хПСх▒ХчнЦчХея╝Ъ",
  useful_elements:"хЦЬчФихЕГч┤ая╝Ъ",
  lucky_colors:"х╣╕ш┐РщвЬшЙ▓я╝Ъ",
  lucky_directions:"щАВхРИцЦ╣ф╜Ня╝Ъ",
  strength_strong:"хБПх╝║",
  strength_weak:"хБПх╝▒",
  strength_balanced:"х╣│шбб",
  desc_strong:"ц╜ЬхКЫш╢│уАБцКЧхОЛхе╜",
  desc_weak:"щЬАхдЦцП┤цЫ┤шГ╜хПСцМе",
  desc_balanced:"хЭЗшббуАБщАВх║ФцАзх╝║",
  desc_generic:"хЕ╖цЬЙчЛмчЙ╣чЙ╣чВ╣",
  season_spring:"цЬицЧ║чФЯхПС",
  season_summer:"чБлцЧ║хдЦцФ╛",
  season_autumn:"щЗСцЧ║цФ╢цХЫ",
  season_winter:"ц░┤цЧ║хЖЕшЧП",
  season_generic:"хнгшКВхп╣хС╜х▒АцЬЙф╕АхоЪх╜▒хУН",
  el_wood:"цЬи", el_fire:"чБл", el_earth:"хЬЯ", el_metal:"щЗС", el_water:"ц░┤",
  dir_wood:"ф╕ЬцЦ╣", dir_fire:"хНЧцЦ╣", dir_earth:"ф╕нхдо/ф╕ЬхМЧ/ше┐хНЧ", dir_metal:"ше┐цЦ╣", dir_water:"хМЧцЦ╣",
  color_wood:"ч╗┐шЙ▓/щЭТшЙ▓", color_fire:"ч║вшЙ▓/ч┤лшЙ▓", color_earth:"щ╗ДшЙ▓/цгХшЙ▓", color_metal:"чЩ╜шЙ▓/щЗСшЙ▓", color_water:"щ╗СшЙ▓/шУЭшЙ▓"
});

Object.assign(translations["zh-TW"], {
  ph_email:"щЫ╗хнРщГ╡ф╗╢ Email",
  ph_password:"хпЖчв╝ Passwordя╝ИшЗ│х░С 8 ф╜Ня╝МхРлхдзх░ПхплцХ╕хнЧчмжшЩЯя╝Й",
  err_reset_fail:"щЗНшинхд▒цХЧя╝Ъ",

  butler_title:"х┐ГцЖРчобхо╢ ┬╖ цЩ║шГ╜шзгшоА",
  day_master:"цЧеф╕╗",
  chart_strength:"хС╜х▒А",
  season:"хнгчпА",
  wuxing_distribution:"ф║ФшбМхИЖф╜И",
  note:"ц│ицДП",
  time_unknown_checked:"х╖▓хЛ╛щБ╕уАМхЗ║чФЯцЩВщЦУф╕Ншй│уАН",
  hour_pillar_excluded:"цЬкч┤НхЕецЩВцЯ▒",
  hint:"цПРчд║",
  no_hour_tip:"чДбцЩВцЯ▒я╝Мх╗║шн░хГЕф╜ЬхПГшАГуАВ",
  dev_strategy:"чЩ╝х▒ХчнЦчХея╝Ъ",
  useful_elements:"хЦЬчФихЕГч┤ая╝Ъ",
  lucky_colors:"х╣╕щБЛщбПшЙ▓я╝Ъ",
  lucky_directions:"щБйхРИцЦ╣ф╜Ня╝Ъ",
  strength_strong:"хБПх╝╖",
  strength_weak:"хБПх╝▒",
  strength_balanced:"х╣│шбб",
  desc_strong:"ц╜ЫхКЫш╢│уАБцКЧхгУхе╜",
  desc_weak:"щЬАхдЦцП┤цЫ┤шГ╜чЩ╝цПо",
  desc_balanced:"хЭЗшббуАБщБйцЗЙцАзх╝╖",
  desc_generic:"хЕ╖цЬЙчНичЙ╣чЙ╣щ╗Ю",
  season_spring:"цЬицЧ║чФЯчЩ╝",
  season_summer:"чБлцЧ║хдЦцФ╛",
  season_autumn:"щЗСцЧ║цФ╢цЦВ",
  season_winter:"ц░┤цЧ║хЕзшЧП",
  season_generic:"хнгчпАх░НхС╜х▒АцЬЙф╕АхоЪх╜▒щЯ┐",
  el_wood:"цЬи", el_fire:"чБл", el_earth:"хЬЯ", el_metal:"щЗС", el_water:"ц░┤",
  dir_wood:"цЭ▒цЦ╣", dir_fire:"хНЧцЦ╣", dir_earth:"ф╕нхдо/цЭ▒хМЧ/ше┐хНЧ", dir_metal:"ше┐цЦ╣", dir_water:"хМЧцЦ╣",
  color_wood:"ч╢ашЙ▓/щЭТшЙ▓", color_fire:"ч┤ЕшЙ▓/ч┤лшЙ▓", color_earth:"щ╗ГшЙ▓/цгХшЙ▓", color_metal:"чЩ╜шЙ▓/щЗСшЙ▓", color_water:"щ╗СшЙ▓/шЧНшЙ▓"
});

Object.assign(translations["en"], {
  ph_email:"Email address",
  ph_password:"Password (8+ with upper/lower/number/symbol)",
  err_reset_fail:"Reset failed: ",

  butler_title:"Xinlian Butler ┬╖ Insight",
  day_master:"Day Master",
  chart_strength:"Chart Strength",
  season:"Season",
  wuxing_distribution:"Five Elements",
  note:"Note",
  time_unknown_checked:"тАЬBirth time unknownтАЭ is checked",
  hour_pillar_excluded:"Hour pillar not included",
  hint:"Hint",
  no_hour_tip:"No hour pillar тАФ treat as reference only.",
  dev_strategy:"Development strategy: ",
  useful_elements:"Favorable elements: ",
  lucky_colors:"Lucky colors: ",
  lucky_directions:"Lucky directions: ",
  strength_strong:"Strong-leaning",
  strength_weak:"Weak-leaning",
  strength_balanced:"Balanced",
  desc_strong:"High potential and stress-tolerant",
  desc_weak:"Works better with external support",
  desc_balanced:"Well-balanced and adaptable",
  desc_generic:"Has unique characteristics",
  season_spring:"Wood thrives; outward growth",
  season_summer:"Fire thrives; expression/outflow",
  season_autumn:"Metal thrives; organize/refine",
  season_winter:"Water thrives; conserve/reflect",
  season_generic:"Seasonal qi has some influence",
  el_wood:"Wood", el_fire:"Fire", el_earth:"Earth", el_metal:"Metal", el_water:"Water",
  dir_wood:"East", dir_fire:"South", dir_earth:"Center/NE/SW", dir_metal:"West", dir_water:"North",
  color_wood:"Green/Teal", color_fire:"Red/Purple", color_earth:"Yellow/Brown", color_metal:"White/Gold", color_water:"Black/Blue"
});

/***** цЦ░хвЮя╝ЪцЧешпн ja *****/
translations["ja"] = {
  lang_label:"шиАшкЮ", btn_register:"уВвуВлуВжуГ│уГИф╜ЬцИР", btn_login:"уГнуВ░уВдуГ│", btn_reset:"ЁЯФС уГСуВ╣уГпуГ╝уГЙхЖНшинхоЪ",
  note_price:"цЦ░шжПчЩ╗щМ▓уБз1хЫЮуБочДбцЦЩф╜УщиУуВТщА▓хСИ", note_price1:"$9.9 / цЬИ ┬╖ VIPя╝ИхС╜чРЖуВ╣уГЪуГ╝уВ╣ + х┐ГцАЬуВ╣уГЪуГ╝уВ╣ + уВ╣уГФуГкуГБуГеуВвуГлшмЫх║зя╝Й",
  err_need_ep:"уГбуГ╝уГлуВвуГЙуГмуВ╣уБиуГСуВ╣уГпуГ╝уГЙуВТхЕехКЫуБЧуБжуБПуБауБХуБД", err_pwd_rule:"8цЦЗхнЧф╗еф╕КуГ╗хдзх░ПшЛ▒хнЧуГ╗цХ░хнЧуГ╗шиШхП╖уВТхРлуВБуБжуБПуБауБХуБД",
  err_no_account:"уВвуВлуВжуГ│уГИуБМшжЛуБдуБЛуВКуБ╛уБЫуВУуАВхЕИуБлчЩ╗щМ▓уБЧуБжуБПуБауБХуБД", err_wrong_pwd:"уГСуВ╣уГпуГ╝уГЙуБМцнгуБЧуБПуБВуВКуБ╛уБЫуВУ", err_expired:"ф╝ЪхУбцЬЯщЩРуБМхИЗуВМуБжуБДуБ╛уБЩуАВцЫ┤цЦ░уБЧуБжуБПуБауБХуБД",
  err_login_fail:"уГнуВ░уВдуГ│уБлхд▒цХЧуБЧуБ╛уБЧуБЯя╝Ъ", err_register_fail:"чЩ╗щМ▓уБлхд▒цХЧуБЧуБ╛уБЧуБЯя╝Ъ", err_email_empty:"уГбуГ╝уГлуБпх┐ЕщаИуБзуБЩ", err_pwd_empty:"уГСуВ╣уГпуГ╝уГЙуБпх┐ЕщаИуБзуБЩ",
  err_reset_fail:"хЖНшинхоЪуБлхд▒цХЧя╝Ъ",
  prompt_email:"чЩ╗щМ▓ц╕ИуБ┐уБоуГбуГ╝уГлуВвуГЙуГмуВ╣уВТхЕехКЫя╝Ъ", prompt_newpwd:"цЦ░уБЧуБДуГСуВ╣уГпуГ╝уГЙя╝И8цЦЗхнЧф╗еф╕КуГ╗шЛ▒цХ░хнЧшиШхП╖я╝Йя╝Ъ",
  btn_upgrade:"ЁЯТО VIPя╝ИцЬИщбНя╝ЙуБлуВвуГГуГЧуВ░уГмуГ╝уГЙ", btn_backshop:"тЖР уВ╣уГИуВвуБлцИ╗уВЛ",
  vip_title:"ЁЯМЩ ф╝ЪхУбуВиуГкуВв", vip_mingli:"ЁЯЧЭ хС╜чРЖуВ╣уГЪуГ╝уВ╣я╝Иф╝ЪхУбщЩРхоЪя╝Й", vip_xinlian:"ЁЯМЩ х┐ГцАЬуВ╣уГЪуГ╝уВ╣я╝Иф╝ЪхУбщЩРхоЪя╝Й",
  vip_love:"уБФч╕Бя╝ЪцБЛцДЫуГ╗ч╡РхйЪуБохВ╛хРС", vip_career:"уВнуГгуГкуВвя╝ЪшБ╖ха┤/ш╡╖ценуБохПпшГ╜цАз", vip_wealth:"ш▓бщБЛя╝Ъш▓бф╜НхИЖцЮРуГ╗уВ┐уВдуГЯуГ│уВ░",
  vip_pet:"уГЪуГГуГИхС╜чРЖя╝ЪцАзца╝уБиуБФч╕Б", vip_hepan:"чЫ╕цАзщССхоЪя╝Ъч╡РхйЪцЧехПЦуВКуГ╗хЗ║чФгцЩВхИ╗", vip_name:"хС╜хРНщССхоЪя╝Ъф╝Ъчд╛хРНуГ╗ш╡дуБбуВГуВУхРНуГ╗цФ╣хРН",
  vip_fengshui:"ш▓бф╜Н ├Ч хЛХч╖Ъя╝Ъф╜Пх▒Е / уВкуГХуВгуВ╣", vip_record:"уВ╣уГФуГкуГБуГеуВвуГлшиШщМ▓я╝ЪхЖЩчЬЯуГ╗хдвуГ╗щЯ│хг░уГ╗чеИуВК", vip_course:"шмЫх║зя╝ЪхЕлхнЧ/уВ┐уГнуГГуГИ/хНацШЯ/цХ░чзШ/HD",
  vip_memorial:"хо╢цЧПуГбуГвуГкуВвуГля╝ЪщЬКчЪДуВвуГ╝уВлуВдуГЦ", vip_tasks:"цпОщА▒уБоч╖┤ч┐Т / хДАх╝ПуВ┐уВ╣уВп", vip_shop:"уВ╣уГИуВвхЙ▓х╝Х & х╛бхоИуВК",
  login_title:"ЁЯТО VIP уГнуВ░уВдуГ│",
  chat_fab:"ш│кхХП", chat_placeholder:"ф╜ХуВТчЯеуВКуБЯуБДуБзуБЩуБЛя╝Яя╝Иф╛Ля╝ЪчДбцЦЩф╜УщиУуБохзЛуВБцЦ╣я╝Й", chat_send:"щАБф┐б",
  msg_reset_ok:"уГСуВ╣уГпуГ╝уГЙуВТцЫ┤цЦ░уБЧуБ╛уБЧуБЯуАВцЦ░уБЧуБДуГСуВ╣уГпуГ╝уГЙуБзуГнуВ░уВдуГ│уБЧуБжуБПуБауБХуБДуАВ",
  ph_email:"уГбуГ╝уГлуВвуГЙуГмуВ╣", ph_password:"уГСуВ╣уГпуГ╝уГЙя╝И8цЦЗхнЧф╗еф╕КуГ╗шЛ▒цХ░хнЧшиШхП╖я╝Й",

  butler_title:"х┐ГцАЬчобхо╢уГ╗уВдуГ│уВ╡уВдуГИ",
  day_master:"цЧеф╕╗", chart_strength:"хС╜х▒А", season:"хнгчпА", wuxing_distribution:"ф║ФшбМхИЖх╕Г",
  note:"ц│ицДП", time_unknown_checked:"уАМхЗ║чФЯцЩВщЦУф╕НцШОуАНуБлуГБуВзуГГуВпц╕ИуБ┐", hour_pillar_excluded:"цЩВцЯ▒уБпшиИчоЧуБлхРлуВБуБжуБДуБ╛уБЫуВУ",
  hint:"уГТуГ│уГИ", no_hour_tip:"цЩВцЯ▒уБкуБЧуБоуБЯуВБуАБшзгщЗИуБпхПВшАГчиЛх║жуБлуАВ",
  dev_strategy:"чЩ║х▒ХцИжчХея╝Ъ", useful_elements:"хЦЬчФия╝Ъ", lucky_colors:"уГйуГГуВнуГ╝уВлуГйуГ╝я╝Ъ", lucky_directions:"хРЙцЦ╣ф╜Ня╝Ъ",
  strength_strong:"хБПх╝╖", strength_weak:"хБПх╝▒", strength_balanced:"х╣│шбб",
  desc_strong:"ц╜ЬхЬихКЫуБМщлШуБПуАБуГЧуГмуГГуВ╖уГгуГ╝уБлх╝╖уБД", desc_weak:"хдЦщГиуБохКйуБСуБзхКЫуВТчЩ║цПоуБЧуВДуБЩуБД", desc_balanced:"уГРуГйуГ│уВ╣уБМшЙпуБПщБйх┐ЬхКЫуБМщлШуБД", desc_generic:"чЛмшЗкуБохАЛцАзуБМуБВуВКуБ╛уБЩ",
  season_spring:"цЬиуБМцЧ║уБШуБжф╝╕уБ│уВДуБЩуБД", season_summer:"чБлуБМцЧ║уБШхдЦхРСчЪДуБл", season_autumn:"щЗСуБМцЧ║уБШцХ┤чРЖуГ╗хПОцЦВ", season_winter:"ц░┤уБМцЧ║уБШхЖЕчЬБуГ╗шУДуБИ",
  season_generic:"хнгчпАуБоц░ЧуБлф╕АхоЪуБох╜▒щЯ┐уВТхПЧуБСуБ╛уБЩ",
  el_wood:"цЬи", el_fire:"чБл", el_earth:"хЬЯ", el_metal:"щЗС", el_water:"ц░┤",
  dir_wood:"цЭ▒", dir_fire:"хНЧ", dir_earth:"ф╕нхдо/хМЧцЭ▒/хНЧше┐", dir_metal:"ше┐", dir_water:"хМЧ",
  color_wood:"ч╖С/щЭТ", color_fire:"ш╡д/ч┤л", color_earth:"щ╗Д/шМ╢", color_metal:"чЩ╜/щЗС", color_water:"щ╗Т/щЭТ"
};

/***** цЦ░хвЮя╝ЪхН░хЬ░шпн hi *****/
translations["hi"] = {
  lang_label:"рднрд╛рд╖рд╛", btn_register:"рдЦрд╛рддрд╛ рдмрдирд╛рдПрдБ", btn_login:"рд▓реЙрдЧ рдЗрди", btn_reset:"ЁЯФС рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ",
  note_price:"рдирдП рдЦрд╛рддреЗ рдкрд░ рдПрдХ рдмрд╛рд░ рдирд┐рдГрд╢реБрд▓реНрдХ рдЯреНрд░рд╛рдпрд▓", note_price1:"$9.9 / рдорд╛рд╣ ┬╖ VIP (рдЬреНрдпреЛрддрд┐рд╖ + рд╕реЛрд▓ + рдХреЛрд░реНрд╕)",
  err_need_ep:"рдИрдореЗрд▓ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░реЗрдВ", err_pwd_rule:"рдкрд╛рд╕рд╡рд░реНрдб 8+ рдФрд░ рдмрдбрд╝реЗ/рдЫреЛрдЯреЗ рдЕрдХреНрд╖рд░, рдЕрдВрдХ, рдЪрд┐рдиреНрд╣ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ",
  err_no_account:"рдЦрд╛рддрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛, рдХреГрдкрдпрд╛ рдкрд╣рд▓реЗ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ", err_wrong_pwd:"рдЧрд▓рдд рдкрд╛рд╕рд╡рд░реНрдб", err_expired:"рд╕рджрд╕реНрдпрддрд╛ рд╕рдорд╛рдкреНрддтАФрдХреГрдкрдпрд╛ рд░рд┐рдиреНрдпреВ рдХрд░реЗрдВ",
  err_login_fail:"рд▓реЙрдЧрд┐рди рд╡рд┐рдлрд▓: ", err_register_fail:"рдкрдВрдЬреАрдХрд░рдг рд╡рд┐рдлрд▓: ", err_email_empty:"рдИрдореЗрд▓ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛", err_pwd_empty:"рдкрд╛рд╕рд╡рд░реНрдб рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛",
  err_reset_fail:"рд░реАрд╕реЗрдЯ рд╡рд┐рдлрд▓: ",
  prompt_email:"рдкрдВрдЬреАрдХреГрдд рдИрдореЗрд▓ рджрд░реНрдЬ рдХрд░реЗрдВ:", prompt_newpwd:"рдирдпрд╛ рдкрд╛рд╕рд╡рд░реНрдб (8+, рдмрдбрд╝реЗ/рдЫреЛрдЯреЗ/рдЕрдВрдХ/рдЪрд┐рдиреНрд╣):",
  btn_upgrade:"ЁЯТО VIP (рдорд╛рд╕рд┐рдХ) рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб", btn_backshop:"тЖР рд╕реНрдЯреЛрд░ рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдБ",
  vip_title:"ЁЯМЩ VIP рд╕рджрд╕реНрдп рдХреНрд╖реЗрддреНрд░", vip_mingli:"ЁЯЧЭ рдЬреНрдпреЛрддрд┐рд╖ рд╕реНрдкреЗрд╕ ┬╖ рд╡рд┐рд╢реЗрд╖", vip_xinlian:"ЁЯМЩ рд╕реЛрд▓ рд╕реНрдкреЗрд╕ ┬╖ рд╡рд┐рд╢реЗрд╖",
  vip_love:"рд╕рдВрдмрдВрдз: рдкреНрд░реЗрдо/рд╡рд┐рд╡рд╛рд╣ рдкреНрд░рд╡реГрддреНрддрд┐", vip_career:"рдХрд░рд┐рдпрд░: рдХрд╛рд░реНрдпрд╕реНрдерд▓/рдЙрджреНрдпрдорд┐рддрд╛", vip_wealth:"рдзрди: рдзрди-рд╕реНрдерд╛рди/рд╕рдордп",
  vip_pet:"рдкрд╛рд▓рддреВ рднрд╛рдЧреНрдп: рд╕реНрд╡рднрд╛рд╡ рдПрд╡рдВ рдмрдВрдзрди", vip_hepan:"рд╕рд┐рдиреИрд╕реНрдЯреНрд░рд┐: рд╡рд┐рд╡рд╛рд╣ рддрд┐рдерд┐/рдЬрдиреНрдо рд╕рдордп", vip_name:"рдирд╛рдо рд╡рд┐рд╢реНрд▓реЗрд╖рдг: рдХрдВрдкрдиреА/рд╢рд┐рд╢реБ/рдкреБрдирд░реНрдирд╛рдо",
  vip_fengshui:"рдзрди-рд╕реНрдерд╛рди ├Ч рд▓реЗрдЖрдЙрдЯ: рдШрд░/рдСрдлрд┐рд╕", vip_record:"рдЖрдзреНрдпрд╛рддреНрдорд┐рдХ рд░рд┐рдХрд╛рд░реНрдб: рдлреЛрдЯреЛ/рд╕рдкрдирд╛/рдЖрд╡рд╛рдЬрд╝/рдкреНрд░рд╛рд░реНрдердирд╛", vip_course:"рдХреЛрд░реНрд╕: рдмрд╛рдЬрд╝реА/рдЯреИрд░реЛ/рдЬреНрдпреЛрддрд┐рд╖/рдЕрдВрдХ/HD",
  vip_memorial:"рдкрд░рд┐рд╡рд╛рд░ рд╕реНрдорд╛рд░рдХ: рдЖрдзреНрдпрд╛рддреНрдорд┐рдХ рд╕рдВрдЧреНрд░рд╣", vip_tasks:"рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдЕрднреНрдпрд╛рд╕ / рдЕрдиреБрд╖реНрдард╛рди", vip_shop:"рд╕реНрдЯреЛрд░ рдЫреВрдЯ рдПрд╡рдВ рдУрдорд╛рдореЛрд░реА",
  login_title:"ЁЯТО VIP рд▓реЙрдЧрд┐рди",
  chat_fab:"рдЪреИрдЯ", chat_placeholder:"рдЖрдк рдХреНрдпрд╛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ? (рдЙрджрд╛.: рдореБрдлреНрдд рдЯреНрд░рд╛рдпрд▓ рдХреИрд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ)", chat_send:"рднреЗрдЬреЗрдВ",
  msg_reset_ok:"рдкрд╛рд╕рд╡рд░реНрдб рдЕрдкрдбреЗрдЯ рд╣реЛ рдЧрдпрд╛ред рдирдП рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВред",
  ph_email:"рдИрдореЗрд▓", ph_password:"рдкрд╛рд╕рд╡рд░реНрдб (8+ рдмрдбрд╝реЗ/рдЫреЛрдЯреЗ/рдЕрдВрдХ/рдЪрд┐рдиреНрд╣)",

  butler_title:"Xinlian Butler ┬╖ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
  day_master:"рджрд┐рди рд╕реНрд╡рд╛рдореА", chart_strength:"рдЪрд╛рд░реНрдЯ рдмрд▓", season:"рдЛрддреБ", wuxing_distribution:"рдкрдВрдЪрддрддреНрд╡ рд╡рд┐рддрд░рдг",
  note:"рдиреЛрдЯ", time_unknown_checked:"тАЬрдЬрдиреНрдо рд╕рдордп рдЕрдЬреНрдЮрд╛рддтАЭ рдЪреБрдирд╛ рд╣реИ", hour_pillar_excluded:"рдШрдВрдЯрд╛ рд╕реНрддрдВрдн рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ",
  hint:"рд╕реБрдЭрд╛рд╡", no_hour_tip:"рдШрдВрдЯрд╛ рд╕реНрддрдВрдн рдирд╣реАрдВ тАФ рдкрд░рд┐рдгрд╛рдо рд╕рдВрджрд░реНрдн рд╣реЗрддреБред",
  dev_strategy:"рд╡рд┐рдХрд╛рд╕ рд░рдгрдиреАрддрд┐я╝Ъ", useful_elements:"рдкреНрд░рд┐рдп рддрддреНрд╡я╝Ъ", lucky_colors:"рд▓рдХреА рд░рдВрдЧя╝Ъ", lucky_directions:"рд╢реБрдн рджрд┐рд╢рд╛я╝Ъ",
  strength_strong:"рдкреНрд░рдмрд▓", strength_weak:"рдХрдордЬрд╝реЛрд░", strength_balanced:"рд╕рдВрддреБрд▓рд┐рдд",
  desc_strong:"рд╕рдВрднрд╛рд╡рдирд╛ рдЕрдзрд┐рдХ, рджрдмрд╛рд╡ рд╕рд╣рдиреЗ рд╡рд╛рд▓рд╛", desc_weak:"рдмрд╛рд╣рд░реА рд╕рд╣рдпреЛрдЧ рд╕реЗ рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди", desc_balanced:"рд╕рдВрддреБрд▓рд┐рдд рдФрд░ рдЕрдиреБрдХреВрд▓рдиреАрдп", desc_generic:"рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╣реИрдВ",
  season_spring:"рд╡рд╕рдВрдд: рд▓рдХрдбрд╝реА рдкреНрд░рдмрд▓, рд╡рд┐рдХрд╛рд╕", season_summer:"рдЧрд░реНрдореА: рдЕрдЧреНрдирд┐ рдкреНрд░рдмрд▓, рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐", season_autumn:"рд╢рд░рдж: рдзрд╛рддреБ рдкреНрд░рдмрд▓, рд╕рдВрдпреЛрдЬрди", season_winter:"рд╢реАрдд: рдЬрд▓ рдкреНрд░рдмрд▓, рд╕рдВрдЪрдп",
  season_generic:"рдЛрддреБ рдХрд╛ рдХреБрдЫ рдкреНрд░рднрд╛рд╡ рд░рд╣рддрд╛ рд╣реИ",
  el_wood:"рд▓рдХрдбрд╝реА", el_fire:"рдЕрдЧреНрдирд┐", el_earth:"рдкреГрдереНрд╡реА", el_metal:"рдзрд╛рддреБ", el_water:"рдЬрд▓",
  dir_wood:"рдкреВрд░реНрд╡", dir_fire:"рджрдХреНрд╖рд┐рдг", dir_earth:"рдордзреНрдп/рдИрд╢рд╛рдиреНрдп/рдиреИрдЛрддреНрдп", dir_metal:"рдкрд╢реНрдЪрд┐рдо", dir_water:"рдЙрддреНрддрд░",
  color_wood:"рд╣рд░рд╛/рдиреАрд▓рд╛рдкрди", color_fire:"рд▓рд╛рд▓/рдмреИрдВрдЧрдиреА", color_earth:"рдкреАрд▓рд╛/рднреВрд░рд╛", color_metal:"рд╕рдлреЗрдж/рд╕реНрд╡рд░реНрдг", color_water:"рдХрд╛рд▓рд╛/рдиреАрд▓рд╛"
};

/***** цЦ░хвЮя╝ЪщймцЭешпн ms *****/
translations["ms"] = {
  lang_label:"Bahasa", btn_register:"Daftar Akaun", btn_login:"Log masuk", btn_reset:"ЁЯФС Tetapkan semula kata laluan",
  note_price:"Akaun baharu menerima satu percubaan percuma", note_price1:"$9.9 / bulan ┬╖ VIP (Astrologi + Jiwa + Kursus)",
  err_need_ep:"Masukkan emel dan kata laluan", err_pwd_rule:"Kata laluan mesti 8+ serta huruf besar/kecil, nombor dan simbol",
  err_no_account:"Akaun tidak ditemui. Sila daftar dahulu.", err_wrong_pwd:"Kata laluan tidak betul", err_expired:"Keahlian tamatтАФsila perbaharui",
  err_login_fail:"Log masuk gagal: ", err_register_fail:"Pendaftaran gagal: ", err_email_empty:"Emel tidak boleh kosong", err_pwd_empty:"Kata laluan tidak boleh kosong",
  err_reset_fail:"Tetapan semula gagal: ",
  prompt_email:"Masukkan emel berdaftar anda:", prompt_newpwd:"Kata laluan baharu (8+, huruf/nombor/simbol):",
  btn_upgrade:"ЁЯТО Naik taraf ke VIP (Bulanan)", btn_backshop:"тЖР Kembali ke Kedai",
  vip_title:"ЁЯМЩ Zon Ahli VIP", vip_mingli:"ЁЯЧЭ Ruang Astrologi ┬╖ Eksklusif", vip_xinlian:"ЁЯМЩ Ruang Jiwa ┬╖ Eksklusif",
  vip_love:"Jodoh: cinta & trend perkahwinan", vip_career:"Kerjaya: tempat kerja/usahawan", vip_wealth:"Rezeki: kedudukan & masa",
  vip_pet:"Takdir haiwan peliharaan: sifat & jalinan", vip_hepan:"Keserasian: tarikh nikah & waktu kelahiran", vip_name:"Analisis nama: syarikat/bayi/penamaan semula",
  vip_fengshui:"Kedudukan wang ├Ч susun atur: rumah/pejabat", vip_record:"Rekod spiritual: foto/mimpi/suara/doa", vip_course:"Kursus: Bazi/Tarot/Astrologi/Nombor/HD",
  vip_memorial:"Peringatan keluarga: arkib spiritual", vip_tasks:"Amalan mingguan / ritual", vip_shop:"Diskaun & omamori tersuai",
  login_title:"ЁЯТО Log masuk VIP",
  chat_fab:"Chat", chat_placeholder:"Apa yang anda ingin tahu? (cth: cara mulakan percubaan percuma)", chat_send:"Hantar",
  msg_reset_ok:"Kata laluan dikemas kini. Log masuk dengan yang baharu.",
  ph_email:"Emel", ph_password:"Kata laluan (8+ huruf/nombor/simbol)",

  butler_title:"Xinlian Butler ┬╖ Analisis",
  day_master:"Day Master", chart_strength:"Kekuatan Carta", season:"Musim", wuxing_distribution:"Agihan Lima Unsur",
  note:"Nota", time_unknown_checked:"тАЬMasa lahir tidak pastiтАЭ dipilih", hour_pillar_excluded:"Tiang jam tidak diambil kira",
  hint:"Petua", no_hour_tip:"Tiada tiang jam тАФ rujukan sahaja.",
  dev_strategy:"Strategi pembangunan: ", useful_elements:"Unsur berguna: ", lucky_colors:"Warna bertuah: ", lucky_directions:"Arah bertuah: ",
  strength_strong:"Cenderung kuat", strength_weak:"Cenderung lemah", strength_balanced:"Seimbang",
  desc_strong:"Potensi tinggi, tahan tekanan", desc_weak:"Lebih baik dengan sokongan luar", desc_balanced:"Seimbang dan mudah menyesuaikan", desc_generic:"Mempunyai keunikan tersendiri",
  season_spring:"Musim bunga: Kayu kuat", season_summer:"Musim panas: Api kuat", season_autumn:"Musim luruh: Logam kuat", season_winter:"Musim sejuk: Air kuat",
  season_generic:"Pengaruh musim wujud",
  el_wood:"Kayu", el_fire:"Api", el_earth:"Tanah", el_metal:"Logam", el_water:"Air",
  dir_wood:"Timur", dir_fire:"Selatan", dir_earth:"Tengah/Timur Laut/Barat Daya", dir_metal:"Barat", dir_water:"Utara",
  color_wood:"Hijau/Biru kehijauan", color_fire:"Merah/Ungu", color_earth:"Kuning/Coklat", color_metal:"Putih/Emas", color_water:"Hitam/Biru"
};
  
  function applyI18n(){
    document.querySelectorAll("[data-i18n]").forEach(el=>{ const key=el.getAttribute("data-i18n"); el.textContent=t(key);});
    document.querySelectorAll("[data-i18n-ph]").forEach(el=>{ const key=el.getAttribute("data-i18n-ph"); el.setAttribute("placeholder", t(key));});
  }
  function applyChatI18n(){
    const fab=$('ssChatFab'), inp=$('ssChatInput'), btn=$('ssChatSend');
    if (fab) fab.textContent = t('chat_fab');
    if (inp) inp.placeholder = t('chat_placeholder');
    if (btn) btn.textContent = t('chat_send');
  }

  /* ================== хЕлхнЧшобчоЧхЩия╝ИчоАхМЦя╝Й ================== */
  class BaziCalculator{
    constructor(){
      this.HEAVENLY_STEMS=['чФ▓','ф╣Щ','ф╕Щ','ф╕Б','цИК','х╖▒','х║Ъ','ш╛Ы','хгм','чЩ╕'];
      this.EARTHLY_BRANCHES=['хнР','ф╕С','хпЕ','хНп','ш╛░','х╖│','хНИ','цЬк','чФ│','щЕЙ','цИМ','ф║е'];
      this.ZODIAC=['щ╝а','чЙЫ','шЩО','хЕФ','щ╛Щ','шЫЗ','щйм','ч╛К','чМ┤','щ╕б','чЛЧ','чМк'];
      this.NAYIN=['ц╡╖ф╕нщЗС','чВЙф╕нчБл','хдзцЮЧцЬи','ш╖пцЧБхЬЯ','хЙСщФЛщЗС','х▒▒хд┤чБл','ц╢зф╕Лц░┤','хЯОхд┤хЬЯ','чЩ╜шЬбщЗС','цЭицЯ│цЬи','ц│Йф╕нц░┤','х▒Лф╕КхЬЯ','щЬ╣щЫ│чБл','цЭ╛цЯПцЬи','щХ┐ц╡Бц░┤','чаВчЯ│щЗС','х▒▒ф╕ЛчБл','х╣│хЬ░цЬи','хгБф╕КхЬЯ','щЗСчоФщЗС','ф╜ЫчБпчБл','хдйц▓│ц░┤','хдзщй┐хЬЯ','щТЧщТПщЗС','цбСцЯШцЬи','хдзц║кц░┤','ц▓Щф╕нхЬЯ','хдйф╕КчБл','чЯ│цж┤цЬи','хдзц╡╖ц░┤'];
    }
    calculateYearPillar(year){ const s=(year-4)%10,b=(year-4)%12; return{stem:this.HEAVENLY_STEMS[(s+10)%10],branch:this.EARTHLY_BRANCHES[(b+12)%12],zodiac:this.ZODIAC[(b+12)%12]}; }
    solarMonthIndex(y,m,d){ const mmdd=m*100+d; const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]]; let idx=11; for(const [thr,val] of gates) if(mmdd>=thr) idx=val; const branchBy={1:'хпЕ',2:'хНп',3:'ш╛░',4:'х╖│',5:'хНИ',6:'цЬк',7:'чФ│',8:'щЕЙ',9:'цИМ',10:'ф║е',11:'хнР',12:'ф╕С'}; return{index:idx,branch:branchBy[idx]}; }
    calculateMonthPillar(year,month,day){ const {index,branch}=this.solarMonthIndex(year,month,day); const yStemIdx=this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem); const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0}; const stemIdx=(startMap[yStemIdx]+(index-1))%10; return{stem:this.HEAVENLY_STEMS[stemIdx],branch}; }
    calculateDayPillar(year,month,day){ const baseUTC=Date.UTC(1900,0,31); const targetUTC=Date.UTC(year,month-1,day); const dayDiff=Math.floor((targetUTC-baseUTC)/86400000); const stemIdx=(0+dayDiff)%10; const branchIdx=(4+dayDiff)%12; return{stem:this.HEAVENLY_STEMS[(stemIdx+10)%10],branch:this.EARTHLY_BRANCHES[(branchIdx+12)%12]}; }
    calculateHourPillar(dayStem,hour){ const branchMap={23:'хнР',0:'хнР',1:'ф╕С',2:'ф╕С',3:'хпЕ',4:'хпЕ',5:'хНп',6:'хНп',7:'ш╛░',8:'ш╛░',9:'х╖│',10:'х╖│',11:'хНИ',12:'хНИ',13:'цЬк',14:'цЬк',15:'чФ│',16:'чФ│',17:'щЕЙ',18:'щЕЙ',19:'цИМ',20:'цИМ',21:'ф║е',22:'ф║е'}; const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8}; const dayIdx=this.HEAVENLY_STEMS.indexOf(dayStem); const hourIndex=Math.floor((hour+1)/2)%12; const stemIdx=(startMap[dayIdx]+hourIndex)%10; return{stem:this.HEAVENLY_STEMS[stemIdx],branch:branchMap[hour]}; }
    getElement(stem,branch){ const s={чФ▓:'цЬи',ф╣Щ:'цЬи',ф╕Щ:'чБл',ф╕Б:'чБл',цИК:'хЬЯ',х╖▒:'хЬЯ',х║Ъ:'щЗС',ш╛Ы:'щЗС',хгм:'ц░┤',чЩ╕:'ц░┤'}; const b={хнР:'ц░┤',ф╕С:'хЬЯ',хпЕ:'цЬи',хНп:'цЬи',ш╛░:'хЬЯ',х╖│:'чБл',хНИ:'чБл',цЬк:'хЬЯ',чФ│:'щЗС',щЕЙ:'щЗС',цИМ:'хЬЯ',ф║е:'ц░┤'}; return `${s[stem]}${b[branch]}`; }
    getNayin(stem,branch){ const si=this.HEAVENLY_STEMS.indexOf(stem), bi=this.EARTHLY_BRANCHES.indexOf(branch); return this.NAYIN[(si*2+bi)%this.NAYIN.length]; }
    getStemElement(stem){ return ({чФ▓:'цЬи',ф╣Щ:'цЬи',ф╕Щ:'чБл',ф╕Б:'чБл',цИК:'хЬЯ',х╖▒:'хЬЯ',х║Ъ:'щЗС',ш╛Ы:'щЗС',хгм:'ц░┤',чЩ╕:'ц░┤'})[stem]; }
    getBranchElement(branch){ return ({хнР:'ц░┤',ф╕С:'хЬЯ',хпЕ:'цЬи',хНп:'цЬи',ш╛░:'хЬЯ',х╖│:'чБл',хНИ:'чБл',цЬк:'хЬЯ',чФ│:'щЗС',щЕЙ:'щЗС',цИМ:'хЬЯ',ф║е:'ц░┤'})[branch]; }
    calculateBazi(year,month,day,hour=12,timeUnknown=false){
      const yearP=this.calculateYearPillar(year), monthP=this.calculateMonthPillar(year,month,day), dayP=this.calculateDayPillar(year,month,day);
      const hourP=timeUnknown?{stem:'я╝Я',branch:'я╝Я'}:this.calculateHourPillar(dayP.stem,hour);
      const dayElement=this.getStemElement(dayP.stem);
      const pillars={year:yearP,month:monthP,day:{...dayP,element:dayElement},hour:hourP};
      const cnt={цЬи:0,чБл:0,хЬЯ:0,щЗС:0,ц░┤:0};
      (timeUnknown?[yearP,monthP,dayP]:[yearP,monthP,dayP,hourP]).forEach(p=>{ if(p.stem&&p.stem!=='я╝Я')cnt[this.getStemElement(p.stem)]+=1; if(p.branch&&p.branch!=='я╝Я')cnt[this.getBranchElement(p.branch)]+=1; });
      const total=Object.values(cnt).reduce((a,b)=>a+b,0)||1;
      const pct={wood:cnt['цЬи']/total*100,fire:cnt['чБл']/total*100,earth:cnt['хЬЯ']/total*100,metal:cnt['щЗС']/total*100,water:cnt['ц░┤']/total*100};
      return {pillars,counts:cnt,percents:pct,timeUnknown};
    }
  }
  const baziCalculator = new BaziCalculator();

  /* ================== шзДхИЩ/ц╕▓цЯУ ================== */
  function renderPillars(root,p,timeUnknown=false){
    if(!root) return; root.innerHTML='';
    [['х╣┤цЯ▒',p.year],['цЬИцЯ▒',p.month],['цЧецЯ▒',p.day],['цЧ╢цЯ▒',p.hour]].forEach(([tit,v])=>{
      const u=(tit==='цЧ╢цЯ▒'&&timeUnknown); const stem=u?'я╝Я':v.stem,branch=u?'я╝Я':v.branch;
      const div=document.createElement('div'); div.className='pillar'; div.innerHTML=`<div class="tit">${tit}</div><div class="gz">${stem}${branch}</div>`; root.appendChild(div);
    });
  }
  function displayClassicArea(p,timeUnknown){
    const ge=(s,b)=>baziCalculator.getElement(s,b), ny=(s,b)=>baziCalculator.getNayin(s,b);
    setText('year-stem',p.year.stem); setText('year-branch',p.year.branch);
    setText('month-stem',p.month.stem); setText('month-branch',p.month.branch);
    setText('day-stem',p.day.stem); setText('day-branch',p.day.branch);
    setText('hour-stem',timeUnknown?'я╝Я':p.hour.stem); setText('hour-branch',timeUnknown?'я╝Я':p.hour.branch);
    const setIf=(id,val)=>{const el=$(id); if(el) el.textContent=val; };
    setIf('year-element',ge(p.year.stem,p.year.branch)); setIf('month-element',ge(p.month.stem,p.month.branch));
    setIf('day-element',ge(p.day.stem,p.day.branch)); setIf('hour-element',timeUnknown?'цЬкчЯе':ge(p.hour.stem,p.hour.branch));
    setIf('year-nayin',ny(p.year.stem,p.year.branch)); setIf('month-nayin',ny(p.month.stem,p.month.branch));
    setIf('day-nayin',ny(p.day.stem,p.day.branch)); setIf('hour-nayin',timeUnknown?'цЬкчЯе':ny(p.hour.stem,p.hour.branch));
  }
  function judgeStrength(dayGan,monthZhi,cnt){
    const STEM_ELEM={чФ▓:'цЬи',ф╣Щ:'цЬи',ф╕Щ:'чБл',ф╕Б:'чБл',цИК:'хЬЯ',х╖▒:'хЬЯ',х║Ъ:'щЗС',ш╛Ы:'щЗС',хгм:'ц░┤',чЩ╕:'ц░┤'};
    const SEASON_BY_MONTH_BRANCH={хпЕ:'цШе',хНп:'цШе',ш╛░:'цШе',х╖│:'хдП',хНИ:'хдП',цЬк:'хдП',чФ│:'чзЛ',щЕЙ:'чзЛ',цИМ:'чзЛ',ф║е:'хЖм',хнР:'хЖм',ф╕С:'хЖм'};
    const dmEl=STEM_ELEM[dayGan], season=SEASON_BY_MONTH_BRANCH[monthZhi]||'-';
    let score=0; if((season==='цШе'&&'цЬичБл'.includes(dmEl))||(season==='хдП'&&'чБлхЬЯ'.includes(dmEl))||(season==='чзЛ'&&dmEl==='щЗС')||(season==='хЖм'&&dmEl==='ц░┤')) score+=2;
    score+=(cnt[dmEl]||0)*1.2; const mark=score>=3?'хБПх╝║':(score<=1?'хБПх╝▒':'х╣│шбб'); const focus=mark==='хБПх╝║'?'ц│ДчзА/хИ╢хМЦ':(mark==='хБПх╝▒'?'шбехКй/щб║хК┐':'хоИф╕н/ш░ГхТМ'); return{season,mark,focus};
  }
  function chooseUseful(strength,dmElem){
    if(strength==='хБПх╝║') return {strategy:'ц│ДчзА/хИ╢хМЦ', useful:({цЬи:['чБл','хЬЯ','щЗС'],чБл:['хЬЯ','щЗС','ц░┤'],хЬЯ:['щЗС','ц░┤','цЬи'],щЗС:['ц░┤','цЬи','чБл'],ц░┤:['цЬи','чБл','хЬЯ']})[dmElem], avoid:[dmElem]};
    if(strength==='хБПх╝▒') return {strategy:'чФЯцЙ╢/шбехКй', useful:({цЬи:['цЬи','ц░┤'],чБл:['чБл','цЬи'],хЬЯ:['хЬЯ','чБл'],щЗС:['щЗС','хЬЯ'],ц░┤:['ц░┤','щЗС']})[dmElem], avoid:[]};
    return {strategy:'ш░ГхТМ', useful:['цЬи','чБл','хЬЯ','щЗС','ц░┤'], avoid:[]};
  }

// тАФтАФ шпншиАя╝ЪхИЭхзЛхМЦ + хИЗцНвхРОщЗНц╕▓цЯУ
function initLangUI(){
  const sel = document.getElementById('langSelect');
  if(!sel) return;
  // шп╗хПЦшо░х┐ЖшпншиА
  const current = getLang();
  sel.value = current;
  document.documentElement.lang = current;
  applyI18n();
  applyChatI18n();

  sel.addEventListener('change', ()=>{
    setLang(sel.value);               // хнШ localStorage + <html lang=...>
    applyI18n();                      // хИ╖цЦ░цЙАцЬЙ data-i18n цЦЗцбИ
    applyChatI18n();                  // хИ╖цЦ░хП│ф╕ЛшзТтАЬх┐ГцАЬчобхо╢тАЭш╛УхЕехМ║цЦЗцбИ
    rerenderReportsIfAny();           // щЗНцЦ░ц╕▓цЯУх╖▓чФЯцИРчЪДцКехСКя╝ИшзБф╕Ля╝Й
  });
}

// цКехСКщЗНц╕▓цЯУя╝ИхИЗшпнчзНцЧ╢ш░ГчФия╝Й
function rerenderReportsIfAny(){
  // 1) ч╗ПхЕ╕шбица╝хМ║хПкхМЕхРлчмжхП╖я╝Мф╕НщЬАшжБщЗНхИ╖я╝ЫщЬАшжБчЪДшпЭхПпхЬицндцМЙщЬАцФ╣цЦЗцбИ
  // 2) хпМцКехСК/хЕНш┤╣цКехСКя╝Ъца╣цНоч╝УхнШчЪДф╕Кф╕АцмбцХ░цНощЗНх╗║
  if (window.__last_report__) {
    const { pillars, percents, st, adv, tu } = window.__last_report__;
    // хЕИщЗНх╗║тАЬхЕНш┤╣цКехСК + чобхо╢хНбчЙЗтАЭ
    mountExtensionsIntoResult({ pillars, percents, st, adv, timeUnknown: tu });
    // хЖНщЗНх╗║тАЬхпМцКехСКтАЭ
    mountRichReport({ pillars, percents, st, adv, timeUnknown: tu });
    // цККчобхо╢хНбчЙЗчз╗хИ░тАЬхБех║╖тАЭхРОя╝ИхжВцЮЬф╜ацЬЙш┐Щф╕кф╜Нч╜ошжБц▒Вя╝Й
    if (typeof relocateButlerPanel === 'function') relocateButlerPanel();
  }
}    

/* ================== х┐ГцАЬчобхо╢я╝ИхИЖцЮРхЩия╜ЬхдЪшпншиАя╝Й ================== */
class XinLianAssistant{
  constructor(){ this.currentContext = null; }

  // х░Пх╖ехЕ╖я╝Ъф╕н/шЛ▒чнЙхИЖщЪФчмж
  _join(list){ const lang = (getLang()||'').toLowerCase(); return list.filter(Boolean).join(lang.startsWith('zh')?'уАБ':', '); }

  // х╝║х╝▒цаЗчн╛хдЪшпншиА
  _strengthLabel(m){
    const map = { 'хБПх╝║': t('strength_strong'), 'хБПх╝▒': t('strength_weak'), 'х╣│шбб': t('strength_balanced') };
    return map[m] || m;
  }

  // ф║ФшбМф╕ОцЦ╣ф╜НуАБщвЬшЙ▓хдЪшпншиА
  _EL(){ return {
    wood: t('el_wood'), fire: t('el_fire'), earth: t('el_earth'), metal: t('el_metal'), water: t('el_water')
  }; }
  _DIR(){ return {
    wood: t('dir_wood'), fire: t('dir_fire'), earth: t('dir_earth'), metal: t('dir_metal'), water: t('dir_water')
  }; }
  _COLOR(){ return {
    wood: t('color_wood'), fire: t('color_fire'), earth: t('color_earth'),
    metal: t('color_metal'), water: t('color_water')
  }; }

  generateAnalysis(baziData){
    this.currentContext = baziData;
    const a = $('assistant-analysis'), b = $('assistant-advice');
    if (a) a.innerHTML = this.analyzeBazi(baziData);
    if (b) b.innerHTML = this.generateAdvice(baziData);
  }

  analyzeBazi({dayMaster,elements,strength,season,timeUnknown}){
    const timeNote = timeUnknown
      ? `<li><strong>${t('note')}</strong>я╝Ъ${t('time_unknown_checked')}я╝М<strong>${t('hour_pillar_excluded')}</strong>уАВ</li>`
      : '';
    return `<ul class="ul">
      <li>${t('day_master')}я╝Ъ<strong>${dayMaster.stem}я╝И${dayMaster.element}я╝Й</strong></li>
      <li>${t('chart_strength')}<strong>${this._strengthLabel(strength.mark)}</strong>я╝Ъ${this.getStrengthDescription(strength.mark)}</li>
      <li>${t('season')}я╝Ъ<strong>${season}</strong>я╝М${this.getSeasonInfluence(season)}</li>
      <li>${t('wuxing_distribution')}я╝Ъ${this.getElementDistribution(elements)}</li>
      ${timeNote}
    </ul>`;
  }

  generateAdvice({strength,useful,timeUnknown}){
    const warn = timeUnknown ? `<li><strong>${t('hint')}</strong>я╝Ъ${t('no_hour_tip')}</li>` : '';
    const luckyColors = this.getLuckyColors(useful.useful||[]);
    const luckyDirs   = this.getLuckyDirections(useful.useful||[]);
    return `<ul class="ul">
      <li><strong>${t('dev_strategy')}</strong>${strength.focus}</li>
      <li><strong>${t('useful_elements')}</strong>${this._join(useful.useful||[])}</li>
      <li><strong>${t('lucky_colors')}</strong>${luckyColors}</li>
      <li><strong>${t('lucky_directions')}</strong>${luckyDirs}</li>
      ${warn}
    </ul>`;
  }

  // тАФтАФ цППш┐░&цШах░Дф╣ЯхБЪхдЪшпншиА
  getStrengthDescription(m){
    const map = {
      'хБПх╝║': t('desc_strong'),
      'хБПх╝▒': t('desc_weak'),
      'х╣│шбб': t('desc_balanced')
    };
    return map[m] || t('desc_generic');
  }

  getSeasonInfluence(season){
    const map = { 'цШе': t('season_spring'), 'хдП': t('season_summer'), 'чзЛ': t('season_autumn'), 'хЖм': t('season_winter') };
    return map[season] || t('season_generic');
  }

  getLuckyColors(list){
    const C = this._COLOR();
    const m = { 'цЬи': C.wood, 'чБл': C.fire, 'хЬЯ': C.earth, 'щЗС': C.metal, 'ц░┤': C.water };
    return this._join(list.map(x=>m[x]));
  }

  getLuckyDirections(list){
    const D = this._DIR();
    const m = { 'цЬи': D.wood, 'чБл': D.fire, 'хЬЯ': D.earth, 'щЗС': D.metal, 'ц░┤': D.water };
    return this._join(list.map(x=>m[x]));
  }

  ELABEL(){ return this._EL(); } // хЕ╝хо╣цЧзш░ГчФи

  getElementDistribution(elements){
    const L = this._EL();
    return Object.entries(elements)
      .sort((a,b)=>b[1]-a[1])
      .map(([k,v])=>`${L[k]||k}${Math.round(v)}%`)
      .join(this._join([]).replace(/./g,'' ) || 'уАБ'); // чФихРМшпншиАхИЖщЪФчмж
  }
}


  /* ================== хЕНш┤╣/хпМцКехСК ================== */
  function buildFreeReportHTML({pillars,percents,st,adv,timeUnknown}){
    const L={wood:'цЬи',fire:'чБл',earth:'хЬЯ',metal:'щЗС',water:'ц░┤'};
    const entries=Object.entries(percents); const strongestK=entries.reduce((a,b)=>a[1]>b[1]?a:b)[0]; const weakestK=entries.reduce((a,b)=>a[1]<b[1]?a:b)[0];
    const strongest=L[strongestK], weakest=L[weakestK]; const absents=Object.keys(percents).filter(k=>Math.round(percents[k])===0).map(k=>L[k]).join('уАБ');
    const fmt=k=>`${L[k]} ${Math.round(percents[k]||0)}%`; const line=['wood','fire','earth','metal','water'].map(fmt).join('уАА');
    const fav=(adv?.useful||[]).join('уАБ'); const avoid=(adv?.avoid||[]).join('уАБ')||'тАФ'; const hourTxt=timeUnknown?'я╝Яя╝Я':(pillars.hour.stem+pillars.hour.branch);
    return `<div class="xl-card" style="margin-top:12px;padding:16px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);">
      <h3 style="margin:0 0 8px;color:var(--brand)">хЕНш┤╣цКехСК</h3>
      <p style="margin:6px 0;">хЫЫцЯ▒я╝Ъ<strong>${pillars.year.stem}${pillars.year.branch} ${pillars.month.stem}${pillars.month.branch} ${pillars.day.stem}${pillars.day.branch} ${hourTxt}</strong></p>
      <p style="margin:6px 0;">цЧеф╕╗я╝Ъ<strong>${pillars.day.stem}</strong>я╝И<strong>${pillars.day.element}</strong>я╝Йя╜ЬхнгшКВя╝Ъ<strong>${st.season||'-'}</strong>я╜ЬхС╜х▒Ая╝Ъ<strong>${st.mark}</strong> ┬╖ <strong>${st.focus}</strong></p>
      <p style="margin:8px 0;">ф║ФшбМя╝Ъ${line}</p>
      <p style="margin:4px 0;"><strong>${strongest}</strong>хБПцЧ║я╝Ы<strong>${weakest}</strong>хБПх╝▒уАВ${absents?`<span class="muted">я╝Ич╝║я╝Ъ${absents}я╝Й</span>`:''}</p>
      <ul style="margin:6px 0 0 18px;line-height:1.6">
        <li>хЦЬчФиф╝ШхЕИя╝Ъ<strong>${fav||'тАФ'}</strong>я╝Ых┐Мшо│я╝Ъ${avoid}</li>
        <li>ш░ГшббшжБчВ╣я╝Ъ${st.focus}</li>
      </ul>
      ${timeUnknown?`<p class="muted" style="margin-top:6px;">цПРчд║я╝ЪцЧ╢щЧ┤ф╕Ншпжя╝МцЧ╢цЯ▒цЬкч║│хЕеуАВ</p>`:''}
    </div>`;
  }

  function buildRichReportHTML({pillars,percents,st,adv,timeUnknown}){
    const L={wood:'цЬи',fire:'чБл',earth:'хЬЯ',metal:'щЗС',water:'ц░┤'}; const P=pillars;
    const line=['wood','fire','earth','metal','water'].map(k=>`${L[k]}${Math.round(percents[k]||0)}%`).join(' ');
    const entries=Object.entries(percents); const strongestK=entries.reduce((a,b)=>a[1]>b[1]?a:b, ['wood',0])[0]; const weakestK=entries.reduce((a,b)=>a[1]<b[1]?a:b, ['wood',0])[0];
    const strongest=L[strongestK]||'тАФ', weakest=L[weakestK]||'тАФ'; const absents=Object.keys(percents).filter(k=>Math.round(percents[k]||0)===0).map(k=>L[k]).join('уАБ');
    const favList=(adv?.useful||[]).join('уАБ')||'тАФ', avoidList=(adv?.avoid||[]).join('уАБ')||'тАФ'; const hourTxt=timeUnknown?'я╝Яя╝Я':(P.hour.stem+P.hour.branch);
    return `
      <section class="card" style="padding:20px;">
        <h3 style="margin-top:0;color:var(--brand)">ф╕АуАБхС╜чЫШцА╗шзИ</h3>
        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;font-size:14px;">
          <div>хЫЫцЯ▒я╝Ъ<strong>${P.year.stem}${P.year.branch} ${P.month.stem}${P.month.branch} ${P.day.stem}${P.day.branch} ${hourTxt}</strong></div>
          <div>цЧеф╕╗я╝Ъ<strong>${P.day.stem}</strong>я╝И<strong>${P.day.element}</strong>я╝Й</div>
          <div>хнгшКВя╝Ъ<strong>${st.season||'-'}</strong></div>
          <div>хС╜х▒Ая╝Ъ<strong>${st.mark}</strong> ┬╖ чнЦчХея╝Ъ<strong>${st.focus}</strong></div>
        </div>
      </section>
    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф║МуАБф║ФшбМшГ╜щЗПхИЖцЮР</h3>
      <div style="font-size:14px;">${line}</div>
      <p style="margin:10px 0 0;"><strong>${strongest}</strong>хБПцЧ║я╝Ы<strong>${weakest}</strong>хБПх╝▒уАВ${absents?`<span class="muted">я╝Ич╝║я╝Ъ${absents}я╝Й</span>`:''}</p>
      <ul style="margin:10px 0 0 18px;line-height:1.6">
        <li>хЦЬчФиф╝ШхЕИя╝Ъ<strong>${favList}</strong></li>
        <li>ш░ГшббшжБчВ╣я╝Ъ${st.focus}</li>
      </ul>
      ${timeUnknown?`<p class="muted" style="margin-top:8px;">цПРчд║я╝ЪхЗ║чФЯцЧ╢щЧ┤ф╕Ншпжя╝МцЬкч║│хЕецЧ╢цЯ▒уАВ</p>`:''}
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф╕ЙуАБцАзца╝ф╕Охдйш╡Л</h3>
      <p style="margin:8px 0;">ф╛ЭцНоцЧеф╕╗уАБхнгшКВф╕Ох╝║х╝▒ч╗ЩхЗ║ца╕х┐ГцАзца╝цаЗчн╛я╝ИцибцЭ┐хМЦя╝ЙуАВ</p>
      <p style="margin:8px 0;">ф╝ШхК┐шГ╜щЗПя╝ЪцЙзшбМ/хИЫщАа/хнжф╣ая╝ИцибцЭ┐хМЦя╝Й</p>
      <p style="margin:8px 0;">ц╜ЬхЬицМСцИШя╝ЪцАеш║Б/ш╛╣чХМя╝ИцибцЭ┐хМЦя╝Й</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">хЫЫуАБца╝х▒Аф╕ОхЦЬх┐М</h3>
      <p style="margin:8px 0;">хЦЬчФия╝Ъ${favList}я╝Ых┐Мшо│я╝Ъ${avoidList}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф║ФуАБф║Лф╕Ъф╕ОхПСх▒Хя╝ИхЕНш┤╣шпХшп╗я╝Й</h3>
      <p style="margin:8px 0;">щАВхРИщвЖхЯЯя╝Ъф╛ЭцНохЦЬчФиф╕ОцЧеф╕╗ц░Фш┤ия╝ИцибцЭ┐хМЦя╝Й</p>
      <p style="margin:8px 0;">хПСх▒ХчнЦчХея╝Ъ${st.focus}я╝Мх╗║члЛ SOP</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">хЕнуАБцДЯцГЕф╕ОхЕ│ч│╗я╝ИхЕНш┤╣шпХшп╗я╝Й</h3>
      <p style="margin:8px 0;">ц▓ЯщАЪшКВхеПф╕Ош╛╣чХМя╝ИцибцЭ┐хМЦя╝Й</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф╕ГуАБш┤вхпМф╕ОчРЖш┤вя╝ИхЕНш┤╣шпХшп╗я╝Й</h3>
      <p style="margin:8px 0;">чРЖш┤вх╗║шооя╝Ъф╗е ${favList} ф╕║ф╕╗ш░Гя╝Мчи│ф╕нц▒Вш┐Ы</p>
    </section>

    <!-- хЕлуАБхБех║╖ф╕Оф╜ЬцБп -->
    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">хЕлуАБхБех║╖ф╕Оф╜ЬцБп</h3>
      <p style="margin:8px 0;">цМЙцЬАх╝▒ф║ФшбМя╝И${weakest}я╝ЙхИ╢хоЪф╜ЬцБпя╝ИцибцЭ┐хМЦя╝Й</p>
    </section>

    <!-- ф╣ЭуАБчОпхвГф╕ОшЙ▓х╜йя╝ИцМкхИ░чобхо╢ф╣ЛхЙНя╝Й -->
    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф╣ЭуАБчОпхвГф╕ОшЙ▓х╜й</h3>
      <p style="margin:8px 0;">цЬЙхИйцЦ╣ф╜Нф╕ОщЕНшЙ▓щЪПхЦЬчФия╝ИцибцЭ┐хМЦя╝Й</p>
    </section>

    <!-- Butler цПТхЕеф╜Нч╜оя╝ЪчОпхвГшКВхРОя╝Ихп╣цНвф╜Нч╜охРОщФЪчВ╣цФ╛хЬиш┐ЩщЗМя╝Й -->
    <div id="butler-anchor"></div>
  `;
}

function buildRichReportHTML({pillars,percents,st,adv,timeUnknown}){
  const L={wood:'цЬи',fire:'чБл',earth:'хЬЯ',metal:'щЗС',water:'ц░┤'}; 
  const P=pillars;
  const line=['wood','fire','earth','metal','water'].map(k=>`${L[k]}${Math.round(percents[k]||0)}%`).join(' ');
  const entries=Object.entries(percents);
  const strongestK=entries.reduce((a,b)=>a[1]>b[1]?a:b, ['wood',0])[0];
  const weakestK  =entries.reduce((a,b)=>a[1]<b[1]?a:b, ['wood',0])[0];
  const strongest=L[strongestK]||'тАФ', weakest=L[weakestK]||'тАФ';
  const absents=Object.keys(percents).filter(k=>Math.round(percents[k]||0)===0).map(k=>L[k]).join('уАБ');
  const favList=(adv?.useful||[]).join('уАБ')||'тАФ', avoidList=(adv?.avoid||[]).join('уАБ')||'тАФ';
  const hourTxt=timeUnknown?'я╝Яя╝Я':(P.hour.stem+P.hour.branch);

  return `
    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">ф╕АуАБхС╜чЫШцА╗шзИ</h3>
      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;font-size:14px;">
        <div>хЫЫцЯ▒я╝Ъ<strong>${P.year.stem}${P.year.branch} ${P.month.stem}${P.month.branch} ${P.day.stem}${P.day.branch} ${hourTxt}</strong></div>
        <div>цЧеф╕╗я╝Ъ<strong>${P.day.stem}</strong>я╝И<strong>${P.day.element}</strong>я╝Й</div>
        <div>хнгшКВя╝Ъ<strong>${st.season||'-'}</strong></div>
        <div>хС╜х▒Ая╝Ъ<strong>${st.mark}</strong> ┬╖ чнЦчХея╝Ъ<strong>${st.focus}</strong></div>
      </div>
    </section>

/* ================== чобхо╢хНбчЙЗя╝ИцФпцМБхдЪшпншиАя╝Й ================== */
function buildButlerHTML(){
  return `
    <div id="assistant-panel" class="xl-card"
         style="margin-top:12px;padding:16px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);">
      <h3 class="butler-title" style="margin:0 0 8px;color:var(--brand)"
          data-i18n="butler_title">${t('butler_title')}</h3>
      <div id="assistant-analysis"></div>
      <div id="assistant-advice" style="margin-top:8px"></div>
    </div>`;
}

  function buildChatDrawerHTML(){
    return `<details id="gpt-drawer" class="xl-card" style="margin-top:12px;padding:0;border-radius:10px;background:var(--card);box-shadow:var(--shadow);">
      <summary style="cursor:pointer;list-style:none;padding:12px 16px;font-weight:700;color:var(--brand);">GPT щЧочнФ</summary>
      <div style="padding:10px 12px;">
        <div id="gpt-body" style="max-height:260px;overflow:auto;font-size:14px;line-height:1.5;border:1px solid #222;border-radius:8px;padding:8px;"></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <input id="gpt-input" placeholder="щЧочВ╣ф╗Аф╣ИтАж" style="flex:1;padding:8px;border-radius:8px;border:1px solid #222;background:#0b0f14;color:var(--text)">
          <button id="gpt-send" style="padding:8px 12px;border-radius:8px;background:var(--brand);color:#111;font-weight:700">хПСщАБ</button>
        </div>
      </div>
    </details>`;
  }
  async function callChatAPI(userText,ctx){
    const payload={messages:[{role:'user',content:userText}],context:ctx};
    async function post(url){ try{ const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); if(r.ok){ const t=await r.text(); try{ const j=JSON.parse(t); return j.reply||t||'я╝ИцЧахУНх║Фя╝Й'; }catch{return t||'я╝ИцЧахУНх║Фя╝Й'; } } }catch(_){} return null; }
    return await post('/api/butler/chat') || await post('/api/chat') || 'я╝ИцЪВцЧ╢цЧац│Хш┐ЮцОехИ░цЬНхКбчлпя╝Й';
  }
function mountExtensionsIntoResult({pillars, percents, st, adv, timeUnknown}){
  const resultEl = $('result');
  if (!resultEl) return;

  let freeNode = $('xl-free-report');
  if (!freeNode) {
    freeNode = document.createElement('div');
    freeNode.id = 'xl-free-report';
    resultEl.appendChild(freeNode);
  }
  freeNode.innerHTML = buildFreeReportHTML({pillars, percents, st, adv, timeUnknown});

  let butler = $('assistant-panel');
  if (!butler) {
    const wrap = document.createElement('div');
    wrap.innerHTML = buildButlerHTML();
    resultEl.appendChild(wrap.firstElementChild);
    applyI18n();
  }

// тАФтАФ хЕих▒Ая╝ЪцККчобхо╢хНбчЙЗчз╗хКихИ░щФЪчВ╣я╝И#butler-anchorя╝Йф╣ЛхРО
function relocateButlerPanel(){
  const panel  = document.getElementById('assistant-panel');
  const anchor = document.getElementById('butler-anchor');
  if (panel && anchor && anchor.parentNode){
    anchor.parentNode.insertBefore(panel, anchor.nextSibling);
  }
}

 /* ================== чФЯцИРхС╜чЫШ ================== */
async function genChart(){
  const birth = ($('birthdate')?.value || '').trim();
  const timeUnknown = $('timeUnknown')?.checked || false;
  if (!birth){ showErr('шп╖хблхЖЩхЗ║чФЯцЧецЬЯуАВ'); return; }

  const btn=$('genBtn'), tx=$('genBtnText'), ld=$('genBtnLoading');
  if(btn) btn.disabled = true;
  if(tx) tx.style.display = 'none';
  if(ld) ld.style.display = 'inline-block';

  try{
    const [Y,M,D] = birth.split('-').map(Number);
    let hour = 12;
    if (!timeUnknown){
      const t = ($('birthtime')?.value || '').trim();
      if (t){
        const h = parseInt(t.split(':')[0], 10);
        if (!Number.isNaN(h)) hour = h;
      }
    }

    const { pillars, counts, percents, timeUnknown: tu } =
      baziCalculator.calculateBazi(Y, M, D, hour, timeUnknown);

    $('result')?.style.setProperty('display','block');
    const timeText = tu ? 'цЧ╢щЧ┤ф╕Ншпж' : (hour + 'цЧ╢');
    setText('bazi-date', `хЗ║чФЯцЧецЬЯ: ${Y}х╣┤${M}цЬИ${D}цЧе ${timeText}`);
    if (tu){ const el=$('bazi-date'); if(el) el.innerHTML += ' <span class="badge-warn">цЬкч║│хЕецЧ╢цЯ▒</span>'; }

    renderPillars($('bazi-pillars'), pillars, tu);
    displayClassicArea(pillars, tu);

    setBar($('bar-цЬи'), percents.wood);  setText('pct-цЬи',  Math.round(percents.wood)  + '%');
    setBar($('bar-чБл'), percents.fire);  setText('pct-чБл',  Math.round(percents.fire)  + '%');
    setBar($('bar-хЬЯ'), percents.earth); setText('pct-хЬЯ',  Math.round(percents.earth) + '%');
    setBar($('bar-щЗС'), percents.metal); setText('pct-щЗС',  Math.round(percents.metal) + '%');
    setBar($('bar-ц░┤'), percents.water); setText('pct-ц░┤',  Math.round(percents.water) + '%');

    const st  = judgeStrength(pillars.day.stem, pillars.month.branch, counts);
    const adv = chooseUseful(st.mark, pillars.day.element);

    const keys = Object.keys(counts);
    const maxK = keys.reduce((a,b)=>counts[a]>counts[b]?a:b);
    const minK = keys.reduce((a,b)=>counts[a]<counts[b]?a:b);
    setText('bazi-elements-balance', `ф║ФшбМф╕н${maxK}хЕГч┤ацЬАх╝║я╝М${minK}хЕГч┤ацЬАх╝▒уАВ`);

    // ф╛ЫшпншиАхИЗцНвцЧ╢щЗНц╕▓цЯУ
    window.__last_report__ = { pillars, percents, st, adv, tu };

    // цЙйх▒Х&хпМцКехСКя╝ИхПкш░Гф╕Ацмбя╝Й
    mountExtensionsIntoResult({ pillars, percents, st, adv, timeUnknown: tu });
    if (typeof mountRichReport === 'function') {
      mountRichReport({ pillars, percents, st, adv, timeUnknown: tu });
    }

    console.log(
      'хоЮщЩЕ тЖТ',
      pillars.year.stem+pillars.year.branch,
      pillars.month.stem+pillars.month.branch,
      pillars.day.stem+pillars.day.branch,
      tu ? 'я╝Я' : (pillars.hour.stem+pillars.hour.branch)
    );
  } catch (err){
    console.error(err);
    showErr('шобчоЧхЕлхнЧцЧ╢хЗ║чО░щФЩшппя╝Мшп╖щЗНшпХ');
  } finally {
    if(btn) btn.disabled = false;
    if(tx)  tx.style.display = 'inline';
    if(ld)  ld.style.display = 'none';
  }
}
function mountRichReport({ pillars, percents, st, adv, timeUnknown }) {
  let host = document.getElementById('rich-report');
  if (!host) {
    host = document.createElement('div');
    host.id = 'rich-report';
    const result = document.getElementById('result');
    if (result) result.appendChild(host);
  }
  host.innerHTML = buildRichReportHTML({ pillars, percents, st, adv, timeUnknown });
  // хПпщАЙя╝ЪцККчобхо╢щЭвцЭ┐чз╗хКихИ░щФЪчВ╣хРО
  if (typeof relocateButlerPanel === 'function') relocateButlerPanel();
}

  /* ================== Chat цВмц╡очРГ ================== */
  document.addEventListener('DOMContentLoaded', ()=>{
    // Chat ц╡очкЧя╝ИцМЙщТо+щЭвцЭ┐я╝Й
    const chatFab=document.createElement('div'); chatFab.className='ss-chat-fab'; chatFab.id='ssChatFab'; chatFab.title='х┐ГцАЬчобхо╢';
    const chatPanel=document.createElement('div'); chatPanel.className='ss-chat-panel'; chatPanel.id='ssChatPanel'; chatPanel.setAttribute('role','dialog'); chatPanel.setAttribute('aria-label','х┐ГцАЬчобхо╢');
    chatPanel.innerHTML = `
      <div class="ss-chat-head"><div class="ss-chat-title">х┐ГцАЬчобхо╢ ┬╖ Chat</div><div class="ss-close" id="ssChatClose">тЬХ</div></div>
      <div class="ss-chat-body" id="ssChatBody" aria-live="polite"></div>
      <div class="ss-chat-input"><input id="ssChatInput" type="text" placeholder="${t('chat_placeholder')}"/><button id="ssChatSend" class="btn">${t('chat_send')}</button></div>`;
    document.body.appendChild(chatFab); document.body.appendChild(chatPanel);
    applyChatI18n();

    const $body=$('ssChatBody'), $input=$('ssChatInput'), $send=$('ssChatSend'), $close=$('ssChatClose');
    const openPanel=()=>{ chatPanel.style.display='block'; $input&&$input.focus(); }; const closePanel=()=>{ chatPanel.style.display='none'; };
    chatFab.addEventListener('click',openPanel); $close&&$close.addEventListener('click',closePanel);

    function addMsg(text,me=false){ const div=document.createElement('div'); div.className='ss-msg'+(me?' me':''); div.textContent=text; $body.appendChild(div); $body.scrollTop=$body.scrollHeight; }
    async function askChat(prompt){
      addMsg(prompt,true); if($input){ $input.value=''; $input.focus(); }
      try{
        const r=await fetch(`${API_BASE}/api/chat`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'system',content:'ф╜ацШптАЬх┐ГцАЬчобхо╢тАЭя╝Мх╕охКйшо┐ховф║ЖшзгхС╜чРЖх┐ГцАЬчй║щЧ┤чЪДхКЯшГ╜уАБхп╝шИкф╕Оф╝ЪхСШшп┤цШОя╝Мшпнц░Фц╕йцЪЦф╕Уф╕ЪуАБчоАц┤БцЬЙцЭбчРЖуАВ'},{role:'user',content:prompt}]})});
        let data,reply=''; try{data=await r.json()}catch{data={}} reply=data.reply??data.text??data?.choices?.[0]?.message?.content??"";
        if(!reply) return addMsg('цК▒цнЙя╝МцЬНхКбцЪВцЧ╢ч╣Бх┐Щя╝Мшп╖чиНхРОщЗНшпХуАВ'); addMsg(reply);
      }catch(e){ addMsg('ч╜Сч╗Ьх╝Вх╕╕я╝Мшп╖чиНхРОхЖНшпХуАВ'); }
    }
    $send&&$send.addEventListener('click',()=>{ const v=$input?.value.trim(); if(v) askChat(v); });
    $input&&$input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ const v=$input.value.trim(); if(v) askChat(v); }});
  });

  /* ================== ф╝░цЧ╢щЧ┤хРСхп╝я╝Иф╗ЕхЛ╛щАЙф╕НшпжцЧ╢шзжхПСя╝Й ================== */
  (function initBirthtimeWizard(){
    const tChk=$('timeUnknown'), tInput=$('birthtime'), btn=$('guessTimeBtn');
    const twMask=$('twMask'), twGrid=$('twGrid'), twApply=$('twApply'), twCancel=$('twCancel');
    if(!tInput||!tChk||!twMask||!twGrid||!twApply||!twCancel) return;

    const DZ=[
      ['хнР','23:00тАУ01:00','00:00'],['ф╕С','01:00тАУ03:00','02:00'],['хпЕ','03:00тАУ05:00','04:00'],['хНп','05:00тАУ07:00','06:00'],
      ['ш╛░','07:00тАУ09:00','08:00'],['х╖│','09:00тАУ11:00','10:00'],['хНИ','11:00тАУ13:00','12:00'],['цЬк','13:00тАУ15:00','14:00'],
      ['чФ│','15:00тАУ17:00','16:00'],['щЕЙ','17:00тАУ19:00','18:00'],['цИМ','19:00тАУ21:00','20:00'],['ф║е','21:00тАУ23:00','22:00']
    ];
    let selected=null;

    function openWizard(){
      twMask.style.display='flex'; selected=null; twApply.disabled=true;
      if(!twGrid.dataset.built){
        DZ.forEach(([z,range])=>{
          const b=document.createElement('button'); b.type='button'; b.className='tw-btn'; b.textContent=`${z}я╝И${range}я╝Й`;
          b.addEventListener('click',()=>{ [...twGrid.children].forEach(x=>x.classList.remove('active')); b.classList.add('active'); selected=z; twApply.disabled=false;});
          twGrid.appendChild(b);
        }); twGrid.dataset.built='1';
      }else{ [...twGrid.children].forEach(x=>x.classList.remove('active')); }
    }
    function closeWizard(){ twMask.style.display='none'; }

    // ф╗Ех╜УхЛ╛щАЙтАЬф╕НшпжтАЭцЧ╢шЗкхКих╝╣хЗ║я╝ЫхПЦц╢ИхЛ╛щАЙхИЩхЕ│щЧн
    tChk.addEventListener('change', ()=>{ tInput.disabled=tChk.checked; if(tChk.checked) openWizard(); else closeWizard(); });

    // я╝ИцМЙщТошвлщЪРшЧПя╝Мф╜Жф┐ЭчХЩхЕ╝хо╣я╝ЪшЛехнШхЬиф╗НхПпцЙУх╝Ая╝Й
    btn && btn.addEventListener('click', openWizard);

    twCancel.addEventListener('click', closeWizard);
    twApply.addEventListener('click', ()=>{
      if(!selected) return;
      const mid=Object.fromEntries(DZ.map(([z,_,m])=>[z,m]))[selected];
      tInput.value=mid; tInput.disabled=false; tChk.checked=false; closeWizard();
    });

    tInput.disabled=tChk.checked;
  })();

  /* ================== чЩ╗х╜Хц╡БчиЛ ================== */
  async function safeJson(resp){ try{return await resp.json()}catch{return{ok:false,msg:'upstream_error'}} }
  async function loginFlow(email,password){
    const res=await safeJson(await fetch(`${API_BASE}/api/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})}));
    const msg=(res.msg||"").toString().toLowerCase(); let expired=false;
    if(res.expired===true) expired=true; else if(msg==='expired') expired=true; else if(res.expiresAt){ const ts=Date.parse(res.expiresAt); if(!Number.isNaN(ts)&&ts<Date.now()) expired=true; }
    if(expired){ const go=confirm(t('err_expired')+'уАВцШпхРжхЙНх╛Ач╗нш┤╣я╝Я'); if(go) window.open('https://yourshopifyshop.com/products/monthly-vip','_blank'); return; }
    if(res.ok===true){ localStorage.setItem('vipEmail',res.email||email); location.href='https://astro.5xliving.com/vip_soul_sanctuary.html'; return; }
    if(msg==='no_account') return showAuthErr(t('err_no_account'));
    if(msg==='wrong_pwd') return showAuthErr(t('err_wrong_pwd'));
    return showAuthErr(t('err_login_fail')+(res.msg?` ${res.msg}`:''));
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    // щ╗ШшодцЧецЬЯ
    const today=new Date(); const def=today.toISOString().split('T')[0]; if($('birthdate')&&!$('birthdate').value) $('birthdate').value=def;
    $('genBtn')?.addEventListener('click',genChart);

    // i18n
    const select=$("langSelect"); const current=getLang(); if(select) select.value=current; applyI18n(); applyChatI18n();
    if(select){ select.addEventListener('change', ()=>{ setLang(select.value); applyI18n(); applyChatI18n(); }); }

    // ц│ихЖМ
    $('registerForm')?.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideAuthErr();
      const email=$('email').value.trim(); const password=$('password').value.trim();
      if(!email||!password) return showAuthErr(t('err_need_ep'));
      if(!strongPwd(password)) return showAuthErr(t('err_pwd_rule'));
      lock($('registerBtn'),true);
      try{
        const res=await safeJson(await fetch(`${API_BASE}/api/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})}));
        if(res.ok===true){ localStorage.setItem('vipEmail',email); location.href='vip_trial.html'; return; }
        if((res.msg||"").toString()==='exists'){ await loginFlow(email,password); return; }
        return showAuthErr((res.msg&&(res.msg+''))||t('err_register_fail'));
      }catch(err){ showAuthErr(t('err_register_fail')+(err?.message||'')); }
      finally{ lock($('registerBtn'),false); }
    });

    // чЩ╗х╜Х
    $('loginForm')?.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideAuthErr();
      const email=$('email').value.trim(); const password=$('password').value.trim();
      if(!email||!password) return showAuthErr(t('err_need_ep'));
      lock($('loginBtn'),true);
      try{ await loginFlow(email,password); }
      catch(err){ showAuthErr(t('err_login_fail')+(err?.message||'')); }
      finally{ lock($('loginBtn'),false); }
    });

    // щЗНшо╛хпЖчаБ
    $('resetBtn')?.addEventListener('click', async ()=>{
      hideAuthErr();
      let email=prompt(t('prompt_email')); if(email===null) return; email=email.trim(); if(!email) return showAuthErr(t('err_email_empty'));
      let newPassword=prompt(t('prompt_newpwd')); if(newPassword===null) return; newPassword=newPassword.trim(); if(!newPassword) return showAuthErr(t('err_pwd_empty'));
      if(!strongPwd(newPassword)) return showAuthErr(t('err_pwd_rule'));
      lock($('resetBtn'),true);
      try{
        const res=await safeJson(await fetch(`${API_BASE}/api/reset`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,newPassword})}));
        if(!res.ok) return showAuthErr((res.msg&&(res.msg+''))||t('err_reset_fail'));
        alert(t('msg_reset_ok'));
      }catch(err){ showAuthErr(t('err_reset_fail')+(err?.message||'')); }
      finally{ lock($('resetBtn'),false); }
    });
  });

  /* ================== шЗкц╡Ля╝Ъ1978-02-21 12:00 тЖТ цИКхНИ чФ▓хпЕ чФ▓хпЕ х║ЪхНИ ================== */
  (function(){
    const c=new BaziCalculator(); const Y=c.calculateYearPillar(1978); const M=c.calculateMonthPillar(1978,2,21); const D=c.calculateDayPillar(1978,2,21); const H=c.calculateHourPillar(D.stem,12);
    console.log('х║Фф╕║ тЖТ х╣┤ цИКхНИя╜ЬцЬИ чФ▓хпЕя╜ЬцЧе чФ▓хпЕя╜ЬцЧ╢ х║ЪхНИ');
    console.log('хоЮщЩЕ тЖТ', Y.stem+Y.branch, M.stem+M.branch, D.stem+D.branch, H.stem+H.branch);
  })();
  </script>
</body>
</html>
