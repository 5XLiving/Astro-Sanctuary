
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· 5XLiving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:16px}
    .title{font-family:"Noto Serif SC",serif;font-weight:700;letter-spacing:.02em}
    .subtitle{color:var(--muted);font-size:.9rem}
    .lang{display:flex;align-items:center;gap:8px}
    .lang select{
      appearance:none;border-radius:10px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:10px 34px 10px 12px;font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat;background-position:calc(100% - 12px) 50%;
    }

    .section{margin-top:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .h2{font-size:1.2rem;margin:0 0 12px;font-weight:800;color:#ffe084;display:flex;gap:8px;align-items:center}
    .h2::before{content:"";width:4px;height:18px;background:var(--brand);border-radius:2px}

    .row{display:grid;gap:12px}
    @media(min-width:760px){.row.cols-3{grid-template-columns:1fr 1fr 1fr}.row.cols-2{grid-template-columns:1fr 1fr}}

    input,select,button{
      width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:12px 12px;font-size:15px;outline:none;
    }
    input::placeholder{color:#6f8092}
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}
    .btn.block{display:block;width:100%}

    .pillars{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .pillar{background:#0f1624;border:1px solid #253245;border-radius:12px;padding:14px 10px;text-align:center}
    .pillar .tit{color:#9aa3b2;font-size:.85rem;margin-bottom:6px}
    .pillar .gz{font-size:1.5rem;font-weight:800;color:var(--gold2)}

    .bazi-table{width:100%;border-collapse:collapse;margin-top:12px;background:#0f1624;border-radius:8px;overflow:hidden}
    .bazi-table th,.bazi-table td{padding:10px 12px;border:1px solid #253245;text-align:center}
    .bazi-table th{background:rgba(212,175,55,.1);color:var(--gold2)}

    .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0}
    .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
    .error-message{background:rgba(255,90,95,.1);border:1px solid #ff5a5f;border-radius:8px;padding:10px;display:none}
    .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
    .muted{color:var(--muted)}

    /* â€”â€” å‡ºç”Ÿæ—¶é—´ï¼šæ—¶é—´è¾“å…¥ + â€œä¸è¯¦â€åŒä¸€è¡Œ â€”â€” */
    .time-row{display:flex;align-items:center;gap:10px}
    .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
    .btn-mini{padding:8px 10px;border-radius:10px}
    /* â€”â€” éšè—â€œä¼°æ—¶é—´â€æŒ‰é’®ï¼šä»…å‹¾é€‰ä¸è¯¦æ—¶å¼¹çª— â€”â€” */
    #guessTimeBtn{display:none !important; visibility:hidden !important;}

    /* â€”â€” å³ä¸‹è§’å¿ƒæ€œç®¡å®¶ï¼ˆé—®ï¼‰ â€”â€” */
    .ss-chat-fab{
      position:fixed;right:18px;bottom:18px;z-index:50;width:56px;height:56px;border-radius:50%;
      background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;display:grid;place-items:center;font-weight:800;
      box-shadow:0 8px 30px rgba(0,0,0,.35);cursor:pointer;border:1px solid #e6c76e
    }
    .ss-chat-panel{
      position:fixed;right:18px;bottom:88px;z-index:50;width:min(460px,92vw);display:none;
      background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)
    }
    .ss-chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #243244}
    .ss-chat-title{font-weight:700}
    .ss-close{cursor:pointer;opacity:.8}
    .ss-chat-body{max-height:300px;overflow:auto;padding:10px 12px}
    .ss-msg{padding:8px 10px;background:#0f1624;border:1px solid #243244;border-radius:10px;margin:6px 0;max-width:80%}
    .ss-msg.me{margin-left:auto;background:#132033}
    .ss-chat-input{display:flex;gap:8px;padding:10px 12px;border-top:1px solid #243244}
    .ss-chat-input input{flex:1}

    /* â€”â€” ä¼šå‘˜åŒºå¸ƒå±€ â€”â€” */
    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}
    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}

    /* â€”â€” åªä¿ç•™ä¸€ä¸ª GPT çª—å£ï¼šéšè—ç»“æœåŒºçš„ GPT æŠ½å±‰ â€”â€” */
    #gpt-drawer, #gpt-drawer[hidden], #gpt-drawer>summary{display:none !important}

    /* â€”â€” ä¼°æ—¶é—´å¼¹çª— â€”â€” */
    .tw-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:60}
    .tw-box{width:min(560px,94vw);background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)}
    .tw-head{padding:12px 14px;border-bottom:1px solid #243244;font-weight:700}
    .tw-body{padding:14px}
    .tw-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .tw-btn{padding:10px;border:1px solid #243244;border-radius:12px;background:#0f1624;color:var(--text);cursor:pointer}
    .tw-btn.active{border-color:var(--gold2);box-shadow:0 0 0 2px rgba(212,175,55,.25) inset}
    .tw-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #243244}
    /* ä¿®å¤ï¼šGrid å­é¡¹å…è®¸æ”¶ç¼©ï¼Œé¿å…å†…å®¹æŠŠé¢æ¿æ’‘ç ´ */
.auth-grid > * { min-width: 0; }
.panel .body .row.one > * { min-width: 0; }

/* è®©ä¼šå‘˜æŒ‰é’®åœ¨çª„å®½åº¦ä¸‹èƒ½æ¢è¡Œã€å±…ä¸­ä¸”ä¸æº¢å‡º */
.panel .body .btn {
  display: flex;               /* æ”¹ä¸º flex æ›´ç¨³ */
  align-items: center;
  justify-content: center;
  text-align: center;
  white-space: normal;         /* å…è®¸æ¢è¡Œ */
  line-height: 1.2;
  word-break: break-word;      /* å¤šè¯­è¨€/é•¿è¯å¯æ–­è¡Œ */
}

/* å—çº§æŒ‰é’®ç¡®ä¿å æ»¡å®¹å™¨ä¸”ä¸è¶…å‡º */
.btn.block { display:block; width:100%; box-sizing:border-box; }

/* å¯é€‰ï¼šå¦‚æœä»æœ‰è½»å¾®ä½ç§»ï¼Œé™åˆ¶æº¢å‡º */
.panel .body { overflow: hidden; }

.panel .body .btn { padding: 10px 14px; }    
  </style>
</head>
<body>
  <header>
    <div class="head-inner container">
      <div class="title">å‘½ç†ä¾›é—¨ Â· å…«å­—ç®€è¯„</div>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="h2">5xLiving Â· å¿«é€Ÿæ’ç›˜</div>

      <div class="row cols-3">
        <div>
          <label class="muted">å§“åï¼ˆå¯é€‰ï¼‰</label>
          <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰">
        </div>
        <div>
          <label class="muted">æ€§åˆ«</label>
          <select id="gender">
            <option value="">ä¸é€éœ²</option>
            <option value="male">ç”·æ€§</option>
            <option value="female">å¥³æ€§</option>
          </select>
        </div>
        <div>
          <label class="muted">å†æ³•</label>
          <select id="calendar">
            <option value="gregorian">é˜³å† / Gregorian</option>
            <option value="lunar">å†œå† / Lunar</option>
          </select>
        </div>
      </div>

      <div class="row cols-3" style="margin-top:10px">
        <div>
          <label class="muted">å‡ºç”Ÿæ—¥æœŸ</label>
          <input type="date" id="birthdate">
        </div>
        <div>
          <label class="muted">å‡ºç”Ÿæ—¶é—´</label>
          <div class="time-row">
            <input type="time" id="birthtime" value="12:00">
            <label class="muted time-unknown"><input type="checkbox" id="timeUnknown"> å‡ºç”Ÿæ—¶é—´ä¸è¯¦</label>
            <!-- è§¦å‘æŒ‰é’®å·²éšè—ï¼Œä»…ä¿ç•™ä»¥å…¼å®¹è„šæœ¬ -->
            <button class="btn btn-mini ghost" id="guessTimeBtn" type="button" title="ç”¨å°æµ‹è¯•ä¼°ä¸€ä¸‹æ—¶é—´">ğŸ§­ ä¼°æ—¶é—´</button>
          </div>
        </div>
        <div style="display:flex;align-items:flex-end">
          <button class="btn" id="genBtn">
            <span id="genBtnText">ç”Ÿæˆå…«å­—</span>
            <span id="genBtnLoading" style="display:none">è®¡ç®—ä¸­...</span>
          </button>
        </div>
      </div>

      <div id="error" class="error-message"></div>
    </section>

    <section id="result" style="display:none;">
      <div class="card">
        <div class="h2">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
        <div class="pillars" id="bazi-pillars"></div>
        <div class="muted" id="bazi-date" style="margin-top:6px"></div>

        <table class="bazi-table">
          <thead><tr><th></th><th>å¹´æŸ±</th><th>æœˆæŸ±</th><th>æ—¥æŸ±</th><th>æ—¶æŸ±</th></tr></thead>
          <tbody>
            <tr><td>å¤©å¹²</td><td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td></tr>
            <tr><td>åœ°æ”¯</td><td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td></tr>
            <tr><td>äº”è¡Œ</td><td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td></tr>
            <tr><td>çº³éŸ³</td><td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td></tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="h2">äº”è¡Œèƒ½é‡åˆ†æ</div>
        <div class="bar-row"><span>æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
        <div class="bar-row"><span>ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
        <div class="bar-row"><span>åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
        <div class="bar-row"><span>é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
        <div class="bar-row"><span>æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
        <div id="bazi-elements-balance" class="muted" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- ä¼šå‘˜ä¸“åŒº -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- å·¦ä¾§ï¼šè¾“å…¥ + æ³¨å†Œ/ç™»å½• -->
          <div class="panel">
            <div class="head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
            <div class="body">
              <div class="row" id="authFields">
                <label for="email" class="sr-only">Email</label>
                <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="é‚®ç®± Email" data-i18n-ph="ph_email" required/>
                <input id="password" type="password" autocomplete="new-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" data-i18n-ph="ph_password" required/>
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
                <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- å³ä¾§ï¼šä¼šå‘˜ä¸è¿”å› -->
          <div class="panel">
            <div class="head">ä¼šå‘˜æœåŠ¡</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
  </main>

  <!-- ä¼°æ—¶é—´å¼¹çª— -->
  <div class="tw-mask" id="twMask" aria-hidden="true">
    <div class="tw-box" role="dialog" aria-modal="true" aria-labelledby="twTitle">
      <div class="tw-head" id="twTitle">ğŸ§­ ä¼°ä¸€ä¸ªå¤§è‡´å‡ºç”Ÿæ—¶é—´</div>
      <div class="tw-body">
        <div class="muted" style="margin-bottom:8px">é€‰æ‹©ä½ è®°å¾—çš„<strong>å¤§æ¦‚æ—¶æ®µ</strong>ï¼ˆåœ°æ”¯åŒå°æ—¶æ®µï¼‰</div>
        <div class="tw-grid" id="twGrid"></div>
        <div class="muted" style="margin-top:10px;font-size:.9em">
          é€‰æ‹©åç‚¹â€œå¡«å…¥æ—¶é—´â€ï¼Œä¼šç”¨è¯¥æ—¶æ®µçš„ä¸­ä½æ—¶é—´å†™åˆ°ä¸Šæ–¹æ—¶é—´è¾“å…¥æ¡†ï¼Œå¹¶è‡ªåŠ¨å–æ¶ˆâ€œæ—¶é—´ä¸è¯¦â€ã€‚
        </div>
      </div>
      <div class="tw-foot">
        <button class="btn ghost" id="twCancel" type="button">å–æ¶ˆ</button>
        <button class="btn" id="twApply" type="button" disabled>å¡«å…¥æ—¶é—´</button>
      </div>
    </div>
  </div>

<script>
'use strict';

/* ================== é…ç½® & å·¥å…· ================== */
const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';

const $ = id => document.getElementById(id);
function showErr(msg){ const e=$("error"); if(!e) return; e.textContent=msg; e.style.display="block"; setTimeout(()=>{e.style.display='none'},5000); }
function hideErr(){ const e=$("error"); if(!e) return; e.style.display="none"; e.textContent=""; }
function showAuthErr(msg){ const e=$("authError"); if(!e) return; e.textContent=msg; e.style.display="block"; setTimeout(()=>{e.style.display='none'},5000); }
function hideAuthErr(){ const e=$("authError"); if(!e) return; e.style.display="none"; e.textContent=""; }
function lock(el, v){ if(el) el.disabled = v; }
function strongPwd(pw){ return pw.length>=8 && /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /[0-9]/.test(pw) && /[^A-Za-z0-9]/.test(pw); }
function setText(id, v){ const el=$(id); if(el) el.textContent=v; }
function setBar(el, pct){ if(el) el.style.width = Math.max(0, Math.min(100, pct)) + '%'; }

/* ================== å¤šè¯­è¨€ï¼ˆç²¾ç®€ï¼‰ ================== */
const LANG_KEY="site_lang";
function getLang(){ return localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN"; }
function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
const translations = {
  "zh-CN": { lang_label:"è¯­è¨€", btn_register:"æ³¨å†Œè´¦æˆ·", btn_login:"ç™»å…¥è´¦æˆ·", btn_reset:"ğŸ”‘ é‡è®¾å¯†ç ",
    note_price:"æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ", note_price1:"$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰",
    err_need_ep:"è¯·è¾“å…¥é‚®ç®±ä¸å¯†ç ", err_pwd_rule:"å¯†ç è‡³å°‘8ä½ï¼Œéœ€åŒ…å«å¤§å†™/å°å†™/æ•°å­—/ç‰¹æ®Šç¬¦å·",
    err_no_account:"è´¦æˆ·ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ³¨å†Œ", err_wrong_pwd:"å¯†ç é”™è¯¯", err_expired:"ä¼šå‘˜å·²è¿‡æœŸï¼Œè¯·ç»­è´¹",
    err_login_fail:"ç™»å…¥å¤±è´¥ï¼š", err_register_fail:"æ³¨å†Œå¤±è´¥ï¼š", err_email_empty:"é‚®ç®±ä¸èƒ½ä¸ºç©º", err_pwd_empty:"å¯†ç ä¸èƒ½ä¸ºç©º",
    prompt_email:"è¯·è¾“å…¥æ³¨å†Œé‚®ç®±ï¼š", prompt_newpwd:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™ã€æ•°å­—ã€ç¬¦å·ï¼‰ï¼š",
    btn_upgrade:"ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰", btn_backshop:"â† è¿”å›å‘½ç†å•†åŸ",
    vip_title:"ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment", vip_mingli:"ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹", vip_xinlian:"ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹",
    vip_love:"å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿", vip_career:"äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›", vip_wealth:"è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº",
    vip_pet:"å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†", vip_hepan:"åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶", vip_name:"æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿",
    vip_fengshui:"è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ", vip_record:"çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·", vip_course:"å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾",
    vip_memorial:"å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­", vip_tasks:"æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡", vip_shop:"èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
    login_title:"ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",
    chat_fab:"é—®", chat_placeholder:"è¯·é—®æ‚¨æƒ³äº†è§£ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ï¼šå¦‚ä½•å¼€å§‹å…è´¹ä½“éªŒï¼‰", chat_send:"å‘é€",
    msg_reset_ok:"å¯†ç å·²æˆåŠŸæ›´æ–°ï¼Œè¯·ç”¨æ–°å¯†ç é‡æ–°ç™»å…¥ã€‚"
  },
  "zh-TW": { lang_label:"èªè¨€", btn_register:"è¨»å†Šå¸³æˆ¶", btn_login:"ç™»å…¥å¸³æˆ¶", btn_reset:"ğŸ”‘ é‡è¨­å¯†ç¢¼",
    note_price:"è¨»å†Šè´ˆä¸€æ¬¡å…è²»é«”é©—", note_price1:"$9.9 / æœˆè²» VIPï¼ˆå‘½ç†ç©ºé–“ + å¿ƒæ†ç©ºé–“ + éˆæ€§èª²ç¨‹ï¼‰",
    err_need_ep:"è«‹è¼¸å…¥é›»å­éƒµä»¶èˆ‡å¯†ç¢¼", err_pwd_rule:"å¯†ç¢¼è‡³å°‘8ä½ï¼Œéœ€åŒ…å«å¤§å°å¯«/æ•¸å­—/ç‰¹æ®Šç¬¦è™Ÿ",
    err_no_account:"å¸³æˆ¶ä¸å­˜åœ¨ï¼Œè«‹å…ˆè¨»å†Š", err_wrong_pwd:"å¯†ç¢¼éŒ¯èª¤", err_expired:"æœƒå“¡å·²éæœŸï¼Œè«‹çºŒè²»",
    err_login_fail:"ç™»å…¥å¤±æ•—ï¼š", err_register_fail:"è¨»å†Šå¤±æ•—ï¼š", err_email_empty:"éƒµç®±ä¸èƒ½ç‚ºç©º", err_pwd_empty:"å¯†ç¢¼ä¸èƒ½ç‚ºç©º",
    prompt_email:"è«‹è¼¸å…¥è¨»å†Šéƒµç®±ï¼š", prompt_newpwd:"è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å¯«ã€æ•¸å­—ã€ç¬¦è™Ÿï¼‰ï¼š",
    btn_upgrade:"ğŸ’ å‡ç´šç‚º VIPï¼ˆæœˆè²»ï¼‰", btn_backshop:"â† è¿”å›å‘½ç†å•†åŸ",
    vip_title:"ğŸŒ™ æœƒå“¡å€åŸŸ VIP Segment", vip_mingli:"ğŸ— å‘½ç†ç©ºé–“å°ˆå±¬å…§å®¹", vip_xinlian:"ğŸŒ™ å¿ƒæ†ç©ºé–“å°ˆå±¬å…§å®¹",
    vip_love:"å§»ç·£æ–¹å‘ï¼šæˆ€æ„›ç·£åˆ†ã€å©šå§»èµ°å‹¢", vip_career:"äº‹æ¥­æ–¹å‘ï¼šè·å ´ç™¼å±•ã€å‰µæ¥­æ½›åŠ›", vip_wealth:"è²¡é‹æ–¹å‘ï¼šè²¡ä½åˆ†æã€ç†è²¡æ™‚æ©Ÿ",
    vip_pet:"å¯µç‰©å‘½ç†ï¼šä¼´ä¾¶å‹•ç‰©çš„æ€§æ ¼èˆ‡ç·£åˆ†", vip_hepan:"åˆç›¤åˆ†æï¼šå©šæœŸæ“‡æ—¥ã€æ–°ç”Ÿæ“‡æ™‚", vip_name:"æ¸¬ååˆ†æï¼šå…¬å¸åã€å¯¶å¯¶åã€å‘½åæ”¹é‹",
    vip_fengshui:"è²¡ä½åˆç›¤ï¼šä½å®¶ / è¾¦å…¬å®¤å‹•ç·šé…åˆ", vip_record:"éˆæ€§è¨˜éŒ„ï¼šç…§ç‰‡ã€å¤¢å¢ƒã€è²éŸ³ã€é¡˜æœ›ç¥ˆç¦±", vip_course:"å‘½ç†èª²ç¨‹ï¼šå…«å­— / å¡”ç¾… / å æ˜Ÿ / éˆæ•¸ / äººé¡åœ–",
    vip_memorial:"å®¶æ—ç´€å¿µç³»çµ±ï¼šè¦ªäººéˆæ€§ç´€å¿µ & å»¶çºŒ", vip_tasks:"æ¯é€±èƒ½é‡ç·´ç¿’ / ç¥æ˜å„€å¼ä»»å‹™", vip_shop:"èƒ½é‡å•†åŸå°ˆå±¬æŠ˜æ‰£ & å¾¡å®ˆè¨‚è£½",
    login_title:"ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",
    chat_fab:"å•", chat_placeholder:"æƒ³äº†è§£ä»€éº¼ï¼Ÿï¼ˆä¾‹å¦‚ï¼šå¦‚ä½•é–‹å§‹å…è²»é«”é©—ï¼‰", chat_send:"ç™¼é€",
    msg_reset_ok:"å¯†ç¢¼å·²æˆåŠŸæ›´æ–°ï¼Œè«‹ç”¨æ–°å¯†ç¢¼é‡æ–°ç™»å…¥ã€‚"
  },
  "en": { lang_label:"Language", btn_register:"Create Account", btn_login:"Log in", btn_reset:"ğŸ”‘ Reset Password",
    note_price:"New account gets one free trial.", note_price1:"$9.9 / month Â· VIP (Astro + Soul + Courses)",
    err_need_ep:"Enter email and password", err_pwd_rule:"Password must be 8+ and include upper/lowercase, number, symbol",
    err_no_account:"Account not found. Please register first.", err_wrong_pwd:"Incorrect password", err_expired:"Membership expired. Please renew.",
    err_login_fail:"Login failed: ", err_register_fail:"Registration failed: ", err_email_empty:"Email cannot be empty", err_pwd_empty:"Password cannot be empty",
    prompt_email:"Enter your registered email:", prompt_newpwd:"Enter a new password (8+, upper/lower/digit/symbol):",
    btn_upgrade:"ğŸ’ Upgrade to VIP (Monthly)", btn_backshop:"â† Back to Store",
    vip_title:"ğŸŒ™ VIP Segment", vip_mingli:"ğŸ— Astro Sanctuary Â· Exclusive", vip_xinlian:"ğŸŒ™ Soul Sanctuary Â· Exclusive",
    vip_love:"Love: Dating Fate, Marriage Trend", vip_career:"Career: Workplace, Entrepreneurship", vip_wealth:"Wealth: Wealth Position, Timing",
    vip_pet:"Pet Destiny: Temperament & Bond", vip_hepan:"Synastry: Wedding Dates, Birthtime", vip_name:"Name Reading: Company/Baby/Renaming",
    vip_fengshui:"Wealth & Layout: Home / Office", vip_record:"Spiritual Logs: Photos, Dreams, Voice, Prayers", vip_course:"Courses: Bazi / Tarot / Astrology / Numerology / Human Design",
    vip_memorial:"Family Memorial: Spiritual Archive & Legacy", vip_tasks:"Weekly Energy Practices / Divine Ritual Tasks", vip_shop:"Store Discounts & Omamori",
    login_title:"ğŸ’ VIP Login",
    chat_fab:"Chat", chat_placeholder:"What would you like to know? (e.g., how to start the free trial)", chat_send:"Send",
    msg_reset_ok:"Password updated. Please log in with the new one."
  }
};
function t(key){ const L = translations[getLang()] || translations["zh-CN"]; return L[key] || (translations["zh-CN"][key] || key); }

/***** i18n PATCH: å ä½ç¬¦ & ç®¡å®¶ç”¨åˆ°çš„ key *****/
Object.assign(translations["zh-CN"], {
  ph_email:"é‚®ç®± Email",
  ph_password:"å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰",
  err_reset_fail:"é‡è®¾å¤±è´¥ï¼š",
  butler_title:"å¿ƒæ€œç®¡å®¶ Â· æ™ºèƒ½è§£è¯»",
  day_master:"æ—¥ä¸»",
  chart_strength:"å‘½å±€",
  season:"å­£èŠ‚",
  wuxing_distribution:"äº”è¡Œåˆ†å¸ƒ",
  note:"æ³¨æ„",
  time_unknown_checked:"å·²å‹¾é€‰â€œå‡ºç”Ÿæ—¶é—´ä¸è¯¦â€",
  hour_pillar_excluded:"æœªçº³å…¥æ—¶æŸ±",
  hint:"æç¤º",
  no_hour_tip:"æ— æ—¶æŸ±ï¼Œå»ºè®®ä»…ä½œå‚è€ƒã€‚",
  dev_strategy:"å‘å±•ç­–ç•¥ï¼š",
  useful_elements:"å–œç”¨å…ƒç´ ï¼š",
  lucky_colors:"å¹¸è¿é¢œè‰²ï¼š",
  lucky_directions:"é€‚åˆæ–¹ä½ï¼š",
  strength_strong:"åå¼º",
  strength_weak:"åå¼±",
  strength_balanced:"å¹³è¡¡",
  desc_strong:"æ½œåŠ›è¶³ã€æŠ—å‹å¥½",
  desc_weak:"éœ€å¤–æ´æ›´èƒ½å‘æŒ¥",
  desc_balanced:"å‡è¡¡ã€é€‚åº”æ€§å¼º",
  desc_generic:"å…·æœ‰ç‹¬ç‰¹ç‰¹ç‚¹",
  season_spring:"æœ¨æ—ºç”Ÿå‘",
  season_summer:"ç«æ—ºå¤–æ”¾",
  season_autumn:"é‡‘æ—ºæ”¶æ•›",
  season_winter:"æ°´æ—ºå†…è—",
  season_generic:"å­£èŠ‚å¯¹å‘½å±€æœ‰ä¸€å®šå½±å“",
  el_wood:"æœ¨", el_fire:"ç«", el_earth:"åœŸ", el_metal:"é‡‘", el_water:"æ°´",
  dir_wood:"ä¸œæ–¹", dir_fire:"å—æ–¹", dir_earth:"ä¸­å¤®/ä¸œåŒ—/è¥¿å—", dir_metal:"è¥¿æ–¹", dir_water:"åŒ—æ–¹",
  color_wood:"ç»¿è‰²/é’è‰²", color_fire:"çº¢è‰²/ç´«è‰²", color_earth:"é»„è‰²/æ£•è‰²", color_metal:"ç™½è‰²/é‡‘è‰²", color_water:"é»‘è‰²/è“è‰²"
});
Object.assign(translations["zh-TW"], {
  ph_email:"é›»å­éƒµä»¶ Email",
  ph_password:"å¯†ç¢¼ Passwordï¼ˆè‡³å°‘ 8 ä½ï¼Œå«å¤§å°å¯«æ•¸å­—ç¬¦è™Ÿï¼‰",
  err_reset_fail:"é‡è¨­å¤±æ•—ï¼š",
  butler_title:"å¿ƒæ†ç®¡å®¶ Â· æ™ºèƒ½è§£è®€",
  day_master:"æ—¥ä¸»",
  chart_strength:"å‘½å±€",
  season:"å­£ç¯€",
  wuxing_distribution:"äº”è¡Œåˆ†ä½ˆ",
  note:"æ³¨æ„",
  time_unknown_checked:"å·²å‹¾é¸ã€Œå‡ºç”Ÿæ™‚é–“ä¸è©³ã€",
  hour_pillar_excluded:"æœªç´å…¥æ™‚æŸ±",
  hint:"æç¤º",
  no_hour_tip:"ç„¡æ™‚æŸ±ï¼Œå»ºè­°åƒ…ä½œåƒè€ƒã€‚",
  dev_strategy:"ç™¼å±•ç­–ç•¥ï¼š",
  useful_elements:"å–œç”¨å…ƒç´ ï¼š",
  lucky_colors:"å¹¸é‹é¡è‰²ï¼š",
  lucky_directions:"é©åˆæ–¹ä½ï¼š",
  strength_strong:"åå¼·",
  strength_weak:"åå¼±",
  strength_balanced:"å¹³è¡¡",
  desc_strong:"æ½›åœ¨åŠ›é«˜ã€æŠ—å£“å¥½",
  desc_weak:"éœ€å¤–æ´æ›´èƒ½ç™¼æ®",
  desc_balanced:"å‡è¡¡ã€é©æ‡‰æ€§å¼·",
  desc_generic:"å…·æœ‰ç¨ç‰¹ç‰¹é»",
  season_spring:"æœ¨æ—ºç”Ÿç™¼",
  season_summer:"ç«æ—ºå¤–æ”¾",
  season_autumn:"é‡‘æ—ºæ”¶æ–‚",
  season_winter:"æ°´æ—ºå…§è—",
  season_generic:"å­£ç¯€å°å‘½å±€æœ‰ä¸€å®šå½±éŸ¿",
  el_wood:"æœ¨", el_fire:"ç«", el_earth:"åœŸ", el_metal:"é‡‘", el_water:"æ°´",
  dir_wood:"æ±æ–¹", dir_fire:"å—æ–¹", dir_earth:"ä¸­å¤®/æ±åŒ—/è¥¿å—", dir_metal:"è¥¿æ–¹", dir_water:"åŒ—æ–¹",
  color_wood:"ç¶ è‰²/é’è‰²", color_fire:"ç´…è‰²/ç´«è‰²", color_earth:"é»ƒè‰²/æ£•è‰²", color_metal:"ç™½è‰²/é‡‘è‰²", color_water:"é»‘è‰²/è—è‰²"
});
Object.assign(translations["en"], {
  ph_email:"Email address",
  ph_password:"Password (8+ with upper/lower/number/symbol)",
  err_reset_fail:"Reset failed: ",
  butler_title:"Xinlian Butler Â· Insight",
  day_master:"Day Master",
  chart_strength:"Chart Strength",
  season:"Season",
  wuxing_distribution:"Five Elements",
  note:"Note",
  time_unknown_checked:"â€œBirth time unknownâ€ is checked",
  hour_pillar_excluded:"Hour pillar not included",
  hint:"Hint",
  no_hour_tip:"No hour pillar â€” treat as reference only.",
  dev_strategy:"Development strategy: ",
  useful_elements:"Favorable elements: ",
  lucky_colors:"Lucky colors: ",
  lucky_directions:"Lucky directions: ",
  strength_strong:"Strong-leaning",
  strength_weak:"Weak-leaning",
  strength_balanced:"Balanced",
  desc_strong:"High potential and stress-tolerant",
  desc_weak:"Works better with external support",
  desc_balanced:"Well-balanced and adaptable",
  desc_generic:"Has unique characteristics",
  season_spring:"Wood thrives; outward growth",
  season_summer:"Fire thrives; expression/outflow",
  season_autumn:"Metal thrives; organize/refine",
  season_winter:"Water thrives; conserve/reflect",
  season_generic:"Seasonal qi has some influence",
  el_wood:"Wood", el_fire:"Fire", el_earth:"Earth", el_metal:"Metal", el_water:"Water",
  dir_wood:"East", dir_fire:"South", dir_earth:"Center/NE/SW", dir_metal:"West", dir_water:"North",
  color_wood:"Green/Teal", color_fire:"Red/Purple", color_earth:"Yellow/Brown", color_metal:"White/Gold", color_water:"Black/Blue"
});

/***** æ–°å¢ï¼šæ—¥è¯­ ja *****/
translations["ja"] = { /* â€¦â€¦ä¸ä¸Šä¸€ç‰ˆç›¸åŒï¼Œç•¥ï¼Œå·²å®Œæ•´ä¿ç•™â€¦â€¦ */ 
  lang_label:"è¨€èª", btn_register:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ", btn_login:"ãƒ­ã‚°ã‚¤ãƒ³", btn_reset:"ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š",
  note_price:"æ–°è¦ç™»éŒ²ã§1å›ã®ç„¡æ–™ä½“é¨“ã‚’é€²å‘ˆ", note_price1:"$9.9 / æœˆ Â· VIPï¼ˆå‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ + å¿ƒæ€œã‚¹ãƒšãƒ¼ã‚¹ + ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¬›åº§ï¼‰",
  err_need_ep:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", err_pwd_rule:"8æ–‡å­—ä»¥ä¸Šãƒ»å¤§å°è‹±å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ã‚’å«ã‚ã¦ãã ã•ã„",
  err_no_account:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ç™»éŒ²ã—ã¦ãã ã•ã„", err_wrong_pwd:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“", err_expired:"ä¼šå“¡æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚æ›´æ–°ã—ã¦ãã ã•ã„",
  err_login_fail:"ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸï¼š", err_register_fail:"ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸï¼š", err_email_empty:"ãƒ¡ãƒ¼ãƒ«ã¯å¿…é ˆã§ã™", err_pwd_empty:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™",
  err_reset_fail:"å†è¨­å®šã«å¤±æ•—ï¼š",
  prompt_email:"ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ï¼š", prompt_newpwd:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šãƒ»è‹±æ•°å­—è¨˜å·ï¼‰ï¼š",
  btn_upgrade:"ğŸ’ VIPï¼ˆæœˆé¡ï¼‰ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰", btn_backshop:"â† ã‚¹ãƒˆã‚¢ã«æˆ»ã‚‹",
  vip_title:"ğŸŒ™ ä¼šå“¡ã‚¨ãƒªã‚¢", vip_mingli:"ğŸ— å‘½ç†ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆä¼šå“¡é™å®šï¼‰", vip_xinlian:"ğŸŒ™ å¿ƒæ€œã‚¹ãƒšãƒ¼ã‚¹ï¼ˆä¼šå“¡é™å®šï¼‰",
  vip_love:"ã”ç¸ï¼šæ‹æ„›ãƒ»çµå©šã®å‚¾å‘", vip_career:"ã‚­ãƒ£ãƒªã‚¢ï¼šè·å ´/èµ·æ¥­ã®å¯èƒ½æ€§", vip_wealth:"è²¡é‹ï¼šè²¡ä½åˆ†æãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°",
  vip_pet:"ãƒšãƒƒãƒˆå‘½ç†ï¼šæ€§æ ¼ã¨ã”ç¸", vip_hepan:"ç›¸æ€§é‘‘å®šï¼šçµå©šæ—¥å–ã‚Šãƒ»å‡ºç”£æ™‚åˆ»", vip_name:"å‘½åé‘‘å®šï¼šä¼šç¤¾åãƒ»èµ¤ã¡ã‚ƒã‚“åãƒ»æ”¹å",
  vip_fengshui:"è²¡ä½ Ã— å‹•ç·šï¼šä½å±… / ã‚ªãƒ•ã‚£ã‚¹", vip_record:"ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¨˜éŒ²ï¼šå†™çœŸãƒ»å¤¢ãƒ»éŸ³å£°ãƒ»ç¥ˆã‚Š", vip_course:"è¬›åº§ï¼šå…«å­—/ã‚¿ãƒ­ãƒƒãƒˆ/å æ˜Ÿ/æ•°ç§˜/HD",
  vip_memorial:"å®¶æ—ãƒ¡ãƒ¢ãƒªã‚¢ãƒ«ï¼šéœŠçš„ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–", vip_tasks:"æ¯é€±ã®ç·´ç¿’ / å„€å¼ã‚¿ã‚¹ã‚¯", vip_shop:"ã‚¹ãƒˆã‚¢å‰²å¼• & å¾¡å®ˆã‚Š",
  login_title:"ğŸ’ VIP ãƒ­ã‚°ã‚¤ãƒ³",
  chat_fab:"è³ªå•", chat_placeholder:"ä½•ã‚’çŸ¥ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿï¼ˆä¾‹ï¼šç„¡æ–™ä½“é¨“ã®å§‹ã‚æ–¹ï¼‰", chat_send:"é€ä¿¡",
  msg_reset_ok:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚",
  ph_email:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", ph_password:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šãƒ»è‹±æ•°å­—è¨˜å·ï¼‰",
  butler_title:"å¿ƒæ€œç®¡å®¶ãƒ»ã‚¤ãƒ³ã‚µã‚¤ãƒˆ",
  day_master:"æ—¥ä¸»", chart_strength:"å‘½å±€", season:"å­£ç¯€", wuxing_distribution:"äº”è¡Œåˆ†å¸ƒ",
  note:"æ³¨æ„", time_unknown_checked:"ã€Œå‡ºç”Ÿæ™‚é–“ä¸æ˜ã€ã«ãƒã‚§ãƒƒã‚¯æ¸ˆã¿", hour_pillar_excluded:"æ™‚æŸ±ã¯è¨ˆç®—ã«å«ã‚ã¦ã„ã¾ã›ã‚“",
  hint:"ãƒ’ãƒ³ãƒˆ", no_hour_tip:"æ™‚æŸ±ãªã—ã®ãŸã‚ã€è§£é‡ˆã¯å‚è€ƒç¨‹åº¦ã«ã€‚",
  dev_strategy:"ç™ºå±•æˆ¦ç•¥ï¼š", useful_elements:"å–œç”¨ï¼š", lucky_colors:"ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ï¼š", lucky_directions:"å‰æ–¹ä½ï¼š",
  strength_strong:"åå¼·", strength_weak:"åå¼±", strength_balanced:"å¹³è¡¡",
  desc_strong:"æ½œåœ¨åŠ›ãŒé«˜ãã€ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã«å¼·ã„", desc_weak:"å¤–éƒ¨ã®åŠ©ã‘ã§åŠ›ã‚’ç™ºæ®ã—ã‚„ã™ã„", desc_balanced:"ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãé©å¿œåŠ›ãŒé«˜ã„", desc_generic:"ç‹¬è‡ªã®å€‹æ€§ãŒã‚ã‚Šã¾ã™",
  season_spring:"æœ¨ãŒæ—ºã˜ã¦ä¼¸ã³ã‚„ã™ã„", season_summer:"ç«ãŒæ—ºã˜å¤–å‘çš„ã«", season_autumn:"é‡‘ãŒæ—ºã˜æ•´ç†ãƒ»åæ–‚", season_winter:"æ°´ãŒæ—ºã˜å†…çœãƒ»è“„ãˆ",
  season_generic:"å­£ç¯€ã®æ°—ã«ä¸€å®šã®å½±éŸ¿ã‚’å—ã‘ã¾ã™",
  el_wood:"æœ¨", el_fire:"ç«", el_earth:"åœŸ", el_metal:"é‡‘", el_water:"æ°´",
  dir_wood:"æ±", dir_fire:"å—", dir_earth:"ä¸­å¤®/åŒ—æ±/å—è¥¿", dir_metal:"è¥¿", dir_water:"åŒ—",
  color_wood:"ç·‘/é’", color_fire:"èµ¤/ç´«", color_earth:"é»„/èŒ¶", color_metal:"ç™½/é‡‘", color_water:"é»’/é’"
};

/***** æ–°å¢ï¼šå°åœ°è¯­ hi *****/
translations["hi"] = { /* â€¦â€¦ä¿æŒä¸ä¸Šä¸€ç‰ˆä¸€è‡´â€¦â€¦ */ 
  lang_label:"à¤­à¤¾à¤·à¤¾", btn_register:"à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤", btn_login:"à¤²à¥‰à¤— à¤‡à¤¨", btn_reset:"ğŸ”‘ à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤°à¥€à¤¸à¥‡à¤Ÿ",
  note_price:"à¤¨à¤ à¤–à¤¾à¤¤à¥‡ à¤ªà¤° à¤à¤• à¤¬à¤¾à¤° à¤¨à¤¿à¤ƒà¤¶à¥à¤²à¥à¤• à¤Ÿà¥à¤°à¤¾à¤¯à¤²", note_price1:"$9.9 / à¤®à¤¾à¤¹ Â· VIP (à¤œà¥à¤¯à¥‹à¤¤à¤¿à¤· + à¤¸à¥‹à¤² + à¤•à¥‹à¤°à¥à¤¸)",
  err_need_ep:"à¤ˆà¤®à¥‡à¤² à¤”à¤° à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚", err_pwd_rule:"à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ 8+ à¤”à¤° à¤¬à¤¡à¤¼à¥‡/à¤›à¥‹à¤Ÿà¥‡ à¤…à¤•à¥à¤·à¤°, à¤…à¤‚à¤•, à¤šà¤¿à¤¨à¥à¤¹ à¤¶à¤¾à¤®à¤¿à¤² à¤¹à¥‹à¤‚",
  err_no_account:"à¤–à¤¾à¤¤à¤¾ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾, à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¤¹à¤²à¥‡ à¤°à¤œà¤¿à¤¸à¥à¤Ÿà¤° à¤•à¤°à¥‡à¤‚", err_wrong_pwd:"à¤—à¤²à¤¤ à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡", err_expired:"à¤¸à¤¦à¤¸à¥à¤¯à¤¤à¤¾ à¤¸à¤®à¤¾à¤ªà¥à¤¤â€”à¤•à¥ƒà¤ªà¤¯à¤¾ à¤°à¤¿à¤¨à¥à¤¯à¥‚ à¤•à¤°à¥‡à¤‚",
  err_login_fail:"à¤²à¥‰à¤—à¤¿à¤¨ à¤µà¤¿à¤«à¤²: ", err_register_fail:"à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤µà¤¿à¤«à¤²: ", err_email_empty:"à¤ˆà¤®à¥‡à¤² à¤–à¤¾à¤²à¥€ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾", err_pwd_empty:"à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤–à¤¾à¤²à¥€ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾",
  err_reset_fail:"à¤°à¥€à¤¸à¥‡à¤Ÿ à¤µà¤¿à¤«à¤²: ",
  prompt_email:"à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ à¤ˆà¤®à¥‡à¤² à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚:", prompt_newpwd:"à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ (8+, à¤¬à¤¡à¤¼à¥‡/à¤›à¥‹à¤Ÿà¥‡/à¤…à¤‚à¤•/à¤šà¤¿à¤¨à¥à¤¹):",
  btn_upgrade:"ğŸ’ VIP (à¤®à¤¾à¤¸à¤¿à¤•) à¤®à¥‡à¤‚ à¤…à¤ªà¤—à¥à¤°à¥‡à¤¡", btn_backshop:"â† à¤¸à¥à¤Ÿà¥‹à¤° à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤",
  vip_title:"ğŸŒ™ VIP à¤¸à¤¦à¤¸à¥à¤¯ à¤•à¥à¤·à¥‡à¤¤à¥à¤°", vip_mingli:"ğŸ— à¤œà¥à¤¯à¥‹à¤¤à¤¿à¤· à¤¸à¥à¤ªà¥‡à¤¸ Â· à¤µà¤¿à¤¶à¥‡à¤·", vip_xinlian:"ğŸŒ™ à¤¸à¥‹à¤² à¤¸à¥à¤ªà¥‡à¤¸ Â· à¤µà¤¿à¤¶à¥‡à¤·",
  vip_love:"à¤¸à¤‚à¤¬à¤‚à¤§: à¤ªà¥à¤°à¥‡à¤®/à¤µà¤¿à¤µà¤¾à¤¹ à¤ªà¥à¤°à¤µà¥ƒà¤¤à¥à¤¤à¤¿", vip_career:"à¤•à¤°à¤¿à¤¯à¤°: à¤•à¤¾à¤°à¥à¤¯à¤¸à¥à¤¥à¤²/à¤‰à¤¦à¥à¤¯à¤®à¤¿à¤¤à¤¾", vip_wealth:"à¤§à¤¨: à¤§à¤¨-à¤¸à¥à¤¥à¤¾à¤¨/à¤¸à¤®à¤¯",
  vip_pet:"à¤ªà¤¾à¤²à¤¤à¥‚ à¤­à¤¾à¤—à¥à¤¯: à¤¸à¥à¤µà¤­à¤¾à¤µ à¤à¤µà¤‚ à¤¬à¤‚à¤§à¤¨", vip_hepan:"à¤¸à¤¿à¤¨à¥ˆà¤¸à¥à¤Ÿà¥à¤°à¤¿: à¤µà¤¿à¤µà¤¾à¤¹ à¤¤à¤¿à¤¥à¤¿/à¤œà¤¨à¥à¤® à¤¸à¤®à¤¯", vip_name:"à¤¨à¤¾à¤® à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£: à¤•à¤‚à¤ªà¤¨à¥€/à¤¶à¤¿à¤¶à¥/à¤ªà¥à¤¨à¤°à¥à¤¨à¤¾à¤®",
  vip_fengshui:"à¤§à¤¨-à¤¸à¥à¤¥à¤¾à¤¨ Ã— à¤²à¥‡à¤†à¤‰à¤Ÿ: à¤˜à¤°/à¤‘à¤«à¤¿à¤¸", vip_record:"à¤†à¤§à¥à¤¯à¤¾à¤¤à¥à¤®à¤¿à¤• à¤°à¤¿à¤•à¤¾à¤°à¥à¤¡: à¤«à¥‹à¤Ÿà¥‹/à¤¸à¤ªà¤¨à¤¾/à¤†à¤µà¤¾à¤œà¤¼/à¤ªà¥à¤°à¤¾à¤°à¥à¤¥à¤¨à¤¾", vip_course:"à¤•à¥‹à¤°à¥à¤¸: à¤¬à¤¾à¤œà¤¼à¥€/à¤Ÿà¥ˆà¤°à¥‹/à¤œà¥à¤¯à¥‹à¤¤à¤¿à¤·/à¤…à¤‚à¤•/HD",
  vip_memorial:"à¤ªà¤°à¤¿à¤µà¤¾à¤° à¤¸à¥à¤®à¤¾à¤°à¤•: à¤†à¤§à¥à¤¯à¤¾à¤¤à¥à¤®à¤¿à¤• à¤¸à¤‚à¤—à¥à¤°à¤¹", vip_tasks:"à¤¸à¤¾à¤ªà¥à¤¤à¤¾à¤¹à¤¿à¤• à¤…à¤­à¥à¤¯à¤¾à¤¸ / à¤…à¤¨à¥à¤·à¥à¤ à¤¾à¤¨", vip_shop:"à¤¸à¥à¤Ÿà¥‹à¤° à¤›à¥‚à¤Ÿ à¤à¤µà¤‚ à¤“à¤®à¤¾à¤®à¥‹à¤°à¥€",
  login_title:"ğŸ’ VIP à¤²à¥‰à¤—à¤¿à¤¨",
  chat_fab:"à¤šà¥ˆà¤Ÿ", chat_placeholder:"à¤†à¤ª à¤•à¥à¤¯à¤¾ à¤œà¤¾à¤¨à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡? (à¤‰à¤¦à¤¾.: à¤®à¥à¤«à¥à¤¤ à¤Ÿà¥à¤°à¤¾à¤¯à¤² à¤•à¥ˆà¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚)", chat_send:"à¤­à¥‡à¤œà¥‡à¤‚",
  msg_reset_ok:"à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤ à¤¨à¤ à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ à¤¸à¥‡ à¤²à¥‰à¤— à¤‡à¤¨ à¤•à¤°à¥‡à¤‚à¥¤",
  ph_email:"à¤ˆà¤®à¥‡à¤²", ph_password:"à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡ (8+ à¤¬à¤¡à¤¼à¥‡/à¤›à¥‹à¤Ÿà¥‡/à¤…à¤‚à¤•/à¤šà¤¿à¤¨à¥à¤¹)",
  butler_title:"Xinlian Butler Â· à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",
  day_master:"à¤¦à¤¿à¤¨ à¤¸à¥à¤µà¤¾à¤®à¥€", chart_strength:"à¤šà¤¾à¤°à¥à¤Ÿ à¤¬à¤²", season:"à¤‹à¤¤à¥", wuxing_distribution:"à¤ªà¤‚à¤šà¤¤à¤¤à¥à¤µ à¤µà¤¿à¤¤à¤°à¤£",
  note:"à¤¨à¥‹à¤Ÿ", time_unknown_checked:"â€œà¤œà¤¨à¥à¤® à¤¸à¤®à¤¯ à¤…à¤œà¥à¤à¤¾à¤¤â€ à¤šà¥à¤¨à¤¾ à¤¹à¥ˆ", hour_pillar_excluded:"à¤˜à¤‚à¤Ÿà¤¾ à¤¸à¥à¤¤à¤‚à¤­ à¤¶à¤¾à¤®à¤¿à¤² à¤¨à¤¹à¥€à¤‚",
  hint:"à¤¸à¥à¤à¤¾à¤µ", no_hour_tip:"à¤˜à¤‚à¤Ÿà¤¾ à¤¸à¥à¤¤à¤‚à¤­ à¤¨à¤¹à¥€à¤‚ â€” à¤ªà¤°à¤¿à¤£à¤¾à¤® à¤¸à¤‚à¤¦à¤°à¥à¤­ à¤¹à¥‡à¤¤à¥à¥¤",
  dev_strategy:"à¤µà¤¿à¤•à¤¾à¤¸ à¤°à¤£à¤¨à¥€à¤¤à¤¿ï¼š", useful_elements:"à¤ªà¥à¤°à¤¿à¤¯ à¤¤à¤¤à¥à¤µï¼š", lucky_colors:"à¤²à¤•à¥€ à¤°à¤‚à¤—ï¼š", lucky_directions:"à¤¶à¥à¤­ à¤¦à¤¿à¤¶à¤¾ï¼š",
  strength_strong:"à¤ªà¥à¤°à¤¬à¤²", strength_weak:"à¤•à¤®à¤œà¤¼à¥‹à¤°", strength_balanced:"à¤¸à¤‚à¤¤à¥à¤²à¤¿à¤¤",
  desc_strong:"à¤¸à¤‚à¤­à¤¾à¤µà¤¨à¤¾ à¤…à¤§à¤¿à¤•, à¤¦à¤¬à¤¾à¤µ à¤¸à¤¹à¤¨à¥‡ à¤µà¤¾à¤²à¤¾", desc_weak:"à¤¬à¤¾à¤¹à¤°à¥€ à¤¸à¤¹à¤¯à¥‹à¤— à¤¸à¥‡ à¤¬à¥‡à¤¹à¤¤à¤° à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¨", desc_balanced:"à¤¸à¤‚à¤¤à¥à¤²à¤¿à¤¤ à¤”à¤° à¤…à¤¨à¥à¤•à¥‚à¤²à¤¨à¥€à¤¯", desc_generic:"à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤µà¤¿à¤¶à¥‡à¤·à¤¤à¤¾à¤à¤ à¤¹à¥ˆà¤‚",
  season_spring:"à¤µà¤¸à¤‚à¤¤: à¤²à¤•à¤¡à¤¼à¥€ à¤ªà¥à¤°à¤¬à¤², à¤µà¤¿à¤•à¤¾à¤¸", season_summer:"à¤—à¤°à¥à¤®à¥€: à¤…à¤—à¥à¤¨à¤¿ à¤ªà¥à¤°à¤¬à¤², à¤…à¤­à¤¿à¤µà¥à¤¯à¤•à¥à¤¤à¤¿", season_autumn:"à¤¶à¤°à¤¦: à¤§à¤¾à¤¤à¥ à¤ªà¥à¤°à¤¬à¤², à¤¸à¤‚à¤¯à¥‹à¤œà¤¨", season_winter:"à¤¶à¥€à¤¤: à¤œà¤² à¤ªà¥à¤°à¤¬à¤², à¤¸à¤‚à¤šà¤¯",
  season_generic:"à¤‹à¤¤à¥ à¤•à¤¾ à¤•à¥à¤› à¤ªà¥à¤°à¤­à¤¾à¤µ à¤°à¤¹à¤¤à¤¾ à¤¹à¥ˆ",
  el_wood:"à¤²à¤•à¤¡à¤¼à¥€", el_fire:"à¤…à¤—à¥à¤¨à¤¿", el_earth:"à¤ªà¥ƒà¤¥à¥à¤µà¥€", el_metal:"à¤§à¤¾à¤¤à¥", el_water:"à¤œà¤²",
  dir_wood:"à¤ªà¥‚à¤°à¥à¤µ", dir_fire:"à¤¦à¤•à¥à¤·à¤¿à¤£", dir_earth:"à¤®à¤§à¥à¤¯/à¤ˆà¤¶à¤¾à¤¨à¥à¤¯/à¤¨à¥ˆà¤‹à¤¤à¥à¤¯", dir_metal:"à¤ªà¤¶à¥à¤šà¤¿à¤®", dir_water:"à¤‰à¤¤à¥à¤¤à¤°",
  color_wood:"à¤¹à¤°à¤¾/à¤¨à¥€à¤²à¤¾à¤ªà¤¨", color_fire:"à¤²à¤¾à¤²/à¤¬à¥ˆà¤‚à¤—à¤¨à¥€", color_earth:"à¤ªà¥€à¤²à¤¾/à¤­à¥‚à¤°à¤¾", color_metal:"à¤¸à¤«à¥‡à¤¦/à¤¸à¥à¤µà¤°à¥à¤£", color_water:"à¤•à¤¾à¤²à¤¾/à¤¨à¥€à¤²à¤¾"
};

/***** æ–°å¢ï¼šé©¬æ¥è¯­ ms *****/
translations["ms"] = { /* â€¦â€¦ä¿æŒä¸ä¸Šä¸€ç‰ˆä¸€è‡´â€¦â€¦ */ 
  lang_label:"Bahasa", btn_register:"Daftar Akaun", btn_login:"Log masuk", btn_reset:"ğŸ”‘ Tetapkan semula kata laluan",
  note_price:"Akaun baharu menerima satu percubaan percuma", note_price1:"$9.9 / bulan Â· VIP (Astrologi + Jiwa + Kursus)",
  err_need_ep:"Masukkan emel dan kata laluan", err_pwd_rule:"Kata laluan mesti 8+ serta huruf besar/kecil, nombor dan simbol",
  err_no_account:"Akaun tidak ditemui. Sila daftar dahulu.", err_wrong_pwd:"Kata laluan tidak betul", err_expired:"Keahlian tamatâ€”sila perbaharui",
  err_login_fail:"Log masuk gagal: ", err_register_fail:"Pendaftaran gagal: ", err_email_empty:"Emel tidak boleh kosong", err_pwd_empty:"Kata laluan tidak boleh kosong",
  err_reset_fail:"Tetapan semula gagal: ",
  prompt_email:"Masukkan emel berdaftar anda:", prompt_newpwd:"Kata laluan baharu (8+, huruf/nombor/simbol):",
  btn_upgrade:"ğŸ’ Naik taraf ke VIP (Bulanan)", btn_backshop:"â† Kembali ke Kedai",
  vip_title:"ğŸŒ™ Zon Ahli VIP", vip_mingli:"ğŸ— Ruang Astrologi Â· Eksklusif", vip_xinlian:"ğŸŒ™ Ruang Jiwa Â· Eksklusif",
  vip_love:"Jodoh: cinta & trend perkahwinan", vip_career:"Kerjaya: tempat kerja/usahawan", vip_wealth:"Rezeki: kedudukan & masa",
  vip_pet:"Takdir haiwan peliharaan: sifat & jalinan", vip_hepan:"Keserasian: tarikh nikah & waktu kelahiran", vip_name:"Analisis nama: syarikat/bayi/penamaan semula",
  vip_fengshui:"Kedudukan wang Ã— susun atur: rumah/pejabat", vip_record:"Rekod spiritual: foto/mimpi/suara/doa", vip_course:"Kursus: Bazi/Tarot/Astrologi/Nombor/HD",
  vip_memorial:"Peringatan keluarga: arkib spiritual", vip_tasks:"Amalan mingguan / ritual", vip_shop:"Diskaun & omamori tersuai",
  login_title:"ğŸ’ Log masuk VIP",
  chat_fab:"Chat", chat_placeholder:"Apa yang anda ingin tahu? (cth: cara mulakan percubaan percuma)", chat_send:"Hantar",
  msg_reset_ok:"Kata laluan dikemas kini. Log masuk dengan yang baharu.",
  ph_email:"Emel", ph_password:"Kata laluan (8+ huruf/nombor/simbol)",
  butler_title:"Xinlian Butler Â· Analisis",
  day_master:"Day Master", chart_strength:"Kekuatan Carta", season:"Musim", wuxing_distribution:"Agihan Lima Unsur",
  note:"Nota", time_unknown_checked:"â€œMasa lahir tidak pastiâ€ dipilih", hour_pillar_excluded:"Tiang jam tidak diambil kira",
  hint:"Petua", no_hour_tip:"Tiada tiang jam â€” rujukan sahaja.",
  dev_strategy:"Strategi pembangunan: ", useful_elements:"Unsur berguna: ", lucky_colors:"Warna bertuah: ", lucky_directions:"Arah bertuah: ",
  strength_strong:"Cenderung kuat", strength_weak:"Cenderung lemah", strength_balanced:"Seimbang",
  desc_strong:"Potensi tinggi, tahan tekanan", desc_weak:"Lebih baik dengan sokongan luar", desc_balanced:"Seimbang dan mudah menyesuaikan", desc_generic:"Mempunyai keunikan tersendiri",
  season_spring:"Musim bunga: Kayu kuat", season_summer:"Musim panas: Api kuat", season_autumn:"Musim luruh: Logam kuat", season_winter:"Musim sejuk: Air kuat",
  season_generic:"Pengaruh musim wujud",
  el_wood:"Kayu", el_fire:"Api", el_earth:"Tanah", el_metal:"Logam", el_water:"Air",
  dir_wood:"Timur", dir_fire:"Selatan", dir_earth:"Tengah/Timur Laut/Barat Daya", dir_metal:"Barat", dir_water:"Utara",
  color_wood:"Hijau/Biru kehijauan", color_fire:"Merah/Ungu", color_earth:"Kuning/Coklat", color_metal:"Putih/Emas", color_water:"Hitam/Biru"
};

/* ====== æŠ¥å‘Šç›¸å…³ï¼šæ–°å¢/è¡¥å…… i18n Keys ====== */
Object.assign(translations['zh-CN'], {
  rpt_free_title: 'å…è´¹ç®€æŠ¥',
  rpt_pillars_label: 'å››æŸ±',
  rpt_daymaster_label: 'æ—¥ä¸»',
  rpt_season_label: 'å­£èŠ‚',
  rpt_chart_label: 'å‘½å±€',
  rpt_strategy_label: 'ç­–ç•¥',
  rpt_wuxing_label: 'äº”è¡Œåˆ†å¸ƒ',
  rpt_strongest_word: 'åæ—º',
  rpt_weakest_word: 'åå¼±',
  rpt_absent_prefix: 'ç¼ºï¼š',
  rpt_fav_avoid_template: 'å–œç”¨ï¼š{fav}ï½œå¿Œï¼š{avoid}',
  rpt_balance_focus_label: 'è°ƒè¡¡è¦ç‚¹',
  rpt_time_hint: 'æç¤ºï¼šå‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œæœªçº³å…¥æ—¶æŸ±ï¼Œä»…ä¾›å‚è€ƒã€‚',
  rpt_time_unknown: 'æ—¶é—´ä¸è¯¦',

  rpt_sec_overview_title: 'ä¸€ã€å‘½ç›˜æ€»è§ˆ',
  rpt_sec_elements_title: 'äºŒã€äº”è¡Œèƒ½é‡åˆ†æ',
  rpt_sec_traits_title: 'ä¸‰ã€æ€§æ ¼ä¸å¤©èµ‹',
  rpt_traits_intro: 'ä¾æ®æ—¥ä¸»ã€å­£èŠ‚ä¸å¼ºå¼±ç»™å‡ºæ ¸å¿ƒæ€§æ ¼æ ‡ç­¾ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_traits_adv: 'ä¼˜åŠ¿èƒ½é‡ï¼šæ‰§è¡Œ / åˆ›é€  / å­¦ä¹ ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_traits_chal: 'æ½œåœ¨æŒ‘æˆ˜ï¼šèŠ‚å¥ / è¾¹ç•Œ / è¿‡çŠ¹ä¸åŠï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_structure_title: 'å››ã€æ ¼å±€ä¸å–œå¿Œ',
  rpt_structure_line_template: 'å–œç”¨ï¼š{fav}ï¼›å¿Œè®³ï¼š{avoid}',
  rpt_sec_career_title: 'äº”ã€äº‹ä¸šä¸å‘å±•ï¼ˆå…è´¹è¯•è¯»ï¼‰',
  rpt_career_fields_placeholder: 'é€‚åˆé¢†åŸŸï¼šç»“åˆå–œç”¨ä¸æ°”è´¨ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_dev_strategy_prefix: 'å‘å±•ç­–ç•¥ï¼š',
  rpt_sec_love_title: 'å…­ã€æ„Ÿæƒ…ä¸å…³ç³»ï¼ˆå…è´¹è¯•è¯»ï¼‰',
  rpt_love_placeholder: 'æ²Ÿé€šèŠ‚å¥ä¸è¾¹ç•Œå»ºè®®ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_wealth_title: 'ä¸ƒã€è´¢å¯Œä¸ç†è´¢ï¼ˆå…è´¹è¯•è¯»ï¼‰',
  rpt_wealth_suggestion_template: 'ç†è´¢å»ºè®®ï¼šä»¥ {fav} ä¸ºä¸»è°ƒï¼Œç¨³ä¸­æ±‚è¿›ã€‚',
  rpt_sec_health_title: 'å…«ã€å¥åº·ä¸ä½œæ¯',
  rpt_health_placeholder_template: 'å›´ç»•æœ€å¼±äº”è¡Œï¼ˆ{weak}ï¼‰åšä½œæ¯ä¸ç¯å¢ƒä¼˜åŒ–ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_env_title: 'ä¹ã€ç¯å¢ƒä¸è‰²å½©',
  rpt_env_placeholder: 'æœ‰åˆ©æ–¹ä½ä¸é…è‰²éšå–œç”¨ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_strategy_drain: 'æ³„ç§€/åˆ¶åŒ–',
  rpt_strategy_support: 'ç”Ÿæ‰¶/è¡¥åŠ©',
  rpt_strategy_balance: 'è°ƒå’Œ'
});
Object.assign(translations['en'], {
  rpt_free_title: 'Free Summary',
  rpt_pillars_label: 'Pillars',
  rpt_daymaster_label: 'Day Master',
  rpt_season_label: 'Season',
  rpt_chart_label: 'Chart',
  rpt_strategy_label: 'Strategy',
  rpt_wuxing_label: 'Five Elements',
  rpt_strongest_word: 'strongest',
  rpt_weakest_word: 'weakest',
  rpt_absent_prefix: 'Absent: ',
  rpt_fav_avoid_template: 'Favorable: {fav} | Avoid: {avoid}',
  rpt_balance_focus_label: 'Balance focus',
  rpt_time_hint: 'Note: birth time unknown; hour pillar excludedâ€”use as reference only.',
  rpt_time_unknown: 'Unknown time',
  rpt_sec_overview_title: '1) Overview',
  rpt_sec_elements_title: '2) Element Analysis',
  rpt_sec_traits_title: '3) Traits & Talents',
  rpt_traits_intro: 'Core trait tags based on DM, season, and strength (placeholder).',
  rpt_traits_adv: 'Advantages: Execution / Creativity / Learning (placeholder).',
  rpt_traits_chal: 'Challenges: Pace / Boundaries (placeholder).',
  rpt_sec_structure_title: '4) Structure & Preferences',
  rpt_structure_line_template: 'Favorable: {fav}; Avoid: {avoid}',
  rpt_sec_career_title: '5) Career (sample)',
  rpt_career_fields_placeholder: 'Suitable fields (placeholder).',
  rpt_dev_strategy_prefix: 'Development strategy: ',
  rpt_sec_love_title: '6) Love (sample)',
  rpt_love_placeholder: 'Communication tempo & boundaries (placeholder).',
  rpt_sec_wealth_title: '7) Wealth (sample)',
  rpt_wealth_suggestion_template: 'Wealth tip: prefer flows aligned with {fav}.',
  rpt_sec_health_title: '8) Health',
  rpt_health_placeholder_template: 'Care for weakest element: {weak}.',
  rpt_sec_env_title: '9) Environment & Colors',
  rpt_env_placeholder: 'Favorable directions & palette follow your favorable elements.',
  rpt_strategy_drain: 'Drain/Control',
  rpt_strategy_support: 'Support/Nourish',
  rpt_strategy_balance: 'Balance'
});
Object.assign(translations['zh-TW'], { /* ä»…è¡¥æŠ¥å‘Šç›¸å…³é”®ï¼Œä¸è¦†ç›–åŸæœ¬ç¹ä½“ */
  rpt_free_title: 'å…è²»ç°¡å ±',
  rpt_pillars_label: 'å››æŸ±',
  rpt_daymaster_label: 'æ—¥ä¸»',
  rpt_season_label: 'å­£ç¯€',
  rpt_chart_label: 'å‘½å±€',
  rpt_strategy_label: 'ç­–ç•¥',
  rpt_wuxing_label: 'äº”è¡Œåˆ†å¸ƒ',
  rpt_strongest_word: 'åæ—º',
  rpt_weakest_word: 'åå¼±',
  rpt_absent_prefix: 'ç¼ºï¼š',
  rpt_fav_avoid_template: 'å–œç”¨ï¼š{fav}ï½œå¿Œï¼š{avoid}',
  rpt_balance_focus_label: 'èª¿è¡¡è¦é»',
  rpt_time_hint: 'æç¤ºï¼šå‡ºç”Ÿæ™‚é–“ä¸è©³ï¼Œæœªç´å…¥æ™‚æŸ±ï¼Œåƒ…ä¾›åƒè€ƒã€‚',
  rpt_time_unknown: 'æ™‚é–“ä¸è©³',
  rpt_sec_overview_title: 'ä¸€ã€å‘½ç›¤ç¸½è¦½',
  rpt_sec_elements_title: 'äºŒã€äº”è¡Œèƒ½é‡åˆ†æ',
  rpt_sec_traits_title: 'ä¸‰ã€æ€§æ ¼èˆ‡å¤©è³¦',
  rpt_traits_intro: 'ä¾æ“šæ—¥ä¸»ã€å­£ç¯€èˆ‡å¼·å¼±çµ¦å‡ºæ ¸å¿ƒæ€§æ ¼æ¨™ç±¤ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_traits_adv: 'å„ªå‹¢èƒ½é‡ï¼šåŸ·è¡Œï¼å‰µé€ ï¼å­¸ç¿’ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_traits_chal: 'æ½›åœ¨æŒ‘æˆ°ï¼šç¯€å¥ï¼é‚Šç•Œï¼éçŒ¶ä¸åŠï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_structure_title: 'å››ã€æ ¼å±€èˆ‡å–œå¿Œ',
  rpt_structure_line_template: 'å–œç”¨ï¼š{fav}ï¼›å¿Œè«±ï¼š{avoid}',
  rpt_sec_career_title: 'äº”ã€äº‹æ¥­èˆ‡ç™¼å±•ï¼ˆå…è²»è©¦è®€ï¼‰',
  rpt_career_fields_placeholder: 'é©åˆé ˜åŸŸï¼šçµåˆå–œç”¨èˆ‡æ°£è³ªï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_dev_strategy_prefix: 'ç™¼å±•ç­–ç•¥ï¼š',
  rpt_sec_love_title: 'å…­ã€æ„Ÿæƒ…èˆ‡é—œä¿‚ï¼ˆå…è²»è©¦è®€ï¼‰',
  rpt_love_placeholder: 'æºé€šç¯€å¥èˆ‡é‚Šç•Œå»ºè­°ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_wealth_title: 'ä¸ƒã€è²¡å¯Œèˆ‡ç†è²¡ï¼ˆå…è²»è©¦è®€ï¼‰',
  rpt_wealth_suggestion_template: 'ç†è²¡å»ºè­°ï¼šä»¥ {fav} ç‚ºä¸»èª¿ï¼Œç©©ä¸­æ±‚é€²ã€‚',
  rpt_sec_health_title: 'å…«ã€å¥åº·èˆ‡ä½œæ¯',
  rpt_health_placeholder_template: 'åœç¹æœ€å¼±äº”è¡Œï¼ˆ{weak}ï¼‰ä½œæ¯èˆ‡ç’°å¢ƒæœ€ä½³åŒ–ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_sec_env_title: 'ä¹ã€ç’°å¢ƒèˆ‡è‰²å½©',
  rpt_env_placeholder: 'æœ‰åˆ©æ–¹ä½èˆ‡é…è‰²éš¨å–œç”¨ï¼ˆæ¨¡æ¿åŒ–å ä½ï¼‰ã€‚',
  rpt_strategy_drain: 'æ´©ç§€ï¼åˆ¶åŒ–',
  rpt_strategy_support: 'ç”Ÿæ‰¶ï¼è£œåŠ©',
  rpt_strategy_balance: 'èª¿å’Œ'
});

/* ================== å…«å­—è®¡ç®—å™¨ï¼ˆç®€åŒ–ï¼‰ ================== */
class BaziCalculator{
  constructor(){
    this.HEAVENLY_STEMS=['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    this.EARTHLY_BRANCHES=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
    this.ZODIAC=['é¼ ','ç‰›','è™','å…”','é¾™','è›‡','é©¬','ç¾Š','çŒ´','é¸¡','ç‹—','çŒª'];
    this.NAYIN=['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
  }
  calculateYearPillar(year){ const s=(year-4)%10,b=(year-4)%12; return{stem:this.HEAVENLY_STEMS[(s+10)%10],branch:this.EARTHLY_BRANCHES[(b+12)%12],zodiac:this.ZODIAC[(b+12)%12]}; }
  solarMonthIndex(y,m,d){ const mmdd=m*100+d; const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]]; let idx=11; for(const [thr,val] of gates) if(mmdd>=thr) idx=val; const branchBy={1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'}; return{index:idx,branch:branchBy[idx]}; }
  calculateMonthPillar(year,month,day){ const {index,branch}=this.solarMonthIndex(year,month,day); const yStemIdx=this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem); const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0}; const stemIdx=(startMap[yStemIdx]+(index-1))%10; return{stem:this.HEAVENLY_STEMS[stemIdx],branch}; }
  calculateDayPillar(year,month,day){ const baseUTC=Date.UTC(1900,0,31); const targetUTC=Date.UTC(year,month-1,day); const dayDiff=Math.floor((targetUTC-baseUTC)/86400000); const stemIdx=(0+dayDiff)%10; const branchIdx=(4+dayDiff)%12; return{stem:this.HEAVENLY_STEMS[(stemIdx+10)%10],branch:this.EARTHLY_BRANCHES[(branchIdx+12)%12]}; }
  calculateHourPillar(dayStem,hour){ const branchMap={23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'}; const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8}; const dayIdx=this.HEAVENLY_STEMS.indexOf(dayStem); const hourIndex=Math.floor((hour+1)/2)%12; const stemIdx=(startMap[dayIdx]+hourIndex)%10; return{stem:this.HEAVENLY_STEMS[stemIdx],branch:branchMap[hour]}; }
  getElement(stem,branch){ const s={ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'}; const b={å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'}; return `${s[stem]}${b[branch]}`; }
  getNayin(stem,branch){ const si=this.HEAVENLY_STEMS.indexOf(stem), bi=this.EARTHLY_BRANCHES.indexOf(branch); return this.NAYIN[(si*2+bi)%this.NAYIN.length]; }
  getStemElement(stem){ return ({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'})[stem]; }
  getBranchElement(branch){ return ({å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'})[branch]; }
  calculateBazi(year,month,day,hour=12,timeUnknown=false){
    const yearP=this.calculateYearPillar(year), monthP=this.calculateMonthPillar(year,month,day), dayP=this.calculateDayPillar(year,month,day);
    const hourP=timeUnknown?{stem:'ï¼Ÿ',branch:'ï¼Ÿ'}:this.calculateHourPillar(dayP.stem,hour);
    const dayElement=this.getStemElement(dayP.stem);
    const pillars={year:yearP,month:monthP,day:{...dayP,element:dayElement},hour:hourP};
    const cnt={æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    (timeUnknown?[yearP,monthP,dayP]:[yearP,monthP,dayP,hourP]).forEach(p=>{ if(p.stem&&p.stem!=='ï¼Ÿ')cnt[this.getStemElement(p.stem)]+=1; if(p.branch&&p.branch!=='ï¼Ÿ')cnt[this.getBranchElement(p.branch)]+=1; });
    const total=Object.values(cnt).reduce((a,b)=>a+b,0)||1;
    const pct={wood:cnt['æœ¨']/total*100,fire:cnt['ç«']/total*100,earth:cnt['åœŸ']/total*100,metal:cnt['é‡‘']/total*100,water:cnt['æ°´']/total*100};
    return {pillars,counts:cnt,percents:pct,timeUnknown};
  }
}
const baziCalculator = new BaziCalculator();

/* ================== è§„åˆ™/æ¸²æŸ“ ================== */
function renderPillars(root,p,timeUnknown=false){
  if(!root) return; root.innerHTML='';
  [['å¹´æŸ±',p.year],['æœˆæŸ±',p.month],['æ—¥æŸ±',p.day],['æ—¶æŸ±',p.hour]].forEach(([tit,v])=>{
    const u=(tit==='æ—¶æŸ±'&&timeUnknown); const stem=u?'ï¼Ÿ':v.stem,branch=u?'ï¼Ÿ':v.branch;
    const div=document.createElement('div'); div.className='pillar'; div.innerHTML=`<div class="tit">${tit}</div><div class="gz">${stem}${branch}</div>`; root.appendChild(div);
  });
}
function displayClassicArea(p,timeUnknown){
  const ge=(s,b)=>baziCalculator.getElement(s,b), ny=(s,b)=>baziCalculator.getNayin(s,b);
  setText('year-stem',p.year.stem); setText('year-branch',p.year.branch);
  setText('month-stem',p.month.stem); setText('month-branch',p.month.branch);
  setText('day-stem',p.day.stem); setText('day-branch',p.day.branch);
  setText('hour-stem',timeUnknown?'ï¼Ÿ':p.hour.stem); setText('hour-branch',timeUnknown?'ï¼Ÿ':p.hour.branch);
  const setIf=(id,val)=>{const el=$(id); if(el) el.textContent=val; };
  setIf('year-element',ge(p.year.stem,p.year.branch)); setIf('month-element',ge(p.month.stem,p.month.branch));
  setIf('day-element',ge(p.day.stem,p.day.branch)); setIf('hour-element',timeUnknown?'æœªçŸ¥':ge(p.hour.stem,p.hour.branch));
  setIf('year-nayin',ny(p.year.stem,p.year.branch)); setIf('month-nayin',ny(p.month.stem,p.month.branch));
  setIf('day-nayin',ny(p.day.stem,p.day.branch)); setIf('hour-nayin',timeUnknown?'æœªçŸ¥':ny(p.hour.stem,p.hour.branch));
}
function judgeStrength(dayGan,monthZhi,cnt){
  const STEM_ELEM={ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'};
  const SEASON_BY_MONTH_BRANCH={å¯…:'æ˜¥',å¯:'æ˜¥',è¾°:'æ˜¥',å·³:'å¤',åˆ:'å¤',æœª:'å¤',ç”³:'ç§‹',é…‰:'ç§‹',æˆŒ:'ç§‹',äº¥:'å†¬',å­:'å†¬',ä¸‘:'å†¬'};
  const dmEl=STEM_ELEM[dayGan], season=SEASON_BY_MONTH_BRANCH[monthZhi]||'-';
  let score=0;
  if((season==='æ˜¥'&&'æœ¨ç«'.includes(dmEl))||(season==='å¤'&&'ç«åœŸ'.includes(dmEl))||(season==='ç§‹'&&dmEl==='é‡‘')||(season==='å†¬'&&dmEl==='æ°´')) score+=2;
  score+=(cnt[dmEl]||0)*1.2;
  const mark=score>=3?'åå¼º':(score<=1?'åå¼±':'å¹³è¡¡');
  const focus=mark==='åå¼º'?'æ³„ç§€/åˆ¶åŒ–':(mark==='åå¼±'?'è¡¥åŠ©/é¡ºåŠ¿':'å®ˆä¸­/è°ƒå’Œ'); return{season,mark,focus};
}
function chooseUseful(strength,dmElem){
  if(strength==='åå¼º') return {strategy:'æ³„ç§€/åˆ¶åŒ–', useful:({æœ¨:['ç«','åœŸ','é‡‘'],ç«:['åœŸ','é‡‘','æ°´'],åœŸ:['é‡‘','æ°´','æœ¨'],é‡‘:['æ°´','æœ¨','ç«'],æ°´:['æœ¨','ç«','åœŸ']})[dmElem], avoid:[dmElem]};
  if(strength==='åå¼±') return {strategy:'ç”Ÿæ‰¶/è¡¥åŠ©', useful:({æœ¨:['æœ¨','æ°´'],ç«:['ç«','æœ¨'],åœŸ:['åœŸ','ç«'],é‡‘:['é‡‘','åœŸ'],æ°´:['æ°´','é‡‘']})[dmElem], avoid:[]};
  return {strategy:'è°ƒå’Œ', useful:['æœ¨','ç«','åœŸ','é‡‘','æ°´'], avoid:[]};
}

/* ================== å¿ƒæ€œç®¡å®¶ï¼ˆåˆ†æå™¨ï½œå¤šè¯­è¨€ï¼‰â€”â€”â˜…è¿™æ¬¡è¡¥ä¸Š â˜… ================== */
class XinLianAssistant{
  constructor(){ this.currentContext = null; }
  _join(list){ const lang = (getLang()||'').toLowerCase(); return list.filter(Boolean).join(lang.startsWith('zh')?'ã€':', '); }
  _strengthLabel(m){ const map = { 'åå¼º': t('strength_strong'), 'åå¼±': t('strength_weak'), 'å¹³è¡¡': t('strength_balanced') }; return map[m] || m; }
  _EL(){ return { wood: t('el_wood'), fire: t('el_fire'), earth: t('el_earth'), metal: t('el_metal'), water: t('el_water') }; }
  _DIR(){ return { wood: t('dir_wood'), fire: t('dir_fire'), earth: t('dir_earth'), metal: t('dir_metal'), water: t('dir_water') }; }
  _COLOR(){ return { wood: t('color_wood'), fire: t('color_fire'), earth: t('color_earth'), metal: t('color_metal'), water: t('color_water') }; }

  generateAnalysis(baziData){
    this.currentContext = baziData;
    const a = $('assistant-analysis'), b = $('assistant-advice');
    if (a) a.innerHTML = this.analyzeBazi(baziData);
    if (b) b.innerHTML = this.generateAdvice(baziData);
  }
  analyzeBazi({dayMaster,elements,strength,season,timeUnknown}){
    const timeNote = timeUnknown ? `<li><strong>${t('note')}</strong>ï¼š${t('time_unknown_checked')}ï¼Œ<strong>${t('hour_pillar_excluded')}</strong>ã€‚</li>` : '';
    return `<ul class="ul">
      <li>${t('day_master')}ï¼š<strong>${dayMaster.stem}ï¼ˆ${dayMaster.element}ï¼‰</strong></li>
      <li>${t('chart_strength')}<strong>${this._strengthLabel(strength.mark)}</strong>ï¼š${this.getStrengthDescription(strength.mark)}</li>
      <li>${t('season')}ï¼š<strong>${season}</strong>ï¼Œ${this.getSeasonInfluence(season)}</li>
      <li>${t('wuxing_distribution')}ï¼š${this.getElementDistribution(elements)}</li>
      ${timeNote}
    </ul>`;
  }
  generateAdvice({strength,useful,timeUnknown}){
    const warn = timeUnknown ? `<li><strong>${t('hint')}</strong>ï¼š${t('no_hour_tip')}</li>` : '';
    const luckyColors = this.getLuckyColors(useful.useful||[]);
    const luckyDirs   = this.getLuckyDirections(useful.useful||[]);
    return `<ul class="ul">
      <li><strong>${t('dev_strategy')}</strong>${strength.focus}</li>
      <li><strong>${t('useful_elements')}</strong>${this._join(useful.useful||[])}</li>
      <li><strong>${t('lucky_colors')}</strong>${luckyColors}</li>
      <li><strong>${t('lucky_directions')}</strong>${luckyDirs}</li>
      ${warn}
    </ul>`;
  }
  getStrengthDescription(m){
    const map = { 'åå¼º': t('desc_strong'), 'åå¼±': t('desc_weak'), 'å¹³è¡¡': t('desc_balanced') };
    return map[m] || t('desc_generic');
  }
  getSeasonInfluence(season){
    const map = { 'æ˜¥': t('season_spring'), 'å¤': t('season_summer'), 'ç§‹': t('season_autumn'), 'å†¬': t('season_winter') };
    return map[season] || t('season_generic');
  }
  getLuckyColors(list){
    const C = this._COLOR(); const m = { 'æœ¨': C.wood, 'ç«': C.fire, 'åœŸ': C.earth, 'é‡‘': C.metal, 'æ°´': C.water };
    return this._join(list.map(x=>m[x]));
  }
  getLuckyDirections(list){
    const D = this._DIR(); const m = { 'æœ¨': D.wood, 'ç«': D.fire, 'åœŸ': D.earth, 'é‡‘': D.metal, 'æ°´': D.water };
    return this._join(list.map(x=>m[x]));
  }
  ELABEL(){ return this._EL(); }
  getElementDistribution(elements){
    const L = this._EL();
    return Object.entries(elements)
      .sort((a,b)=>b[1]-a[1])
      .map(([k,v])=>`${L[k]||k}${Math.round(v)}%`)
      .join(this._join([]).replace(/./g,'' ) || 'ã€');
  }
}

/* ================== å¤šè¯­è¨€å¸®åŠ©å‡½æ•°ï¼ˆæŠ¥å‘Šç”¨ï¼‰ ================== */
const EL_CHAR_TO_KEY = { 'æœ¨':'wood', 'ç«':'fire', 'åœŸ':'earth', 'é‡‘':'metal', 'æ°´':'water' };
function ELABEL(){ return { wood:t('el_wood'), fire:t('el_fire'), earth:t('el_earth'), metal:t('el_metal'), water:t('el_water') }; }
function elCharsToLocale(arr){ const L=ELABEL(); return (arr||[]).map(ch=>L[EL_CHAR_TO_KEY[ch]] || ch); }
function listJoin(arr){ const lang=(getLang()||'').toLowerCase(); const sep=lang.startsWith('zh')?'ã€':', '; return (arr||[]).filter(Boolean).join(sep); }
function seasonName(s){ const map={'æ˜¥':t('season_spring'),'å¤':t('season_summer'),'ç§‹':t('season_autumn'),'å†¬':t('season_winter')}; return map[s] || t('season_generic'); }
function strategyName(s){
  const map = { 'æ³„ç§€/åˆ¶åŒ–': translations[getLang()]?.rpt_strategy_drain || 'æ³„ç§€/åˆ¶åŒ–',
                'ç”Ÿæ‰¶/è¡¥åŠ©': translations[getLang()]?.rpt_strategy_support || 'ç”Ÿæ‰¶/è¡¥åŠ©',
                'è°ƒå’Œ': translations[getLang()]?.rpt_strategy_balance || 'è°ƒå’Œ',
                'æ´©ç§€ï¼åˆ¶åŒ–': translations[getLang()]?.rpt_strategy_drain || 'æ´©ç§€ï¼åˆ¶åŒ–',
                'ç”Ÿæ‰¶ï¼è£œåŠ©': translations[getLang()]?.rpt_strategy_support || 'ç”Ÿæ‰¶ï¼è£œåŠ©' };
  return map[s] || s;
}

/* ============ æŠ¥å‘Šï¼šå…è´¹ + å¯ŒæŠ¥å‘Š ============ */
function buildFreeReportHTML({pillars, percents, st, adv, timeUnknown}){
  const E = ELABEL();
  const entries = Object.entries(percents||{});
  const strongestK = entries.reduce((a,b)=>a[1]>b[1]?a:b, ['wood',0])[0];
  const weakestK   = entries.reduce((a,b)=>a[1]<b[1]?a:b, ['wood',0])[0];
  const strongest = E[strongestK] || '';
  const weakest   = E[weakestK] || '';
  const absents = Object.keys(percents||{}).filter(k=>Math.round(percents[k]||0)===0).map(k=>E[k]).filter(Boolean);
  const fmt = k => `${E[k]} ${Math.round(percents[k]||0)}%`;
  const lang = (getLang()||'').toLowerCase();
  const sep  = lang.startsWith('zh') ? 'ã€€' : ' Â· ';
  const line = ['wood','fire','earth','metal','water'].map(fmt).join(sep);

  const favLoc   = elCharsToLocale(adv?.useful||[]);
  const avoidLoc = elCharsToLocale(adv?.avoid||[]);
  const favText   = favLoc.length ? listJoin(favLoc) : (lang.startsWith('zh')?'â€”':'â€”');
  const avoidText = avoidLoc.length ? listJoin(avoidLoc) : (lang.startsWith('zh')?'â€”':'â€”');

  const hourTxt = timeUnknown ? t('rpt_time_unknown') : (pillars.hour.stem + pillars.hour.branch);
  const dmElemKey = EL_CHAR_TO_KEY[pillars.day.element] || 'wood';
  const dmElemName = E[dmElemKey];
  const stName = strategyName(st.focus);

  const favAvoidLine = t('rpt_fav_avoid_template').replace('{fav}', favText).replace('{avoid}', avoidText);
  const absStr = absents.length ? (lang.startsWith('zh') ? `ï¼ˆ${t('rpt_absent_prefix')}${listJoin(absents)}ï¼‰` : ` (${t('rpt_absent_prefix')}${listJoin(absents)})`) : '';

  return `
    <div class="xl-card" style="margin-top:12px;padding:16px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);">
      <h3 style="margin:0 0 8px;color:var(--brand)">${t('rpt_free_title')}</h3>
      <p style="margin:6px 0;">${t('rpt_pillars_label')}ï¼š<strong>${pillars.year.stem}${pillars.year.branch} ${pillars.month.stem}${pillars.month.branch} ${pillars.day.stem}${pillars.day.branch} ${hourTxt}</strong></p>
      <p style="margin:6px 0;">${t('rpt_daymaster_label')}ï¼š<strong>${pillars.day.stem}</strong>ï¼ˆ<strong>${dmElemName}</strong>ï¼‰ï½œ${t('rpt_season_label')}ï¼š<strong>${seasonName(st.season)||'-'}</strong>ï½œ${t('rpt_chart_label')}ï¼š<strong>${t('strength_'+(st.mark==='åå¼º'?'strong':st.mark==='åå¼±'?'weak':'balanced'))}</strong> Â· <strong>${t('rpt_strategy_label')}ï¼š${stName}</strong></p>
      <p style="margin:8px 0;">${t('rpt_wuxing_label')}ï¼š${line}</p>
      <p style="margin:4px 0;"><strong>${strongest}</strong>${t('rpt_strongest_word')}ï¼›<strong>${weakest}</strong>${t('rpt_weakest_word')}ã€‚${absStr}</p>
      <ul style="margin:6px 0 0 18px;line-height:1.6">
        <li>${favAvoidLine}</li>
        <li>${t('rpt_balance_focus_label')}ï¼š${stName}</li>
      </ul>
      ${timeUnknown?`<p class="muted" style="margin-top:6px;">${t('rpt_time_hint')}</p>`:''}
    </div>`;
}

function buildRichReportHTML({pillars, percents, st, adv, timeUnknown}){
  const E = ELABEL();
  const lang = (getLang()||'').toLowerCase();
  const sep  = lang.startsWith('zh') ? '' : ' ';
  const line = ['wood','fire','earth','metal','water'].map(k=>`${E[k]}${sep}${Math.round(percents[k]||0)}%`).join(lang.startsWith('zh') ? ' ' : ' Â· ');

  const entries = Object.entries(percents||{});
  const strongestK = entries.reduce((a,b)=>a[1]>b[1]?a:b, ['wood',0])[0];
  const weakestK   = entries.reduce((a,b)=>a[1]<b[1]?a:b, ['wood',0])[0];
  const strongest  = E[strongestK]||'â€”';
  const weakest    = E[weakestK]||'â€”';
  const absentsArr = Object.keys(percents||{}).filter(k=>Math.round(percents[k]||0)===0).map(k=>E[k]);
  const absentsStr = absentsArr.length ? (lang.startsWith('zh')?`ï¼ˆ${t('rpt_absent_prefix')}${listJoin(absentsArr)}ï¼‰`:` (${t('rpt_absent_prefix')}${listJoin(absentsArr)})`) : '';

  const favLoc   = elCharsToLocale(adv?.useful||[]);
  const avoidLoc = elCharsToLocale(adv?.avoid||[]);
  const favList   = favLoc.length ? listJoin(favLoc) : (lang.startsWith('zh')?'â€”':'â€”');
  const avoidList = avoidLoc.length ? listJoin(avoidLoc) : (lang.startsWith('zh')?'â€”':'â€”');

  const hourTxt = timeUnknown ? t('rpt_time_unknown') : (pillars.hour.stem+pillars.hour.branch);
  const dmElemKey = EL_CHAR_TO_KEY[pillars.day.element] || 'wood';
  const dmElemName = E[dmElemKey];
  const stName = strategyName(st.focus);

  return `
    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_overview_title')}</h3>
      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;font-size:14px;">
        <div>${t('rpt_pillars_label')}ï¼š<strong>${pillars.year.stem}${pillars.year.branch} ${pillars.month.stem}${pillars.month.branch} ${pillars.day.stem}${pillars.day.branch} ${hourTxt}</strong></div>
        <div>${t('rpt_daymaster_label')}ï¼š<strong>${pillars.day.stem}</strong>ï¼ˆ<strong>${dmElemName}</strong>ï¼‰</div>
        <div>${t('rpt_season_label')}ï¼š<strong>${seasonName(st.season)||'-'}</strong></div>
        <div>${t('rpt_chart_label')}ï¼š<strong>${t('strength_'+(st.mark==='åå¼º'?'strong':st.mark==='åå¼±'?'weak':'balanced'))}</strong> Â· ${t('rpt_strategy_label')}ï¼š<strong>${stName}</strong></div>
      </div>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_elements_title')}</h3>
      <div style="font-size:14px;">${line}</div>
      <p style="margin:10px 0 0;"><strong>${strongest}</strong>${t('rpt_strongest_word')}ï¼›<strong>${weakest}</strong>${t('rpt_weakest_word')}ã€‚${absentsStr}</p>
      <ul style="margin:10px 0 0 18px;line-height:1.6">
        <li>${t('useful_elements')}${listJoin(favLoc)}</li>
        <li>${t('rpt_balance_focus_label')}ï¼š${stName}</li>
      </ul>
      ${timeUnknown?`<p class="muted" style="margin-top:8px;">${t('rpt_time_hint')}</p>`:''}
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_traits_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_traits_intro')}</p>
      <p style="margin:8px 0;">${t('rpt_traits_adv')}</p>
      <p style="margin:8px 0;">${t('rpt_traits_chal')}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_structure_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_structure_line_template').replace('{fav}', favList).replace('{avoid}', avoidList)}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_career_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_career_fields_placeholder')}</p>
      <p style="margin:8px 0;">${t('rpt_dev_strategy_prefix')}${stName}ï¼ŒSOP</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_love_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_love_placeholder')}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_wealth_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_wealth_suggestion_template').replace('{fav}', favList)}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_health_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_health_placeholder_template').replace('{weak}', weakest)}</p>
    </section>

    <section class="card" style="padding:20px;">
      <h3 style="margin-top:0;color:var(--brand)">${t('rpt_sec_env_title')}</h3>
      <p style="margin:8px 0;">${t('rpt_env_placeholder')}</p>
    </section>

    <div id="butler-anchor"></div>
  `;
}

/* ================== ç®¡å®¶å¡ç‰‡ï¼ˆæ”¯æŒå¤šè¯­è¨€ï¼‰ ================== */
function buildButlerHTML(){
  return `
    <div id="assistant-panel" class="xl-card"
         style="margin-top:12px;padding:16px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);">
      <h3 class="butler-title" style="margin:0 0 8px;color:var(--brand)" data-i18n="butler_title">${t('butler_title')}</h3>
      <div id="assistant-analysis"></div>
      <div id="assistant-advice" style="margin-top:8px"></div>
    </div>`;
}

/* â€”â€” æŒ‚è½½â€œå…è´¹æŠ¥å‘Š + ç®¡å®¶å¡ç‰‡â€å¹¶ç”Ÿæˆç®¡å®¶å†…å®¹ â€”â€” */
function mountExtensionsIntoResult({pillars, percents, st, adv, timeUnknown}){
  const resultEl = $('result');
  if (!resultEl) return;

  let freeNode = $('xl-free-report');
  if (!freeNode) {
    freeNode = document.createElement('div');
    freeNode.id = 'xl-free-report';
    resultEl.appendChild(freeNode);
  }
  freeNode.innerHTML = buildFreeReportHTML({pillars, percents, st, adv, timeUnknown});

  let butler = $('assistant-panel');
  if (!butler) {
    const wrap = document.createElement('div');
    wrap.innerHTML = buildButlerHTML();
    resultEl.appendChild(wrap.firstElementChild);
    applyI18n(); // æ ‡é¢˜å¤šè¯­è¨€
  }

  const assistant = new XinLianAssistant();
  assistant.generateAnalysis({
    dayMaster: { stem: pillars.day.stem, element: pillars.day.element },
    elements: percents,
    strength: st,
    season: st.season,
    useful: adv,
    timeUnknown
  });
}

/* â€”â€” å…¨å±€ï¼šæŠŠç®¡å®¶å¡ç‰‡ç§»åŠ¨åˆ°é”šç‚¹ï¼ˆ#butler-anchorï¼‰ä¹‹å â€”â€” */
function relocateButlerPanel(){
  const panel  = document.getElementById('assistant-panel');
  const anchor = document.getElementById('butler-anchor');
  if (panel && anchor && anchor.parentNode){
    anchor.parentNode.insertBefore(panel, anchor.nextSibling);
  }
}

/* ================== ç”Ÿæˆå‘½ç›˜ ================== */
async function genChart(){
  const birth = ($('birthdate')?.value || '').trim();
  const timeUnknown = $('timeUnknown')?.checked || false;
  if (!birth){ showErr('è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸã€‚'); return; }

  const btn=$('genBtn'), tx=$('genBtnText'), ld=$('genBtnLoading');
  if(btn) btn.disabled = true;
  if(tx) tx.style.display = 'none';
  if(ld) ld.style.display = 'inline-block';

  try{
    const [Y,M,D] = birth.split('-').map(Number);
    let hour = 12;
    if (!timeUnknown){
      const t = ($('birthtime')?.value || '').trim();
      if (t){
        const h = parseInt(t.split(':')[0], 10);
        if (!Number.isNaN(h)) hour = h;
      }
    }

    const { pillars, counts, percents, timeUnknown: tu } =
      baziCalculator.calculateBazi(Y, M, D, hour, timeUnknown);

    $('result')?.style.setProperty('display','block');
    const timeText = tu ? 'æ—¶é—´ä¸è¯¦' : (hour + 'æ—¶');
    setText('bazi-date', `å‡ºç”Ÿæ—¥æœŸ: ${Y}å¹´${M}æœˆ${D}æ—¥ ${timeText}`);
    if (tu){ const el=$('bazi-date'); if(el) el.innerHTML += ' <span class="badge-warn">æœªçº³å…¥æ—¶æŸ±</span>'; }

    renderPillars($('bazi-pillars'), pillars, tu);
    displayClassicArea(pillars, tu);

    setBar($('bar-æœ¨'), percents.wood);  setText('pct-æœ¨',  Math.round(percents.wood)  + '%');
    setBar($('bar-ç«'), percents.fire);  setText('pct-ç«',  Math.round(percents.fire)  + '%');
    setBar($('bar-åœŸ'), percents.earth); setText('pct-åœŸ',  Math.round(percents.earth) + '%');
    setBar($('bar-é‡‘'), percents.metal); setText('pct-é‡‘',  Math.round(percents.metal) + '%');
    setBar($('bar-æ°´'), percents.water); setText('pct-æ°´',  Math.round(percents.water) + '%');

    const st  = judgeStrength(pillars.day.stem, pillars.month.branch, counts);
    const adv = chooseUseful(st.mark, pillars.day.element);

    const keys = Object.keys(counts);
    const maxK = keys.reduce((a,b)=>counts[a]>counts[b]?a:b);
    const minK = keys.reduce((a,b)=>counts[a]<counts[b]?a:b);
    setText('bazi-elements-balance', `äº”è¡Œä¸­${maxK}å…ƒç´ æœ€å¼ºï¼Œ${minK}å…ƒç´ æœ€å¼±ã€‚`);

    window.__last_report__ = { pillars, percents, st, adv, tu };

    mountExtensionsIntoResult({ pillars, percents, st, adv, timeUnknown: tu });
    mountRichReport({ pillars, percents, st, adv, timeUnknown: tu });

    console.log(
      'å®é™… â†’',
      pillars.year.stem+pillars.year.branch,
      pillars.month.stem+pillars.month.branch,
      pillars.day.stem+pillars.day.branch,
      tu ? 'ï¼Ÿ' : (pillars.hour.stem+pillars.hour.branch)
    );
  } catch (err){
    console.error(err);
    showErr('è®¡ç®—å…«å­—æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
  } finally {
    if(btn) btn.disabled = false;
    if(tx)  tx.style.display = 'inline';
    if(ld)  ld.style.display = 'none';
  }
}

function mountRichReport({ pillars, percents, st, adv, timeUnknown }) {
  let host = document.getElementById('rich-report');
  if (!host) {
    host = document.createElement('div');
    host.id = 'rich-report';
    const result = document.getElementById('result');
    if (result) result.appendChild(host);
  }
  host.innerHTML = buildRichReportHTML({ pillars, percents, st, adv, timeUnknown });
  if (typeof relocateButlerPanel === 'function') relocateButlerPanel();
}

/* ================== è¯­è¨€ï¼šåˆå§‹åŒ– + åˆ‡æ¢åé‡æ¸²æŸ“ ================== */
function applyI18n(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{ const key=el.getAttribute("data-i18n"); el.textContent=t(key);});
  document.querySelectorAll("[data-i18n-ph]").forEach(el=>{ const key=el.getAttribute("data-i18n-ph"); el.setAttribute("placeholder", t(key));});
}
function applyChatI18n(){
  const fab=$('ssChatFab'), inp=$('ssChatInput'), btn=$('ssChatSend');
  if (fab) fab.textContent = t('chat_fab');
  if (inp) inp.placeholder = t('chat_placeholder');
  if (btn) btn.textContent = t('chat_send');
}
function initLangUI(){
  const sel = document.getElementById('langSelect');
  if(!sel) return;
  const current = getLang();
  sel.value = current;
  document.documentElement.lang = current;
  applyI18n();
  applyChatI18n();

  sel.addEventListener('change', ()=>{
    setLang(sel.value);
    applyI18n();
    applyChatI18n();
    rerenderReportsIfAny();
  });
}
function rerenderReportsIfAny(){
  if (window.__last_report__) {
    const { pillars, percents, st, adv, tu } = window.__last_report__;
    mountExtensionsIntoResult({ pillars, percents, st, adv, timeUnknown: tu });
    mountRichReport({ pillars, percents, st, adv, timeUnknown: tu });
    if (typeof relocateButlerPanel === 'function') relocateButlerPanel();
  }
}

/* ================== Chat æ‚¬æµ®çƒ ================== */
document.addEventListener('DOMContentLoaded', ()=>{
  const chatFab=document.createElement('div'); chatFab.className='ss-chat-fab'; chatFab.id='ssChatFab'; chatFab.title='å¿ƒæ€œç®¡å®¶';
  const chatPanel=document.createElement('div'); chatPanel.className='ss-chat-panel'; chatPanel.id='ssChatPanel'; chatPanel.setAttribute('role','dialog'); chatPanel.setAttribute('aria-label','å¿ƒæ€œç®¡å®¶');
  chatPanel.innerHTML = `
    <div class="ss-chat-head"><div class="ss-chat-title">å¿ƒæ€œç®¡å®¶ Â· Chat</div><div class="ss-close" id="ssChatClose">âœ•</div></div>
    <div class="ss-chat-body" id="ssChatBody" aria-live="polite"></div>
    <div class="ss-chat-input"><input id="ssChatInput" type="text" placeholder="${t('chat_placeholder')}"/><button id="ssChatSend" class="btn">${t('chat_send')}</button></div>`;
  document.body.appendChild(chatFab); document.body.appendChild(chatPanel);
  applyChatI18n();

  const $body=$('ssChatBody'), $input=$('ssChatInput'), $send=$('ssChatSend'), $close=$('ssChatClose');
  const openPanel=()=>{ chatPanel.style.display='block'; $input&&$input.focus(); }; const closePanel=()=>{ chatPanel.style.display='none'; };
  chatFab.addEventListener('click',openPanel); $close&&$close.addEventListener('click',closePanel);

  function addMsg(text,me=false){ const div=document.createElement('div'); div.className='ss-msg'+(me?' me':''); div.textContent=text; $body.appendChild(div); $body.scrollTop=$body.scrollHeight; }
  async function askChat(prompt){
    addMsg(prompt,true); if($input){ $input.value=''; $input.focus(); }
    try{
      const r=await fetch(`${API_BASE}/api/chat`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'system',content:'ä½ æ˜¯â€œå¿ƒæ€œç®¡å®¶â€ï¼Œå¸®åŠ©è®¿å®¢äº†è§£å‘½ç†å¿ƒæ€œç©ºé—´çš„åŠŸèƒ½ã€å¯¼èˆªä¸ä¼šå‘˜è¯´æ˜ï¼Œè¯­æ°”æ¸©æš–ä¸“ä¸šã€ç®€æ´æœ‰æ¡ç†ã€‚'},{role:'user',content:prompt}]})});
      let data,reply=''; try{data=await r.json()}catch{data={}} reply=data.reply??data.text??data?.choices?.[0]?.message?.content??"";
      if(!reply) return addMsg('æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•ã€‚'); addMsg(reply);
    }catch(e){ addMsg('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ã€‚'); }
  }
  $send&&$send.addEventListener('click',()=>{ const v=$input?.value.trim(); if(v) askChat(v); });
  $input&&$input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ const v=$input.value.trim(); if(v) askChat(v); }});

  // â€”â€” é¡µé¢åˆå§‹ï¼šé»˜è®¤æ—¥æœŸã€æŒ‰é’®ç»‘å®šã€è¯­è¨€ UI
  const today=new Date(); const def=today.toISOString().split('T')[0]; if($('birthdate')&&!$('birthdate').value) $('birthdate').value=def;
  $('genBtn')?.addEventListener('click',genChart);
  initLangUI();
});

/* ================== ä¼°æ—¶é—´å‘å¯¼ï¼ˆä»…å‹¾é€‰ä¸è¯¦æ—¶è§¦å‘ï¼‰ ================== */
(function initBirthtimeWizard(){
  const tChk=$('timeUnknown'), tInput=$('birthtime'), btn=$('guessTimeBtn');
  const twMask=$('twMask'), twGrid=$('twGrid'), twApply=$('twApply'), twCancel=$('twCancel');
  if(!tInput||!tChk||!twMask||!twGrid||!twApply||!twCancel) return;

  const DZ=[
    ['å­','23:00â€“01:00','00:00'],['ä¸‘','01:00â€“03:00','02:00'],['å¯…','03:00â€“05:00','04:00'],['å¯','05:00â€“07:00','06:00'],
    ['è¾°','07:00â€“09:00','08:00'],['å·³','09:00â€“11:00','10:00'],['åˆ','11:00â€“13:00','12:00'],['æœª','13:00â€“15:00','14:00'],
    ['ç”³','15:00â€“17:00','16:00'],['é…‰','17:00â€“19:00','18:00'],['æˆŒ','19:00â€“21:00','20:00'],['äº¥','21:00â€“23:00','22:00']
  ];
  let selected=null;

  function openWizard(){
    twMask.style.display='flex'; selected=null; twApply.disabled=true;
    if(!twGrid.dataset.built){
      DZ.forEach(([z,range])=>{
        const b=document.createElement('button'); b.type='button'; b.className='tw-btn'; b.textContent=`${z}ï¼ˆ${range}ï¼‰`;
        b.addEventListener('click',()=>{ [...twGrid.children].forEach(x=>x.classList.remove('active')); b.classList.add('active'); selected=z; twApply.disabled=false;});
        twGrid.appendChild(b);
      }); twGrid.dataset.built='1';
    }else{ [...twGrid.children].forEach(x=>x.classList.remove('active')); }
  }
  function closeWizard(){ twMask.style.display='none'; }

  tChk.addEventListener('change', ()=>{ tInput.disabled=tChk.checked; if(tChk.checked) openWizard(); else closeWizard(); });
  btn && btn.addEventListener('click', openWizard);
  twCancel.addEventListener('click', closeWizard);
  twApply.addEventListener('click', ()=>{
    if(!selected) return;
    const mid=Object.fromEntries(DZ.map(([z,_,m])=>[z,m]))[selected];
    tInput.value=mid; tInput.disabled=false; tChk.checked=false; closeWizard();
  });
  tInput.disabled=tChk.checked;
})();

/* ================== ç™»å½•æµç¨‹ ================== */
async function safeJson(resp){ try{return await resp.json()}catch{return{ok:false,msg:'upstream_error'}} }
async function loginFlow(email,password){
  const res=await safeJson(await fetch(`${API_BASE}/api/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})}));
  const msg=(res.msg||"").toString().toLowerCase(); let expired=false;
  if(res.expired===true) expired=true; else if(msg==='expired') expired=true; else if(res.expiresAt){ const ts=Date.parse(res.expiresAt); if(!Number.isNaN(ts)&&ts<Date.now()) expired=true; }
  if(expired){ const go=confirm(t('err_expired')+'ã€‚æ˜¯å¦å‰å¾€ç»­è´¹ï¼Ÿ'); if(go) window.open('https://yourshopifyshop.com/products/monthly-vip','_blank'); return; }
  if(res.ok===true){ localStorage.setItem('vipEmail',res.email||email); location.href='https://astro.5xliving.com/vip_soul_sanctuary.html'; return; }
  if(msg==='no_account') return showAuthErr(t('err_no_account'));
  if(msg==='wrong_pwd') return showAuthErr(t('err_wrong_pwd'));
  return showAuthErr(t('err_login_fail')+(res.msg?` ${res.msg}`:''));
}

document.addEventListener('DOMContentLoaded', ()=>{
  $('registerForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault(); hideAuthErr();
    const email=$('email')?.value.trim(); const password=$('password')?.value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    if(!strongPwd(password)) return showAuthErr(t('err_pwd_rule'));
    lock($('registerBtn'),true);
    try{
      const res=await safeJson(await fetch(`${API_BASE}/api/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})}));
      if(res.ok===true){ localStorage.setItem('vipEmail',email); location.href='vip_trial.html'; return; }
      if((res.msg||"").toString()==='exists'){ await loginFlow(email,password); return; }
      return showAuthErr((res.msg&&(res.msg+''))||t('err_register_fail'));
    }catch(err){ showAuthErr(t('err_register_fail')+(err?.message||'')); }
    finally{ lock($('registerBtn'),false); }
  });

  $('loginForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault(); hideAuthErr();
    const email=$('email')?.value.trim(); const password=$('password')?.value.trim();
    if(!email||!password) return showAuthErr(t('err_need_ep'));
    lock($('loginBtn'),true);
    try{ await loginFlow(email,password); }
    catch(err){ showAuthErr(t('err_login_fail')+(err?.message||'')); }
    finally{ lock($('loginBtn'),false); }
  });

  $('resetBtn')?.addEventListener('click', async ()=>{
    hideAuthErr();
    let email=prompt(t('prompt_email')); if(email===null) return; email=email.trim(); if(!email) return showAuthErr(t('err_email_empty'));
    let newPassword=prompt(t('prompt_newpwd')); if(newPassword===null) return; newPassword=newPassword.trim(); if(!newPassword) return showAuthErr(t('err_pwd_empty'));
    if(!strongPwd(newPassword)) return showAuthErr(t('err_pwd_rule'));
    lock($('resetBtn'),true);
    try{
      const res=await safeJson(await fetch(`${API_BASE}/api/reset`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,newPassword})}));
      if(!res.ok) return showAuthErr((res.msg&&(res.msg+''))||t('err_reset_fail'));
      alert(t('msg_reset_ok'));
    }catch(err){ showAuthErr(t('err_reset_fail')+(err?.message||'')); }
    finally{ lock($('resetBtn'),false); }
  });
});

/* ================== è‡ªæµ‹ï¼š1978-02-21 12:00 â†’ æˆŠåˆ ç”²å¯… ç”²å¯… åºšåˆ ================== */
(function(){
  const c=new BaziCalculator(); const Y=c.calculateYearPillar(1978); const M=c.calculateMonthPillar(1978,2,21); const D=c.calculateDayPillar(1978,2,21); const H=c.calculateHourPillar(D.stem,12);
  console.log('åº”ä¸º â†’ å¹´ æˆŠåˆï½œæœˆ ç”²å¯…ï½œæ—¥ ç”²å¯…ï½œæ—¶ åºšåˆ');
  console.log('å®é™… â†’', Y.stem+Y.branch, M.stem+M.branch, D.stem+D.branch, H.stem+H.branch);
})();
</script>
</body>
</html>
