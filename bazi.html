<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>八字命理 · 快速排盘</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* 保持你的原有样式，并修复/补全少量细节 */
:root{
  --bg:#0b0f14;
  --bg-accent:#0e1520;
  --card:#11161dcc;
  --surface:#0f1624;
  --line:#1f2a36;
  --text:#e8edf3;
  --muted:#98a7b7;

  --brand:#d4af37;
  --gold:#d4af37;
  --gold2:#f2d27a;
  --accent:#58b9ff;

  --radius:14px;
  --radius-sm:10px;
  --radius-lg:18px;

  --shadow:0 8px 30px rgba(0,0,0,.35);
  --shadow-sm:0 4px 14px rgba(0,0,0,.28);

  --container:1100px;
  --gap:12px;
  --pad:18px;

  /* 修复：添加正确的focus变量 */
  --focus: 0 0 0 2px rgba(212,175,55,0.2);

  /* 仅供注释说明：媒体查询仍用固定数值写 */
  --bp-s:520px;
  --bp-m:760px;
  --bp-l:900px;
}

/* Reset + base */
*,
*::before,
*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
    linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}

.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}

.site-header{
  position:sticky; top:0; z-index:10;
  background:rgba(11,15,20,.8);
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:var(--shadow-sm);
  font-weight:800; color:#ffe084
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}

.lang{display:flex; align-items:center; gap:8px}
.lang select{
  appearance:none; min-width:140px;
  border-radius:10px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:10px 34px 10px 12px; font-size:0.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}

.section{margin-top:18px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:var(--pad);
  margin:16px 0;
}
.h2{
  font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084;
  display:flex; gap:8px; align-items:center
}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}

.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width: 760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .row.cols-2{grid-template-columns:1fr 1fr}
}

input,select{
  width:100%;
  border-radius:12px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:12px 12px; font-size:15px; outline:0;
}
input::placeholder{color:#6f8092}
input:focus, select:focus{box-shadow:var(--focus); border-color:#3a4c63}

.btn{
  display:inline-grid; place-items:center;
  padding:12px 16px; border-radius:12px;
  border:1px solid #e6c76e;
  background:linear-gradient(180deg,#fff9e6,#e6c76e);
  color:#191919; font-weight:800; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}

.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width: 520px){
  .pillars{grid-template-columns:repeat(2,1fr)}
}

.bazi-table{
  width:100%; border-collapse:collapse; margin-top:12px;
  background:var(--surface); border-radius:8px; overflow:hidden
}
.bazi-table th,.bazi-table td{
  padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle
}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
/* 小屏表格可横向滚动：把 table 用 div 包一层 .bazi-table-wrap 即可 */
.bazi-table-wrap{overflow:auto}
@media (max-width: 420px){
  .bazi-table th,.bazi-table td{padding:8px 10px}
}

.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:60px 1fr 60px; gap:10px; align-items:center}

.error-message{
  background:rgba(255,90,95,.1);
  border:1px solid #ff5a5f; border-radius:8px;
  padding:10px; display:none; margin-top:10px
}
.badge-warn{display:inline-block; padding:2px 8px; margin-left:6px; border:1px solid #ffb84d; border-radius:999px; color:#ffb84d; font-size:0.82rem}
.muted{color:var(--muted)}

.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}

.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.rating{display:flex; align-items:center; gap:8px; margin:8px 0}
.rating-stars{color:var(--gold2)}
.tag{display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:0.85rem; margin:2px}

.luck-grid{display:grid; gap:10px}
.luck-item{background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
.luck-year{font-weight:700; color:var(--gold2)}
.luck-desc{font-size:0.9rem; margin-top:4px}

.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width: 900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)
}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

.ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
.ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
.ai-box-c{color:#e8edf3; line-height:1.7}
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.chip{padding:6px 10px; border-radius:999px; border:1px solid #2a3546; background:#0e1520; color:#e8edf3; cursor:pointer; transition:border-color .2s ease, box-shadow .2s ease}
.chip:hover{border-color:#f2d27a; box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
.chip:disabled{opacity:.6; cursor:not-allowed}

.skeleton{display:grid; gap:8px}
.skeleton div{height:12px; border-radius:6px; background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431); animation:sh 1.2s infinite}
@keyframes sh{0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5}}

.ai-lock-overlay{margin-top:10px; padding-top:10px; border-top:1px solid #1f2a36; text-align:center}
.ai-lock-overlay .tip{color:#ffd88a; font-weight:700; margin-bottom:4px}
.ai-lock-overlay .sub{color:var(--muted)}

.detail-view{display:none}
.detail-header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
.back-btn{background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
.detail-content{line-height:1.8}
.detail-section{margin-bottom:24px}
.detail-section h4{color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
.action-list{list-style:none; padding:0; margin:0}
.action-list li{margin-bottom:8px; padding-left:20px; position:relative}
.action-list li::before{content:"•"; color:var(--gold2); position:absolute; left:0; top:0}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}

/* Motion 优化 */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* Utilities */
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.chips-container{display:flex; flex-wrap:wrap; gap:8px; margin:20px 0; justify-content:center}

/* VIP section demo 可见 */
.vip-section{display:block !important}

/* Butler 组件 */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
.butler-chat{margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
.chat-messages{height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:var(--surface); border-radius:8px; border:1px solid #253245}
.chat-input-area{display:flex; gap:10px}
.chat-input-area input{flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3}
.chat-send-btn{padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:700; cursor:pointer}

/* ==== remove the brown/gold focus outline ==== */
input:focus,
select:focus,
textarea:focus{
  outline: none !important;
  box-shadow: none !important;
  border-color: #243244 !important;
}
button:focus,
.btn:focus,
a:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* (optional) also remove tap highlight on mobile */
*{ -webkit-tap-highlight-color: transparent; }    
.chip:hover{ border-color:#2a3546; box-shadow:none; }

/* 浮窗聊天样式 */
.chat-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 350px;
  height: 500px;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  z-index: 1000;
  display: none;
  flex-direction: column;
}

.chat-float-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(212,175,55,.1);
  color: var(--gold2);
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
}

.chat-float-close {
  background: none;
  border: none;
  color: var(--gold2);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}

.chat-float-close:hover {
  background: rgba(212,175,55,.2);
}

.chat-float-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0;
}

.chat-float-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background: var(--surface);
}

.chat-float-input-area {
  padding: 12px;
  border-top: 1px solid var(--line);
  background: var(--bg-accent);
}

.chat-toggle-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(180deg,#fff9e6,#e6c76e);
  border: 1px solid #e6c76e;
  color: #191919;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(230,199,110,.3);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chat-toggle-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(230,199,110,.5);
}

/* 响应式调整 */
@media (max-width: 768px) {
  .chat-float {
    width: 300px;
    height: 400px;
    bottom: 10px;
    right: 10px;
  }
  
  .chat-toggle-btn {
    width: 50px;
    height: 50px;
    bottom: 10px;
    right: 10px;
  }
}    
</style>
</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
      <span class="title" data-i18n="brand.subtitle">5xLiving · 八字简评</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="nav.langLabel">语言</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN" data-i18n="lang.zh-CN">简体中文</option>
        <option value="zh-TW" data-i18n="lang.zh-TW">繁體中文</option>
        <option value="en"    data-i18n="lang.en">English</option>
        <option value="ja"    data-i18n="lang.ja">日本語</option>
        <option value="th"    data-i18n="lang.th">ไทย</option>
        <option value="ms"    data-i18n="lang.ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2" data-i18n="app.title">八字命理 · 快速排盘</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="form.nameLabel">姓名（可选）</label>
        <input id="name" placeholder="你的称呼（用于个性化）" />
      </div>
      <div>
        <label class="muted" data-i18n="form.genderLabel">性别</label>
        <select id="gender">
          <option value=""        data-i18n="form.gender.hidden">不透露</option>
          <option value="male"    data-i18n="form.gender.male">男性</option>
          <option value="female"  data-i18n="form.gender.female">女性</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="form.calendarLabel">历法</label>
        <select id="calendar">
          <option value="gregorian" data-i18n="form.calendar.gregorian">阳历</option>
          <option value="lunar"     data-i18n="form.calendar.lunar">农历</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted" data-i18n="form.birthdateLabel">出生日期</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted" data-i18n="form.birthtimeLabel">出生时间</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span data-i18n="form.timeUnknown">出生时间不详</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText" data-i18n="btn.generate">生成八字</span>
          <span id="genBtnLoading" style="display:none" data-i18n="btn.loading">计算中...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

<section id="result" style="display:none;">
    <div class="card">
      <div class="h2" data-i18n="result.title">您的生辰八字命盘</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>
     
      <table class="bazi-table">
        <thead>
          <tr>
            <th></th>
            <th data-i18n="pillar.year">年柱</th>
            <th data-i18n="pillar.month">月柱</th>
            <th data-i18n="pillar.day">日柱</th>
            <th data-i18n="pillar.hour">时柱</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-i18n="table.row.stem">天干</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.branch">地支</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.fiveElem">五行</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.nayin">纳音</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2" data-i18n="energy.title">五行能量分析</div>
      <div class="bar-row"><span data-i18n="elem.wood">木</span><div class="bar"><i id="bar-木"></i></div><span id="pct-木">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.fire">火</span><div class="bar"><i id="bar-火"></i></div><span id="pct-火">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.earth">土</span><div class="bar"><i id="bar-土"></i></div><span id="pct-土">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.metal">金</span><div class="bar"><i id="bar-金"></i></div><span id="pct-金">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.water">水</span><div class="bar"><i id="bar-水"></i></div><span id="pct-水">0%</span></div>
      <div id="bazi-elements-balance" class="muted"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span data-i18n="pro.title">🧙‍♂️ 心怜管家 · 专业命理分析</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
</section>
    
<!-- 浮窗聊天按钮 -->
<button class="chat-toggle-btn" id="chatToggle" data-i18n="chat.toggle">问</button>

<!-- 浮窗聊天窗口 -->
<div class="chat-float" id="chatFloat">
  <div class="chat-float-header">
    <span data-i18n="pro.title">🧙‍♂️ 心怜管家 · 专业命理分析</span>
    <button class="chat-float-close" id="chatClose">×</button>
  </div>
  <div class="chat-float-body">
    <div class="chat-float-messages" id="chatMessages">
      <div class="ss-msg" data-i18n="pro.welcome">您好！我是您的专业命理顾问，已为您生成详细分析报告。有什么具体问题可以随时问我。</div>
    </div>
    <div class="chat-float-input-area">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="请输入您的问题..." style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #253245; background: #0e1520; color: #e8edf3;">
        <button class="chat-send-btn" id="chatSend" data-i18n="chat.send" style="padding: 10px 16px; background: var(--gold); color: #191919; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">发送</button>
      </div>
    </div>
  </div>
</div>  

  <section class="card section vip-section">
    <h2 class="group-title" data-i18n="vip.title">🌙 会员区域 VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.astrology">🗝 命理空间专属内容</div>
        <ul>
          <li data-i18n="vip.astrology.match">姻缘方向：恋爱缘分、婚姻走势</li>
          <li data-i18n="vip.astrology.career">事业方向：职场发展、创业潜力</li>
          <li data-i18n="vip.astrology.wealth">财运方向：财位分析、理财时机</li>
          <li data-i18n="vip.astrology.pet">宠物命理：伴侣动物的性格与缘分</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.spiritual">🌙 心怜空间专属内容</div>
        <ul>
          <li data-i18n="vip.spiritual.record">灵性记录：照片、梦境、声音、愿望祈祷</li>
          <li data-i18n="vip.spiritual.courses">命理课程：八字 / 塔罗 / 占星 / 灵数</li>
          <li data-i18n="vip.spiritual.family">家族纪念系统：亲人灵性纪念 & 延续</li>
          <li data-i18n="vip.spiritual.practice">每周能量练习 / 神明仪式任务</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="vip.login.title">💎 登入 VIP 功能</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head" data-i18n="auth.header">账户登录 / 注册</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="邮箱 Email">
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="密码 Password（至少8位，含大小写数字符号）">
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="auth.login">登入账户</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="auth.reset">🔑 重设密码</button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="auth.register">注册账户</button>
              <div class="muted" data-i18n="auth.freeTrialNote">注册账号赠送一次免费体验</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head" data-i18n="vip.services.header">会员服务</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="vip.upgrade">💎 升级为 VIP（月费）</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="vip.back">← 返回命理商城</a>
            </div>
            <div class="muted" data-i18n="vip.priceNote">$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer data-i18n="footer.copy">© 5XLiving • Astro Sanctuary</footer>
</main>
  
<script>window.API_BASE='https://throbbing-lab-1440.hello5xliving.workers.dev';</script>
<script>
/*!
 * 5XLiving · Bazi Quick Chart - PROFESSIONAL VERSION
 */
(() => {
  'use strict';

  const CONFIG = {
    API_BASE: '' // 使用本地计算
  };

  // 扩展的多语言字典
  const I18N = {
    'zh-CN': {
      // ... 保持之前的翻译不变，添加新的 ...
      
      // 专业报告内容
      report: {
        dayMaster: {
          '甲': '甲木命：有积极性的开拓精神，精力旺盛，重感情，刚直豪迈，勤勉随和，但好自我显示，直爽当中隐蔽着一点点的虚伪。',
          '乙': '乙木命：性格柔顺，喜行善事，有同情心，外表谦虚，但内心占有欲强，有才能，适应性广。',
          '丙': '丙火命：热情豪爽，自信好胜，善言健谈，但情绪不稳，冲动易怒，缺乏仔细认真。',
          '丁': '丁火命：敦厚朴实，重信守义，但任性逞强，防止受骗，有时缺乏耐力，办事易半途而废。',
          '戊': '戊土命：有积极性，干一行易于对事物热衷，但性急，任性而逞强。好胜，欲望高，不满足感强烈。',
          '己': '己土命：和缓，谨慎，心灵手巧，但疑虑多，欠果断。容易因情耗财，防止被人牵着走。',
          '庚': '庚金命：积极进取，勇敢果决，自尊心强，有才能，善于结交各方面朋友，但有时过于刚强。',
          '辛': '辛金命：沉着坦直无私，待人接物，认真细致，脚踏实地，但温柔敦厚而寓涵固执。',
          '壬': '壬水命：心胸宽广，机智灵敏，喜欢照顾他人，聪明，有官运，但容易冲动。',
          '癸': '癸水命：逞强顽固，是努力家，有耐力，热情大方，聪颖机灵，但心地狭窄，容易小气。'
        },
        
        pillarAnalysis: {
          '戊午': '年柱戊午：天上火命，为人热情，但伤官透出，性格较为刚烈。',
          '甲寅': '月柱甲寅：大溪水命，比肩坐禄，兄弟姐妹助力，但容易有竞争。',
          '庚午': '时柱庚午：路旁土命，七杀坐伤官，子女有出息但管教较难。'
        },
        
        tenGods: {
          '比肩': '比肩：表示兄弟姐妹、朋友同事。比肩多者重义气，但容易有竞争。',
          '劫财': '劫财：表示异性朋友、竞争对手。劫财多者豪爽，但容易破财。',
          '食神': '食神：表示子女、食禄。食神多者温和，有口福，善于表达。',
          '伤官': '伤官：表示才华、艺术。伤官多者聪明，但性格较为叛逆。',
          '偏财': '偏财：表示父亲、意外之财。偏财多者慷慨，善于理财。',
          '正财': '正财：表示妻子、稳定收入。正财多者节俭，重视家庭。',
          '七杀': '七杀：表示压力、权威。七杀多者果断，有领导能力。',
          '正官': '正官：表示丈夫、官职。正官多者正直，遵守规矩。',
          '偏印': '偏印：表示继母、特殊才能。偏印多者聪明，但性格孤僻。',
          '正印': '正印：表示母亲、学识。正印多者善良，有学识。'
        },
        
        usefulSpirit: {
          '木': '喜用神为木，宜多接触绿色，往东方发展，从事木属性行业。',
          '火': '喜用神为火，宜多接触红色，往南方发展，从事火属性行业。', 
          '土': '喜用神为土，宜多接触黄色，往中部发展，从事土属性行业。',
          '金': '喜用神为金，宜多接触白色，往西方发展，从事金属性行业。',
          '水': '喜用神为水，宜多接触黑色，往北方发展，从事水属性行业。'
        },
        
        relationship: {
          '甲': '感情较为主动，喜欢掌握主导权，对伴侣要求较高。',
          '乙': '感情细腻温柔，需要稳定的情感支持，对伴侣体贴。',
          '丙': '感情热情奔放，但容易冲动，需要学会控制情绪。',
          '丁': '感情专一执着，但容易猜疑，需要建立信任。',
          '戊': '感情稳重务实，重视家庭，但缺乏浪漫。',
          '己': '感情细腻体贴，但容易缺乏安全感。',
          '庚': '感情果断直接，不喜欢拖泥带水。',
          '辛': '感情追求完美，对伴侣要求较高。',
          '壬': '感情丰富多变，需要新鲜感。',
          '癸': '感情细腻敏感，容易情绪化。'
        }
      }
    }
  };

  // 工具函数
  const $ = id => document.getElementById(id);
  const state = { lang: 'zh-CN' };

  function t(key) {
    const keys = key.split('.');
    let value = I18N[state.lang];
    for (const k of keys) {
      value = value ? value[k] : undefined;
    }
    return value || key;
  }

  // 八字计算器 - 增强版本
  class ProfessionalBaziCalculator {
    constructor() {
      this.HEAVENLY_STEMS = ['甲','乙','丙','丁','戊','己','庚','辛','壬','癸'];
      this.EARTHLY_BRANCHES = ['子','丑','寅','卯','辰','巳','午','未','申','酉','戌','亥'];
      this.NAYIN = ['海中金','炉中火','大林木','路旁土','剑锋金','山头火','涧下水','城头土','白蜡金','杨柳木','泉中水','屋上土','霹雳火','松柏木','长流水','砂石金','山下火','平地木','壁上土','金箔金','佛灯火','天河水','大驿土','钗钏金','桑柘木','大溪水','沙中土','天上火','石榴木','大海水'];
    }

    // 计算十神
    calculateTenGods(dayStem, stems) {
      const tenGodsMap = {
        '甲': { '甲':'比肩', '乙':'劫财', '丙':'食神', '丁':'伤官', '戊':'偏财', '己':'正财', '庚':'七杀', '辛':'正官', '壬':'偏印', '癸':'正印' },
        '乙': { '甲':'劫财', '乙':'比肩', '丙':'伤官', '丁':'食神', '戊':'正财', '己':'偏财', '庚':'正官', '辛':'七杀', '壬':'正印', '癸':'偏印' },
        '丙': { '甲':'偏印', '乙':'正印', '丙':'比肩', '丁':'劫财', '戊':'食神', '己':'伤官', '庚':'偏财', '辛':'正财', '壬':'七杀', '癸':'正官' },
        '丁': { '甲':'正印', '乙':'偏印', '丙':'劫财', '丁':'比肩', '戊':'伤官', '己':'食神', '庚':'正财', '辛':'偏财', '壬':'正官', '癸':'七杀' },
        '戊': { '甲':'七杀', '乙':'正官', '丙':'偏印', '丁':'正印', '戊':'比肩', '己':'劫财', '庚':'食神', '辛':'伤官', '壬':'偏财', '癸':'正财' },
        '己': { '甲':'正官', '乙':'七杀', '丙':'正印', '丁':'偏印', '戊':'劫财', '己':'比肩', '庚':'伤官', '辛':'食神', '壬':'正财', '癸':'偏财' },
        '庚': { '甲':'偏财', '乙':'正财', '丙':'七杀', '丁':'正官', '戊':'偏印', '己':'正印', '庚':'比肩', '辛':'劫财', '壬':'食神', '癸':'伤官' },
        '辛': { '甲':'正财', '乙':'偏财', '丙':'正官', '丁':'七杀', '戊':'正印', '己':'偏印', '庚':'劫财', '辛':'比肩', '壬':'伤官', '癸':'食神' },
        '壬': { '甲':'食神', '乙':'伤官', '丙':'偏财', '丁':'正财', '戊':'七杀', '己':'正官', '庚':'偏印', '辛':'正印', '壬':'比肩', '癸':'劫财' },
        '癸': { '甲':'伤官', '乙':'食神', '丙':'正财', '丁':'偏财', '戊':'正官', '己':'七杀', '庚':'正印', '辛':'偏印', '壬':'劫财', '癸':'比肩' }
      };
      
      return stems.map(stem => tenGodsMap[dayStem]?.[stem] || '-');
    }

    // 计算地支藏干
    calculateHiddenStems(branches) {
      const hiddenMap = {
        '子': ['癸'],
        '丑': ['己','癸','辛'],
        '寅': ['甲','丙','戊'],
        '卯': ['乙'],
        '辰': ['戊','乙','癸'],
        '巳': ['丙','戊','庚'],
        '午': ['丁','己'],
        '未': ['己','丁','乙'],
        '申': ['庚','壬','戊'],
        '酉': ['辛'],
        '戌': ['戊','辛','丁'],
        '亥': ['壬','甲']
      };
      
      return branches.map(branch => hiddenMap[branch] || []);
    }

    // 计算纳音
    getNayin(stem, branch) {
      const si = this.HEAVENLY_STEMS.indexOf(stem);
      const bi = this.EARTHLY_BRANCHES.indexOf(branch);
      return this.NAYIN[(si * 2 + bi) % this.NAYIN.length];
    }

    // 判断日主强弱
    analyzeDayMasterStrength(dayStem, stems, branches, hiddenStems) {
      // 简化的强弱分析逻辑
      const supportingElements = this.getSupportingElements(dayStem);
      let strengthScore = 0;
      
      // 分析天干
      stems.forEach(stem => {
        const element = this.getStemElement(stem);
        if (supportingElements.includes(element)) strengthScore += 2;
      });
      
      // 分析地支和藏干
      branches.forEach((branch, index) => {
        const branchElement = this.getBranchElement(branch);
        if (supportingElements.includes(branchElement)) strengthScore += 1;
        
        hiddenStems[index]?.forEach(hidden => {
          const hiddenElement = this.getStemElement(hidden);
          if (supportingElements.includes(hiddenElement)) strengthScore += 0.5;
        });
      });
      
      if (strengthScore > 8) return 'strong';
      if (strengthScore > 5) return 'balanced';
      return 'weak';
    }

    getSupportingElements(dayStem) {
      const elementMap = {
        '甲': ['木', '水'], '乙': ['木', '水'],
        '丙': ['火', '木'], '丁': ['火', '木'], 
        '戊': ['土', '火'], '己': ['土', '火'],
        '庚': ['金', '土'], '辛': ['金', '土'],
        '壬': ['水', '金'], '癸': ['水', '金']
      };
      return elementMap[dayStem] || [];
    }

    getStemElement(stem) {
      const map = {甲:'木',乙:'木',丙:'火',丁:'火',戊:'土',己:'土',庚:'金',辛:'金',壬:'水',癸:'水'};
      return map[stem] || '-';
    }

    getBranchElement(branch) {
      const map = {子:'水',丑:'土',寅:'木',卯:'木',辰:'土',巳:'火',午:'火',未:'土',申:'金',酉:'金',戌:'土',亥:'水'};
      return map[branch] || '-';
    }

    // 保持其他计算方法不变...
    calculateYearPillar(year) {
      const s = (year - 4) % 10;
      const b = (year - 4) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(s + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(b + 12) % 12] 
      };
    }

    solarMonthIndex(y, m, d) {
      const mmdd = m * 100 + d;
      const gates = [[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]];
      let idx = 11; 
      for (const [thr, val] of gates) { 
        if (mmdd >= thr) idx = val; 
      }
      const branchBy = {1:'寅',2:'卯',3:'辰',4:'巳',5:'午',6:'未',7:'申',8:'酉',9:'戌',10:'亥',11:'子',12:'丑'};
      return { index: idx, branch: branchBy[idx] };
    }

    calculateMonthPillar(year, month, day) {
      const { index, branch } = this.solarMonthIndex(year, month, day);
      const yStemIdx = this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem);
      const startMap = {0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0};
      const stemIdx = (startMap[yStemIdx] + (index - 1)) % 10;
      return { stem: this.HEAVENLY_STEMS[stemIdx], branch };
    }

    calculateDayPillar(year, month, day) {
      const baseUTC = Date.UTC(1900, 0, 31);
      const targetUTC = Date.UTC(year, month - 1, day);
      const dayDiff = Math.floor((targetUTC - baseUTC) / 86400000);
      const stemIdx = (0 + dayDiff) % 10;
      const branchIdx = (4 + dayDiff) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(stemIdx + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(branchIdx + 12) % 12] 
      };
    }

    calculateHourPillar(dayStem, hour) {
      const branchMap = {
        23:'子',0:'子',1:'丑',2:'丑',3:'寅',4:'寅',5:'卯',6:'卯',
        7:'辰',8:'辰',9:'巳',10:'巳',11:'午',12:'午',13:'未',14:'未',
        15:'申',16:'申',17:'酉',18:'酉',19:'戌',20:'戌',21:'亥',22:'亥'
      };
      const startMap = {0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8};
      const dayIdx = this.HEAVENLY_STEMS.indexOf(dayStem);
      const hourIndex = Math.floor((hour + 1) / 2) % 12;
      const stemIdx = (startMap[dayIdx] + hourIndex) % 10;
      return { 
        stem: this.HEAVENLY_STEMS[stemIdx], 
        branch: branchMap[hour] 
      };
    }
  }

  // 专业报告生成器
  function generateProfessionalReport(baziData) {
    const calc = new ProfessionalBaziCalculator();
    const dayStem = baziData.stem[2];
    const tenGods = calc.calculateTenGods(dayStem, baziData.stem);
    const hiddenStems = calc.calculateHiddenStems(baziData.branch);
    const strength = calc.analyzeDayMasterStrength(dayStem, baziData.stem, baziData.branch, hiddenStems);
    
    // 计算五行个数
    const elementCounts = { '金': 0, '木': 0, '水': 0, '火': 0, '土': 0 };
    baziData.stem.forEach(stem => {
      const element = calc.getStemElement(stem);
      if (element !== '-') elementCounts[element]++;
    });
    baziData.branch.forEach(branch => {
      const element = calc.getBranchElement(branch);
      if (element !== '-') elementCounts[element]++;
    });

    // 判断喜用神
    const usefulSpirit = calc.getSupportingElements(dayStem)[0];

    return `
      <div class="butler-section">
        <h4>📊 命盘总览</h4>
        <div class="detail-content">
          <p><strong>日主命理：</strong>${t(`report.dayMaster.${dayStem}`)}</p>
          <p><strong>日主强弱：</strong>${strength === 'strong' ? '身旺' : strength === 'weak' ? '身弱' : '中和'}</p>
          <p><strong>喜用神：</strong>${usefulSpirit} ${t(`report.usefulSpirit.${usefulSpirit}`)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>🌿 五行分析</h4>
        <div class="detail-content">
          <p><strong>五行个数：</strong>${elementCounts['金']}个金，${elementCounts['木']}个木，${elementCounts['水']}个水，${elementCounts['火']}个火，${elementCounts['土']}个土</p>
          <p><strong>五行旺衰：</strong>${Object.entries(baziData.elementsPct).sort((a,b) => b[1]-a[1]).map(([k,v]) => `${k}${v}%`).join('，')}</p>
          <p><strong>帮扶五行：</strong>${calc.getSupportingElements(dayStem).join('、')}</p>
          <p><strong>克泄五行：</strong>${['木','火','土','金','水'].filter(e => !calc.getSupportingElements(dayStem).includes(e)).join('、')}</p>
          ${Object.values(elementCounts).some(v => v === 0) ? `<p><strong>五行所缺：</strong>${Object.entries(elementCounts).filter(([k,v]) => v === 0).map(([k]) => k).join('、')}</p>` : ''}
        </div>
      </div>

      <div class="butler-section">
        <h4>⚡ 十神配置</h4>
        <div class="detail-content">
          <p><strong>年柱${baziData.stem[0]}${baziData.branch[0]}：</strong>${tenGods[0]} ${t(`report.tenGods.${tenGods[0]}`)}</p>
          <p><strong>月柱${baziData.stem[1]}${baziData.branch[1]}：</strong>${tenGods[1]} ${t(`report.tenGods.${tenGods[1]}`)}</p>
          <p><strong>日柱${baziData.stem[2]}${baziData.branch[2]}：</strong>${tenGods[2]} ${t(`report.tenGods.${tenGods[2]}`)}</p>
          <p><strong>时柱${baziData.stem[3]}${baziData.branch[3]}：</strong>${tenGods[3]} ${t(`report.tenGods.${tenGods[3]}`)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>💕 感情婚姻</h4>
        <div class="detail-content">
          <p><strong>感情特质：</strong>${t(`report.relationship.${dayStem}`)}</p>
          <p><strong>婚姻建议：</strong>${strength === 'strong' ? '宜找性格温和的伴侣' : '宜找有能力有担当的伴侣'}</p>
          <p><strong>相处之道：</strong>学会沟通理解，互相包容支持</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>💼 事业发展</h4>
        <div class="detail-content">
          <p><strong>适合行业：</strong>${getSuitableCareers(dayStem, usefulSpirit)}</p>
          <p><strong>发展方位：</strong>${getFavorableDirections(usefulSpirit)}</p>
          <p><strong>职业建议：</strong>${getCareerAdvice(strength, tenGods)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>💰 财运分析</h4>
        <div class="detail-content">
          <p><strong>财运特点：</strong>${getWealthAnalysis(tenGods, elementCounts)}</p>
          <p><strong>求财方向：</strong>${getWealthDirections(usefulSpirit)}</p>
          <p><strong>理财建议：</strong>稳扎稳打，避免投机</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>🌡️ 健康养生</h4>
        <div class="detail-content">
          <p><strong>体质特点：</strong>${getHealthAnalysis(dayStem, elementCounts)}</p>
          <p><strong>注意事项：</strong>${getHealthTips(usefulSpirit)}</p>
          <p><strong>养生建议：</strong>规律作息，适当运动，保持心态平和</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>🔮 近期运势</h4>
        <div class="detail-content">
          <p><strong>整体运势：</strong>稳中求进，适合学习提升</p>
          <p><strong>有利时机：</strong>未来3个月是关键发展期</p>
          <p><strong>注意事项：</strong>避免冲动决策，注意人际关系</p>
        </div>
      </div>
    `;
  }

  // 辅助函数
  function getSuitableCareers(dayStem, usefulSpirit) {
    const careers = {
      '木': '教育、文化、出版、林业、医药',
      '火': '能源、电力、餐饮、娱乐、传媒', 
      '土': '房地产、建筑、农业、资源',
      '金': '金融、机械、法律、军警',
      '水': '贸易、物流、旅游、咨询'
    };
    return careers[usefulSpirit] || '多样化发展';
  }

  function getFavorableDirections(usefulSpirit) {
    const directions = {
      '木': '东方、东南方',
      '火': '南方',
      '土': '中部、本地', 
      '金': '西方、西北方',
      '水': '北方'
    };
    return directions[usefulSpirit] || '各个方位';
  }

  function getCareerAdvice(strength, tenGods) {
    if (strength === 'strong') {
      return '积极开拓，把握领导机会，适合创业或管理岗位';
    } else {
      return '稳扎稳打，积累经验，寻找稳定的工作平台';
    }
  }

  function getWealthAnalysis(tenGods, elementCounts) {
    if (tenGods.includes('偏财')) {
      return '偏财运较好，有机会获得意外之财';
    } else if (tenGods.includes('正财')) {
      return '正财运稳定，适合稳定收入的工作';
    } else {
      return '财运平稳，需要通过努力获得财富';
    }
  }

  function getWealthDirections(usefulSpirit) {
    return getFavorableDirections(usefulSpirit);
  }

  function getHealthAnalysis(dayStem, elementCounts) {
    const healthMap = {
      '木': '注意肝胆、筋骨方面的问题',
      '火': '注意心血管、眼睛方面的问题', 
      '土': '注意脾胃、消化系统的问题',
      '金': '注意呼吸系统、皮肤方面的问题',
      '水': '注意肾脏、泌尿系统的问题'
    };
    return healthMap[dayStem] || '体质较为平衡';
  }

  function getHealthTips(usefulSpirit) {
    const tips = {
      '木': '少饮酒，保护视力，适度运动',
      '火': '控制情绪，避免熬夜，注意睡眠',
      '土': '规律饮食，避免暴饮暴食', 
      '金': '注意保暖，避免干燥环境',
      '水': '保持水分平衡，避免受凉'
    };
    return tips[usefulSpirit] || '保持健康生活习惯';
  }

  // 其他函数保持不变...
  function applyI18n() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      const val = t(key);
      if (val) el.textContent = val;
    });
  }

  // ... 保持其他工具函数和主逻辑不变
})();
</script>
</body>
</html>
