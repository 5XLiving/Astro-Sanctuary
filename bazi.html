<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="page_title">命理供门 · 八字简评（免费版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14;
      --card:#11161dCC;
      --line:#1f2a36;
      --text:#e8edf3;
      --muted:#98a7b7;
      --brand:#d4af37;
      --accent:#58b9ff;
      --radius:14px;
      --shadow:0 8px 30px rgba(0,0,0,.35);
      --blur:10px;
    }
    html,body{height:100%}
    html{font-size:16px}
    @media(min-width:768px){ html{font-size:17px} }
    @media(min-width:1200px){ html{font-size:18px} }
    body{
      margin:0; color:var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                  linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans SC", Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:url('assets/images/gate.jpg') center/cover no-repeat;
      filter:brightness(.45) saturate(.9) blur(2px);
    }
    .glow{
      position:fixed; inset:auto auto 10% -10%;
      width:45vw; height:45vw; max-width:700px; max-height:700px;
      background:radial-gradient(closest-side, #2a98ff33, transparent 70%);
      filter:blur(30px); z-index:-1; pointer-events:none;
    }
    .container{width:100%; max-width:1000px; padding:24px 16px 80px; margin:0 auto;}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(12px);
      background:#0b0f14cc; border-bottom:1px solid #0f1622;
    }
    .head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:16px}
    .brand{display:flex; align-items:center; gap:12px}
    .brand-badge{
      width:36px; height:36px; border-radius:10px; background:linear-gradient(145deg,#273243,#0e141c);
      display:grid; place-items:center; color:var(--brand); font-weight:700; box-shadow:var(--shadow)
    }
    .title{font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; letter-spacing:.02em; font-size:1.1rem}
    .subtitle{color:var(--muted); font-size:.9rem}

    /* 语言选择器（与 index.html 一致） */
    .lang{display:flex; align-items:center; gap:8px}
    .lang label{color:var(--muted); font-size:.9rem}
    .lang select{
      appearance:none; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text);
      padding:10px 34px 10px 12px; font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
    }

    .card{
      background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
      box-shadow:var(--shadow); backdrop-filter: blur(var(--blur)); padding:18px;
    }
    .stack{display:grid; gap:12px}
    .row{display:grid; gap:10px}
    @media(min-width:640px){ .row{grid-template-columns:1fr 1fr} }

    input,select,button{
      width:100%; box-sizing:border-box; border-radius:12px; border:1px solid #243244;
      background:#0e1520; color:var(--text); padding:14px 13px; font-size:1rem; outline:none;
    }
    input::placeholder{color:#6f8092}
    select{appearance:none; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}

    .btn{
      background:linear-gradient(180deg,#1d2a3a,#101723); border:1px solid #28364a;
      font-weight:600; letter-spacing:.02em; cursor:pointer; transition:transform .05s ease, box-shadow .2s ease, border .2s ease;
    }
    .btn:hover{box-shadow:0 6px 18px rgba(88,185,255,.15), inset 0 1px 0 #2e3c50}
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}

    .section{margin-top:18px}
    .section h2{
      font-family:"Noto Serif SC","Noto Serif",serif; font-weight:600; font-size:1.2rem; margin:0 0 12px;
      display:flex; align-items:center; gap:10px
    }
    .section h2::before{
      content:""; width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 0 4px #58b9ff22
    }

    .pillars{display:grid; gap:12px; grid-template-columns:repeat(2,1fr)}
    @media(min-width:900px){ .pillars{grid-template-columns:repeat(4,1fr)} }
    .pillar{border:1px solid #263448; border-radius:12px; padding:12px 12px 10px; background:#0d1420;}
    .pillar .tag{display:inline-block; font-size:.78rem; padding:4px 8px; border-radius:999px; border:1px solid #2b3a4f; color:#c7d5e6; background:#0b111b}
    .pillar .big{font-size:1.5rem; font-weight:700; margin:8px 0 2px}
    .pill-meta{display:flex; gap:8px; flex-wrap:wrap; color:var(--muted); font-size:.88rem}

    .bars{display:grid; gap:8px}
    .bar{background:#0e1622; border:1px solid #1e2a3a; height:10px; border-radius:999px; overflow:hidden}
    .bar>i{display:block; height:100%}
    .wood{background:#2e8b57} .fire{background:#ff5d3a} .earth{background:#caa563} .metal{background:#79a7ff} .water{background:#3aa9ff}

    .desc{color:#cfd9e6; line-height:1.8}
    .muted{color:var(--muted)}
    .ul{margin:.4rem 0 0; padding-left:1.1rem; text-align:left}
    .ul li{margin:.2rem 0}
    footer{color:#6c7b8c; font-size:.85rem; text-align:center; padding:30px 0}
    .error{color:#ff8f8f}
  </style>
</head>
<body>
  <div class="glow"></div>
  <header>
    <div class="head-inner container">
      <div class="brand">
        <div class="brand-badge">5X</div>
        <div>
          <div class="title" data-i18n="site_title">命理供门 · 八字简评</div>
          <div class="subtitle" data-i18n="site_subtitle">免费版 · 全面不深 | VIP 解锁流年/大运/择日/命名</div>
        </div>
      </div>
      <!-- 语言选择器：与 index.html 一致 -->
      <div class="lang">
        <label for="langSelect" data-i18n="lang_label">语言</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- 表单 -->
    <section class="card stack">
      <div class="row">
        <input id="name" data-i18n-ph="ph_name" placeholder="姓名（可选）">
        <select id="gender">
          <option value="" disabled selected data-i18n="opt_gender">选择性别</option>
          <option value="male" data-i18n="opt_male">男性</option>
          <option value="female" data-i18n="opt_female">女性</option>
        </select>
      </div>
      <div class="row">
        <input type="datetime-local" id="datetime">
        <select id="calendar">
          <option value="gregorian" data-i18n="opt_gregorian">阳历 / Gregorian</option>
          <option value="lunar" disabled data-i18n="opt_lunar">农历 / Lunar（即将支持）</option>
        </select>
      </div>
      <button class="btn" id="genBtn" onclick="showReport(event)" data-i18n="btn_generate">生成八字</button>
      <div class="muted" data-i18n="tip_tz">提示：当前默认东八区时间。若出生地非东八区，后续将支持时区换算。</div>
      <div class="error" id="error" style="display:none"></div>
    </section>

    <!-- 结果 -->
    <section id="result" style="display:none;" class="stack">
      <div class="card section">
        <h2 data-i18n="sec_bazi">八字命理排盘</h2>
        <div class="pillars" id="bazi-pillars"><!-- JS填充 --></div>
        <div class="muted" id="bazi-date"></div>
        <div class="muted" id="bazi-day-master"></div>
        <div class="muted" id="bazi-element"></div>
      </div>

      <div class="card section">
        <h2 data-i18n="sec_wuxing">五行分析</h2>
        <div class="bars">
          <div class="bar"><i id="bar-wood"  class="wood"  style="width:0%"></i></div>
          <div class="bar"><i id="bar-fire"  class="fire"  style="width:0%"></i></div>
          <div class="bar"><i id="bar-earth" class="earth" style="width:0%"></i></div>
          <div class="bar"><i id="bar-metal" class="metal" style="width:0%"></i></div>
          <div class="bar"><i id="bar-water" class="water" style="width:0%"></i></div>
        </div>
        <div class="muted" id="bazi-elements-balance" style="margin-top:8px"></div>
        <div class="muted" id="bazi-strengths" style="margin-top:6px"></div>
      </div>

      <div class="card section">
        <h2 data-i18n="sec_summary">命格简评</h2>
        <div class="desc" id="bazi-advice"></div>
        <ul class="ul" id="fate-points"></ul>
      </div>
    </section>
  </main>

  <footer>© 5XLiving • Astro Sanctuary</footer>

  <script>
    // ---------- 轻量多语言（与 index.html 同模式） ----------
    const translations = {
      "zh-CN": {
        page_title:"命理供门 · 八字简评（免费版）",
        site_title:"命理供门 · 八字简评",
        site_subtitle:"免费版 · 全面不深 | VIP 解锁流年/大运/择日/命名",
        lang_label:"语言",
        ph_name:"姓名（可选）",
        opt_gender:"选择性别", opt_male:"男性", opt_female:"女性",
        opt_gregorian:"阳历 / Gregorian", opt_lunar:"农历 / Lunar（即将支持）",
        btn_generate:"生成八字",
        tip_tz:"提示：当前默认东八区时间。若出生地非东八区，后续将支持时区换算。",
        sec_bazi:"八字命理排盘",
        sec_wuxing:"五行分析",
        sec_summary:"命格简评",
        lbl_birth:"出生时间：",
        lbl_animal:"生肖：",
        lbl_rizhu:"日主：",
        lbl_geju:"格局：",
        lbl_wuxing_sum:"五行总结：",
        lbl_traits:"性格特点：",
        lbl_career:"适合领域：",
        lbl_relate:"人际建议：",
        lbl_coord:"五行协调：",
        lbl_rzjp:"日柱简评：",
        lbl_lucky:"幸运：",
        err_choose_gender:"请选择性别",
        err_fill_datetime:"请填写出生日期时间",
        err_req_failed:"请求失败：",
        err_api:"API错误"
      },
      "zh-TW": {
        page_title:"命理供門 · 八字簡評（免費版）",
        site_title:"命理供門 · 八字簡評",
        site_subtitle:"免費版 · 全面不深 | VIP 解鎖流年/大運/擇日/命名",
        lang_label:"語言",
        ph_name:"姓名（可選）",
        opt_gender:"選擇性別", opt_male:"男性", opt_female:"女性",
        opt_gregorian:"陽曆 / Gregorian", opt_lunar:"農曆 / Lunar（即將支援）",
        btn_generate:"生成八字",
        tip_tz:"提示：目前預設東八區時間。若出生地非東八區，後續將支援時區換算。",
        sec_bazi:"八字命理排盤",
        sec_wuxing:"五行分析",
        sec_summary:"命格簡評",
        lbl_birth:"出生時間：",
        lbl_animal:"生肖：",
        lbl_rizhu:"日主：",
        lbl_geju:"格局：",
        lbl_wuxing_sum:"五行總結：",
        lbl_traits:"性格特點：",
        lbl_career:"適合領域：",
        lbl_relate:"人際建議：",
        lbl_coord:"五行協調：",
        lbl_rzjp:"日柱簡評：",
        lbl_lucky:"幸運：",
        err_choose_gender:"請選擇性別",
        err_fill_datetime:"請填寫出生日期時間",
        err_req_failed:"請求失敗：",
        err_api:"API 錯誤"
      },
      "en": {
        page_title:"Bazi Quick Reading (Free)",
        site_title:"Bazi · Quick Reading",
        site_subtitle:"Free overview · Unlock Annual Luck / Decade Luck / Dates / Naming in VIP",
        lang_label:"Language",
        ph_name:"Name (optional)",
        opt_gender:"Select gender", opt_male:"Male", opt_female:"Female",
        opt_gregorian:"Gregorian", opt_lunar:"Lunar (coming soon)",
        btn_generate:"Generate Reading",
        tip_tz:"Note: default timezone is UTC+8. Timezone conversion support is coming.",
        sec_bazi:"Four Pillars",
        sec_wuxing:"Five Elements",
        sec_summary:"Summary",
        lbl_birth:"Birth time: ",
        lbl_animal:"Zodiac: ",
        lbl_rizhu:"Day Master: ",
        lbl_geju:"Pattern: ",
        lbl_wuxing_sum:"Five-element summary: ",
        lbl_traits:"Personality: ",
        lbl_career:"Suitable fields: ",
        lbl_relate:"Relationship tips: ",
        lbl_coord:"Element balancing: ",
        lbl_rzjp:"Day-pillar note: ",
        lbl_lucky:"Lucky: ",
        err_choose_gender:"Please choose a gender",
        err_fill_datetime:"Please fill in birth date & time",
        err_req_failed:"Request failed: ",
        err_api:"API error"
      },
      "ja": {
        page_title:"四柱推命 · クイック鑑定（無料）",
        site_title:"四柱推命 · クイック鑑定",
        site_subtitle:"無料版 · 年運/大運/日取り/命名はVIPで解放",
        lang_label:"言語",
        ph_name:"名前（任意）",
        opt_gender:"性別を選択", opt_male:"男性", opt_female:"女性",
        opt_gregorian:"グレゴリオ暦", opt_lunar:"旧暦（近日対応）",
        btn_generate:"鑑定を生成",
        tip_tz:"注：現在は UTC+8 を既定としています。タイムゾーン変換は今後対応予定。",
        sec_bazi:"命式（年・月・日・時）",
        sec_wuxing:"五行分析",
        sec_summary:"総合コメント",
        lbl_birth:"出生時刻：",
        lbl_animal:"干支：",
        lbl_rizhu:"日主：",
        lbl_geju:"格局：",
        lbl_wuxing_sum:"五行まとめ：",
        lbl_traits:"性格：",
        lbl_career:"適職・適分野：",
        lbl_relate:"対人アドバイス：",
        lbl_coord:"五行バランス：",
        lbl_rzjp:"日柱メモ：",
        lbl_lucky:"ラッキー：",
        err_choose_gender:"性別を選択してください",
        err_fill_datetime:"生年月日時を入力してください",
        err_req_failed:"リクエスト失敗：",
        err_api:"API エラー"
      },
      "th": {
        page_title:"ดวงจีน Bazi · แบบย่อ (ฟรี)",
        site_title:"Bazi · แบบย่อ",
        site_subtitle:"เวอร์ชันฟรี · ปลดล็อกปีชง/มหาฐาน/ฤกษ์/ตั้งชื่อใน VIP",
        lang_label:"ภาษา",
        ph_name:"ชื่อ (ไม่บังคับ)",
        opt_gender:"เลือกเพศ", opt_male:"ชาย", opt_female:"หญิง",
        opt_gregorian:"สากล", opt_lunar:"จันทรคติ (เร็วๆ นี้)",
        btn_generate:"ดูดวง",
        tip_tz:"หมายเหตุ: ค่าเริ่มต้นใช้เวลา UTC+8 จะมีแปลงโซนเวลาในอนาคต",
        sec_bazi:"เส pillars (ปี เดือน วัน เวลา)",
        sec_wuxing:"ธาตุทั้งห้า",
        sec_summary:"สรุป",
        lbl_birth:"เวลาเกิด: ",
        lbl_animal:"นักษัตร: ",
        lbl_rizhu:"ดวงหลัก (Day Master): ",
        lbl_geju:"โครงสร้าง: ",
        lbl_wuxing_sum:"สรุปธาตุ: ",
        lbl_traits:"บุคลิก: ",
        lbl_career:"งานที่เหมาะ: ",
        lbl_relate:"ความสัมพันธ์: ",
        lbl_coord:"ปรับสมดุลธาตุ: ",
        lbl_rzjp:"โน้ตเสาแห่งวัน: ",
        lbl_lucky:"นำโชค: ",
        err_choose_gender:"กรุณาเลือกเพศ",
        err_fill_datetime:"กรุณากรอกวันเวลาเกิด",
        err_req_failed:"คำขอล้มเหลว: ",
        err_api:"ข้อผิดพลาด API"
      },
      "ms": {
        page_title:"Bazi · Bacaan Ringkas (Percuma)",
        site_title:"Bazi · Bacaan Ringkas",
        site_subtitle:"Percuma · Buka Kunci Nasib Tahunan/10 Tahun/Tarikh/Namanya di VIP",
        lang_label:"Bahasa",
        ph_name:"Nama (pilihan)",
        opt_gender:"Pilih jantina", opt_male:"Lelaki", opt_female:"Perempuan",
        opt_gregorian:"Gregorian", opt_lunar:"Lunar (akan datang)",
        btn_generate:"Jana Bacaan",
        tip_tz:"Nota: Zon masa lalai UTC+8. Sokongan pertukaran zon masa akan datang.",
        sec_bazi:"Empat Tiang",
        sec_wuxing:"Lima Unsur",
        sec_summary:"Ringkasan",
        lbl_birth:"Masa lahir: ",
        lbl_animal:"Zodiak: ",
        lbl_rizhu:"Day Master: ",
        lbl_geju:"Corak: ",
        lbl_wuxing_sum:"Ringkasan unsur: ",
        lbl_traits:"Keperibadian: ",
        lbl_career:"Bidang sesuai: ",
        lbl_relate:"Cadangan hubungan: ",
        lbl_coord:"Keseimbangan unsur: ",
        lbl_rzjp:"Nota tiang hari: ",
        lbl_lucky:"Bernasib baik: ",
        err_choose_gender:"Sila pilih jantina",
        err_fill_datetime:"Sila isi tarikh & masa lahir",
        err_req_failed:"Permintaan gagal: ",
        err_api:"Ralat API"
      }
    };

    const LANG_KEY = "site_lang";
    function getLang(){ return localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN"; }
    function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
    function t(key){
      const L = translations[getLang()] || translations["zh-CN"];
      return L[key] || (translations["zh-CN"][key] || key);
    }
    function applyI18n(){
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        el.textContent = t(key);
      });
      document.querySelectorAll("[data-i18n-ph]").forEach(el=>{
        const key = el.getAttribute("data-i18n-ph");
        el.setAttribute("placeholder", t(key));
      });
      const titleEl = document.querySelector("title[data-i18n]");
      if (titleEl) titleEl.textContent = t(titleEl.getAttribute("data-i18n"));
    }

    (function initLang(){
      const select = document.getElementById("langSelect");
      const current = getLang();
      select.value = current;
      applyI18n();
      select.addEventListener("change", ()=>{
        setLang(select.value);
        applyI18n();
      });
    })();
  </script>

  <script>
    // ---------- 渲染工具 ----------
    function renderPillars(pillars){
      const wrap = document.getElementById("bazi-pillars");
      if (!Array.isArray(pillars)) { wrap.innerHTML = "<div class='muted'>—</div>"; return; }
      wrap.innerHTML = pillars.map(p=>{
        const se = p.stem_element || "—";
        const be = p.branch_element || "—";
        const el = p.element || "—";
        const colorClass = {木:"wood",火:"fire",土:"earth",金:"metal",水:"water"}[el] || "";
        return `
          <div class="pillar">
            <span class="tag">${p.title||"—"}</span>
            <div class="big">${p.heavenly_stem||"—"}${p.earthly_branch||"—"}</div>
            <div class="pill-meta">
              <span>天干：${p.heavenly_stem||"—"}（${se}）</span>
              <span>地支：${p.earthly_branch||"—"}（${be}）</span>
              <span class="tag ${colorClass}">五行：${el}</span>
            </div>
            <div class="muted" style="margin-top:6px">纳音：${p.nayin||"—"}</div>
          </div>`;
      }).join("");
    }
    function renderBars(counts){
      const total = Math.max(1, (counts["木"]||0)+(counts["火"]||0)+(counts["土"]||0)+(counts["金"]||0)+(counts["水"]||0));
      const pct = k => Math.round((counts[k]||0)*100/total);
      document.getElementById("bar-wood").style.width  = pct("木")+"%";
      document.getElementById("bar-fire").style.width  = pct("火")+"%";
      document.getElementById("bar-earth").style.width = pct("土")+"%";
      document.getElementById("bar-metal").style.width = pct("金")+"%";
      document.getElementById("bar-water").style.width = pct("水")+"%";
    }
    function applyPrettyLayout(data){
      renderPillars(data.pillars||[]);
      renderBars(data.elements_count_8||{});
      document.getElementById("bazi-date").textContent =
        `${t('lbl_birth')}${data.solar_date||"—"} ${data.birth_time||"—"}　${t('lbl_animal')}${data.year_animal||"—"}`;
      document.getElementById("bazi-day-master").textContent =
        `${t('lbl_rizhu')}${data.day_master||"—"}（${data.day_master_element||"—"}）　${t('lbl_geju')}${data.structure||"—"}`;
      document.getElementById("bazi-element").textContent = `${t('lbl_wuxing_sum')}${data.elements_balance||"—"}`;

      const desc = document.getElementById("bazi-advice");
      desc.innerHTML =
        `<strong>${t('lbl_traits')}</strong>${data.personality_traits||"—"}<br>`+
        `<strong>${t('lbl_career')}</strong>${data.career_suggestions||"—"}<br>`+
        `<strong>${t('lbl_relate')}</strong>${data.relationships_advice||"—"}<br>`+
        `<strong>${t('lbl_coord')}</strong>${data.coordination_advice||"—"}<br>`+
        `<strong>${t('lbl_rzjp')}</strong>${data.day_pillar_note||"—"}<br>`+
        `<strong>${t('lbl_lucky')}</strong>${data.lucky_colors||"—"} / ${data.lucky_directions||"—"} / ${data.lucky_numbers||"—"}`;

      document.getElementById("bazi-elements-balance").textContent = data.strength_description || "";
      document.getElementById("bazi-strengths").textContent = data.tips || "";

      const fp = document.getElementById("fate-points");
      fp.innerHTML = (data.fate_points||[]).map(s=>`<li>${s}</li>`).join("");

      document.getElementById("result").style.display = "grid";
    }

    // ---------- 交互 ----------
    async function showReport(e){
      const btn = document.getElementById("genBtn");
      const err = document.getElementById("error");
      err.style.display="none"; err.textContent="";
      const gender = document.getElementById("gender").value;
      const datetime = document.getElementById("datetime").value;

      if (!gender) { err.textContent=t("err_choose_gender"); err.style.display="block"; return; }
      if (!datetime){ err.textContent=t("err_fill_datetime"); err.style.display="block"; return; }

      const [birth_date, birth_time] = datetime.split("T");
      const old = btn.textContent; btn.disabled = true; btn.textContent = t("btn_generate") + "…";

      try{
        const res = await fetch("https://api.5xliving.com/bazi", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ birth_date, birth_time, gender })
        });
        if(!res.ok){
          const tmsg = await res.text();
          throw new Error(`${t('err_api')}（${res.status}）：${tmsg}`);
        }
        const data = await res.json();
        applyPrettyLayout(data);
        window.scrollTo({ top: document.getElementById("result").offsetTop - 12, behavior: "smooth" });
      }catch(ex){
        err.textContent = t("err_req_failed") + ex.message;
        err.style.display="block";
      }finally{
        btn.disabled = false; btn.textContent = t("btn_generate");
      }
    }

    // 初始化默认时间
    window.addEventListener("DOMContentLoaded", ()=>{
      const el = document.getElementById("datetime");
      if (el) el.value = new Date().toISOString().slice(0,16);
    });
  </script>
</body>
</html>
