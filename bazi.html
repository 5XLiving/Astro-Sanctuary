<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ä¿æŒä½ çš„åŸæœ‰æ ·å¼ï¼Œå¹¶ä¿®å¤/è¡¥å…¨å°‘é‡ç»†èŠ‚ */
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%; margin:0; padding:0;}
    body{
      color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}

    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

    .site-header{position:sticky; top:0; z-index:10; background:#0b0f14cc; border-bottom:1px solid #0f1622; backdrop-filter:saturate(140%) blur(12px)}
    .head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084}
    .title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em; font-size:1.1rem}

    .lang{display:flex; align-items:center; gap:8px}
    .lang select{appearance:none; min-width:140px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}

    .section{margin-top:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .h2{font-size:1.2rem;margin:0 0 12px;font-weight:800;color:#ffe084;display:flex;gap:8px;align-items:center}
    .h2::before{content:"";width:4px;height:18px;background:var(--brand);border-radius:2px}

    .row{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:760px){.row.cols-3{grid-template-columns:1fr 1fr 1fr}.row.cols-2{grid-template-columns:1fr 1fr}}

    input,select{width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text); padding:12px 12px;font-size:15px;outline:none}
    input::placeholder{color:#6f8092}

    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer;transition:all 0.2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}
    .btn.block{display:block;width:100%}

    .pillars{display:grid;grid-template-columns:repeat(4,1fr);gap:10px; margin-bottom:20px}
    .pillar{background:#0f1624;border:1px solid #253245;border-radius:12px;padding:14px 10px;text-align:center}
    .pillar .tit{color:#9aa3b2;font-size:.85rem;margin-bottom:6px}
    .pillar .gz{font-size:1.5rem;font-weight:800;color:var(--gold2)}

    .bazi-table{width:100%;border-collapse:collapse;margin-top:12px;background:#0f1624;border-radius:8px;overflow:hidden}
    .bazi-table th,.bazi-table td{padding:10px 12px;border:1px solid #253245;text-align:center}
    .bazi-table th{background:rgba(212,175,55,.1);color:var(--gold2)}

    .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0; transition:width 0.5s ease}
    .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}

    .error-message{background:rgba(255,90,95,.1);border:1px solid #ff5a5f;border-radius:8px;padding:10px;display:none; margin-top:10px}
    .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
    .muted{color:var(--muted)}

    .time-row{display:flex;align-items:center;gap:10px}
    .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
    .time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

    .gen-wrap{display:flex;align-items:flex-end;justify-content:flex-end}
    #genBtn{width:auto !important}

    .analysis-grid {display:grid; gap:16px; margin-top:20px}
    .analysis-card {background:#0f1624; border:1px solid #253245; border-radius:12px; padding:16px}
    .analysis-card h3 {color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
    .analysis-content {line-height:1.6}
    .rating {display:flex; align-items:center; gap:8px; margin:8px 0}
    .rating-stars {color:var(--gold2)}
    .tag {display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:.85rem; margin:2px}

    .luck-grid {display:grid; gap:10px}
    .luck-item {background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
    .luck-year {font-weight:bold; color:var(--gold2)}
    .luck-desc {font-size:.9rem; margin-top:4px}

    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}

    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}

    .ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
    .ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
    .ai-box-c{color:#e8edf3; line-height:1.7}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #2a3546;background:#0e1520;color:#e8edf3;cursor:pointer; transition:all 0.2s ease}
    .chip:hover{border-color:#f2d27a;box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
    .chip:disabled{opacity:.6; cursor:not-allowed}

    .skeleton{display:grid;gap:8px}
    .skeleton div{height:12px;border-radius:6px;background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);animation:sh 1.2s infinite}
    @keyframes sh{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}

    .ai-lock-overlay{margin-top:10px;padding-top:10px;border-top:1px solid #1f2a36;text-align:center}
    .ai-lock-overlay .tip{color:#ffd88a;font-weight:700;margin-bottom:4px}
    .ai-lock-overlay .sub{color:var(--muted)}

    .detail-view {display:none}
    .detail-header {display:flex; align-items:center; gap:12px; margin-bottom:20px}
    .back-btn {background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
    .detail-content {line-height:1.8}
    .detail-section {margin-bottom:24px}
    .detail-section h4 {color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
    .action-list {list-style:none; padding:0}
    .action-list li {margin-bottom:8px; padding-left:20px; position:relative}
    .action-list li:before {content:"â€¢"; color:var(--gold2); position:absolute; left:0}

    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0; margin-top:40px}

    @media (max-width:520px){
      .title{font-size:1rem}
      .lang select{min-width:120px}
      .pillars{grid-template-columns:repeat(2,1fr)}
      .analysis-grid {grid-template-columns: 1fr}
    }

    .sr-only{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    .chips-container {display:flex;flex-wrap:wrap;gap:8px;margin:20px 0;justify-content:center}

    .vip-section {display:block !important}

    .butler-professional {display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
    .butler-header {display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:bold}
    .butler-content {line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:#0f1624; border-radius:10px; border:1px solid #253245}
    .butler-section {margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
    .butler-section h4 {color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
    .butler-chat {margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
    .chat-messages {height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:#0f1624; border-radius:8px; border:1px solid #253245}
    .chat-input-area {display:flex; gap:10px}
    .chat-input-area input {flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:var(--text)}
    .chat-send-btn {padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:bold; cursor:pointer}
  </style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="#" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="th">à¹„à¸—à¸¢</option>
        <option value="ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted">æ€§åˆ«</label>
        <select id="gender">
          <option value="">ä¸é€éœ²</option>
          <option value="male">ç”·æ€§</option>
          <option value="female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian">é˜³å†</option>
          <option value="lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span>å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

  <section id="result" style="display:none;">
    <div class="card">
      <div class="h2">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>

      <table class="bazi-table">
        <thead><tr><th></th><th>å¹´æŸ±</th><th>æœˆæŸ±</th><th>æ—¥æŸ±</th><th>æ—¶æŸ±</th></tr></thead>
        <tbody>
          <tr><td>å¤©å¹²</td><td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td></tr>
          <tr><td>åœ°æ”¯</td><td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td></tr>
          <tr><td>äº”è¡Œ</td><td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td></tr>
          <tr><td>çº³éŸ³</td><td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span>æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span>ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span>åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span>é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span>æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted" style="margin-top:8px"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span>ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
    <div class="butler-chat">
      <div class="chat-messages" id="chatMessages">
        <div class="ss-msg">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
        <button class="chat-send-btn" id="chatSend">å‘é€</button>
      </div>
    </div>
  </section>

  <section class="card section vip-section">
    <h2 class="group-title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li>å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li>äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li>è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li>å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li>çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li>å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li>å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li>æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email" required />
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" required />
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>

<script>
'use strict';

/* ========= å·¥å…· ========= */
const $ = id => document.getElementById(id);
function showError(message){const e=$('error'); if(!e) return; e.textContent=message; e.style.display='block'; setTimeout(()=>{e.style.display='none'},5000)}
function showAuthErr(message){const e=$('authError'); if(!e) return; e.textContent=message; e.style.display='block'; setTimeout(()=>{e.style.display='none'},5000)}
function hideAuthErr(){const e=$('authError'); if(!e) return; e.style.display='none'; e.textContent=''}
function lock(el,v){ if(el) el.disabled=v }
function setText(id, text){ const el=$(id); if(el) el.textContent=text }
function setBar(elementId, percentage){ const bar=$(elementId); if(bar){ requestAnimationFrame(()=>{ bar.style.width=Math.max(0,Math.min(100,percentage))+'%' }) } }

/* ========= å…«å­—è®¡ç®—æ ¸å¿ƒï¼ˆä¸ä½ çš„ç‰ˆæœ¬ä¸€è‡´ï¼Œç•¥ä½œæ³¨é‡Šï¼‰ ========= */
class BaziCalculator{
  constructor(){
    this.HEAVENLY_STEMS=['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    this.EARTHLY_BRANCHES=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
    this.ZODIAC=['é¼ ','ç‰›','è™','å…”','é¾™','è›‡','é©¬','ç¾Š','çŒ´','é¸¡','ç‹—','çŒª'];
    this.NAYIN=['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
  }
  calculateYearPillar(year){const s=(year-4)%10,b=(year-4)%12; return {stem:this.HEAVENLY_STEMS[(s+10)%10],branch:this.EARTHLY_BRANCHES[(b+12)%12],zodiac:this.ZODIAC[(b+12)%12]}}
  solarMonthIndex(y,m,d){const mmdd=m*100+d; const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]]; let idx=11; for(const [thr,val] of gates) if(mmdd>=thr) idx=val; const branchBy={1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'}; return {index:idx, branch:branchBy[idx]}}
  calculateMonthPillar(year,month,day){const {index,branch}=this.solarMonthIndex(year,month,day); const yStemIdx=this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem); const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0}; const stemIdx=(startMap[yStemIdx]+(index-1))%10; return {stem:this.HEAVENLY_STEMS[stemIdx], branch} }
  calculateDayPillar(year,month,day){const baseUTC=Date.UTC(1900,0,31); const targetUTC=Date.UTC(year,month-1,day); const dayDiff=Math.floor((targetUTC-baseUTC)/86400000); const stemIdx=(0+dayDiff)%10; const branchIdx=(4+dayDiff)%12; return {stem:this.HEAVENLY_STEMS[(stemIdx+10)%10], branch:this.EARTHLY_BRANCHES[(branchIdx+12)%12]}}
  calculateHourPillar(dayStem,hour){const branchMap={23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'}; const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8}; const dayIdx=this.HEAVENLY_STEMS.indexOf(dayStem); const hourIndex=Math.floor((hour+1)/2)%12; const stemIdx=(startMap[dayIdx]+hourIndex)%10; return {stem:this.HEAVENLY_STEMS[stemIdx], branch:branchMap[hour]} }
  getElement(stem,branch){const s={ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'}; const b={å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'}; return `${s[stem]}${b[branch]}`}
  getNayin(stem,branch){const si=this.HEAVENLY_STEMS.indexOf(stem), bi=this.EARTHLY_BRANCHES.indexOf(branch); return this.NAYIN[(si*2+bi)%this.NAYIN.length]}
  getStemElement(stem){return ({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'})[stem]}
  getBranchElement(branch){return ({å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'})[branch]}
  calculateBazi(year,month,day,hour=12,timeUnknown=false){
    const yearP=this.calculateYearPillar(year), monthP=this.calculateMonthPillar(year,month,day), dayP=this.calculateDayPillar(year,month,day);
    const hourP=timeUnknown?{stem:'ï¼Ÿ',branch:'ï¼Ÿ'}:this.calculateHourPillar(dayP.stem,hour);
    const dayElement=this.getStemElement(dayP.stem);
    const pillars={year:yearP,month:monthP,day:{...dayP,element:dayElement},hour:hourP};
    const cnt={æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    (timeUnknown?[yearP,monthP,dayP]:[yearP,monthP,dayP,hourP]).forEach(p=>{ if(p.stem&&p.stem!=='ï¼Ÿ') cnt[this.getStemElement(p.stem)]++; if(p.branch&&p.branch!=='ï¼Ÿ') cnt[this.getBranchElement(p.branch)]++ })
    const total=Object.values(cnt).reduce((a,b)=>a+b,0)||1;
    const pct={ wood:cnt['æœ¨']/total*100, fire:cnt['ç«']/total*100, earth:cnt['åœŸ']/total*100, metal:cnt['é‡‘']/total*100, water:cnt['æ°´']/total*100 };
    return {pillars, counts:cnt, percents:pct, timeUnknown}
  }
}
const baziCalculator=new BaziCalculator();

/* ========= æ˜¾ç¤ºæ¸²æŸ“ ========= */
function renderPillars(pillars, timeUnknown = false) {
  const container = $('bazi-pillars');
  if (!container) return;

  container.innerHTML = '';

  const items = [
    { t: 'å¹´æŸ±', p: pillars.year },
    { t: 'æœˆæŸ±', p: pillars.month },
    { t: 'æ—¥æŸ±', p: pillars.day },
    { t: 'æ—¶æŸ±', p: pillars.hour }
  ];

  items.forEach(({ t, p }) => {
    const u = (t === 'æ—¶æŸ±' && timeUnknown);
    const div = document.createElement('div');
    div.className = 'pillar';
    div.innerHTML = `
      <div class="tit">${t}</div>
      <div class="gz">${u ? 'ï¼Ÿ' : p.stem}${u ? 'ï¼Ÿ' : p.branch}</div>
    `;
    container.appendChild(div);
  });
}

function displayDetailedInfo(pillars, timeUnknown=false){
  setText('year-stem', pillars.year.stem); setText('year-branch', pillars.year.branch);
  setText('month-stem', pillars.month.stem); setText('month-branch', pillars.month.branch);
  setText('day-stem', pillars.day.stem); setText('day-branch', pillars.day.branch);
  setText('hour-stem', timeUnknown?'ï¼Ÿ':pillars.hour.stem); setText('hour-branch', timeUnknown?'ï¼Ÿ':pillars.hour.branch);
  setText('year-element', baziCalculator.getElement(pillars.year.stem, pillars.year.branch));
  setText('month-element', baziCalculator.getElement(pillars.month.stem, pillars.month.branch));
  setText('day-element', baziCalculator.getElement(pillars.day.stem, pillars.day.branch));
  setText('hour-element', timeUnknown?'æœªçŸ¥':baziCalculator.getElement(pillars.hour.stem, pillars.hour.branch));
  setText('year-nayin', baziCalculator.getNayin(pillars.year.stem, pillars.year.branch));
  setText('month-nayin', baziCalculator.getNayin(pillars.month.stem, pillars.month.branch));
  setText('day-nayin', baziCalculator.getNayin(pillars.day.stem, pillars.day.branch));
  setText('hour-nayin', timeUnknown?'æœªçŸ¥':baziCalculator.getNayin(pillars.hour.stem, pillars.hour.branch));
}

/* ========= åç¥æ˜ å°„ ========= */
const TEN_GODS_MAP={
  'ç”²':{'ç”²':'æ¯”è‚©','ä¹™':'åŠ«è´¢','ä¸™':'é£Ÿç¥','ä¸':'ä¼¤å®˜','æˆŠ':'åè´¢','å·±':'æ­£è´¢','åºš':'ä¸ƒæ€','è¾›':'æ­£å®˜','å£¬':'åå°','ç™¸':'æ­£å°'},
  'ä¹™':{'ç”²':'åŠ«è´¢','ä¹™':'æ¯”è‚©','ä¸™':'ä¼¤å®˜','ä¸':'é£Ÿç¥','æˆŠ':'æ­£è´¢','å·±':'åè´¢','åºš':'æ­£å®˜','è¾›':'ä¸ƒæ€','å£¬':'æ­£å°','ç™¸':'åå°'},
  'ä¸™':{'ç”²':'åå°','ä¹™':'æ­£å°','ä¸™':'æ¯”è‚©','ä¸':'åŠ«è´¢','æˆŠ':'é£Ÿç¥','å·±':'ä¼¤å®˜','åºš':'åè´¢','è¾›':'æ­£è´¢','å£¬':'ä¸ƒæ€','ç™¸':'æ­£å®˜'},
  'ä¸':{'ç”²':'æ­£å°','ä¹™':'åå°','ä¸™':'åŠ«è´¢','ä¸':'æ¯”è‚©','æˆŠ':'ä¼¤å®˜','å·±':'é£Ÿç¥','åºš':'æ­£è´¢','è¾›':'åè´¢','å£¬':'æ­£å®˜','ç™¸':'ä¸ƒæ€'},
  'æˆŠ':{'ç”²':'ä¸ƒæ€','ä¹™':'æ­£å®˜','ä¸™':'åå°','ä¸':'æ­£å°','æˆŠ':'æ¯”è‚©','å·±':'åŠ«è´¢','åºš':'é£Ÿç¥','è¾›':'ä¼¤å®˜','å£¬':'åè´¢','ç™¸':'æ­£è´¢'},
  'å·±':{'ç”²':'æ­£å®˜','ä¹™':'ä¸ƒæ€','ä¸™':'æ­£å°','ä¸':'åå°','æˆŠ':'åŠ«è´¢','å·±':'æ¯”è‚©','åºš':'ä¼¤å®˜','è¾›':'é£Ÿç¥','å£¬':'æ­£è´¢','ç™¸':'åè´¢'},
  'åºš':{'ç”²':'åè´¢','ä¹™':'æ­£è´¢','ä¸™':'ä¸ƒæ€','ä¸':'æ­£å®˜','æˆŠ':'åå°','å·±':'æ­£å°','åºš':'æ¯”è‚©','è¾›':'åŠ«è´¢','å£¬':'é£Ÿç¥','ç™¸':'ä¼¤å®˜'},
  'è¾›':{'ç”²':'æ­£è´¢','ä¹™':'åè´¢','ä¸™':'æ­£å®˜','ä¸':'ä¸ƒæ€','æˆŠ':'æ­£å°','å·±':'åå°','åºš':'åŠ«è´¢','è¾›':'æ¯”è‚©','å£¬':'ä¼¤å®˜','ç™¸':'é£Ÿç¥'},
  'å£¬':{'ç”²':'é£Ÿç¥','ä¹™':'ä¼¤å®˜','ä¸™':'åè´¢','ä¸':'æ­£è´¢','æˆŠ':'ä¸ƒæ€','å·±':'æ­£å®˜','åºš':'åå°','è¾›':'æ­£å°','å£¬':'æ¯”è‚©','ç™¸':'åŠ«è´¢'},
  'ç™¸':{'ç”²':'ä¼¤å®˜','ä¹™':'é£Ÿç¥','ä¸™':'æ­£è´¢','ä¸':'åè´¢','æˆŠ':'æ­£å®˜','å·±':'ä¸ƒæ€','åºš':'æ­£å°','è¾›':'åå°','å£¬':'åŠ«è´¢','ç™¸':'æ¯”è‚©'}
};

/* ========= ä¸“ä¸šæŠ¥å‘Šï¼šå®Œæ•´å¯è¿è¡Œå®ç° ========= */
function analyzeElementsDynamic(counts, dayElement){
  const elements=['æœ¨','ç«','åœŸ','é‡‘','æ°´'];
  return elements.map(el=>{
    const c=counts[el]||0; const relation=getElementRelation(dayElement,el);
    return `<p><strong>${el}å…ƒç´ ï¼š</strong>${c}ä¸ª - ${relation}</p>`
  }).join('')
}

function getElementRelation(dayEl,target){
  const r={
    'æœ¨':{'æœ¨':'åŒæˆ‘','ç«':'æˆ‘ç”Ÿ','åœŸ':'æˆ‘å…‹','é‡‘':'å…‹æˆ‘','æ°´':'ç”Ÿæˆ‘'},
    'ç«':{'æœ¨':'ç”Ÿæˆ‘','ç«':'åŒæˆ‘','åœŸ':'æˆ‘ç”Ÿ','é‡‘':'æˆ‘å…‹','æ°´':'å…‹æˆ‘'},
    'åœŸ':{'æœ¨':'å…‹æˆ‘','ç«':'æˆ‘ç”Ÿ','åœŸ':'åŒæˆ‘','é‡‘':'æˆ‘å…‹','æ°´':'æˆ‘ç”Ÿ'},
    'é‡‘':{'æœ¨':'æˆ‘å…‹','ç«':'å…‹æˆ‘','åœŸ':'ç”Ÿæˆ‘','é‡‘':'åŒæˆ‘','æ°´':'æˆ‘ç”Ÿ'},
    'æ°´':{'æœ¨':'æˆ‘ç”Ÿ','ç«':'æˆ‘å…‹','åœŸ':'å…‹æˆ‘','é‡‘':'ç”Ÿæˆ‘','æ°´':'åŒæˆ‘'}
  }; return r[dayEl]?.[target]||'æœªçŸ¥å…³ç³»'
}

function analyzeTenGodsDynamic(pillars, dayStem){
  const pos=['å¹´æŸ±','æœˆæŸ±','æ—¥æŸ±','æ—¶æŸ±']; const keys=['year','month','day','hour'];
  return keys.map((k,i)=>{ const st=pillars[k].stem; if(!st||st==='ï¼Ÿ') return '';
    const tg=TEN_GODS_MAP[dayStem]?.[st]||'æœªçŸ¥'; return `<p><strong>${pos[i]}ï¼š</strong>${tg}ï¼ˆ${st}ï¼‰</p>`
  }).join('')
}

function getSupportingElements(el){return ({'æœ¨':['æ°´','æœ¨'],'ç«':['æœ¨','ç«'],'åœŸ':['ç«','åœŸ'],'é‡‘':['åœŸ','é‡‘'],'æ°´':['é‡‘','æ°´']})[el]||[]}
function getControllingElements(el){return ({'æœ¨':['é‡‘','ç«','åœŸ'],'ç«':['æ°´','åœŸ','é‡‘'],'åœŸ':['æœ¨','é‡‘','æ°´'],'é‡‘':['ç«','æ°´','æœ¨'],'æ°´':['åœŸ','æœ¨','ç«']})[el]||[]}

function getSeasonalAdvice(monthBranch){
  const m={ 'å¯…':'æ˜¥æœ¨æ—ºï¼Œå®œé‡‘åˆ¶æœ¨', 'å¯':'æ˜¥æœ¨æ—ºï¼Œå®œé‡‘åˆ¶æœ¨', 'è¾°':'æ˜¥æœ«åœŸæ—ºï¼Œå®œæœ¨ç–åœŸ',
            'å·³':'å¤ç«æ—ºï¼Œå®œæ°´æµç«', 'åˆ':'å¤ç«æ—ºï¼Œå®œæ°´æµç«', 'æœª':'å¤æœ«åœŸæ—ºï¼Œå®œæ°´æ¶¦åœŸ',
            'ç”³':'ç§‹é‡‘æ—ºï¼Œå®œç«ç‚¼é‡‘', 'é…‰':'ç§‹é‡‘æ—ºï¼Œå®œç«ç‚¼é‡‘', 'æˆŒ':'ç§‹æœ«åœŸæ—ºï¼Œå®œæœ¨ç–åœŸ',
            'äº¥':'å†¬æ°´æ—ºï¼Œå®œç«æš–å±€', 'å­':'å†¬æ°´æ—ºï¼Œå®œç«æš–å±€', 'ä¸‘':'å†¬æœ«åœŸæ—ºï¼Œå®œç«æš–åœŸ' };
  return m[monthBranch]||'å››æ—¶è°ƒå€™ï¼Œä»¥è¡¡å¹³ä¸ºå…ˆ'
}

function getLuckyColors(useful){const map={'æœ¨':'ç»¿è‰²ã€é’è‰²','ç«':'çº¢è‰²ã€ç´«è‰²','åœŸ':'é»„è‰²ã€æ£•è‰²','é‡‘':'ç™½è‰²ã€é‡‘è‰²','æ°´':'é»‘è‰²ã€è“è‰²'}; return useful.map(x=>map[x]).filter(Boolean).join('ã€')}
function getLuckyDirections(useful){const map={'æœ¨':'ä¸œæ–¹','ç«':'å—æ–¹','åœŸ':'ä¸­å¤®','é‡‘':'è¥¿æ–¹','æ°´':'åŒ—æ–¹'}; return useful.map(x=>map[x]).filter(Boolean).join('ã€')}

function getCareerReason(dayStem){const r={'ç”²':'é¢†å¯¼åŠ›å¼ºï¼Œæ“…å¼€æ‹“','ä¹™':'é€‚åº”åè°ƒä½³','ä¸™':'çƒ­æƒ…åˆ›æ„å¼º','ä¸':'ç»†è‡´ç­–åˆ’ä¼˜','æˆŠ':'ç¨³å¥ç®¡ç†å¼º','å·±':'åŠ¡å®æœåŠ¡ç¨³','åºš':'æœæ–­æ‰§è¡Œå¼º','è¾›':'å®¡ç¾ä¸è´¨æ„Ÿå¼º','å£¬':'æµåŠ¨ä¸æ•´åˆå¼º','ç™¸':'æ´å¯Ÿä¸ç ”ç©¶å¼º'}; return r[dayStem]||'ç»¼åˆèƒ½åŠ›å‡è¡¡'}

function getSuitableCareers(dayStem){
  const m={'ç”²':['ç®¡ç†','é¢†å¯¼','å¼€æ‹“'],'ä¹™':['è‰ºæœ¯','æ•™è‚²','æœåŠ¡'],'ä¸™':['åˆ›æ„','ä¼ åª’','å¨±ä¹'],'ä¸':['æŠ€æœ¯','ç ”ç©¶','ç­–åˆ’'],'æˆŠ':['é‡‘è','åœ°äº§','ç®¡ç†'],'å·±':['æ•™è‚²','åŒ»ç–—','æœåŠ¡'],'åºš':['æ³•å¾‹','å†›è­¦','æŠ€æœ¯'],'è¾›':['é‡‘è','ç å®','è‰ºæœ¯'],'å£¬':['è´¸æ˜“','ç‰©æµ','å’¨è¯¢'],'ç™¸':['æ–‡åŒ–','è‰ºæœ¯','å¿ƒç†å­¦']};
  const arr=m[dayStem]||['ç»¼åˆå‘å±•'];
  return arr.map(field=>({field,reason:getCareerReason(dayStem)}))
}

function getSuitableIndustries(dayStem){
  const el=baziCalculator.getStemElement(dayStem);
  const map={
    'æœ¨':'æ—æœ¨/æ•™è‚²/æ–‡åˆ›/è®¾è®¡/åŒ»ç–—/ç”Ÿç‰©',
    'ç«':'èƒ½æº/é¤é¥®/ç”µå•†/ä¼ åª’/æ¼”å‡º',
    'åœŸ':'ä¸åŠ¨äº§/å†œä¸š/åœŸæœ¨/ä¸­ä»‹/ä»“å‚¨',
    'é‡‘':'é‡‘è/é‡‘å±/æ³•å¾‹/å®‰ä¿/ç²¾å¯†åˆ¶é€ ',
    'æ°´':'èˆªè¿/ç‰©æµ/æ—…æ¸¸/å’¨è¯¢/æ•°æ®/è½¯ä»¶'
  };
  return map[el]||'ç»¼åˆè¡Œä¸šå‡å¯'
}

function getWorkplaceStrengths(dayStem){
  const m={'ç”²':'ç›´ç‡æ‹…å½“ã€æ‰§è¡ŒåŠ›å¼º','ä¹™':'äººå’ŒåŠ›å¼ºã€æ¶¦ç‰©ç»†æ— å£°','ä¸™':'æ„ŸæŸ“åŠ›å¼ºã€å–„ç‚¹ç‡ƒå›¢é˜Ÿ','ä¸':'ç­–ç•¥ç»†è…»ã€ç¨³æ‰ç¨³æ‰“','æˆŠ':'å¯é å¯ä¿¡ã€èƒ½æ‰›é‡è´£','å·±':'æœåŠ¡æ„è¯†å¼ºã€ç¨³å®šååŒ','åºš':'è§„åˆ™æ„è¯†å¼ºã€å¿«é€Ÿå†³æ–­','è¾›':'å“è´¨æ„Ÿé«˜ã€ç»†èŠ‚æ§','å£¬':'è§†é‡å¤§ã€è·¨ç•Œæ•´åˆ','ç™¸':'æ´å¯Ÿæ·±ã€å­¦ä¹ å¿«'};return m[dayStem]||'ç¨³å¥åŠ¡å®'}

function getCareerAdvice(pillars,counts){
  const el=baziCalculator.getStemElement(pillars.day.stem);
  const weak = Object.entries(counts).sort((a,b)=>a[1]-b[1])[0][0];
  return `èšç„¦${getSuitableIndustries(pillars.day.stem)}æ–¹å‘ï¼Œå‘æŒ¥${getWorkplaceStrengths(pillars.day.stem)}ï¼›é€‚åº¦è¡¥${weak}ä¹‹ä¸è¶³ï¼Œå½¢æˆé—­ç¯ä¼˜åŠ¿ã€‚`
}

function countWealthGods(pillars, dayStem){
  const stems=[pillars.year.stem,pillars.month.stem,pillars.hour.stem].filter(s=>s&&s!=='ï¼Ÿ');
  return stems.reduce((n,s)=>{const g=TEN_GODS_MAP[dayStem]?.[s]; return n+((g==='æ­£è´¢'||g==='åè´¢')?1:0)},0)
}
function countOfficerGods(pillars, dayStem){
  const stems=[pillars.year.stem,pillars.month.stem,pillars.hour.stem].filter(s=>s&&s!=='ï¼Ÿ');
  return stems.reduce((n,s)=>{const g=TEN_GODS_MAP[dayStem]?.[s]; return n+((g==='æ­£å®˜'||g==='ä¸ƒæ€')?1:0)},0)
}

function analyzeWealthPattern(pillars, dayStem){
  const w=countWealthGods(pillars,dayStem); const o=countOfficerGods(pillars,dayStem);
  let level='ä¸­ç­‰'; if(w>=2&&o>=1) level='è¾ƒå¥½'; if(w>=2&&o>=2) level='ä¸Šç­‰';
  const desc=(w>0?`è§è´¢æ˜Ÿ${w}å¤„`:'è´¢æ˜Ÿå¼±')+'ï¼›'+(o>0?`å®˜æ˜Ÿ${o}åŠ©è§„èŒƒ`:'å°‘å®˜æ˜Ÿï¼Œå®œè‡ªç”±èŒä¸š');
  const dirs=['æ­£ä¸œæ–¹','ä¸œå—æ–¹','å—æ–¹'];
  const advice='é‡è§†ç°é‡‘æµä¸å¤åˆ©ï¼Œå°‘åšé«˜æ æ†ï¼›ä»¥ä¸»ä¸šç°é‡‘å¥¶ç‰›+å‰¯ä¸šæˆé•¿ä¸ºåŒè½®ã€‚';
  const invest='å®œï¼šæŒ‡æ•°åŸºé‡‘/ç°é‡‘æµå‹æ ‡çš„ï¼›å¿Œï¼šçŸ­çº¿é‡ä»“ã€æƒ…ç»ªåŒ–è¿½æ¶¨æ€è·Œã€‚';
  return {level, description:desc, directions:dirs, advice, investmentTips:invest}
}

function getLoveAnalysis(dayStem, counts){
  const el=baziCalculator.getStemElement(dayStem); const water=counts['æ°´']||0; const fire=counts['ç«']||0;
  let pattern='é‡æƒ…ç†æ€§å¹¶é‡'; if(fire>=3) pattern='çƒ­çƒˆç›´æ¥ã€å…ˆæƒ…åç†'; if(water>=3) pattern='æ„Ÿå—ç»†è…»ã€å…ˆç†åæƒ…';
  const ideal={'æœ¨':'æ¸©æŸ”ä½“è´´ã€ä»·å€¼è§‚å¥‘åˆ','ç«':'æ¬£èµä¸é¼“åŠ±ã€èŠ‚å¥ç›¸è¿‘','åœŸ':'ç¨³å®šå¯é ã€åŠ¡å®å…±å»º','é‡‘':'è§„åˆ™è¾¹ç•Œæ¸…æ™°ã€å½¼æ­¤å°Šé‡','æ°´':'æ²Ÿé€šé¡ºæ»‘ã€å¿ƒæ™ºåŒé¢‘'}[el];
  const advice='å…ˆå®šèŠ‚å¥ä¸è¾¹ç•Œï¼Œå†è°ˆæ·±åº¦ï¼›ä»¥å…±åŒç›®æ ‡ä¸ºç‰µå¼•ï¼Œå°‘ç”¨è¯•æ¢ã€‚';
  const timing='é€¢æ¡ƒèŠ±ä¸è´¢å®˜é€å‡ºä¹‹å¹´æ›´æ˜“å®šå±€ï¼ˆå‚è€ƒæµå¹´æ”¯ä¸åç¥ï¼‰ã€‚';
  const notes='é¿å…æƒ…ç»ªæ‹‰æ‰¯ä¸é•¿æœŸä¸ç¡®å®šï¼Œä¿æŒâ€œåé¦ˆâ€”ä¿®æ­£â€ä¸¤å‘¨ä¸€å¾ªç¯ã€‚';
  return {pattern, idealPartner:ideal, advice, timing, notes}
}

function getHealthAnalysis(dayElement, counts){
  const tips={'æœ¨':'è‚èƒ†/ç­‹ï¼Œå®œæ‹‰ä¼¸ä¸æ—©ç¡','ç«':'å¿ƒå°è‚ /è¡€å‹ï¼Œå®œæœ‰æ°§ä¸å†¥æƒ³','åœŸ':'è„¾èƒƒ/ä»£è°¢ï¼Œå®œæ¸…æ·¡è§„å¾‹','é‡‘':'è‚ºå¤§è‚ /çš®è‚¤ï¼Œå®œå‘¼å¸ç»ƒä¹ ','æ°´':'è‚¾è†€èƒ±/è…°è†ï¼Œå®œè¡¥æ°´ä¸æ—©å¯'};
  const diet={'æœ¨':'å¤šç»¿å¶è”¬æœï¼Œå°‘æ²¹ç‚¸','ç«':'å¤šé«˜çº¤ä½ç³–ï¼Œå°‘è¾›è¾£','åœŸ':'å°‘ç”œå°‘æ²¹ï¼Œå¤šç²—ç²®','é‡‘':'å¤šç™½è‰²è”¬æœï¼Œæˆ’çƒŸå°˜','æ°´':'å¤šæ°´ä¸é»‘è‰²é£Ÿæï¼Œå°‘ç†¬å¤œ'};
  const exercise={'æœ¨':'ç‘œä¼½/æ™®æ‹‰æ/æ‹‰ä¼¸','ç«':'è·‘æ­¥/èˆåŠ¨/çƒç±»','åœŸ':'å¿«èµ°/å¾’æ­¥/åŠ›é‡','é‡‘':'å‘¼å¸æ“/éª‘è¡Œ','æ°´':'æ¸¸æ³³/å¤ªæ/æ ¸å¿ƒç¨³å®š'};
  const weak=Object.entries(counts).sort((a,b)=>a[1]-b[1])[0][0];
  return {constitution:tips[dayElement]||'å¹³è¡¡ä½“è´¨', vulnerabilities:[weak+'ç›¸å…³ç³»ç»Ÿ'], healthTips:'å›´ç»•ä½œæ¯ã€è¡¥çŸ­æ¿å…ƒç´ åšå¹²é¢„', dietAdvice:diet[dayElement]||'æ¸…æ·¡å‡è¡¡', exercise:exercise[dayElement]||'ä¸­ç­‰å¼ºåº¦æœ‰æ°§'}
}

function getSpiritualAnalysis(dayStem){
  const trait={'ç”²':'ä½¿å‘½é©±åŠ¨ã€é€‚åˆâ€œä¿®èº«ç«‹ä¸šâ€å¹¶è¡Œ','ä¹™':'æ„ŸçŸ¥ç»†è…»ã€é€‚åˆç–—æ„ˆä¸è‰ºæœ¯ä¿®è¡Œ','ä¸™':'å…‰äº®å¤–æ”¾ã€é€‚åˆå¸¦é¢†ç¤¾ç¾¤','ä¸':'çƒ›ç…§ç»†ç«ã€é€‚åˆå¿ƒæ€§ä¸ç»å…¸ç ”ä¿®','æˆŠ':'å±±å²³å®šåŠ›ã€é€‚åˆé•¿æœŸçºªå¾‹ä¿®è¡Œ','å·±':'åšå¾·è½½ç‰©ã€é€‚åˆæœåŠ¡å‹ä¿®è¡Œ','åºš':'æ–©æ–­æœå†³ã€é€‚åˆæˆ’å¾‹ä¸æ­¦ä¿®','è¾›':'åŒ å¿ƒçº¯ç²¹ã€é€‚åˆç²¾å¾®ä¹‹å­¦','å£¬':'åŒ…å®¹æµåŠ¨ã€é€‚åˆæ°´æ³•/ç¦…ä¿®','ç™¸':'æ·±æ½œé™å®šã€é€‚åˆè§‚æƒ³å†…ä¿®'};
  return {traits:trait[dayStem]||'ç»¼åˆå‹', talents:['å†¥æƒ³','ç¥ˆæ„¿','è®°å½•'], practices:'æ™¨é™å+æ™šå¤ç›˜ï¼Œå‘¨ä¸€å›ºå®šâ€œå‡€å¿ƒæ—¥â€', advice:'ä»¥â€œæ—¥è¯¾10åˆ†é’Ÿâ€æ‰“åº•ï¼Œæœˆåº¦åšä¸€æ¬¡å°é—­å…³'}
}

function getYearlyLuck(year, pillars){
  // ç®€æ´ç‰ˆå ä½ï¼šçœŸå®ç³»ç»Ÿåº”æŒ‰å¤§è¿æµå¹´æ¨æ¼”
  const br=pillars.month.branch; const hint={'å¯…':'æœ¨é£èµ·ï¼Œå®œå¼€æ–°å±€','å¯':'è°‹å®šååŠ¨','è¾°':'ç¨³å¥æ¨è¿›','å·³':'å£°é‡æå‡','åˆ':'äººæ°”æ´»è·ƒ','æœª':'æ”¶æŸæ²‰æ·€','ç”³':'ç»“æ„è°ƒæ•´','é…‰':'å“ç‰Œæ‰“ç£¨','æˆŒ':'èµ„æºæ•´åˆ','äº¥':'è“„åŠ¿å­¦ä¹ ','å­':'ç°é‡‘æµä¼˜å…ˆ','ä¸‘':'ç¨³æ­¥ç§¯ç´¯'}[br]||'å¹³è¡¡ä¸ºå…ˆ';
  return `${year}ï¼š${hint}`
}
function getCareerOpportunities(){return 'Q2-Q3 å¤–ç¼˜æ›´æ—ºï¼Œå®œç«‹é¡¹/ç­¾çº¦ï¼›Q4 æ”¶å£äº¤ä»˜ã€‚'}
function getWealthTrend(){return 'ç°é‡‘æµå…ˆè¡Œï¼Œåšâ€œå¼ºæ”¶æ¬¾+å¼±æŠ•æœºâ€ï¼›é‡ç‚¹çœ‹å¤è´­ä¸å£ç¢‘ã€‚'}
function getLoveTrend(){return 'æ²Ÿé€šæ•ˆç‡æå‡ï¼Œå®œæ˜ç¡®â€œå…³ç³»èŠ‚å¥è¡¨â€ã€‚'}
function getHealthWarning(){return 'æ³¨æ„ç¡çœ ä¸æ¶ˆåŒ–ï¼Œåˆ«è¿è½´è½¬ï¼›æ¯å‘¨è‡³å°‘2æ¬¡ä¸­å¼ºåº¦è¿åŠ¨ã€‚'}

function getLifeStrategy(dayStem, bodyStrength, counts){
  const weak=Object.entries(counts).sort((a,b)=>a[1]-b[1])[0][0];
  return {
    stages:[
      {period:'0-35', focus:'æ‰“åŸºç¡€/éªŒèµ›é“ï¼Œåšä¸€æŠ€ä¹‹é•¿'},
      {period:'35-50', focus:'å½¢æˆäº§å“åŒ–/å“ç‰ŒåŒ–ï¼Œæ‰©å¤§ç°é‡‘æµ'},
      {period:'50+', focus:'çŸ¥è¯†æ²‰æ·€/ç‰ˆæƒåŒ–/ä¼ æ‰¿'}
    ],
    coreStrategy:`ä»¥â€œå¼ºé¡¹Ã—åœºæ™¯â€æ‰“é€ å¯å¤åˆ¶äº§å“ï¼›æ¯å­£ä¿®æ­£ä¸€æ¬¡è·¯çº¿ã€‚`,
    keyDecisions:`å›´ç»• ${getSuitableIndustries(dayStem)} åšèšç„¦ï¼Œå¼±åŒ–${weak}ç›¸å…³çš„çŸ­æ¿ä¸šåŠ¡ã€‚`,
    growthTips:'ä½¿ç”¨OKRä¸å‘¨å¤ç›˜ï¼Œå»ºç«‹æ•°æ®çœ‹æ¿ä¸å¤ç›˜èŠ‚å¾‹ã€‚'
  }
}

/* ========= ç»¼åˆæŠ¥å‘Šè£…é… ========= */
function generateDynamicReport(baziData){
  const {pillars, counts, percents, timeUnknown}=baziData; const dayStem=pillars.day.stem; const dayElement=pillars.day.element;
  const total=Object.values(counts).reduce((a,b)=>a+b,0); const selfStrength=((counts[dayElement]/(total||1))*100).toFixed(1); const bodyStrength=parseFloat(selfStrength)>=30?'èº«å¼º':'èº«å¼±';
  const useful = (parseFloat(selfStrength)>=30) ? getControllingElements(dayElement) : getSupportingElements(dayElement);
  const avoid  = (parseFloat(selfStrength)>=30) ? getSupportingElements(dayElement) : getControllingElements(dayElement);

  const wealthPattern=analyzeWealthPattern(pillars, dayStem);
  const love=getLoveAnalysis(dayStem, counts);
  const health=getHealthAnalysis(dayElement, counts);
  const spirit=getSpiritualAnalysis(dayStem);
  const year=new Date().getFullYear();

  return `
    <div class="butler-section">
      <h4>ğŸ”® ä¸€ã€å‘½ç›˜æ€»è§ˆ</h4>
      <p><strong>å…«å­—ï¼š</strong>${pillars.year.stem}${pillars.year.branch} ${pillars.month.stem}${pillars.month.branch} ${pillars.day.stem}${pillars.day.branch} ${pillars.hour.stem}${pillars.hour.branch}</p>
      <p><strong>æ—¥ä¸»ï¼š</strong>${dayStem}${dayElement}ï¼ˆ${bodyStrength}ï¼Œå æ¯”${selfStrength}%ï¼‰</p>
      <p><strong>äº”è¡Œåˆ†å¸ƒï¼š</strong>æœ¨${Math.round(percents.wood)}% ç«${Math.round(percents.fire)}% åœŸ${Math.round(percents.earth)}% é‡‘${Math.round(percents.metal)}% æ°´${Math.round(percents.water)}%</p>
    </div>
    <div class="butler-section"><h4>ğŸ“Š äºŒã€äº”è¡Œèƒ½é‡åˆ†æ</h4>${analyzeElementsDynamic(counts, dayElement)}</div>
    <div class="butler-section"><h4>âš”ï¸ ä¸‰ã€åç¥é…ç½®åˆ†æ</h4>${analyzeTenGodsDynamic(pillars, dayStem)}</div>
    <div class="butler-section"><h4>ğŸ’ å››ã€ç”¨ç¥å–œå¿Œåˆ†æ</h4>
      <p><strong>èº«å¼ºåˆ¤å®šï¼š</strong>${bodyStrength}</p>
      <p><strong>å–œç”¨ç¥ï¼š</strong>${useful.join('ã€')}ã€€<strong>å¿Œç¥ï¼š</strong>${avoid.join('ã€')}</p>
      <p><strong>è°ƒå€™å»ºè®®ï¼š</strong>${getSeasonalAdvice(pillars.month.branch)}</p>
      <p><strong>å¹¸è¿é¢œè‰²ï¼š</strong>${getLuckyColors(useful)}ã€€<strong>æœ‰åˆ©æ–¹ä½ï¼š</strong>${getLuckyDirections(useful)}</p>
    </div>
    <div class="butler-section"><h4>ğŸ¯ äº”ã€äº‹ä¸šå‘å±•åˆ†æ</h4>
      <p><strong>å¤©èµ‹é¢†åŸŸï¼š</strong></p>
      <ul>${getSuitableCareers(dayStem).map(c=>`<li><strong>${c.field}</strong> - ${c.reason}</li>`).join('')}</ul>
      <p><strong>é€‚åˆè¡Œä¸šï¼š</strong>${getSuitableIndustries(dayStem)}</p>
      <p><strong>èŒåœºä¼˜åŠ¿ï¼š</strong>${getWorkplaceStrengths(dayStem)}</p>
      <p><strong>å‘å±•å»ºè®®ï¼š</strong>${getCareerAdvice(pillars, counts)}</p>
    </div>
    <div class="butler-section"><h4>ğŸ’° å…­ã€è´¢è¿èµ°åŠ¿åˆ†æ</h4>
      <p><strong>è´¢è¿æ ¼å±€ï¼š</strong>${wealthPattern.level}</p>
      <p><strong>è´¢å¯Œç‰¹å¾ï¼š</strong>${wealthPattern.description}</p>
      <p><strong>æ±‚è´¢æ–¹å‘ï¼š</strong>${wealthPattern.directions.join('ã€')}</p>
      <p><strong>ç†è´¢å»ºè®®ï¼š</strong>${wealthPattern.advice}</p>
      <p><strong>æŠ•èµ„å®œå¿Œï¼š</strong>${wealthPattern.investmentTips}</p>
    </div>
    <div class="butler-section"><h4>â¤ï¸ ä¸ƒã€æ„Ÿæƒ…å©šå§»åˆ†æ</h4>
      <p><strong>æ„Ÿæƒ…æ¨¡å¼ï¼š</strong>${love.pattern}</p>
      <p><strong>ç†æƒ³ä¼´ä¾£ï¼š</strong>${love.idealPartner}</p>
      <p><strong>ç›¸å¤„å»ºè®®ï¼š</strong>${love.advice}</p>
      <p><strong>å©šæ‹æ—¶æœºï¼š</strong>${love.timing}</p>
      <p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>${love.notes}</p>
    </div>
    <div class="butler-section"><h4>ğŸŒ¿ å…«ã€å¥åº·å…»ç”Ÿåˆ†æ</h4>
      <p><strong>ä½“è´¨ç‰¹ç‚¹ï¼š</strong>${health.constitution}</p>
      <p><strong>æ˜“æ‚£å€¾å‘ï¼š</strong>${health.vulnerabilities.join('ã€')}</p>
      <p><strong>å…»ç”Ÿé‡ç‚¹ï¼š</strong>${health.healthTips}</p>
      <p><strong>é¥®é£Ÿå»ºè®®ï¼š</strong>${health.dietAdvice}</p>
      <p><strong>è¿åŠ¨æ¨èï¼š</strong>${health.exercise}</p>
    </div>
    <div class="butler-section"><h4>ğŸ”® ä¹ã€ç„å­¦ç¼˜åˆ†</h4>
      <p><strong>çµæ€§ç‰¹è´¨ï¼š</strong>${spirit.traits}</p>
      <p><strong>ç„å­¦å¤©èµ‹ï¼š</strong>${spirit.talents.join('ã€')}</p>
      <p><strong>é€‚åˆæ³•é—¨ï¼š</strong>${spirit.practices}</p>
      <p><strong>ä¿®è¡Œå»ºè®®ï¼š</strong>${spirit.advice}</p>
    </div>
    <div class="butler-section"><h4>ğŸ“… åã€è¿‘æœŸè¿åŠ¿å»ºè®®</h4>
      <p><strong>å½“å‰æµå¹´ï¼š</strong>${getYearlyLuck(year, pillars)}</p>
      <p><strong>äº‹ä¸šæœºé‡ï¼š</strong>${getCareerOpportunities()}</p>
      <p><strong>è´¢è¿èµ°åŠ¿ï¼š</strong>${getWealthTrend()}</p>
      <p><strong>æ„Ÿæƒ…å‘å±•ï¼š</strong>${getLoveTrend()}</p>
      <p><strong>å¥åº·æ³¨æ„ï¼š</strong>${getHealthWarning()}</p>
    </div>
    <div class="butler-section"><h4>ğŸŒŸ åä¸€ã€äººç”Ÿå‘å±•ç­–ç•¥</h4>
      ${(()=>{const s=getLifeStrategy(pillars.day.stem, '', counts); return `<p><strong>æ ¸å¿ƒç­–ç•¥ï¼š</strong>${s.coreStrategy}</p><p><strong>å…³é”®å†³ç­–ï¼š</strong>${s.keyDecisions}</p><p><strong>æˆé•¿å»ºè®®ï¼š</strong>${s.growthTips}</p><ul>${s.stages.map(x=>`<li><strong>${x.period}</strong> - ${x.focus}</li>`).join('')}</ul>`})()}
    </div>
    ${timeUnknown?'<div class="butler-section"><p class="badge-warn">âš ï¸ æç¤ºï¼šå› å‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œéƒ¨åˆ†åˆ†æä»…ä¾›å‚è€ƒã€‚</p></div>':''}
  `
}

/* ========= Butler èŠå¤©ï¼ˆæœ¬åœ°æ¨¡æ‹Ÿï¼‰ ========= */
function initButlerChat(){
  const send=$('chatSend'), input=$('chatInput'), box=$('chatMessages'); if(!send||!input||!box) return;
  const post=(cls,txt)=>{ const d=document.createElement('div'); d.className=cls; d.textContent=txt; box.appendChild(d); box.scrollTop=box.scrollHeight };
  const reply=(q)=>{ post('ss-msg', 'æ”¶åˆ°ï¼š'+q+'ã€‚ç¨åå¯åœ¨ä¸“ä¸šæŠ¥å‘Šç›¸åº”ç« èŠ‚æ‰¾åˆ°è¦ç‚¹ã€‚') };
  function act(){ const msg=input.value.trim(); if(!msg) return; post('ss-msg me', msg); input.value=''; setTimeout(()=>reply(msg), 300) }
  send.addEventListener('click', act); input.addEventListener('keypress', e=>{ if(e.key==='Enter') act() })
}

/* ========= å…¥å£å‡½æ•° ========= */
async function generateBaziChart(){
  let birthdate=$('birthdate')?.value; const birthtime=$('birthtime')?.value; const timeUnknown=$('timeUnknown')?.checked;
  if(!birthdate){ showError('è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ'); return }
  if(birthdate.includes('/')){ const parts=birthdate.split('/'); if(parts.length===3){ const [d,m,y]=parts; birthdate=`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}` } }

  const btn=$('genBtn'), btnText=$('genBtnText'), btnLoading=$('genBtnLoading');
  lock(btn,true); if(btnText) btnText.style.display='none'; if(btnLoading) btnLoading.style.display='inline-block';

  try{
    const [year,month,day]=birthdate.split('-').map(Number); if(!year||!month||!day||year<1900||year>2100) throw new Error('æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼Œè¯·ç”¨ YYYY-MM-DD');
    let hour = 12;
if (!timeUnknown && birthtime) {
  let h = parseInt(birthtime.split(':')[0], 10);
  const isPM = /pm/i.test(birthtime) || /ä¸‹åˆ|æ™š/i.test(birthtime);
  const isAM = /am/i.test(birthtime) || /ä¸Šåˆ|æ—©/i.test(birthtime);
  if (isPM && h < 12) h += 12;
  if (isAM && h === 12) h = 0;
  if (!isNaN(h)) hour = h;
}

    const data=baziCalculator.calculateBazi(year,month,day,hour,timeUnknown); const {pillars, percents, timeUnknown:tu}=data;

    const result=$('result'); if(result) result.style.display='block';
    setText('bazi-date', `å‡ºç”Ÿæ—¥æœŸ: ${year}å¹´${month}æœˆ${day}æ—¥ ${tu?'æ—¶é—´ä¸è¯¦':hour+'æ—¶'}`);
    if(tu){ const dateEl=$('bazi-date'); if(dateEl) dateEl.innerHTML += ' <span class="badge-warn">æœªçº³å…¥æ—¶æŸ±</span>' }

    renderPillars(pillars, tu); displayDetailedInfo(pillars, tu);

    setBar('bar-æœ¨', percents.wood); setText('pct-æœ¨', Math.round(percents.wood)+'%');
    setBar('bar-ç«', percents.fire); setText('pct-ç«', Math.round(percents.fire)+'%');
    setBar('bar-åœŸ', percents.earth); setText('pct-åœŸ', Math.round(percents.earth)+'%');
    setBar('bar-é‡‘', percents.metal); setText('pct-é‡‘', Math.round(percents.metal)+'%');
    setBar('bar-æ°´', percents.water); setText('pct-æ°´', Math.round(percents.water)+'%');

    const arr=[{n:'æœ¨',v:percents.wood},{n:'ç«',v:percents.fire},{n:'åœŸ',v:percents.earth},{n:'é‡‘',v:percents.metal},{n:'æ°´',v:percents.water}];
    const strongest=arr.reduce((a,b)=>a.v>b.v?a:b), weakest=arr.reduce((a,b)=>a.v<b.v?a:b);
    setText('bazi-elements-balance', `äº”è¡Œä¸­${strongest.n}æœ€å¼ºï¼Œ${weakest.n}æœ€å¼±ã€‚`);

    const wrap=$('butlerProfessional'); if(wrap){ wrap.style.display='block'; const target=$('professionalReport'); if(target){ target.innerHTML = generateDynamicReport(data) } }
  }catch(err){ console.error(err); showError(err.message||'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•') }
  finally{ lock(btn,false); if(btnText) btnText.style.display='inline-block'; if(btnLoading) btnLoading.style.display='none' }
}

function init(){
  const d=$('birthdate'); if(d){ const t=new Date(); const y=t.getFullYear(), m=String(t.getMonth()+1).padStart(2,'0'), dd=String(t.getDate()).padStart(2,'0'); d.value=`${y}-${m}-${dd}` }
  const tm=$('birthtime'); if(tm){ const n=new Date(); const hh=String(n.getHours()).padStart(2,'0'), mm=String(n.getMinutes()).padStart(2,'0'); tm.value=`${hh}:${mm}` }
  const gen=$('genBtn'); if(gen) gen.addEventListener('click', generateBaziChart);
  const chk=$('timeUnknown'), ti=$('birthtime'); if(chk && ti){ chk.addEventListener('change',()=>{ ti.disabled=chk.checked; if(chk.checked) ti.value='' }) }
  initButlerChat();
}

if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();
</script>
</body>
</html>
