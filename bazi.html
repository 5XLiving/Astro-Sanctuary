<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ä¿æŒä½ çš„åŸæœ‰æ ·å¼ï¼Œå¹¶ä¿®å¤/è¡¥å…¨å°‘é‡ç»†èŠ‚ */
:root{
  --bg:#0b0f14;
  --bg-accent:#0e1520;
  --card:#11161dcc;
  --surface:#0f1624;
  --line:#1f2a36;
  --text:#e8edf3;
  --muted:#98a7b7;

  --brand:#d4af37;
  --gold:#d4af37;
  --gold2:#f2d27a;
  --accent:#58b9ff;

  --radius:14px;
  --radius-sm:10px;
  --radius-lg:18px;

  --shadow:0 8px 30px rgba(0,0,0,.35);
  --shadow-sm:0 4px 14px rgba(0,0,0,.28);

  --container:1100px;
  --gap:12px;
  --pad:18px;

  /* ä¿®å¤ï¼šæ·»åŠ æ­£ç¡®çš„focuså˜é‡ */
  --focus: 0 0 0 2px rgba(212,175,55,0.2);

  /* ä»…ä¾›æ³¨é‡Šè¯´æ˜ï¼šåª’ä½“æŸ¥è¯¢ä»ç”¨å›ºå®šæ•°å€¼å†™ */
  --bp-s:520px;
  --bp-m:760px;
  --bp-l:900px;
}

/* Reset + base */
*,
*::before,
*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
    linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}

.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}

.site-header{
  position:sticky; top:0; z-index:10;
  background:rgba(11,15,20,.8);
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:var(--shadow-sm);
  font-weight:800; color:#ffe084
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}

.lang{display:flex; align-items:center; gap:8px}
.lang select{
  appearance:none; min-width:140px;
  border-radius:10px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:10px 34px 10px 12px; font-size:0.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}

.section{margin-top:18px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:var(--pad);
  margin:16px 0;
}
.h2{
  font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084;
  display:flex; gap:8px; align-items:center
}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}

.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width: 760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .row.cols-2{grid-template-columns:1fr 1fr}
}

input,select{
  width:100%;
  border-radius:12px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:12px 12px; font-size:15px; outline:0;
}
input::placeholder{color:#6f8092}
input:focus, select:focus{box-shadow:var(--focus); border-color:#3a4c63}

.btn{
  display:inline-grid; place-items:center;
  padding:12px 16px; border-radius:12px;
  border:1px solid #e6c76e;
  background:linear-gradient(180deg,#fff9e6,#e6c76e);
  color:#191919; font-weight:800; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}

.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width: 520px){
  .pillars{grid-template-columns:repeat(2,1fr)}
}

.bazi-table{
  width:100%; border-collapse:collapse; margin-top:12px;
  background:var(--surface); border-radius:8px; overflow:hidden
}
.bazi-table th,.bazi-table td{
  padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle
}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
/* å°å±è¡¨æ ¼å¯æ¨ªå‘æ»šåŠ¨ï¼šæŠŠ table ç”¨ div åŒ…ä¸€å±‚ .bazi-table-wrap å³å¯ */
.bazi-table-wrap{overflow:auto}
@media (max-width: 420px){
  .bazi-table th,.bazi-table td{padding:8px 10px}
}

.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:60px 1fr 60px; gap:10px; align-items:center}

.error-message{
  background:rgba(255,90,95,.1);
  border:1px solid #ff5a5f; border-radius:8px;
  padding:10px; display:none; margin-top:10px
}
.badge-warn{display:inline-block; padding:2px 8px; margin-left:6px; border:1px solid #ffb84d; border-radius:999px; color:#ffb84d; font-size:0.82rem}
.muted{color:var(--muted)}

.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}

.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.rating{display:flex; align-items:center; gap:8px; margin:8px 0}
.rating-stars{color:var(--gold2)}
.tag{display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:0.85rem; margin:2px}

.luck-grid{display:grid; gap:10px}
.luck-item{background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
.luck-year{font-weight:700; color:var(--gold2)}
.luck-desc{font-size:0.9rem; margin-top:4px}

.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width: 900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)
}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

.ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
.ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
.ai-box-c{color:#e8edf3; line-height:1.7}
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.chip{padding:6px 10px; border-radius:999px; border:1px solid #2a3546; background:#0e1520; color:#e8edf3; cursor:pointer; transition:border-color .2s ease, box-shadow .2s ease}
.chip:hover{border-color:#f2d27a; box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
.chip:disabled{opacity:.6; cursor:not-allowed}

.skeleton{display:grid; gap:8px}
.skeleton div{height:12px; border-radius:6px; background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431); animation:sh 1.2s infinite}
@keyframes sh{0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5}}

.ai-lock-overlay{margin-top:10px; padding-top:10px; border-top:1px solid #1f2a36; text-align:center}
.ai-lock-overlay .tip{color:#ffd88a; font-weight:700; margin-bottom:4px}
.ai-lock-overlay .sub{color:var(--muted)}

.detail-view{display:none}
.detail-header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
.back-btn{background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
.detail-content{line-height:1.8}
.detail-section{margin-bottom:24px}
.detail-section h4{color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
.action-list{list-style:none; padding:0; margin:0}
.action-list li{margin-bottom:8px; padding-left:20px; position:relative}
.action-list li::before{content:"â€¢"; color:var(--gold2); position:absolute; left:0; top:0}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}

/* Motion ä¼˜åŒ– */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* Utilities */
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.chips-container{display:flex; flex-wrap:wrap; gap:8px; margin:20px 0; justify-content:center}

/* VIP section demo å¯è§ */
.vip-section{display:block !important}

/* Butler ç»„ä»¶ */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
.butler-chat{margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
.chat-messages{height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:var(--surface); border-radius:8px; border:1px solid #253245}
.chat-input-area{display:flex; gap:10px}
.chat-input-area input{flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3}
.chat-send-btn{padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:700; cursor:pointer}

/* ==== remove the brown/gold focus outline ==== */
input:focus,
select:focus,
textarea:focus{
  outline: none !important;
  box-shadow: none !important;
  border-color: #243244 !important;
}
button:focus,
.btn:focus,
a:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* (optional) also remove tap highlight on mobile */
*{ -webkit-tap-highlight-color: transparent; }    
.chip:hover{ border-color:#2a3546; box-shadow:none; }

/* æµ®çª—èŠå¤©æ ·å¼ */
.chat-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 350px;
  height: 500px;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  z-index: 1000;
  display: none;
  flex-direction: column;
}

.chat-float-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(212,175,55,.1);
  color: var(--gold2);
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
}

.chat-float-close {
  background: none;
  border: none;
  color: var(--gold2);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}

.chat-float-close:hover {
  background: rgba(212,175,55,.2);
}

.chat-float-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0;
}

.chat-float-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background: var(--surface);
}

.chat-float-input-area {
  padding: 12px;
  border-top: 1px solid var(--line);
  background: var(--bg-accent);
}

.chat-toggle-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(180deg,#fff9e6,#e6c76e);
  border: 1px solid #e6c76e;
  color: #191919;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(230,199,110,.3);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chat-toggle-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(230,199,110,.5);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .chat-float {
    width: 300px;
    height: 400px;
    bottom: 10px;
    right: 10px;
  }
  
  .chat-toggle-btn {
    width: 50px;
    height: 50px;
    bottom: 10px;
    right: 10px;
  }
}    
</style>
</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
      <span class="title" data-i18n="brand.subtitle">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="nav.langLabel">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN" data-i18n="lang.zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW" data-i18n="lang.zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en"    data-i18n="lang.en">English</option>
        <option value="ja"    data-i18n="lang.ja">æ—¥æœ¬èª</option>
        <option value="th"    data-i18n="lang.th">à¹„à¸—à¸¢</option>
        <option value="ms"    data-i18n="lang.ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2" data-i18n="app.title">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="form.nameLabel">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted" data-i18n="form.genderLabel">æ€§åˆ«</label>
        <select id="gender">
          <option value=""        data-i18n="form.gender.hidden">ä¸é€éœ²</option>
          <option value="male"    data-i18n="form.gender.male">ç”·æ€§</option>
          <option value="female"  data-i18n="form.gender.female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="form.calendarLabel">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian" data-i18n="form.calendar.gregorian">é˜³å†</option>
          <option value="lunar"     data-i18n="form.calendar.lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted" data-i18n="form.birthdateLabel">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted" data-i18n="form.birthtimeLabel">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span data-i18n="form.timeUnknown">å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText" data-i18n="btn.generate">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none" data-i18n="btn.loading">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

<section id="result" style="display:none;">
    <div class="card">
      <div class="h2" data-i18n="result.title">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>
     
      <table class="bazi-table">
        <thead>
          <tr>
            <th></th>
            <th data-i18n="pillar.year">å¹´æŸ±</th>
            <th data-i18n="pillar.month">æœˆæŸ±</th>
            <th data-i18n="pillar.day">æ—¥æŸ±</th>
            <th data-i18n="pillar.hour">æ—¶æŸ±</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-i18n="table.row.stem">å¤©å¹²</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.branch">åœ°æ”¯</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.fiveElem">äº”è¡Œ</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.nayin">çº³éŸ³</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2" data-i18n="energy.title">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span data-i18n="elem.wood">æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.fire">ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.earth">åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.metal">é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.water">æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
</section>
    
<!-- æµ®çª—èŠå¤©æŒ‰é’® -->
<button class="chat-toggle-btn" id="chatToggle" data-i18n="chat.toggle">é—®</button>

<!-- æµ®çª—èŠå¤©çª—å£ -->
<div class="chat-float" id="chatFloat">
  <div class="chat-float-header">
    <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    <button class="chat-float-close" id="chatClose">Ã—</button>
  </div>
  <div class="chat-float-body">
    <div class="chat-float-messages" id="chatMessages">
      <div class="ss-msg" data-i18n="pro.welcome">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
    </div>
    <div class="chat-float-input-area">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #253245; background: #0e1520; color: #e8edf3;">
        <button class="chat-send-btn" id="chatSend" data-i18n="chat.send" style="padding: 10px 16px; background: var(--gold); color: #191919; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">å‘é€</button>
      </div>
    </div>
  </div>
</div>  

  <section class="card section vip-section">
    <h2 class="group-title" data-i18n="vip.title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.astrology">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.astrology.match">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li data-i18n="vip.astrology.career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li data-i18n="vip.astrology.wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li data-i18n="vip.astrology.pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.spiritual">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.spiritual.record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li data-i18n="vip.spiritual.courses">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li data-i18n="vip.spiritual.family">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li data-i18n="vip.spiritual.practice">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="vip.login.title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head" data-i18n="auth.header">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email">
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰">
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="auth.login">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="auth.reset">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="auth.register">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted" data-i18n="auth.freeTrialNote">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head" data-i18n="vip.services.header">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="vip.upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="vip.back">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted" data-i18n="vip.priceNote">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer data-i18n="footer.copy">Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>
  
<script>window.API_BASE='https://throbbing-lab-1440.hello5xliving.workers.dev';</script>
<script>
/*!
 * 5XLiving Â· Bazi Quick Chart - PROFESSIONAL VERSION
 */
(() => {
  'use strict';

  const CONFIG = {
    API_BASE: '' // ä½¿ç”¨æœ¬åœ°è®¡ç®—
  };

  // æ‰©å±•çš„å¤šè¯­è¨€å­—å…¸
  const I18N = {
    'zh-CN': {
      // ... ä¿æŒä¹‹å‰çš„ç¿»è¯‘ä¸å˜ï¼Œæ·»åŠ æ–°çš„ ...
      
      // ä¸“ä¸šæŠ¥å‘Šå†…å®¹
      report: {
        dayMaster: {
          'ç”²': 'ç”²æœ¨å‘½ï¼šæœ‰ç§¯ææ€§çš„å¼€æ‹“ç²¾ç¥ï¼Œç²¾åŠ›æ—ºç››ï¼Œé‡æ„Ÿæƒ…ï¼Œåˆšç›´è±ªè¿ˆï¼Œå‹¤å‹‰éšå’Œï¼Œä½†å¥½è‡ªæˆ‘æ˜¾ç¤ºï¼Œç›´çˆ½å½“ä¸­éšè”½ç€ä¸€ç‚¹ç‚¹çš„è™šä¼ªã€‚',
          'ä¹™': 'ä¹™æœ¨å‘½ï¼šæ€§æ ¼æŸ”é¡ºï¼Œå–œè¡Œå–„äº‹ï¼Œæœ‰åŒæƒ…å¿ƒï¼Œå¤–è¡¨è°¦è™šï¼Œä½†å†…å¿ƒå æœ‰æ¬²å¼ºï¼Œæœ‰æ‰èƒ½ï¼Œé€‚åº”æ€§å¹¿ã€‚',
          'ä¸™': 'ä¸™ç«å‘½ï¼šçƒ­æƒ…è±ªçˆ½ï¼Œè‡ªä¿¡å¥½èƒœï¼Œå–„è¨€å¥è°ˆï¼Œä½†æƒ…ç»ªä¸ç¨³ï¼Œå†²åŠ¨æ˜“æ€’ï¼Œç¼ºä¹ä»”ç»†è®¤çœŸã€‚',
          'ä¸': 'ä¸ç«å‘½ï¼šæ•¦åšæœ´å®ï¼Œé‡ä¿¡å®ˆä¹‰ï¼Œä½†ä»»æ€§é€å¼ºï¼Œé˜²æ­¢å—éª—ï¼Œæœ‰æ—¶ç¼ºä¹è€åŠ›ï¼ŒåŠäº‹æ˜“åŠé€”è€ŒåºŸã€‚',
          'æˆŠ': 'æˆŠåœŸå‘½ï¼šæœ‰ç§¯ææ€§ï¼Œå¹²ä¸€è¡Œæ˜“äºå¯¹äº‹ç‰©çƒ­è¡·ï¼Œä½†æ€§æ€¥ï¼Œä»»æ€§è€Œé€å¼ºã€‚å¥½èƒœï¼Œæ¬²æœ›é«˜ï¼Œä¸æ»¡è¶³æ„Ÿå¼ºçƒˆã€‚',
          'å·±': 'å·±åœŸå‘½ï¼šå’Œç¼“ï¼Œè°¨æ…ï¼Œå¿ƒçµæ‰‹å·§ï¼Œä½†ç–‘è™‘å¤šï¼Œæ¬ æœæ–­ã€‚å®¹æ˜“å› æƒ…è€—è´¢ï¼Œé˜²æ­¢è¢«äººç‰µç€èµ°ã€‚',
          'åºš': 'åºšé‡‘å‘½ï¼šç§¯æè¿›å–ï¼Œå‹‡æ•¢æœå†³ï¼Œè‡ªå°Šå¿ƒå¼ºï¼Œæœ‰æ‰èƒ½ï¼Œå–„äºç»“äº¤å„æ–¹é¢æœ‹å‹ï¼Œä½†æœ‰æ—¶è¿‡äºåˆšå¼ºã€‚',
          'è¾›': 'è¾›é‡‘å‘½ï¼šæ²‰ç€å¦ç›´æ— ç§ï¼Œå¾…äººæ¥ç‰©ï¼Œè®¤çœŸç»†è‡´ï¼Œè„šè¸å®åœ°ï¼Œä½†æ¸©æŸ”æ•¦åšè€Œå¯“æ¶µå›ºæ‰§ã€‚',
          'å£¬': 'å£¬æ°´å‘½ï¼šå¿ƒèƒ¸å®½å¹¿ï¼Œæœºæ™ºçµæ•ï¼Œå–œæ¬¢ç…§é¡¾ä»–äººï¼Œèªæ˜ï¼Œæœ‰å®˜è¿ï¼Œä½†å®¹æ˜“å†²åŠ¨ã€‚',
          'ç™¸': 'ç™¸æ°´å‘½ï¼šé€å¼ºé¡½å›ºï¼Œæ˜¯åŠªåŠ›å®¶ï¼Œæœ‰è€åŠ›ï¼Œçƒ­æƒ…å¤§æ–¹ï¼Œèªé¢–æœºçµï¼Œä½†å¿ƒåœ°ç‹­çª„ï¼Œå®¹æ˜“å°æ°”ã€‚'
        },
        
        pillarAnalysis: {
          'æˆŠåˆ': 'å¹´æŸ±æˆŠåˆï¼šå¤©ä¸Šç«å‘½ï¼Œä¸ºäººçƒ­æƒ…ï¼Œä½†ä¼¤å®˜é€å‡ºï¼Œæ€§æ ¼è¾ƒä¸ºåˆšçƒˆã€‚',
          'ç”²å¯…': 'æœˆæŸ±ç”²å¯…ï¼šå¤§æºªæ°´å‘½ï¼Œæ¯”è‚©åç¦„ï¼Œå…„å¼Ÿå§å¦¹åŠ©åŠ›ï¼Œä½†å®¹æ˜“æœ‰ç«äº‰ã€‚',
          'åºšåˆ': 'æ—¶æŸ±åºšåˆï¼šè·¯æ—åœŸå‘½ï¼Œä¸ƒæ€åä¼¤å®˜ï¼Œå­å¥³æœ‰å‡ºæ¯ä½†ç®¡æ•™è¾ƒéš¾ã€‚'
        },
        
        tenGods: {
          'æ¯”è‚©': 'æ¯”è‚©ï¼šè¡¨ç¤ºå…„å¼Ÿå§å¦¹ã€æœ‹å‹åŒäº‹ã€‚æ¯”è‚©å¤šè€…é‡ä¹‰æ°”ï¼Œä½†å®¹æ˜“æœ‰ç«äº‰ã€‚',
          'åŠ«è´¢': 'åŠ«è´¢ï¼šè¡¨ç¤ºå¼‚æ€§æœ‹å‹ã€ç«äº‰å¯¹æ‰‹ã€‚åŠ«è´¢å¤šè€…è±ªçˆ½ï¼Œä½†å®¹æ˜“ç ´è´¢ã€‚',
          'é£Ÿç¥': 'é£Ÿç¥ï¼šè¡¨ç¤ºå­å¥³ã€é£Ÿç¦„ã€‚é£Ÿç¥å¤šè€…æ¸©å’Œï¼Œæœ‰å£ç¦ï¼Œå–„äºè¡¨è¾¾ã€‚',
          'ä¼¤å®˜': 'ä¼¤å®˜ï¼šè¡¨ç¤ºæ‰åã€è‰ºæœ¯ã€‚ä¼¤å®˜å¤šè€…èªæ˜ï¼Œä½†æ€§æ ¼è¾ƒä¸ºå›é€†ã€‚',
          'åè´¢': 'åè´¢ï¼šè¡¨ç¤ºçˆ¶äº²ã€æ„å¤–ä¹‹è´¢ã€‚åè´¢å¤šè€…æ…·æ…¨ï¼Œå–„äºç†è´¢ã€‚',
          'æ­£è´¢': 'æ­£è´¢ï¼šè¡¨ç¤ºå¦»å­ã€ç¨³å®šæ”¶å…¥ã€‚æ­£è´¢å¤šè€…èŠ‚ä¿­ï¼Œé‡è§†å®¶åº­ã€‚',
          'ä¸ƒæ€': 'ä¸ƒæ€ï¼šè¡¨ç¤ºå‹åŠ›ã€æƒå¨ã€‚ä¸ƒæ€å¤šè€…æœæ–­ï¼Œæœ‰é¢†å¯¼èƒ½åŠ›ã€‚',
          'æ­£å®˜': 'æ­£å®˜ï¼šè¡¨ç¤ºä¸ˆå¤«ã€å®˜èŒã€‚æ­£å®˜å¤šè€…æ­£ç›´ï¼Œéµå®ˆè§„çŸ©ã€‚',
          'åå°': 'åå°ï¼šè¡¨ç¤ºç»§æ¯ã€ç‰¹æ®Šæ‰èƒ½ã€‚åå°å¤šè€…èªæ˜ï¼Œä½†æ€§æ ¼å­¤åƒ»ã€‚',
          'æ­£å°': 'æ­£å°ï¼šè¡¨ç¤ºæ¯äº²ã€å­¦è¯†ã€‚æ­£å°å¤šè€…å–„è‰¯ï¼Œæœ‰å­¦è¯†ã€‚'
        },
        
        usefulSpirit: {
          'æœ¨': 'å–œç”¨ç¥ä¸ºæœ¨ï¼Œå®œå¤šæ¥è§¦ç»¿è‰²ï¼Œå¾€ä¸œæ–¹å‘å±•ï¼Œä»äº‹æœ¨å±æ€§è¡Œä¸šã€‚',
          'ç«': 'å–œç”¨ç¥ä¸ºç«ï¼Œå®œå¤šæ¥è§¦çº¢è‰²ï¼Œå¾€å—æ–¹å‘å±•ï¼Œä»äº‹ç«å±æ€§è¡Œä¸šã€‚', 
          'åœŸ': 'å–œç”¨ç¥ä¸ºåœŸï¼Œå®œå¤šæ¥è§¦é»„è‰²ï¼Œå¾€ä¸­éƒ¨å‘å±•ï¼Œä»äº‹åœŸå±æ€§è¡Œä¸šã€‚',
          'é‡‘': 'å–œç”¨ç¥ä¸ºé‡‘ï¼Œå®œå¤šæ¥è§¦ç™½è‰²ï¼Œå¾€è¥¿æ–¹å‘å±•ï¼Œä»äº‹é‡‘å±æ€§è¡Œä¸šã€‚',
          'æ°´': 'å–œç”¨ç¥ä¸ºæ°´ï¼Œå®œå¤šæ¥è§¦é»‘è‰²ï¼Œå¾€åŒ—æ–¹å‘å±•ï¼Œä»äº‹æ°´å±æ€§è¡Œä¸šã€‚'
        },
        
        relationship: {
          'ç”²': 'æ„Ÿæƒ…è¾ƒä¸ºä¸»åŠ¨ï¼Œå–œæ¬¢æŒæ¡ä¸»å¯¼æƒï¼Œå¯¹ä¼´ä¾£è¦æ±‚è¾ƒé«˜ã€‚',
          'ä¹™': 'æ„Ÿæƒ…ç»†è…»æ¸©æŸ”ï¼Œéœ€è¦ç¨³å®šçš„æƒ…æ„Ÿæ”¯æŒï¼Œå¯¹ä¼´ä¾£ä½“è´´ã€‚',
          'ä¸™': 'æ„Ÿæƒ…çƒ­æƒ…å¥”æ”¾ï¼Œä½†å®¹æ˜“å†²åŠ¨ï¼Œéœ€è¦å­¦ä¼šæ§åˆ¶æƒ…ç»ªã€‚',
          'ä¸': 'æ„Ÿæƒ…ä¸“ä¸€æ‰§ç€ï¼Œä½†å®¹æ˜“çŒœç–‘ï¼Œéœ€è¦å»ºç«‹ä¿¡ä»»ã€‚',
          'æˆŠ': 'æ„Ÿæƒ…ç¨³é‡åŠ¡å®ï¼Œé‡è§†å®¶åº­ï¼Œä½†ç¼ºä¹æµªæ¼«ã€‚',
          'å·±': 'æ„Ÿæƒ…ç»†è…»ä½“è´´ï¼Œä½†å®¹æ˜“ç¼ºä¹å®‰å…¨æ„Ÿã€‚',
          'åºš': 'æ„Ÿæƒ…æœæ–­ç›´æ¥ï¼Œä¸å–œæ¬¢æ‹–æ³¥å¸¦æ°´ã€‚',
          'è¾›': 'æ„Ÿæƒ…è¿½æ±‚å®Œç¾ï¼Œå¯¹ä¼´ä¾£è¦æ±‚è¾ƒé«˜ã€‚',
          'å£¬': 'æ„Ÿæƒ…ä¸°å¯Œå¤šå˜ï¼Œéœ€è¦æ–°é²œæ„Ÿã€‚',
          'ç™¸': 'æ„Ÿæƒ…ç»†è…»æ•æ„Ÿï¼Œå®¹æ˜“æƒ…ç»ªåŒ–ã€‚'
        }
      }
    }
  };

  // å·¥å…·å‡½æ•°
  const $ = id => document.getElementById(id);
  const state = { lang: 'zh-CN' };

  function t(key) {
    const keys = key.split('.');
    let value = I18N[state.lang];
    for (const k of keys) {
      value = value ? value[k] : undefined;
    }
    return value || key;
  }

  // å…«å­—è®¡ç®—å™¨ - å¢å¼ºç‰ˆæœ¬
  class ProfessionalBaziCalculator {
    constructor() {
      this.HEAVENLY_STEMS = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
      this.EARTHLY_BRANCHES = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
      this.NAYIN = ['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
    }

    // è®¡ç®—åç¥
    calculateTenGods(dayStem, stems) {
      const tenGodsMap = {
        'ç”²': { 'ç”²':'æ¯”è‚©', 'ä¹™':'åŠ«è´¢', 'ä¸™':'é£Ÿç¥', 'ä¸':'ä¼¤å®˜', 'æˆŠ':'åè´¢', 'å·±':'æ­£è´¢', 'åºš':'ä¸ƒæ€', 'è¾›':'æ­£å®˜', 'å£¬':'åå°', 'ç™¸':'æ­£å°' },
        'ä¹™': { 'ç”²':'åŠ«è´¢', 'ä¹™':'æ¯”è‚©', 'ä¸™':'ä¼¤å®˜', 'ä¸':'é£Ÿç¥', 'æˆŠ':'æ­£è´¢', 'å·±':'åè´¢', 'åºš':'æ­£å®˜', 'è¾›':'ä¸ƒæ€', 'å£¬':'æ­£å°', 'ç™¸':'åå°' },
        'ä¸™': { 'ç”²':'åå°', 'ä¹™':'æ­£å°', 'ä¸™':'æ¯”è‚©', 'ä¸':'åŠ«è´¢', 'æˆŠ':'é£Ÿç¥', 'å·±':'ä¼¤å®˜', 'åºš':'åè´¢', 'è¾›':'æ­£è´¢', 'å£¬':'ä¸ƒæ€', 'ç™¸':'æ­£å®˜' },
        'ä¸': { 'ç”²':'æ­£å°', 'ä¹™':'åå°', 'ä¸™':'åŠ«è´¢', 'ä¸':'æ¯”è‚©', 'æˆŠ':'ä¼¤å®˜', 'å·±':'é£Ÿç¥', 'åºš':'æ­£è´¢', 'è¾›':'åè´¢', 'å£¬':'æ­£å®˜', 'ç™¸':'ä¸ƒæ€' },
        'æˆŠ': { 'ç”²':'ä¸ƒæ€', 'ä¹™':'æ­£å®˜', 'ä¸™':'åå°', 'ä¸':'æ­£å°', 'æˆŠ':'æ¯”è‚©', 'å·±':'åŠ«è´¢', 'åºš':'é£Ÿç¥', 'è¾›':'ä¼¤å®˜', 'å£¬':'åè´¢', 'ç™¸':'æ­£è´¢' },
        'å·±': { 'ç”²':'æ­£å®˜', 'ä¹™':'ä¸ƒæ€', 'ä¸™':'æ­£å°', 'ä¸':'åå°', 'æˆŠ':'åŠ«è´¢', 'å·±':'æ¯”è‚©', 'åºš':'ä¼¤å®˜', 'è¾›':'é£Ÿç¥', 'å£¬':'æ­£è´¢', 'ç™¸':'åè´¢' },
        'åºš': { 'ç”²':'åè´¢', 'ä¹™':'æ­£è´¢', 'ä¸™':'ä¸ƒæ€', 'ä¸':'æ­£å®˜', 'æˆŠ':'åå°', 'å·±':'æ­£å°', 'åºš':'æ¯”è‚©', 'è¾›':'åŠ«è´¢', 'å£¬':'é£Ÿç¥', 'ç™¸':'ä¼¤å®˜' },
        'è¾›': { 'ç”²':'æ­£è´¢', 'ä¹™':'åè´¢', 'ä¸™':'æ­£å®˜', 'ä¸':'ä¸ƒæ€', 'æˆŠ':'æ­£å°', 'å·±':'åå°', 'åºš':'åŠ«è´¢', 'è¾›':'æ¯”è‚©', 'å£¬':'ä¼¤å®˜', 'ç™¸':'é£Ÿç¥' },
        'å£¬': { 'ç”²':'é£Ÿç¥', 'ä¹™':'ä¼¤å®˜', 'ä¸™':'åè´¢', 'ä¸':'æ­£è´¢', 'æˆŠ':'ä¸ƒæ€', 'å·±':'æ­£å®˜', 'åºš':'åå°', 'è¾›':'æ­£å°', 'å£¬':'æ¯”è‚©', 'ç™¸':'åŠ«è´¢' },
        'ç™¸': { 'ç”²':'ä¼¤å®˜', 'ä¹™':'é£Ÿç¥', 'ä¸™':'æ­£è´¢', 'ä¸':'åè´¢', 'æˆŠ':'æ­£å®˜', 'å·±':'ä¸ƒæ€', 'åºš':'æ­£å°', 'è¾›':'åå°', 'å£¬':'åŠ«è´¢', 'ç™¸':'æ¯”è‚©' }
      };
      
      return stems.map(stem => tenGodsMap[dayStem]?.[stem] || '-');
    }

    // è®¡ç®—åœ°æ”¯è—å¹²
    calculateHiddenStems(branches) {
      const hiddenMap = {
        'å­': ['ç™¸'],
        'ä¸‘': ['å·±','ç™¸','è¾›'],
        'å¯…': ['ç”²','ä¸™','æˆŠ'],
        'å¯': ['ä¹™'],
        'è¾°': ['æˆŠ','ä¹™','ç™¸'],
        'å·³': ['ä¸™','æˆŠ','åºš'],
        'åˆ': ['ä¸','å·±'],
        'æœª': ['å·±','ä¸','ä¹™'],
        'ç”³': ['åºš','å£¬','æˆŠ'],
        'é…‰': ['è¾›'],
        'æˆŒ': ['æˆŠ','è¾›','ä¸'],
        'äº¥': ['å£¬','ç”²']
      };
      
      return branches.map(branch => hiddenMap[branch] || []);
    }

    // è®¡ç®—çº³éŸ³
    getNayin(stem, branch) {
      const si = this.HEAVENLY_STEMS.indexOf(stem);
      const bi = this.EARTHLY_BRANCHES.indexOf(branch);
      return this.NAYIN[(si * 2 + bi) % this.NAYIN.length];
    }

    // åˆ¤æ–­æ—¥ä¸»å¼ºå¼±
    analyzeDayMasterStrength(dayStem, stems, branches, hiddenStems) {
      // ç®€åŒ–çš„å¼ºå¼±åˆ†æé€»è¾‘
      const supportingElements = this.getSupportingElements(dayStem);
      let strengthScore = 0;
      
      // åˆ†æå¤©å¹²
      stems.forEach(stem => {
        const element = this.getStemElement(stem);
        if (supportingElements.includes(element)) strengthScore += 2;
      });
      
      // åˆ†æåœ°æ”¯å’Œè—å¹²
      branches.forEach((branch, index) => {
        const branchElement = this.getBranchElement(branch);
        if (supportingElements.includes(branchElement)) strengthScore += 1;
        
        hiddenStems[index]?.forEach(hidden => {
          const hiddenElement = this.getStemElement(hidden);
          if (supportingElements.includes(hiddenElement)) strengthScore += 0.5;
        });
      });
      
      if (strengthScore > 8) return 'strong';
      if (strengthScore > 5) return 'balanced';
      return 'weak';
    }

    getSupportingElements(dayStem) {
      const elementMap = {
        'ç”²': ['æœ¨', 'æ°´'], 'ä¹™': ['æœ¨', 'æ°´'],
        'ä¸™': ['ç«', 'æœ¨'], 'ä¸': ['ç«', 'æœ¨'], 
        'æˆŠ': ['åœŸ', 'ç«'], 'å·±': ['åœŸ', 'ç«'],
        'åºš': ['é‡‘', 'åœŸ'], 'è¾›': ['é‡‘', 'åœŸ'],
        'å£¬': ['æ°´', 'é‡‘'], 'ç™¸': ['æ°´', 'é‡‘']
      };
      return elementMap[dayStem] || [];
    }

    getStemElement(stem) {
      const map = {ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'};
      return map[stem] || '-';
    }

    getBranchElement(branch) {
      const map = {å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'};
      return map[branch] || '-';
    }

    // ä¿æŒå…¶ä»–è®¡ç®—æ–¹æ³•ä¸å˜...
    calculateYearPillar(year) {
      const s = (year - 4) % 10;
      const b = (year - 4) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(s + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(b + 12) % 12] 
      };
    }

    solarMonthIndex(y, m, d) {
      const mmdd = m * 100 + d;
      const gates = [[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]];
      let idx = 11; 
      for (const [thr, val] of gates) { 
        if (mmdd >= thr) idx = val; 
      }
      const branchBy = {1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'};
      return { index: idx, branch: branchBy[idx] };
    }

    calculateMonthPillar(year, month, day) {
      const { index, branch } = this.solarMonthIndex(year, month, day);
      const yStemIdx = this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem);
      const startMap = {0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0};
      const stemIdx = (startMap[yStemIdx] + (index - 1)) % 10;
      return { stem: this.HEAVENLY_STEMS[stemIdx], branch };
    }

    calculateDayPillar(year, month, day) {
      const baseUTC = Date.UTC(1900, 0, 31);
      const targetUTC = Date.UTC(year, month - 1, day);
      const dayDiff = Math.floor((targetUTC - baseUTC) / 86400000);
      const stemIdx = (0 + dayDiff) % 10;
      const branchIdx = (4 + dayDiff) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(stemIdx + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(branchIdx + 12) % 12] 
      };
    }

    calculateHourPillar(dayStem, hour) {
      const branchMap = {
        23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',
        7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',
        15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'
      };
      const startMap = {0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8};
      const dayIdx = this.HEAVENLY_STEMS.indexOf(dayStem);
      const hourIndex = Math.floor((hour + 1) / 2) % 12;
      const stemIdx = (startMap[dayIdx] + hourIndex) % 10;
      return { 
        stem: this.HEAVENLY_STEMS[stemIdx], 
        branch: branchMap[hour] 
      };
    }
  }

  // ä¸“ä¸šæŠ¥å‘Šç”Ÿæˆå™¨
  function generateProfessionalReport(baziData) {
    const calc = new ProfessionalBaziCalculator();
    const dayStem = baziData.stem[2];
    const tenGods = calc.calculateTenGods(dayStem, baziData.stem);
    const hiddenStems = calc.calculateHiddenStems(baziData.branch);
    const strength = calc.analyzeDayMasterStrength(dayStem, baziData.stem, baziData.branch, hiddenStems);
    
    // è®¡ç®—äº”è¡Œä¸ªæ•°
    const elementCounts = { 'é‡‘': 0, 'æœ¨': 0, 'æ°´': 0, 'ç«': 0, 'åœŸ': 0 };
    baziData.stem.forEach(stem => {
      const element = calc.getStemElement(stem);
      if (element !== '-') elementCounts[element]++;
    });
    baziData.branch.forEach(branch => {
      const element = calc.getBranchElement(branch);
      if (element !== '-') elementCounts[element]++;
    });

    // åˆ¤æ–­å–œç”¨ç¥
    const usefulSpirit = calc.getSupportingElements(dayStem)[0];

    return `
      <div class="butler-section">
        <h4>ğŸ“Š å‘½ç›˜æ€»è§ˆ</h4>
        <div class="detail-content">
          <p><strong>æ—¥ä¸»å‘½ç†ï¼š</strong>${t(`report.dayMaster.${dayStem}`)}</p>
          <p><strong>æ—¥ä¸»å¼ºå¼±ï¼š</strong>${strength === 'strong' ? 'èº«æ—º' : strength === 'weak' ? 'èº«å¼±' : 'ä¸­å’Œ'}</p>
          <p><strong>å–œç”¨ç¥ï¼š</strong>${usefulSpirit} ${t(`report.usefulSpirit.${usefulSpirit}`)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸŒ¿ äº”è¡Œåˆ†æ</h4>
        <div class="detail-content">
          <p><strong>äº”è¡Œä¸ªæ•°ï¼š</strong>${elementCounts['é‡‘']}ä¸ªé‡‘ï¼Œ${elementCounts['æœ¨']}ä¸ªæœ¨ï¼Œ${elementCounts['æ°´']}ä¸ªæ°´ï¼Œ${elementCounts['ç«']}ä¸ªç«ï¼Œ${elementCounts['åœŸ']}ä¸ªåœŸ</p>
          <p><strong>äº”è¡Œæ—ºè¡°ï¼š</strong>${Object.entries(baziData.elementsPct).sort((a,b) => b[1]-a[1]).map(([k,v]) => `${k}${v}%`).join('ï¼Œ')}</p>
          <p><strong>å¸®æ‰¶äº”è¡Œï¼š</strong>${calc.getSupportingElements(dayStem).join('ã€')}</p>
          <p><strong>å…‹æ³„äº”è¡Œï¼š</strong>${['æœ¨','ç«','åœŸ','é‡‘','æ°´'].filter(e => !calc.getSupportingElements(dayStem).includes(e)).join('ã€')}</p>
          ${Object.values(elementCounts).some(v => v === 0) ? `<p><strong>äº”è¡Œæ‰€ç¼ºï¼š</strong>${Object.entries(elementCounts).filter(([k,v]) => v === 0).map(([k]) => k).join('ã€')}</p>` : ''}
        </div>
      </div>

      <div class="butler-section">
        <h4>âš¡ åç¥é…ç½®</h4>
        <div class="detail-content">
          <p><strong>å¹´æŸ±${baziData.stem[0]}${baziData.branch[0]}ï¼š</strong>${tenGods[0]} ${t(`report.tenGods.${tenGods[0]}`)}</p>
          <p><strong>æœˆæŸ±${baziData.stem[1]}${baziData.branch[1]}ï¼š</strong>${tenGods[1]} ${t(`report.tenGods.${tenGods[1]}`)}</p>
          <p><strong>æ—¥æŸ±${baziData.stem[2]}${baziData.branch[2]}ï¼š</strong>${tenGods[2]} ${t(`report.tenGods.${tenGods[2]}`)}</p>
          <p><strong>æ—¶æŸ±${baziData.stem[3]}${baziData.branch[3]}ï¼š</strong>${tenGods[3]} ${t(`report.tenGods.${tenGods[3]}`)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸ’• æ„Ÿæƒ…å©šå§»</h4>
        <div class="detail-content">
          <p><strong>æ„Ÿæƒ…ç‰¹è´¨ï¼š</strong>${t(`report.relationship.${dayStem}`)}</p>
          <p><strong>å©šå§»å»ºè®®ï¼š</strong>${strength === 'strong' ? 'å®œæ‰¾æ€§æ ¼æ¸©å’Œçš„ä¼´ä¾£' : 'å®œæ‰¾æœ‰èƒ½åŠ›æœ‰æ‹…å½“çš„ä¼´ä¾£'}</p>
          <p><strong>ç›¸å¤„ä¹‹é“ï¼š</strong>å­¦ä¼šæ²Ÿé€šç†è§£ï¼Œäº’ç›¸åŒ…å®¹æ”¯æŒ</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸ’¼ äº‹ä¸šå‘å±•</h4>
        <div class="detail-content">
          <p><strong>é€‚åˆè¡Œä¸šï¼š</strong>${getSuitableCareers(dayStem, usefulSpirit)}</p>
          <p><strong>å‘å±•æ–¹ä½ï¼š</strong>${getFavorableDirections(usefulSpirit)}</p>
          <p><strong>èŒä¸šå»ºè®®ï¼š</strong>${getCareerAdvice(strength, tenGods)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸ’° è´¢è¿åˆ†æ</h4>
        <div class="detail-content">
          <p><strong>è´¢è¿ç‰¹ç‚¹ï¼š</strong>${getWealthAnalysis(tenGods, elementCounts)}</p>
          <p><strong>æ±‚è´¢æ–¹å‘ï¼š</strong>${getWealthDirections(usefulSpirit)}</p>
          <p><strong>ç†è´¢å»ºè®®ï¼š</strong>ç¨³æ‰ç¨³æ‰“ï¼Œé¿å…æŠ•æœº</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸŒ¡ï¸ å¥åº·å…»ç”Ÿ</h4>
        <div class="detail-content">
          <p><strong>ä½“è´¨ç‰¹ç‚¹ï¼š</strong>${getHealthAnalysis(dayStem, elementCounts)}</p>
          <p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>${getHealthTips(usefulSpirit)}</p>
          <p><strong>å…»ç”Ÿå»ºè®®ï¼š</strong>è§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨ï¼Œä¿æŒå¿ƒæ€å¹³å’Œ</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>ğŸ”® è¿‘æœŸè¿åŠ¿</h4>
        <div class="detail-content">
          <p><strong>æ•´ä½“è¿åŠ¿ï¼š</strong>ç¨³ä¸­æ±‚è¿›ï¼Œé€‚åˆå­¦ä¹ æå‡</p>
          <p><strong>æœ‰åˆ©æ—¶æœºï¼š</strong>æœªæ¥3ä¸ªæœˆæ˜¯å…³é”®å‘å±•æœŸ</p>
          <p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>é¿å…å†²åŠ¨å†³ç­–ï¼Œæ³¨æ„äººé™…å…³ç³»</p>
        </div>
      </div>
    `;
  }

  // è¾…åŠ©å‡½æ•°
  function getSuitableCareers(dayStem, usefulSpirit) {
    const careers = {
      'æœ¨': 'æ•™è‚²ã€æ–‡åŒ–ã€å‡ºç‰ˆã€æ—ä¸šã€åŒ»è¯',
      'ç«': 'èƒ½æºã€ç”µåŠ›ã€é¤é¥®ã€å¨±ä¹ã€ä¼ åª’', 
      'åœŸ': 'æˆ¿åœ°äº§ã€å»ºç­‘ã€å†œä¸šã€èµ„æº',
      'é‡‘': 'é‡‘èã€æœºæ¢°ã€æ³•å¾‹ã€å†›è­¦',
      'æ°´': 'è´¸æ˜“ã€ç‰©æµã€æ—…æ¸¸ã€å’¨è¯¢'
    };
    return careers[usefulSpirit] || 'å¤šæ ·åŒ–å‘å±•';
  }

  function getFavorableDirections(usefulSpirit) {
    const directions = {
      'æœ¨': 'ä¸œæ–¹ã€ä¸œå—æ–¹',
      'ç«': 'å—æ–¹',
      'åœŸ': 'ä¸­éƒ¨ã€æœ¬åœ°', 
      'é‡‘': 'è¥¿æ–¹ã€è¥¿åŒ—æ–¹',
      'æ°´': 'åŒ—æ–¹'
    };
    return directions[usefulSpirit] || 'å„ä¸ªæ–¹ä½';
  }

  function getCareerAdvice(strength, tenGods) {
    if (strength === 'strong') {
      return 'ç§¯æå¼€æ‹“ï¼ŒæŠŠæ¡é¢†å¯¼æœºä¼šï¼Œé€‚åˆåˆ›ä¸šæˆ–ç®¡ç†å²—ä½';
    } else {
      return 'ç¨³æ‰ç¨³æ‰“ï¼Œç§¯ç´¯ç»éªŒï¼Œå¯»æ‰¾ç¨³å®šçš„å·¥ä½œå¹³å°';
    }
  }

  function getWealthAnalysis(tenGods, elementCounts) {
    if (tenGods.includes('åè´¢')) {
      return 'åè´¢è¿è¾ƒå¥½ï¼Œæœ‰æœºä¼šè·å¾—æ„å¤–ä¹‹è´¢';
    } else if (tenGods.includes('æ­£è´¢')) {
      return 'æ­£è´¢è¿ç¨³å®šï¼Œé€‚åˆç¨³å®šæ”¶å…¥çš„å·¥ä½œ';
    } else {
      return 'è´¢è¿å¹³ç¨³ï¼Œéœ€è¦é€šè¿‡åŠªåŠ›è·å¾—è´¢å¯Œ';
    }
  }

  function getWealthDirections(usefulSpirit) {
    return getFavorableDirections(usefulSpirit);
  }

  function getHealthAnalysis(dayStem, elementCounts) {
    const healthMap = {
      'æœ¨': 'æ³¨æ„è‚èƒ†ã€ç­‹éª¨æ–¹é¢çš„é—®é¢˜',
      'ç«': 'æ³¨æ„å¿ƒè¡€ç®¡ã€çœ¼ç›æ–¹é¢çš„é—®é¢˜', 
      'åœŸ': 'æ³¨æ„è„¾èƒƒã€æ¶ˆåŒ–ç³»ç»Ÿçš„é—®é¢˜',
      'é‡‘': 'æ³¨æ„å‘¼å¸ç³»ç»Ÿã€çš®è‚¤æ–¹é¢çš„é—®é¢˜',
      'æ°´': 'æ³¨æ„è‚¾è„ã€æ³Œå°¿ç³»ç»Ÿçš„é—®é¢˜'
    };
    return healthMap[dayStem] || 'ä½“è´¨è¾ƒä¸ºå¹³è¡¡';
  }

  function getHealthTips(usefulSpirit) {
    const tips = {
      'æœ¨': 'å°‘é¥®é…’ï¼Œä¿æŠ¤è§†åŠ›ï¼Œé€‚åº¦è¿åŠ¨',
      'ç«': 'æ§åˆ¶æƒ…ç»ªï¼Œé¿å…ç†¬å¤œï¼Œæ³¨æ„ç¡çœ ',
      'åœŸ': 'è§„å¾‹é¥®é£Ÿï¼Œé¿å…æš´é¥®æš´é£Ÿ', 
      'é‡‘': 'æ³¨æ„ä¿æš–ï¼Œé¿å…å¹²ç‡¥ç¯å¢ƒ',
      'æ°´': 'ä¿æŒæ°´åˆ†å¹³è¡¡ï¼Œé¿å…å—å‡‰'
    };
    return tips[usefulSpirit] || 'ä¿æŒå¥åº·ç”Ÿæ´»ä¹ æƒ¯';
  }

  // å…¶ä»–å‡½æ•°ä¿æŒä¸å˜...
  function applyI18n() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      const val = t(key);
      if (val) el.textContent = val;
    });
  }

  // ... ä¿æŒå…¶ä»–å·¥å…·å‡½æ•°å’Œä¸»é€»è¾‘ä¸å˜
})();
</script>
</body>
</html>
