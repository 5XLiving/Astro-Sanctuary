<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å…«å­—å‘½ç† Â· ä¸“ä¸šæ’ç›˜</title>
    <style>
        /* ç°æœ‰CSSä¿æŒä¸å˜ï¼Œåªæ·»åŠ æ–°æ ·å¼ */
        
        /* å¿ƒæ€œç®¡å®¶ä¸“ä¸šçª—å£ */
        .butler-professional {
            display: none;
            margin-top: 20px;
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 20px;
        }
        
        .butler-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--gold2);
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .butler-content {
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: #0f1624;
            border-radius: 10px;
            border: 1px solid #253245;
        }
        
        .butler-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #253245;
        }
        
        .butler-section h4 {
            color: var(--gold2);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        /* å¯¹è¯ç•Œé¢ */
        .butler-chat {
            margin-top: 20px;
            border-top: 1px solid var(--line);
            padding-top: 15px;
        }
        
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: #0f1624;
            border-radius: 8px;
            border: 1px solid #253245;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        
        .chat-input-area input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #253245;
            background: #0e1520;
            color: var(--text);
        }
        
        .chat-send-btn {
            padding: 10px 20px;
            background: var(--gold);
            color: #191919;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- 1. ç°æœ‰æ’ç›˜è¡¨å•ä¿æŒä¸å˜ -->
    <section class="card">
        <div class="h2">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
        <div class="row cols-3">
            <div>
                <label class="muted">å§“åï¼ˆå¯é€‰ï¼‰</label>
                <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
            </div>
            <div>
                <label class="muted">æ€§åˆ«</label>
                <select id="gender">
                    <option value="">ä¸é€éœ²</option>
                    <option value="male">ç”·æ€§</option>
                    <option value="female">å¥³æ€§</option>
                </select>
            </div>
            <div>
                <label class="muted">å†æ³•</label>
                <select id="calendar">
                    <option value="gregorian">é˜³å†</option>
                    <option value="lunar">å†œå†</option>
                </select>
            </div>
        </div>
        <div class="row cols-3" style="margin-top:10px">
            <div>
                <label class="muted">å‡ºç”Ÿæ—¥æœŸ</label>
                <input type="date" id="birthdate" />
            </div>
            <div>
                <label class="muted">å‡ºç”Ÿæ—¶é—´</label>
                <div class="time-row">
                    <input type="time" id="birthtime" />
                    <label class="muted time-unknown">
                        <input type="checkbox" id="timeUnknown" />
                        <span>å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
                    </label>
                </div>
            </div>
            <div class="gen-wrap">
                <button class="btn" id="genBtn" type="button">
                    <span id="genBtnText">ç”Ÿæˆå…«å­—</span>
                    <span id="genBtnLoading" style="display:none">è®¡ç®—ä¸­...</span>
                </button>
            </div>
        </div>
    </section>

    <!-- 2. å¿ƒæ€œç®¡å®¶ä¸“ä¸šçª—å£ -->
    <section id="butlerProfessional" class="butler-professional">
        <div class="butler-header">
            <span>ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
        </div>
        
        <div class="butler-content" id="professionalReport">
            <!-- AIç”Ÿæˆçš„ä¸“ä¸šæŠ¥å‘Šå°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
        </div>
        
        <div class="butler-chat">
            <div class="chat-messages" id="chatMessages">
                <div class="ss-msg">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
                <button class="chat-send-btn" id="chatSend">å‘é€</button>
            </div>
        </div>
    </section>

    <!-- 3. VIPåŒºåŸŸä¿æŒä¸å˜ -->
    <section class="card section vip-section">
        <!-- ç°æœ‰VIPä»£ç  -->
    </section>

    <script>
        // å…«å­—è®¡ç®—æ ¸å¿ƒä»£ç ä¿æŒä¸å˜
        
        // ä¸“ä¸šæŠ¥å‘Šç”Ÿæˆå‡½æ•°
        async function generateProfessionalReport(baziData) {
            const prompt = `
            ä½œä¸º40å¹´ç»éªŒçš„èµ„æ·±å‘½ç†å¸ˆï¼Œè¯·ä¸ºä»¥ä¸‹å…«å­—ç”Ÿæˆä¸“ä¸šçº§åˆ†ææŠ¥å‘Šï¼š
            
            å…«å­—ï¼š${baziData.pillars.year.stem}${baziData.pillars.year.branch} 
                  ${baziData.pillars.month.stem}${baziData.pillars.month.branch}
                  ${baziData.pillars.day.stem}${baziData.pillars.day.branch} 
                  ${baziData.pillars.hour.stem}${baziData.pillars.hour.branch}
            
            æ€§åˆ«ï¼š${baziData.gender || 'æœªé€éœ²'}
            äº”è¡Œåˆ†å¸ƒï¼šæœ¨${baziData.counts.æœ¨}% ç«${baziData.counts.ç«}% åœŸ${baziData.counts.åœŸ}% é‡‘${baziData.counts.é‡‘}% æ°´${baziData.counts.æ°´}%
            
            è¯·ç”¨ä¸“ä¸šå‘½ç†æœ¯è¯­ç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼ŒåŒ…å«ï¼š
            
            ğŸ”® ä¸€ã€æ ¼å±€å±‚æ¬¡
            - è¯†åˆ«æ‰€æœ‰é€‚ç”¨æ ¼å±€ï¼ˆå»ºç¦„æ ¼ã€æœ¨ç«é€šæ˜ç­‰20+ç§æ ¼å±€ï¼‰
            - æ ¼å±€ç­‰çº§è¯„å®š
            - ç‰¹æ®Šæ ¼å±€è¯´æ˜
            
            âš”ï¸ äºŒã€åç¥é…ç½®åˆ†æ
            - æ¯ä¸ªåç¥çš„å®é™…å½±å“
            - åç¥ç»„åˆåˆ†æ
            - åç¥å¯¹æ€§æ ¼çš„å½±å“
            
            ğŸ’ ä¸‰ã€ç”¨ç¥å–œå¿Œ
            - ç²¾ç¡®ç”¨ç¥åˆ¤æ–­
            - å¤§è¿æµå¹´å–œå¿Œ
            - è°ƒå€™ç”¨ç¥åˆ†æ
            
            ğŸ¯ å››ã€äº‹ä¸šå‘å±•
            - å…·ä½“è¡Œä¸šå»ºè®®
            - èŒä¸šå‘å±•è·¯å¾„
            - é€‚åˆçš„å²—ä½ç±»å‹
            
            ğŸ’° äº”ã€è´¢è¿åˆ†æ  
            - è´¢è¿ç‰¹ç‚¹
            - æŠ•èµ„å»ºè®®
            - è´¢å¯Œç§¯ç´¯æ—¶æœº
            
            ğŸ”® å…­ã€ç„å­¦ç¼˜åˆ†
            - çµæ€§ç‰¹è´¨
            - é€‚åˆçš„ä¿®è¡Œæ–¹å‘
            - å‘½ç†å­¦ä¹ æ½œåŠ›
            
            ğŸ“… ä¸ƒã€æµå¹´è¯¦æ‰¹ï¼ˆæœªæ¥3å¹´ï¼‰
            - æ¯å¹´è¿åŠ¿é‡ç‚¹
            - å…³é”®æ—¶é—´èŠ‚ç‚¹
            - æ³¨æ„äº‹é¡¹
            
            æ ¼å¼è¦æ±‚ï¼šä¸“ä¸šæ·±åº¦ï¼Œå…·ä½“å»ºè®®ï¼Œé¿å…æ³›æ³›è€Œè°ˆã€‚
            `;

            // è°ƒç”¨AIç”ŸæˆæŠ¥å‘Š
            const report = await callAIForProfessionalReport(prompt);
            return report;
        }

        // æ˜¾ç¤ºä¸“ä¸šæŠ¥å‘Š
        async function showProfessionalReport(baziData) {
            const butlerSection = document.getElementById('butlerProfessional');
            const reportContainer = document.getElementById('professionalReport');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            reportContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="skeleton">
                        <div style="width: 80%"></div>
                        <div style="width: 60%"></div>
                        <div style="width: 70%"></div>
                    </div>
                    <div style="color: var(--muted); margin-top: 10px;">æ­£åœ¨ç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š...</div>
                </div>
            `;
            
            butlerSection.style.display = 'block';
            
            try {
                const report = await generateProfessionalReport(baziData);
                reportContainer.innerHTML = report;
                
                // æ»šåŠ¨åˆ°æŠ¥å‘ŠåŒºåŸŸ
                butlerSection.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                reportContainer.innerHTML = `
                    <div style="color: #ff6b6b; text-align: center;">
                        æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•
                    </div>
                `;
            }
        }

        // ä¿®æ”¹ç°æœ‰çš„ç”Ÿæˆå…«å­—å‡½æ•°
        async function generateBaziChart() {
            // ç°æœ‰å…«å­—è®¡ç®—é€»è¾‘...
            
            // è®¡ç®—å®Œæˆåæ˜¾ç¤ºä¸“ä¸šæŠ¥å‘Š
            const baziData = {
                pillars: pillars,
                counts: counts, 
                gender: document.getElementById('gender').value,
                // å…¶ä»–å¿…è¦æ•°æ®
            };
            
            await showProfessionalReport(baziData);
        }

        // åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
        function initButlerChat() {
            const chatSend = document.getElementById('chatSend');
            const chatInput = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');
            
            chatSend.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            function sendChatMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                const userMsg = document.createElement('div');
                userMsg.className = 'ss-msg me';
                userMsg.textContent = message;
                chatMessages.appendChild(userMsg);
                
                chatInput.value = '';
                
                // æ¨¡æ‹ŸAIå›å¤
                setTimeout(() => {
                    const aiMsg = document.createElement('div');
                    aiMsg.className = 'ss-msg';
                    aiMsg.textContent = 'è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œè®©æˆ‘ç»“åˆæ‚¨çš„å‘½ç›˜ä¸ºæ‚¨è¯¦ç»†åˆ†æ...';
                    chatMessages.appendChild(aiMsg);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
            }
        }

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç°æœ‰åˆå§‹åŒ–ä»£ç ...
            initButlerChat();
        });
    </script>
</body>
</html>
