<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ä¿æŒä½ çš„åŸæœ‰æ ·å¼ï¼Œå¹¶ä¿®å¤/è¡¥å…¨å°‘é‡ç»†èŠ‚ */
:root{
  --bg:#0b0f14;
  --bg-accent:#0e1520;
  --card:#11161dcc;
  --surface:#0f1624;
  --line:#1f2a36;
  --text:#e8edf3;
  --muted:#98a7b7;

  --brand:#d4af37;
  --gold:#d4af37;
  --gold2:#f2d27a;
  --accent:#58b9ff;

  --radius:14px;
  --radius-sm:10px;
  --radius-lg:18px;

  --shadow:0 8px 30px rgba(0,0,0,.35);
  --shadow-sm:0 4px 14px rgba(0,0,0,.28);

  --container:1100px;
  --gap:12px;
  --pad:18px;

  /* ä¿®å¤ï¼šæ·»åŠ æ­£ç¡®çš„focuså˜é‡ */
  --focus: 0 0 0 2px rgba(212,175,55,0.2);

  /* ä»…ä¾›æ³¨é‡Šè¯´æ˜ï¼šåª’ä½“æŸ¥è¯¢ä»ç”¨å›ºå®šæ•°å€¼å†™ */
  --bp-s:520px;
  --bp-m:760px;
  --bp-l:900px;
}

/* Reset + base */
*,
*::before,
*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
    linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}

.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}

.site-header{
  position:sticky; top:0; z-index:10;
  background:rgba(11,15,20,.8);
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:var(--shadow-sm);
  font-weight:800; color:#ffe084
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}

.lang{display:flex; align-items:center; gap:8px}
.lang select{
  appearance:none; min-width:140px;
  border-radius:10px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:10px 34px 10px 12px; font-size:0.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}

.section{margin-top:18px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:var(--pad);
  margin:16px 0;
}
.h2{
  font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084;
  display:flex; gap:8px; align-items:center
}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}

.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width: 760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .row.cols-2{grid-template-columns:1fr 1fr}
}

input,select{
  width:100%;
  border-radius:12px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:12px 12px; font-size:15px; outline:0;
}
input::placeholder{color:#6f8092}
input:focus, select:focus{box-shadow:var(--focus); border-color:#3a4c63}

.btn{
  display:inline-grid; place-items:center;
  padding:12px 16px; border-radius:12px;
  border:1px solid #e6c76e;
  background:linear-gradient(180deg,#fff9e6,#e6c76e);
  color:#191919; font-weight:800; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}

.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width: 520px){
  .pillars{grid-template-columns:repeat(2,1fr)}
}

.bazi-table{
  width:100%; border-collapse:collapse; margin-top:12px;
  background:var(--surface); border-radius:8px; overflow:hidden
}
.bazi-table th,.bazi-table td{
  padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle
}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
/* å°å±è¡¨æ ¼å¯æ¨ªå‘æ»šåŠ¨ï¼šæŠŠ table ç”¨ div åŒ…ä¸€å±‚ .bazi-table-wrap å³å¯ */
.bazi-table-wrap{overflow:auto}
@media (max-width: 420px){
  .bazi-table th,.bazi-table td{padding:8px 10px}
}

.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:60px 1fr 60px; gap:10px; align-items:center}

.error-message{
  background:rgba(255,90,95,.1);
  border:1px solid #ff5a5f; border-radius:8px;
  padding:10px; display:none; margin-top:10px
}
.badge-warn{display:inline-block; padding:2px 8px; margin-left:6px; border:1px solid #ffb84d; border-radius:999px; color:#ffb84d; font-size:0.82rem}
.muted{color:var(--muted)}

.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}

.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.rating{display:flex; align-items:center; gap:8px; margin:8px 0}
.rating-stars{color:var(--gold2)}
.tag{display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:0.85rem; margin:2px}

.luck-grid{display:grid; gap:10px}
.luck-item{background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
.luck-year{font-weight:700; color:var(--gold2)}
.luck-desc{font-size:0.9rem; margin-top:4px}

.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width: 900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)
}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

.ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
.ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
.ai-box-c{color:#e8edf3; line-height:1.7}
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.chip{padding:6px 10px; border-radius:999px; border:1px solid #2a3546; background:#0e1520; color:#e8edf3; cursor:pointer; transition:border-color .2s ease, box-shadow .2s ease}
.chip:hover{border-color:#f2d27a; box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
.chip:disabled{opacity:.6; cursor:not-allowed}

.skeleton{display:grid; gap:8px}
.skeleton div{height:12px; border-radius:6px; background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431); animation:sh 1.2s infinite}
@keyframes sh{0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5}}

.ai-lock-overlay{margin-top:10px; padding-top:10px; border-top:1px solid #1f2a36; text-align:center}
.ai-lock-overlay .tip{color:#ffd88a; font-weight:700; margin-bottom:4px}
.ai-lock-overlay .sub{color:var(--muted)}

.detail-view{display:none}
.detail-header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
.back-btn{background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
.detail-content{line-height:1.8}
.detail-section{margin-bottom:24px}
.detail-section h4{color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
.action-list{list-style:none; padding:0; margin:0}
.action-list li{margin-bottom:8px; padding-left:20px; position:relative}
.action-list li::before{content:"â€¢"; color:var(--gold2); position:absolute; left:0; top:0}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}

/* Motion ä¼˜åŒ– */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* Utilities */
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.chips-container{display:flex; flex-wrap:wrap; gap:8px; margin:20px 0; justify-content:center}

/* VIP section demo å¯è§ */
.vip-section{display:block !important}

/* Butler ç»„ä»¶ */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
.butler-chat{margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
.chat-messages{height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:var(--surface); border-radius:8px; border:1px solid #253245}
.chat-input-area{display:flex; gap:10px}
.chat-input-area input{flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3}
.chat-send-btn{padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:700; cursor:pointer}

/* ==== remove the brown/gold focus outline ==== */
input:focus,
select:focus,
textarea:focus{
  outline: none !important;
  box-shadow: none !important;
  border-color: #243244 !important;
}
button:focus,
.btn:focus,
a:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* (optional) also remove tap highlight on mobile */
*{ -webkit-tap-highlight-color: transparent; }    
.chip:hover{ border-color:#2a3546; box-shadow:none; }

/* æµ®çª—èŠå¤©æ ·å¼ */
.chat-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 350px;
  height: 500px;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  z-index: 1000;
  display: none;
  flex-direction: column;
}

.chat-float-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(212,175,55,.1);
  color: var(--gold2);
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
}

.chat-float-close {
  background: none;
  border: none;
  color: var(--gold2);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}

.chat-float-close:hover {
  background: rgba(212,175,55,.2);
}

.chat-float-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0;
}

.chat-float-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background: var(--surface);
}

.chat-float-input-area {
  padding: 12px;
  border-top: 1px solid var(--line);
  background: var(--bg-accent);
}

.chat-toggle-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(180deg,#fff9e6,#e6c76e);
  border: 1px solid #e6c76e;
  color: #191919;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(230,199,110,.3);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chat-toggle-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(230,199,110,.5);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .chat-float {
    width: 300px;
    height: 400px;
    bottom: 10px;
    right: 10px;
  }
  
  .chat-toggle-btn {
    width: 50px;
    height: 50px;
    bottom: 10px;
    right: 10px;
  }
}    
</style>
</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
      <span class="title" data-i18n="brand.subtitle">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="nav.langLabel">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN" data-i18n="lang.zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW" data-i18n="lang.zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en"    data-i18n="lang.en">English</option>
        <option value="ja"    data-i18n="lang.ja">æ—¥æœ¬èª</option>
        <option value="th"    data-i18n="lang.th">à¹„à¸—à¸¢</option>
        <option value="ms"    data-i18n="lang.ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2" data-i18n="app.title">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="form.nameLabel">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted" data-i18n="form.genderLabel">æ€§åˆ«</label>
        <select id="gender">
          <option value=""        data-i18n="form.gender.hidden">ä¸é€éœ²</option>
          <option value="male"    data-i18n="form.gender.male">ç”·æ€§</option>
          <option value="female"  data-i18n="form.gender.female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="form.calendarLabel">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian" data-i18n="form.calendar.gregorian">é˜³å†</option>
          <option value="lunar"     data-i18n="form.calendar.lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted" data-i18n="form.birthdateLabel">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted" data-i18n="form.birthtimeLabel">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span data-i18n="form.timeUnknown">å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText" data-i18n="btn.generate">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none" data-i18n="btn.loading">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

<section id="result" style="display:none;">
    <div class="card">
      <div class="h2" data-i18n="result.title">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>
     
      <table class="bazi-table">
        <thead>
          <tr>
            <th></th>
            <th data-i18n="pillar.year">å¹´æŸ±</th>
            <th data-i18n="pillar.month">æœˆæŸ±</th>
            <th data-i18n="pillar.day">æ—¥æŸ±</th>
            <th data-i18n="pillar.hour">æ—¶æŸ±</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-i18n="table.row.stem">å¤©å¹²</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.branch">åœ°æ”¯</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.fiveElem">äº”è¡Œ</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.nayin">çº³éŸ³</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2" data-i18n="energy.title">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span data-i18n="elem.wood">æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.fire">ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.earth">åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.metal">é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.water">æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
</section>
    
<!-- æµ®çª—èŠå¤©æŒ‰é’® -->
<button class="chat-toggle-btn" id="chatToggle" data-i18n="chat.toggle">é—®</button>

<!-- æµ®çª—èŠå¤©çª—å£ -->
<div class="chat-float" id="chatFloat">
  <div class="chat-float-header">
    <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    <button class="chat-float-close" id="chatClose">Ã—</button>
  </div>
  <div class="chat-float-body">
    <div class="chat-float-messages" id="chatMessages">
      <div class="ss-msg" data-i18n="pro.welcome">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
    </div>
    <div class="chat-float-input-area">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #253245; background: #0e1520; color: #e8edf3;">
        <button class="chat-send-btn" id="chatSend" data-i18n="chat.send" style="padding: 10px 16px; background: var(--gold); color: #191919; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">å‘é€</button>
      </div>
    </div>
  </div>
</div>  

  <section class="card section vip-section">
    <h2 class="group-title" data-i18n="vip.title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.astrology">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.astrology.match">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li data-i18n="vip.astrology.career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li data-i18n="vip.astrology.wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li data-i18n="vip.astrology.pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.spiritual">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.spiritual.record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li data-i18n="vip.spiritual.courses">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li data-i18n="vip.spiritual.family">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li data-i18n="vip.spiritual.practice">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="vip.login.title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head" data-i18n="auth.header">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email">
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰">
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="auth.login">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="auth.reset">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="auth.register">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted" data-i18n="auth.freeTrialNote">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head" data-i18n="vip.services.header">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="vip.upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="vip.back">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted" data-i18n="vip.priceNote">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer data-i18n="footer.copy">Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>
  
<script>window.API_BASE='https://throbbing-lab-1440.hello5xliving.workers.dev';</script>
<script>
/*!
 * 5XLiving Â· Bazi Quick Chart - MULTI-LANGUAGE VERSION
 */
(() => {
  'use strict';

  const CONFIG = {
    API_BASE: '' // ä½¿ç”¨æœ¬åœ°è®¡ç®—
  };

  // å®Œæ•´çš„å¤šè¯­è¨€å­—å…¸
  const I18N = {
    'zh-CN': {
      brand: { subtitle: '5xLiving Â· å…«å­—ç®€è¯„' },
      nav: { langLabel: 'è¯­è¨€' },
      lang: { 
        'zh-CN':'ç®€ä½“ä¸­æ–‡',
        'zh-TW':'ç¹é«”ä¸­æ–‡',
        'en':'English',
        'ja':'æ—¥æœ¬èª', 
        'th':'à¹„à¸—à¸¢',
        'ms':'Bahasa Melayu'
      },
      app: { title: 'å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜' },
      form: {
        nameLabel: 'å§“åï¼ˆå¯é€‰ï¼‰',
        namePlaceholder: 'ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰',
        genderLabel: 'æ€§åˆ«',
        gender: { hidden:'ä¸é€éœ²', male:'ç”·æ€§', female:'å¥³æ€§' },
        calendarLabel: 'å†æ³•',
        calendar: { gregorian:'é˜³å†', lunar:'å†œå†' },
        birthdateLabel: 'å‡ºç”Ÿæ—¥æœŸ',
        birthtimeLabel: 'å‡ºç”Ÿæ—¶é—´',
        timeUnknown: 'å‡ºç”Ÿæ—¶é—´ä¸è¯¦'
      },
      btn: { generate: 'ç”Ÿæˆå…«å­—', loading: 'è®¡ç®—ä¸­...' },
      result: { title: 'æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜' },
      pillar: { year:'å¹´æŸ±', month:'æœˆæŸ±', day:'æ—¥æŸ±', hour:'æ—¶æŸ±' },
      table: { 
        row: { stem:'å¤©å¹²', branch:'åœ°æ”¯', fiveElem:'äº”è¡Œ', nayin:'çº³éŸ³' }
      },
      energy: { title: 'äº”è¡Œèƒ½é‡åˆ†æ' },
      elem: { wood: 'æœ¨', fire: 'ç«', earth: 'åœŸ', metal: 'é‡‘', water: 'æ°´' },
      pro: { 
        title: 'ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ', 
        welcome: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚'
      },
      chat: { send: 'å‘é€', placeholder: 'è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...', toggle: 'é—®' },
      vip: {
        title: 'ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment',
        group: { astrology:'ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹', spiritual:'ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹' },
        astrology: { 
          match:'å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿', 
          career:'äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›', 
          wealth:'è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº', 
          pet:'å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†'
        },
        spiritual: { 
          record:'çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·', 
          courses:'å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°', 
          family:'å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­', 
          practice:'æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡'
        },
        login: { title: 'ğŸ’ ç™»å…¥ VIP åŠŸèƒ½' },
        services: { header: 'ä¼šå‘˜æœåŠ¡' },
        upgrade: 'ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰',
        back: 'â† è¿”å›å‘½ç†å•†åŸ',
        priceNote: '$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰'
      },
      auth: {
        header: 'è´¦æˆ·ç™»å½• / æ³¨å†Œ',
        login: 'ç™»å…¥è´¦æˆ·',
        reset: 'ğŸ”‘ é‡è®¾å¯†ç ',
        register: 'æ³¨å†Œè´¦æˆ·',
        freeTrialNote: 'æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ',
        emailPlaceholder: 'é‚®ç®± Email',
        passwordPlaceholder: 'å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰'
      },
      footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
      err: {
        fillBirthdate: 'è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ',
        invalidDate: 'æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼Œè¯·ç”¨ YYYY-MM-DD',
        generateFail: 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
      },
      ui: {
        unknown: 'æœªçŸ¥',
        timeUnknown: 'æ—¶é—´ä¸è¯¦',
        hourSuffix: '{h}æ—¶',
        birthSummary: 'å‡ºç”Ÿæ—¥æœŸ: {y}å¹´{m}æœˆ{d}æ—¥ {timeText}',
        balance: 'äº”è¡Œä¸­{strongest}æœ€å¼ºï¼Œ{weakest}æœ€å¼±ã€‚'
      },
      badge: { noHour: 'æœªçº³å…¥æ—¶æŸ±' },
      chatDyn: { autoReply: 'æ”¶åˆ°ï¼š{q}ã€‚ç¨åå¯åœ¨ä¸“ä¸šæŠ¥å‘Šç›¸åº”ç« èŠ‚æ‰¾åˆ°è¦ç‚¹ã€‚' },
      elemNames: { æœ¨:'æœ¨', ç«:'ç«', åœŸ:'åœŸ', é‡‘:'é‡‘', æ°´:'æ°´' },
      report: { 
        hourUnknownTip: 'âš ï¸ æç¤ºï¼šå› å‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œéƒ¨åˆ†åˆ†æä»…ä¾›å‚è€ƒã€‚',
        tipTitle: 'æç¤º',
        generating: 'æ­£åœ¨ç”Ÿæˆä¸“ä¸šåˆ†ææŠ¥å‘Š...',
        failed: 'æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
      },
      // ä¸“ä¸šæŠ¥å‘Šå†…å®¹
      reportTitles: {
        overview: 'ğŸ“Š å‘½ç›˜æ€»è§ˆ',
        fiveElements: 'ğŸŒ¿ äº”è¡Œåˆ†æ',
        tenGods: 'âš¡ åç¥é…ç½®',
        relationship: 'ğŸ’• æ„Ÿæƒ…å©šå§»',
        career: 'ğŸ’¼ äº‹ä¸šå‘å±•',
        wealth: 'ğŸ’° è´¢è¿åˆ†æ',
        health: 'ğŸŒ¡ï¸ å¥åº·å…»ç”Ÿ',
        nearTerm: 'ğŸ”® è¿‘æœŸè¿åŠ¿'
      },    
      report: {
        errorTitle: 'æç¤º',
        noContent: 'æœªè·å–åˆ°æŠ¥å‘Šå†…å®¹',
        hourUnknownTip: 'âš ï¸ æç¤ºï¼šå› å‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œéƒ¨åˆ†åˆ†æä»…ä¾›å‚è€ƒã€‚',
        tipTitle: 'æç¤º'
      },
      reportLabels: {
        dayMaster: 'æ—¥ä¸»å‘½ç†',
        strength: 'æ—¥ä¸»å¼ºå¼±',
        usefulSpirit: 'å–œç”¨ç¥',
        elementCount: 'äº”è¡Œä¸ªæ•°',
        elementStrength: 'äº”è¡Œæ—ºè¡°',
        supportElements: 'å¸®æ‰¶äº”è¡Œ',
        restrainElements: 'å…‹æ³„äº”è¡Œ',
        missingElements: 'äº”è¡Œæ‰€ç¼º',
        traits: 'æ„Ÿæƒ…ç‰¹è´¨',
        marriageAdvice: 'å©šå§»å»ºè®®',
        relationshipTips: 'ç›¸å¤„ä¹‹é“',
        suitableCareers: 'é€‚åˆè¡Œä¸š',
        careerAdvice: 'å‘å±•å»ºè®®',
        favorableDirections: 'æœ‰åˆ©æ–¹ä½',
        wealthCharacteristics: 'è´¢è¿ç‰¹ç‚¹',
        wealthDirections: 'æ±‚è´¢æ–¹å‘',
        financialAdvice: 'ç†è´¢å»ºè®®',
        healthCharacteristics: 'ä½“è´¨ç‰¹ç‚¹',
        healthTips: 'æ³¨æ„äº‹é¡¹',
        wellnessAdvice: 'å…»ç”Ÿå»ºè®®',
        overallFortune: 'æ•´ä½“è¿åŠ¿',
        favorableTiming: 'æœ‰åˆ©æ—¶æœº',
        cautions: 'æ³¨æ„äº‹é¡¹'
      }
    },
// zh-TW ç¹é«”ä¸­æ–‡
'zh-TW': {
  brand: { subtitle: '5xLiving Â· å…«å­—ç°¡è©•' },
  nav: { langLabel: 'èªè¨€' },
  lang: { 
    'zh-CN':'ç°¡é«”ä¸­æ–‡',
    'zh-TW':'ç¹é«”ä¸­æ–‡',
    'en':'English',
    'ja':'æ—¥æœ¬èª', 
    'th':'à¹„à¸—à¸¢',
    'ms':'Bahasa Melayu'
  },
  app: { title: 'å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›¤' },
  form: {
    nameLabel: 'å§“åï¼ˆå¯é¸ï¼‰',
    namePlaceholder: 'ä½ çš„ç¨±å‘¼ï¼ˆç”¨æ–¼å€‹æ€§åŒ–ï¼‰',
    genderLabel: 'æ€§åˆ¥',
    gender: { hidden:'ä¸é€éœ²', male:'ç”·æ€§', female:'å¥³æ€§' },
    calendarLabel: 'æ›†æ³•',
    calendar: { gregorian:'é™½æ›†', lunar:'è¾²æ›†' },
    birthdateLabel: 'å‡ºç”Ÿæ—¥æœŸ',
    birthtimeLabel: 'å‡ºç”Ÿæ™‚é–“',
    timeUnknown: 'å‡ºç”Ÿæ™‚é–“ä¸è©³'
  },
  btn: { generate: 'ç”Ÿæˆå…«å­—', loading: 'è¨ˆç®—ä¸­...' },
  result: { title: 'æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›¤' },
  pillar: { year:'å¹´æŸ±', month:'æœˆæŸ±', day:'æ—¥æŸ±', hour:'æ™‚æŸ±' },
  table: { 
    row: { stem:'å¤©å¹²', branch:'åœ°æ”¯', fiveElem:'äº”è¡Œ', nayin:'ç´éŸ³' }
  },
  energy: { title: 'äº”è¡Œèƒ½é‡åˆ†æ' },
  elem: { wood: 'æœ¨', fire: 'ç«', earth: 'åœŸ', metal: 'é‡‘', water: 'æ°´' },
  pro: { 
    title: 'ğŸ§™â€â™‚ï¸ å¿ƒæ†ç®¡å®¶ Â· å°ˆæ¥­å‘½ç†åˆ†æ', 
    welcome: 'æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å°ˆæ¥­å‘½ç†é¡§å•ï¼Œå·²ç‚ºæ‚¨ç”Ÿæˆè©³ç´°åˆ†æå ±å‘Šã€‚æœ‰ä»€éº¼å…·é«”å•é¡Œå¯ä»¥éš¨æ™‚å•æˆ‘ã€‚'
  },
  chat: { send: 'ç™¼é€', placeholder: 'è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...', toggle: 'å•' },
  vip: {
    title: 'ğŸŒ™ æœƒå“¡å€åŸŸ VIP Segment',
    group: { astrology:'ğŸ— å‘½ç†ç©ºé–“å°ˆå±¬å…§å®¹', spiritual:'ğŸŒ™ å¿ƒæ†ç©ºé–“å°ˆå±¬å…§å®¹' },
    astrology: { 
      match:'å§»ç·£æ–¹å‘ï¼šæˆ€æ„›ç·£åˆ†ã€å©šå§»èµ°å‹¢', 
      career:'äº‹æ¥­æ–¹å‘ï¼šè·å ´ç™¼å±•ã€å‰µæ¥­æ½›åŠ›', 
      wealth:'è²¡é‹æ–¹å‘ï¼šè²¡ä½åˆ†æã€ç†è²¡æ™‚æ©Ÿ', 
      pet:'å¯µç‰©å‘½ç†ï¼šä¼´ä¾¶å‹•ç‰©çš„æ€§æ ¼èˆ‡ç·£åˆ†'
    },
    spiritual: { 
      record:'éˆæ€§è¨˜éŒ„ï¼šç…§ç‰‡ã€å¤¢å¢ƒã€è²éŸ³ã€é¡˜æœ›ç¥ˆç¦±', 
      courses:'å‘½ç†èª²ç¨‹ï¼šå…«å­— / å¡”ç¾… / å æ˜Ÿ / éˆæ•¸', 
      family:'å®¶æ—ç´€å¿µç³»çµ±ï¼šè¦ªäººéˆæ€§ç´€å¿µ & å»¶çºŒ', 
      practice:'æ¯é€±èƒ½é‡ç·´ç¿’ / ç¥æ˜å„€å¼ä»»å‹™'
    },
    login: { title: 'ğŸ’ ç™»å…¥ VIP åŠŸèƒ½' },
    services: { header: 'æœƒå“¡æœå‹™' },
    upgrade: 'ğŸ’ å‡ç´šç‚º VIPï¼ˆæœˆè²»ï¼‰',
    back: 'â† è¿”å›å‘½ç†å•†åŸ',
    priceNote: '$9.9 / æœˆè²» VIPï¼ˆå‘½ç†ç©ºé–“ + å¿ƒæ†ç©ºé–“ + éˆæ€§èª²ç¨‹ï¼‰'
  },
  auth: {
    header: 'è³¬æˆ¶ç™»éŒ„ / è¨»å†Š',
    login: 'ç™»å…¥è³¬æˆ¶',
    reset: 'ğŸ”‘ é‡è¨­å¯†ç¢¼',
    register: 'è¨»å†Šè³¬æˆ¶',
    freeTrialNote: 'è¨»å†Šè³¬è™Ÿè´ˆé€ä¸€æ¬¡å…è²»é«”é©—',
    emailPlaceholder: 'éƒµç®± Email',
    passwordPlaceholder: 'å¯†ç¢¼ Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å¯«æ•¸å­—ç¬¦è™Ÿï¼‰'
  },
  footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
  err: {
    fillBirthdate: 'è«‹å¡«å¯«å‡ºç”Ÿæ—¥æœŸ',
    invalidDate: 'ç„¡æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼Œè«‹ç”¨ YYYY-MM-DD',
    generateFail: 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦'
  },
  ui: {
    unknown: 'æœªçŸ¥',
    timeUnknown: 'æ™‚é–“ä¸è©³',
    hourSuffix: '{h}æ™‚',
    birthSummary: 'å‡ºç”Ÿæ—¥æœŸ: {y}å¹´{m}æœˆ{d}æ—¥ {timeText}',
    balance: 'äº”è¡Œä¸­{strongest}æœ€å¼·ï¼Œ{weakest}æœ€å¼±ã€‚'
  },
  badge: { noHour: 'æœªç´å…¥æ™‚æŸ±' },
  chatDyn: { autoReply: 'æ”¶åˆ°ï¼š{q}ã€‚ç¨å¾Œå¯åœ¨å°ˆæ¥­å ±å‘Šç›¸æ‡‰ç« ç¯€æ‰¾åˆ°è¦é»ã€‚' },
  elemNames: { æœ¨:'æœ¨', ç«:'ç«', åœŸ:'åœŸ', é‡‘:'é‡‘', æ°´:'æ°´' },
  report: { 
    hourUnknownTip: 'âš ï¸ æç¤ºï¼šå› å‡ºç”Ÿæ™‚é–“ä¸è©³ï¼Œéƒ¨åˆ†åˆ†æåƒ…ä¾›åƒè€ƒã€‚',
    tipTitle: 'æç¤º',
    generating: 'æ­£åœ¨ç”Ÿæˆå°ˆæ¥­åˆ†æå ±å‘Š...',
    failed: 'å ±å‘Šç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦'
  },
  reportTitles: {
    overview: 'ğŸ“Š å‘½ç›¤ç¸½è¦½',
    fiveElements: 'ğŸŒ¿ äº”è¡Œåˆ†æ',
    tenGods: 'âš¡ åç¥é…ç½®',
    relationship: 'ğŸ’• æ„Ÿæƒ…å©šå§»',
    career: 'ğŸ’¼ äº‹æ¥­ç™¼å±•',
    wealth: 'ğŸ’° è²¡é‹åˆ†æ',
    health: 'ğŸŒ¡ï¸ å¥åº·é¤Šç”Ÿ',
    nearTerm: 'ğŸ”® è¿‘æœŸé‹å‹¢'
  },
  reportLabels: {
    dayMaster: 'æ—¥ä¸»å‘½ç†',
    strength: 'æ—¥ä¸»å¼·å¼±',
    usefulSpirit: 'å–œç”¨ç¥',
    elementCount: 'äº”è¡Œå€‹æ•¸',
    elementStrength: 'äº”è¡Œæ—ºè¡°',
    supportElements: 'å¹«æ‰¶äº”è¡Œ',
    restrainElements: 'å‰‹æ³„äº”è¡Œ',
    missingElements: 'äº”è¡Œæ‰€ç¼º',
    traits: 'æ„Ÿæƒ…ç‰¹è³ª',
    marriageAdvice: 'å©šå§»å»ºè­°',
    relationshipTips: 'ç›¸è™•ä¹‹é“',
    suitableCareers: 'é©åˆè¡Œæ¥­',
    careerAdvice: 'ç™¼å±•å»ºè­°',
    favorableDirections: 'æœ‰åˆ©æ–¹ä½',
    wealthCharacteristics: 'è²¡é‹ç‰¹é»',
    wealthDirections: 'æ±‚è²¡æ–¹å‘',
    financialAdvice: 'ç†è²¡å»ºè­°',
    healthCharacteristics: 'é«”è³ªç‰¹é»',
    healthTips: 'æ³¨æ„äº‹é …',
    wellnessAdvice: 'é¤Šç”Ÿå»ºè­°',
    overallFortune: 'æ•´é«”é‹å‹¢',
    favorableTiming: 'æœ‰åˆ©æ™‚æ©Ÿ',
    cautions: 'æ³¨æ„äº‹é …'
  }
},

// en English
'en': {
  brand: { subtitle: '5xLiving Â· Bazi Brief' },
  nav: { langLabel: 'Language' },
  lang: { 
    'zh-CN':'Simplified Chinese',
    'zh-TW':'Traditional Chinese', 
    'en':'English',
    'ja':'Japanese',
    'th':'Thai',
    'ms':'Malay'
  },
  app: { title: 'Bazi Destiny Â· Quick Chart' },
  form: {
    nameLabel: 'Name (optional)',
    namePlaceholder: 'Your name (for personalization)',
    genderLabel: 'Gender',
    gender: { hidden:'Prefer not to say', male:'Male', female:'Female' },
    calendarLabel: 'Calendar',
    calendar: { gregorian:'Solar', lunar:'Lunar' },
    birthdateLabel: 'Birth Date',
    birthtimeLabel: 'Birth Time',
    timeUnknown: 'Time unknown'
  },
  btn: { generate: 'Generate Bazi', loading: 'Calculating...' },
  result: { title: 'Your Bazi Destiny Chart' },
  pillar: { year:'Year', month:'Month', day:'Day', hour:'Hour' },
  table: { 
    row: { stem:'Heavenly Stem', branch:'Earthly Branch', fiveElem:'Elements', nayin:'Nayin' }
  },
  energy: { title: 'Five Elements Analysis' },
  elem: { wood: 'Wood', fire: 'Fire', earth: 'Earth', metal: 'Metal', water: 'Water' },
  pro: { 
    title: 'ğŸ§™â€â™‚ï¸ Butler Â· Professional Analysis', 
    welcome: 'Hello! I am your professional destiny advisor. I have generated a detailed analysis report for you. Feel free to ask me any specific questions.'
  },
  chat: { send: 'Send', placeholder: 'Type your question...', toggle: 'Ask' },
  vip: {
    title: 'ğŸŒ™ VIP Members Area',
    group: { astrology:'ğŸ— Exclusive Astrology', spiritual:'ğŸŒ™ Spiritual Space' },
    astrology: { 
      match:'Relationships: Love & Marriage', 
      career:'Career: Workplace & Entrepreneurship', 
      wealth:'Wealth: Analysis & Timing', 
      pet:'Pet Astrology: Personality & Bond'
    },
    spiritual: { 
      record:'Spiritual Records: Photos, Dreams, Voice, Prayers', 
      courses:'Courses: Bazi / Tarot / Astrology / Numerology', 
      family:'Family Memorial System', 
      practice:'Weekly Practices / Rituals'
    },
    login: { title: 'ğŸ’ VIP Login' },
    services: { header: 'Membership Services' },
    upgrade: 'ğŸ’ Upgrade to VIP (Monthly)',
    back: 'â† Back to Store',
    priceNote: '$9.9 / Month VIP (Astrology + Spiritual + Courses)'
  },
  auth: {
    header: 'Login / Register',
    login: 'Sign In',
    reset: 'ğŸ”‘ Reset Password',
    register: 'Register',
    freeTrialNote: 'Free trial for new accounts',
    emailPlaceholder: 'Email',
    passwordPlaceholder: 'Password (min 8 chars, mixed case & symbols)'
  },
  footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
  err: {
    fillBirthdate: 'Please enter birth date',
    invalidDate: 'Invalid date format, use YYYY-MM-DD',
    generateFail: 'Generation failed, please try again later'
  },
  ui: {
    unknown: 'Unknown',
    timeUnknown: 'Time unknown',
    hourSuffix: '{h}:00',
    birthSummary: 'Birth: {y}-{m}-{d} {timeText}',
    balance: '{strongest} strongest, {weakest} weakest among elements.'
  },
  badge: { noHour: 'Hour pillar excluded' },
  chatDyn: { autoReply: 'Received: {q}. Key points will be in relevant report sections.' },
  elemNames: { æœ¨:'Wood', ç«:'Fire', åœŸ:'Earth', é‡‘:'Metal', æ°´:'Water' },
  report: { 
    hourUnknownTip: 'âš ï¸ Note: Birth time unknown; analysis for reference only.',
    tipTitle: 'TIP',
    generating: 'Generating professional analysis...',
    failed: 'Report generation failed, please try again later'
  },
  reportTitles: {
    overview: 'ğŸ“Š Chart Overview',
    fiveElements: 'ğŸŒ¿ Elements Analysis',
    tenGods: 'âš¡ Ten Gods',
    relationship: 'ğŸ’• Relationship',
    career: 'ğŸ’¼ Career',
    wealth: 'ğŸ’° Wealth',
    health: 'ğŸŒ¡ï¸ Health',
    nearTerm: 'ğŸ”® Near Term'
  },
  reportLabels: {
    dayMaster: 'Day Master',
    strength: 'Strength',
    usefulSpirit: 'Useful Elements',
    elementCount: 'Elements Count',
    elementStrength: 'Elements Strength',
    supportElements: 'Supporting',
    restrainElements: 'Restraining', 
    missingElements: 'Missing Elements',
    traits: 'Relationship Traits',
    marriageAdvice: 'Marriage Advice',
    relationshipTips: 'Relationship Tips',
    suitableCareers: 'Suitable Careers',
    careerAdvice: 'Career Advice',
    favorableDirections: 'Favorable Directions',
    wealthCharacteristics: 'Wealth Traits',
    wealthDirections: 'Wealth Directions',
    financialAdvice: 'Financial Advice',
    healthCharacteristics: 'Health Traits',
    healthTips: 'Health Tips',
    wellnessAdvice: 'Wellness Advice',
    overallFortune: 'Overall Fortune',
    favorableTiming: 'Favorable Timing',
    cautions: 'Cautions'
  }
},

// ja æ—¥æœ¬èª
'ja': {
  brand: { subtitle: '5xLiving Â· å…«å­—ç°¡è©•' },
  nav: { langLabel: 'è¨€èª' },
  lang: { 
    'zh-CN':'ç°¡ä½“å­—',
    'zh-TW':'ç¹ä½“å­—', 
    'en':'è‹±èª',
    'ja':'æ—¥æœ¬èª',
    'th':'ã‚¿ã‚¤èª',
    'ms':'ãƒãƒ¬ãƒ¼èª'
  },
  app: { title: 'å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›¤' },
  form: {
    nameLabel: 'åå‰ï¼ˆä»»æ„ï¼‰',
    namePlaceholder: 'ã‚ãªãŸã®åå‰ï¼ˆå€‹äººç”¨ï¼‰',
    genderLabel: 'æ€§åˆ¥',
    gender: { hidden:'éå…¬é–‹', male:'ç”·æ€§', female:'å¥³æ€§' },
    calendarLabel: 'æš¦æ³•',
    calendar: { gregorian:'å¤ªé™½æš¦', lunar:'å¤ªé™°æš¦' },
    birthdateLabel: 'ç”Ÿå¹´æœˆæ—¥',
    birthtimeLabel: 'å‡ºç”Ÿæ™‚é–“',
    timeUnknown: 'å‡ºç”Ÿæ™‚é–“ä¸æ˜'
  },
  btn: { generate: 'å…«å­—ç”Ÿæˆ', loading: 'è¨ˆç®—ä¸­...' },
  result: { title: 'ã‚ãªãŸã®ç”Ÿè¾°å…«å­—å‘½ç›¤' },
  pillar: { year:'å¹´æŸ±', month:'æœˆæŸ±', day:'æ—¥æŸ±', hour:'æ™‚æŸ±' },
  table: { 
    row: { stem:'å¤©å¹²', branch:'åœ°æ”¯', fiveElem:'äº”è¡Œ', nayin:'ç´éŸ³' }
  },
  energy: { title: 'äº”è¡Œã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†æ' },
  elem: { wood: 'æœ¨', fire: 'ç«', earth: 'åœŸ', metal: 'é‡‘', water: 'æ°´' },
  pro: { 
    title: 'ğŸ§™â€â™‚ï¸ ç®¡å®¶ Â· å°‚é–€å‘½ç†åˆ†æ', 
    welcome: 'ã“ã‚“ã«ã¡ã¯ï¼å°‚é–€ã®å‘½ç†é¡§å•ã§ã™ã€‚è©³ç´°ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚å…·ä½“çš„ãªè³ªå•ãŒã‚ã‚Œã°ãŠèããã ã•ã„ã€‚'
  },
  chat: { send: 'é€ä¿¡', placeholder: 'è³ªå•ã‚’å…¥åŠ›...', toggle: 'è³ªå•' },
  vip: {
    title: 'ğŸŒ™ ä¼šå“¡ã‚¨ãƒªã‚¢ VIP',
    group: { astrology:'ğŸ— å‘½ç†ç©ºé–“', spiritual:'ğŸŒ™ ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«' },
    astrology: { 
      match:'æ‹æ„›ãƒ»çµå©šé‹', 
      career:'ã‚­ãƒ£ãƒªã‚¢ãƒ»èµ·æ¥­', 
      wealth:'è²¡é‹ãƒ»æŠ•è³‡', 
      pet:'ãƒšãƒƒãƒˆç›¸æ€§'
    },
    spiritual: { 
      record:'ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«è¨˜éŒ²', 
      courses:'è¬›åº§: å…«å­—/ã‚¿ãƒ­ãƒƒãƒˆ/å æ˜Ÿè¡“', 
      family:'å®¶æ—è¨˜å¿µã‚·ã‚¹ãƒ†ãƒ ', 
      practice:'é€±æ¬¡ç·´ç¿’ãƒ»å„€å¼'
    },
    login: { title: 'ğŸ’ VIPãƒ­ã‚°ã‚¤ãƒ³' },
    services: { header: 'ä¼šå“¡ã‚µãƒ¼ãƒ“ã‚¹' },
    upgrade: 'ğŸ’ VIPã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆæœˆé¡ï¼‰',
    back: 'â† ã‚·ãƒ§ãƒƒãƒ—ã«æˆ»ã‚‹',
    priceNote: '$9.9/æœˆ VIPï¼ˆå‘½ç†+ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«+è¬›åº§ï¼‰'
  },
  auth: {
    header: 'ãƒ­ã‚°ã‚¤ãƒ³ / ç™»éŒ²',
    login: 'ãƒ­ã‚°ã‚¤ãƒ³',
    reset: 'ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ',
    register: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²',
    freeTrialNote: 'æ–°è¦ç™»éŒ²ã§ç„¡æ–™ä½“é¨“',
    emailPlaceholder: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
    passwordPlaceholder: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰'
  },
  footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
  err: {
    fillBirthdate: 'ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›',
    invalidDate: 'ç„¡åŠ¹ãªæ—¥ä»˜å½¢å¼ YYYY-MM-DD',
    generateFail: 'ç”Ÿæˆå¤±æ•—ã€å¾Œã»ã©å†è©¦è¡Œ'
  },
  ui: {
    unknown: 'ä¸æ˜',
    timeUnknown: 'æ™‚é–“ä¸æ˜',
    hourSuffix: '{h}æ™‚',
    birthSummary: 'å‡ºç”Ÿ: {y}å¹´{m}æœˆ{d}æ—¥ {timeText}',
    balance: 'äº”è¡Œã§{strongest}ãŒæœ€å¼·ã€{weakest}ãŒæœ€å¼±'
  },
  badge: { noHour: 'æ™‚æŸ±ãªã—' },
  chatDyn: { autoReply: 'å—ä¿¡: {q}ã€‚é–¢é€£ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¦ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚' },
  elemNames: { æœ¨:'æœ¨', ç«:'ç«', åœŸ:'åœŸ', é‡‘:'é‡‘', æ°´:'æ°´' },
  report: { 
    hourUnknownTip: 'âš ï¸ æ³¨æ„: å‡ºç”Ÿæ™‚é–“ä¸æ˜ã€å‚è€ƒæƒ…å ±ã§ã™',
    tipTitle: 'ãƒ’ãƒ³ãƒˆ',
    generating: 'å°‚é–€åˆ†æç”Ÿæˆä¸­...',
    failed: 'å ±å‘Šç”Ÿæˆå¤±æ•—ã€å¾Œã»ã©å†è©¦è¡Œ'
  },
  reportTitles: {
    overview: 'ğŸ“Š å‘½ç›¤æ¦‚è¦',
    fiveElements: 'ğŸŒ¿ äº”è¡Œåˆ†æ',
    tenGods: 'âš¡ åç¥é…ç½®',
    relationship: 'ğŸ’• æ‹æ„›å©šå§»',
    career: 'ğŸ’¼ ã‚­ãƒ£ãƒªã‚¢',
    wealth: 'ğŸ’° è²¡é‹',
    health: 'ğŸŒ¡ï¸ å¥åº·',
    nearTerm: 'ğŸ”® è¿‘æœŸé‹å‹¢'
  },
  reportLabels: {
    dayMaster: 'æ—¥ä¸»',
    strength: 'å¼·å¼±',
    usefulSpirit: 'å–œç”¨ç¥',
    elementCount: 'äº”è¡Œæ•°',
    elementStrength: 'äº”è¡Œå¼·å¼±',
    supportElements: 'æ”¯æ´äº”è¡Œ',
    restrainElements: 'æŠ‘åˆ¶äº”è¡Œ',
    missingElements: 'ä¸è¶³äº”è¡Œ',
    traits: 'æ‹æ„›ç‰¹æ€§',
    marriageAdvice: 'çµå©šã‚¢ãƒ‰ãƒã‚¤ã‚¹',
    relationshipTips: 'é–¢ä¿‚ã®ã‚³ãƒ„',
    suitableCareers: 'é©è·',
    careerAdvice: 'ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒ‰ãƒã‚¤ã‚¹',
    favorableDirections: 'æœ‰åˆ©ãªæ–¹ä½',
    wealthCharacteristics: 'è²¡é‹ç‰¹æ€§',
    wealthDirections: 'æ±‚è²¡æ–¹ä½',
    financialAdvice: 'è²¡å‹™ã‚¢ãƒ‰ãƒã‚¤ã‚¹',
    healthCharacteristics: 'ä½“è³ªç‰¹æ€§',
    healthTips: 'æ³¨æ„ç‚¹',
    wellnessAdvice: 'å¥åº·ã‚¢ãƒ‰ãƒã‚¤ã‚¹',
    overallFortune: 'å…¨ä½“é‹å‹¢',
    favorableTiming: 'æœ‰åˆ©ãªæ™‚æœŸ',
    cautions: 'æ³¨æ„äº‹é …'
  }
},

// th à¹„à¸—à¸¢
'th': {
  brand: { subtitle: '5xLiving Â· å…«å­—ç°¡è©•' },
  nav: { langLabel: 'à¸ à¸²à¸©à¸²' },
  lang: { 
    'zh-CN':'à¸ˆà¸µà¸™à¸•à¸±à¸§à¸¢à¹ˆà¸­',
    'zh-TW':'à¸ˆà¸µà¸™à¸•à¸±à¸§à¹€à¸•à¹‡à¸¡',
    'en':'à¸­à¸±à¸‡à¸à¸¤à¸©',
    'ja':'à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',
    'th':'à¹„à¸—à¸¢', 
    'ms':'à¸¡à¸²à¹€à¸¥à¸¢à¹Œ'
  },
  app: { title: 'à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œå…«å­— Â· à¸ˆà¸±à¸”à¸—à¸³à¸”à¸§à¸‡' },
  form: {
    nameLabel: 'à¸Šà¸·à¹ˆà¸­ (à¹„à¸¡à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™)',
    namePlaceholder: 'à¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“ (à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§)',
    genderLabel: 'à¹€à¸à¸¨',
    gender: { hidden:'à¹„à¸¡à¹ˆà¹€à¸›à¸´à¸”à¹€à¸œà¸¢', male:'à¸Šà¸²à¸¢', female:'à¸«à¸à¸´à¸‡' },
    calendarLabel: 'à¸›à¸à¸´à¸—à¸´à¸™',
    calendar: { gregorian:'à¸ªà¸²à¸à¸¥', lunar:'à¸ˆà¸±à¸™à¸—à¸£à¸„à¸•à¸´' },
    birthdateLabel: 'à¸§à¸±à¸™à¹€à¸à¸´à¸”',
    birthtimeLabel: 'à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”',
    timeUnknown: 'à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”à¹„à¸¡à¹ˆà¹à¸™à¹ˆà¸Šà¸±à¸”'
  },
  btn: { generate: 'à¸ªà¸£à¹‰à¸²à¸‡å…«å­—', loading: 'à¸à¸³à¸¥à¸±à¸‡à¸„à¸³à¸™à¸§à¸“...' },
  result: { title: 'à¸”à¸§à¸‡à¸Šà¸°à¸•à¸²à¸à¸·à¹‰à¸™à¸à¸²à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“' },
  pillar: { year:'à¸›à¸µ', month:'à¹€à¸”à¸·à¸­à¸™', day:'à¸§à¸±à¸™', hour:'à¹€à¸§à¸¥à¸²' },
  table: { 
    row: { stem:'à¸ªà¸§à¸£à¸£à¸„à¹Œ', branch:'à¹‚à¸¥à¸', fiveElem:'à¸˜à¸²à¸•à¸¸', nayin:'à¸™à¹ˆà¸²à¸­à¸´à¹ˆà¸™' }
  },
  energy: { title: 'à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸˜à¸²à¸•à¸¸à¸—à¸±à¹‰à¸‡à¸«à¹‰à¸²' },
  elem: { wood: 'à¹„à¸¡à¹‰', fire: 'à¹„à¸Ÿ', earth: 'à¸”à¸´à¸™', metal: 'à¸—à¸­à¸‡', water: 'à¸™à¹‰à¸³' },
  pro: { 
    title: 'ğŸ§™â€â™‚ï¸ à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥ Â· à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸', 
    welcome: 'à¸ªà¸§à¸±à¸ªà¸”à¸µ! à¸‰à¸±à¸™à¹€à¸›à¹‡à¸™à¸—à¸µà¹ˆà¸›à¸£à¸¶à¸à¸©à¸²à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸à¸‚à¸­à¸‡à¸„à¸¸à¸“ à¹„à¸”à¹‰à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹‚à¸”à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹à¸¥à¹‰à¸§ à¸¡à¸µà¸„à¸³à¸–à¸²à¸¡à¸­à¸°à¹„à¸£à¸à¹‡à¸–à¸²à¸¡à¹„à¸”à¹‰'
  },
  chat: { send: 'à¸ªà¹ˆà¸‡', placeholder: 'à¸à¸´à¸¡à¸à¹Œà¸„à¸³à¸–à¸²à¸¡...', toggle: 'à¸–à¸²à¸¡' },
  vip: {
    title: 'ğŸŒ™ à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸¡à¸²à¸Šà¸´à¸ VIP',
    group: { astrology:'ğŸ— à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œ', spiritual:'ğŸŒ™ à¸ˆà¸´à¸•à¸§à¸´à¸à¸à¸²à¸“' },
    astrology: { 
      match:'à¸„à¸§à¸²à¸¡à¸£à¸±à¸ãƒ»à¸à¸²à¸£à¹à¸•à¹ˆà¸‡à¸‡à¸²à¸™', 
      career:'à¸­à¸²à¸Šà¸µà¸ãƒ»à¸˜à¸¸à¸£à¸à¸´à¸ˆ', 
      wealth:'à¹‚à¸Šà¸„à¸¥à¸²à¸ ãƒ»à¸à¸²à¸£à¹€à¸‡à¸´à¸™', 
      pet:'à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡'
    },
    spiritual: { 
      record:'à¸šà¸±à¸™à¸—à¸¶à¸à¸ˆà¸´à¸•à¸§à¸´à¸à¸à¸²à¸“', 
      courses:'à¸„à¸­à¸£à¹Œà¸ª: å…«å­—/à¸—à¸²à¹‚à¸£à¸•à¹Œ/à¸”à¸§à¸‡à¸”à¸²à¸§', 
      family:'à¸£à¸°à¸šà¸šà¸„à¸§à¸²à¸¡à¸—à¸£à¸‡à¸ˆà¸³à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§', 
      practice:'à¹à¸šà¸šà¸à¸¶à¸à¸«à¸±à¸”à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ'
    },
    login: { title: 'ğŸ’ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š VIP' },
    services: { header: 'à¸šà¸£à¸´à¸à¸²à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸' },
    upgrade: 'ğŸ’ à¸­à¸±à¸›à¹€à¸à¸£à¸”à¹€à¸›à¹‡à¸™ VIP (à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™)',
    back: 'â† à¸à¸¥à¸±à¸šà¸ªà¸¹à¹ˆà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²',
    priceNote: '$9.9/à¹€à¸”à¸·à¸­à¸™ VIP (à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œ+à¸ˆà¸´à¸•à¸§à¸´à¸à¸à¸²à¸“+à¸„à¸­à¸£à¹Œà¸ª)'
  },
  auth: {
    header: 'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š / à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™',
    login: 'à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š',
    reset: 'ğŸ”‘ à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™',
    register: 'à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™',
    freeTrialNote: 'à¸—à¸”à¸¥à¸­à¸‡à¸Ÿà¸£à¸µà¸ªà¸³à¸«à¸£à¸±à¸šà¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆ',
    emailPlaceholder: 'à¸­à¸µà¹€à¸¡à¸¥',
    passwordPlaceholder: 'à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ (8 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¸‚à¸¶à¹‰à¸™à¹„à¸›)'
  },
  footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
  err: {
    fillBirthdate: 'à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸§à¸±à¸™à¹€à¸à¸´à¸”',
    invalidDate: 'à¸£à¸¹à¸›à¹à¸šà¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ YYYY-MM-DD',
    generateFail: 'à¸ªà¸£à¹‰à¸²à¸‡à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ'
  },
  ui: {
    unknown: 'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š',
    timeUnknown: 'à¹€à¸§à¸¥à¸²à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š',
    hourSuffix: '{h}:00',
    birthSummary: 'à¹€à¸à¸´à¸”: {y}-{m}-{d} {timeText}',
    balance: '{strongest} à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡à¸—à¸µà¹ˆà¸ªà¸¸à¸” {weakest} à¸­à¹ˆà¸­à¸™à¹à¸­à¸—à¸µà¹ˆà¸ªà¸¸à¸”'
  },
  badge: { noHour: 'à¹„à¸¡à¹ˆà¸¡à¸µà¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡' },
  chatDyn: { autoReply: 'à¹„à¸”à¹‰à¸£à¸±à¸š: {q} à¸”à¸¹à¸ˆà¸¸à¸”à¸ªà¸³à¸„à¸±à¸à¹ƒà¸™à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡' },
  elemNames: { æœ¨:'à¹„à¸¡à¹‰', ç«:'à¹„à¸Ÿ', åœŸ:'à¸”à¸´à¸™', é‡‘:'à¸—à¸­à¸‡', æ°´:'à¸™à¹‰à¸³' },
  report: { 
    hourUnknownTip: 'âš ï¸ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹€à¸à¸·à¹ˆà¸­à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡',
    tipTitle: 'à¸„à¸³à¹à¸™à¸°à¸™à¸³',
    generating: 'à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ...',
    failed: 'à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ'
  },
  reportTitles: {
    overview: 'ğŸ“Š à¸ à¸²à¸à¸£à¸§à¸¡à¸”à¸§à¸‡',
    fiveElements: 'ğŸŒ¿ à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸˜à¸²à¸•à¸¸',
    tenGods: 'âš¡ à¹€à¸—à¸à¸ªà¸´à¸šà¸­à¸‡à¸„à¹Œ',
    relationship: 'ğŸ’• à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ',
    career: 'ğŸ’¼ à¸­à¸²à¸Šà¸µà¸',
    wealth: 'ğŸ’° à¹‚à¸Šà¸„à¸¥à¸²à¸ ',
    health: 'ğŸŒ¡ï¸ à¸ªà¸¸à¸‚à¸ à¸²à¸',
    nearTerm: 'ğŸ”® à¸”à¸§à¸‡à¸£à¸°à¸¢à¸°à¹ƒà¸à¸¥à¹‰'
  },
  reportLabels: {
    dayMaster: 'à¸”à¸²à¸§à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™',
    strength: 'à¸„à¸§à¸²à¸¡à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡',
    usefulSpirit: 'à¸˜à¸²à¸•à¸¸à¹€à¸ªà¸£à¸´à¸¡',
    elementCount: 'à¸ˆà¸³à¸™à¸§à¸™à¸˜à¸²à¸•à¸¸',
    elementStrength: 'à¸„à¸§à¸²à¸¡à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡à¸˜à¸²à¸•à¸¸',
    supportElements: 'à¸˜à¸²à¸•à¸¸à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™',
    restrainElements: 'à¸˜à¸²à¸•à¸¸à¸„à¸§à¸šà¸„à¸¸à¸¡',
    missingElements: 'à¸˜à¸²à¸•à¸¸à¸‚à¸²à¸”',
    traits: 'à¸¥à¸±à¸à¸©à¸“à¸°à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ',
    marriageAdvice: 'à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸à¸²à¸£à¹à¸•à¹ˆà¸‡à¸‡à¸²à¸™',
    relationshipTips: 'à¹€à¸„à¸¥à¹‡à¸”à¸¥à¸±à¸šà¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ',
    suitableCareers: 'à¸­à¸²à¸Šà¸µà¸à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°',
    careerAdvice: 'à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸­à¸²à¸Šà¸µà¸',
    favorableDirections: 'à¸—à¸´à¸¨à¸—à¸²à¸‡à¸”à¸µ',
    wealthCharacteristics: 'à¸¥à¸±à¸à¸©à¸“à¸°à¹‚à¸Šà¸„à¸¥à¸²à¸ ',
    wealthDirections: 'à¸—à¸´à¸¨à¸—à¸²à¸‡à¸«à¸²à¹€à¸‡à¸´à¸™',
    financialAdvice: 'à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸à¸²à¸£à¹€à¸‡à¸´à¸™',
    healthCharacteristics: 'à¸¥à¸±à¸à¸©à¸“à¸°à¸ªà¸¸à¸‚à¸ à¸²à¸',
    healthTips: 'à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡',
    wellnessAdvice: 'à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸ªà¸¸à¸‚à¸ à¸²à¸',
    overallFortune: 'à¸”à¸§à¸‡à¸£à¸§à¸¡',
    favorableTiming: 'à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸”à¸µ',
    cautions: 'à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡'
  }
},

// ms Bahasa Melayu
'ms': {
  brand: { subtitle: '5xLiving Â· Ringkas Bazi' },
  nav: { langLabel: 'Bahasa' },
  lang: { 
    'zh-CN':'Cina Ringkas',
    'zh-TW':'Cina Tradisional',
    'en':'Inggeris',
    'ja':'Jepun',
    'th':'Thai',
    'ms':'Melayu'
  },
  app: { title: 'Bazi Â· Carta Pantas' },
  form: {
    nameLabel: 'Nama (pilihan)',
    namePlaceholder: 'Nama anda (untuk peribadi)',
    genderLabel: 'Jantina',
    gender: { hidden:'Rahsia', male:'Lelaki', female:'Perempuan' },
    calendarLabel: 'Kalendar',
    calendar: { gregorian:'Masihi', lunar:'Qamari' },
    birthdateLabel: 'Tarikh Lahir',
    birthtimeLabel: 'Masa Lahir',
    timeUnknown: 'Masa tidak pasti'
  },
  btn: { generate: 'Jana Bazi', loading: 'Mengira...' },
  result: { title: 'Carta Bazi Anda' },
  pillar: { year:'Tahun', month:'Bulan', day:'Hari', hour:'Jam' },
  table: { 
    row: { stem:'Batang Langit', branch:'Cawangan Bumi', fiveElem:'Unsur', nayin:'Nayin' }
  },
  energy: { title: 'Analisis Lima Unsur' },
  elem: { wood: 'Kayu', fire: 'Api', earth: 'Tanah', metal: 'Logam', water: 'Air' },
  pro: { 
    title: 'ğŸ§™â€â™‚ï¸ Butler Â· Analisis Profesional', 
    welcome: 'Helo! Saya penasihat nasib profesional anda. Laporan terperinci telah dijana. Tanya soalan khusus.'
  },
  chat: { send: 'Hantar', placeholder: 'Taip soalan...', toggle: 'Tanya' },
  vip: {
    title: 'ğŸŒ™ Kawasan VIP',
    group: { astrology:'ğŸ— Astrologi', spiritual:'ğŸŒ™ Kerohanian' },
    astrology: { 
      match:'Hubungan & Perkahwinan', 
      career:'Kerjaya & Perniagaan', 
      wealth:'Kewangan & Pelaburan', 
      pet:'Astrologi Haiwan'
    },
    spiritual: { 
      record:'Rekod Kerohanian', 
      courses:'Kursus: Bazi/Tarot/Astrologi', 
      family:'Sistem Memorial Keluarga', 
      practice:'Amalan Mingguan'
    },
    login: { title: 'ğŸ’ Log Masuk VIP' },
    services: { header: 'Perkhidmatan Ahli' },
    upgrade: 'ğŸ’ Naik Taraf VIP (Bulanan)',
    back: 'â† Kembali ke Kedai',
    priceNote: '$9.9/Bulan VIP (Astrologi+Kerohanian+Kursus)'
  },
  auth: {
    header: 'Log Masuk / Daftar',
    login: 'Log Masuk',
    reset: 'ğŸ”‘ Reset Kata Laluan',
    register: 'Daftar',
    freeTrialNote: 'Percubaan percuma akaun baru',
    emailPlaceholder: 'Emel',
    passwordPlaceholder: 'Kata Laluan (min 8 aksara)'
  },
  footer: { copy: 'Â© 5XLiving â€¢ Astro Sanctuary' },
  err: {
    fillBirthdate: 'Sila isi tarikh lahir',
    invalidDate: 'Format tarikh tidak sah YYYY-MM-DD',
    generateFail: 'Jana gagal, cuba lagi'
  },
  ui: {
    unknown: 'Tidak diketahui',
    timeUnknown: 'Masa tidak diketahui',
    hourSuffix: '{h}:00',
    birthSummary: 'Lahir: {y}-{m}-{d} {timeText}',
    balance: '{strongest} paling kuat, {weakest} paling lemah'
  },
  badge: { noHour: 'Tiada jam' },
  chatDyn: { autoReply: 'Diterima: {q}. Lihat titik utama dalam bahagian berkaitan.' },
  elemNames: { æœ¨:'Kayu', ç«:'Api', åœŸ:'Tanah', é‡‘:'Logam', æ°´:'Air' },
  report: { 
    hourUnknownTip: 'âš ï¸ Nota: Masa lahir tidak diketahui, analisis untuk rujukan',
    tipTitle: 'TIP',
    generating: 'Menjana analisis profesional...',
    failed: 'Jana laporan gagal, cuba lagi'
  },
  reportTitles: {
    overview: 'ğŸ“Š Gambaran Keseluruhan',
    fiveElements: 'ğŸŒ¿ Analisis Unsur',
    tenGods: 'âš¡ Sepuluh Dewa',
    relationship: 'ğŸ’• Hubungan',
    career: 'ğŸ’¼ Kerjaya',
    wealth: 'ğŸ’° Kekayaan',
    health: 'ğŸŒ¡ï¸ Kesihatan',
    nearTerm: 'ğŸ”® Nasib Terdekat'
  },
  reportLabels: {
    dayMaster: 'Tuan Hari',
    strength: 'Kekuatan',
    usefulSpirit: 'Unsur Berguna',
    elementCount: 'Bilangan Unsur',
    elementStrength: 'Kekuatan Unsur',
    supportElements: 'Unsur Menyokong',
    restrainElements: 'Unsur Menahan',
    missingElements: 'Unsur Tiada',
    traits: 'Ciri Hubungan',
    marriageAdvice: 'Nasihat Perkahwinan',
    relationshipTips: 'Tip Hubungan',
    suitableCareers: 'Kerjaya Sesuai',
    careerAdvice: 'Nasihat Kerjaya',
    favorableDirections: 'Arah Menguntungkan',
    wealthCharacteristics: 'Ciri Kekayaan',
    wealthDirections: 'Arah Kekayaan',
    financialAdvice: 'Nasihat Kewangan',
    healthCharacteristics: 'Ciri Kesihatan',
    healthTips: 'Tip Kesihatan',
    wellnessAdvice: 'Nasihat Kesihatan',
    overallFortune: 'Nasib Keseluruhan',
    favorableTiming: 'Masa Menguntungkan',
    cautions: 'Langkah Berjaga-jaga'
  }
}  // â† ms è¯­è¨€ç»“æŸ
}; // â† æ•´ä¸ª I18N å¯¹è±¡ç»“æŸ

  // å·¥å…·å‡½æ•°
  const $ = id => document.getElementById(id);
  const state = { 
    lang: localStorage.getItem('5x_lang') || 'zh-CN'
  };

  function get(obj, path) {
    return path.split('.').reduce((o, k) => (o && o[k] != null) ? o[k] : undefined, obj);
  }

  function t(key) {
    const dict = I18N[state.lang] || I18N['zh-CN'];
    const val = get(dict, key);
    return (typeof val === 'string') ? val : key;
  }

  function applyI18n() {
    const dict = I18N[state.lang] || I18N['zh-CN'];
    document.documentElement.lang = state.lang;

    // ç¿»è¯‘æ‰€æœ‰ data-i18n å…ƒç´ 
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      const val = get(dict, key);
      if (typeof val === 'string' && val) el.textContent = val;
    });

    // ç¿»è¯‘é€‰é¡¹
    document.querySelectorAll('option[data-i18n]').forEach(opt => {
      const key = opt.getAttribute('data-i18n');
      const val = get(dict, key);
      if (typeof val === 'string' && val) opt.textContent = val;
    });

    // è®¾ç½®placeholder
    const ph = {
      name: get(dict, 'form.namePlaceholder'),
      email: get(dict, 'auth.emailPlaceholder'),
      password: get(dict, 'auth.passwordPlaceholder'),
      chat: get(dict, 'chat.placeholder')
    };
    if ($('name') && ph.name) $('name').placeholder = ph.name;
    if ($('email') && ph.email) $('email').placeholder = ph.email;
    if ($('password') && ph.password) $('password').placeholder = ph.password;
    if ($('chatInput') && ph.chat) $('chatInput').placeholder = ph.chat;

    // æ›´æ–°è¯­è¨€é€‰æ‹©å™¨
    const langSelect = $('langSelect');
    if (langSelect) langSelect.value = state.lang;
  }

  function showErr(msg) {
    const box = $('error');
    if (!box) return;
    box.textContent = msg || t('err.generateFail');
    box.style.display = 'block';
    setTimeout(() => { box.style.display = 'none'; }, 4000);
  }

  function setGenLoading(v) {
    const btn = $('genBtn'), txt = $('genBtnText'), ld = $('genBtnLoading');
    if (!btn) return;
    btn.disabled = !!v;
    if (txt) txt.style.display = v ? 'none' : 'inline';
    if (ld) ld.style.display = v ? 'inline' : 'none';
  }

  // å…«å­—è®¡ç®—å™¨
  class BaziCalculator {
    constructor() {
      this.HEAVENLY_STEMS = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
      this.EARTHLY_BRANCHES = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
      this.NAYIN = ['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
    }

    calculateYearPillar(year) {
      const s = (year - 4) % 10;
      const b = (year - 4) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(s + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(b + 12) % 12] 
      };
    }

    solarMonthIndex(y, m, d) {
      const mmdd = m * 100 + d;
      const gates = [[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]];
      let idx = 11; 
      for (const [thr, val] of gates) { 
        if (mmdd >= thr) idx = val; 
      }
      const branchBy = {1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'};
      return { index: idx, branch: branchBy[idx] };
    }

    calculateMonthPillar(year, month, day) {
      const { index, branch } = this.solarMonthIndex(year, month, day);
      const yStemIdx = this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem);
      const startMap = {0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0};
      const stemIdx = (startMap[yStemIdx] + (index - 1)) % 10;
      return { stem: this.HEAVENLY_STEMS[stemIdx], branch };
    }

    calculateDayPillar(year, month, day) {
      const baseUTC = Date.UTC(1900, 0, 31);
      const targetUTC = Date.UTC(year, month - 1, day);
      const dayDiff = Math.floor((targetUTC - baseUTC) / 86400000);
      const stemIdx = (0 + dayDiff) % 10;
      const branchIdx = (4 + dayDiff) % 12;
      return { 
        stem: this.HEAVENLY_STEMS[(stemIdx + 10) % 10], 
        branch: this.EARTHLY_BRANCHES[(branchIdx + 12) % 12] 
      };
    }

    calculateHourPillar(dayStem, hour) {
      const branchMap = {
        23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',
        7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',
        15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'
      };
      const startMap = {0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8};
      const dayIdx = this.HEAVENLY_STEMS.indexOf(dayStem);
      const hourIndex = Math.floor((hour + 1) / 2) % 12;
      const stemIdx = (startMap[dayIdx] + hourIndex) % 10;
      return { 
        stem: this.HEAVENLY_STEMS[stemIdx], 
        branch: branchMap[hour] 
      };
    }

    getStemElement(stem) {
      const map = {ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'};
      return map[stem] || '-';
    }

    getBranchElement(branch) {
      const map = {å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'};
      return map[branch] || '-';
    }

    getNayin(stem, branch) {
      const si = this.HEAVENLY_STEMS.indexOf(stem);
      const bi = this.EARTHLY_BRANCHES.indexOf(branch);
      return this.NAYIN[(si * 2 + bi) % this.NAYIN.length];
    }

    // è®¡ç®—åç¥
    calculateTenGods(dayStem, stems) {
      const tenGodsMap = {
        'ç”²': { 'ç”²':'æ¯”è‚©', 'ä¹™':'åŠ«è´¢', 'ä¸™':'é£Ÿç¥', 'ä¸':'ä¼¤å®˜', 'æˆŠ':'åè´¢', 'å·±':'æ­£è´¢', 'åºš':'ä¸ƒæ€', 'è¾›':'æ­£å®˜', 'å£¬':'åå°', 'ç™¸':'æ­£å°' },
        'ä¹™': { 'ç”²':'åŠ«è´¢', 'ä¹™':'æ¯”è‚©', 'ä¸™':'ä¼¤å®˜', 'ä¸':'é£Ÿç¥', 'æˆŠ':'æ­£è´¢', 'å·±':'åè´¢', 'åºš':'æ­£å®˜', 'è¾›':'ä¸ƒæ€', 'å£¬':'æ­£å°', 'ç™¸':'åå°' },
        'ä¸™': { 'ç”²':'åå°', 'ä¹™':'æ­£å°', 'ä¸™':'æ¯”è‚©', 'ä¸':'åŠ«è´¢', 'æˆŠ':'é£Ÿç¥', 'å·±':'ä¼¤å®˜', 'åºš':'åè´¢', 'è¾›':'æ­£è´¢', 'å£¬':'ä¸ƒæ€', 'ç™¸':'æ­£å®˜' },
        'ä¸': { 'ç”²':'æ­£å°', 'ä¹™':'åå°', 'ä¸™':'åŠ«è´¢', 'ä¸':'æ¯”è‚©', 'æˆŠ':'ä¼¤å®˜', 'å·±':'é£Ÿç¥', 'åºš':'æ­£è´¢', 'è¾›':'åè´¢', 'å£¬':'æ­£å®˜', 'ç™¸':'ä¸ƒæ€' },
        'æˆŠ': { 'ç”²':'ä¸ƒæ€', 'ä¹™':'æ­£å®˜', 'ä¸™':'åå°', 'ä¸':'æ­£å°', 'æˆŠ':'æ¯”è‚©', 'å·±':'åŠ«è´¢', 'åºš':'é£Ÿç¥', 'è¾›':'ä¼¤å®˜', 'å£¬':'åè´¢', 'ç™¸':'æ­£è´¢' },
        'å·±': { 'ç”²':'æ­£å®˜', 'ä¹™':'ä¸ƒæ€', 'ä¸™':'æ­£å°', 'ä¸':'åå°', 'æˆŠ':'åŠ«è´¢', 'å·±':'æ¯”è‚©', 'åºš':'ä¼¤å®˜', 'è¾›':'é£Ÿç¥', 'å£¬':'æ­£è´¢', 'ç™¸':'åè´¢' },
        'åºš': { 'ç”²':'åè´¢', 'ä¹™':'æ­£è´¢', 'ä¸™':'ä¸ƒæ€', 'ä¸':'æ­£å®˜', 'æˆŠ':'åå°', 'å·±':'æ­£å°', 'åºš':'æ¯”è‚©', 'è¾›':'åŠ«è´¢', 'å£¬':'é£Ÿç¥', 'ç™¸':'ä¼¤å®˜' },
        'è¾›': { 'ç”²':'æ­£è´¢', 'ä¹™':'åè´¢', 'ä¸™':'æ­£å®˜', 'ä¸':'ä¸ƒæ€', 'æˆŠ':'æ­£å°', 'å·±':'åå°', 'åºš':'åŠ«è´¢', 'è¾›':'æ¯”è‚©', 'å£¬':'ä¼¤å®˜', 'ç™¸':'é£Ÿç¥' },
        'å£¬': { 'ç”²':'é£Ÿç¥', 'ä¹™':'ä¼¤å®˜', 'ä¸™':'åè´¢', 'ä¸':'æ­£è´¢', 'æˆŠ':'ä¸ƒæ€', 'å·±':'æ­£å®˜', 'åºš':'åå°', 'è¾›':'æ­£å°', 'å£¬':'æ¯”è‚©', 'ç™¸':'åŠ«è´¢' },
        'ç™¸': { 'ç”²':'ä¼¤å®˜', 'ä¹™':'é£Ÿç¥', 'ä¸™':'æ­£è´¢', 'ä¸':'åè´¢', 'æˆŠ':'æ­£å®˜', 'å·±':'ä¸ƒæ€', 'åºš':'æ­£å°', 'è¾›':'åå°', 'å£¬':'åŠ«è´¢', 'ç™¸':'æ¯”è‚©' }
      };
      
      const map = tenGodsMap[dayStem];
      if (!map) return stems.map(() => '-');
      
      return stems.map(stem => map[stem] || '-');
    }
  }

  // æ¸²æŸ“å‡½æ•°
  function renderPillars(labels) {
    const titles = [t('pillar.year'), t('pillar.month'), t('pillar.day'), t('pillar.hour')];
    const html = labels.map((label, i) => `
      <div class="pillar">
        <div class="tit">${titles[i]}</div>
        <div class="gz">${label || '-'}</div>
      </div>
    `).join('');
    const box = $('bazi-pillars');
    if (box) box.innerHTML = html;
  }

  function renderTable(data) {
    const KEYS = ['year','month','day','hour'];
    const rows = ['stem','branch','element','nayin'];
    const rowLabels = [
      t('table.row.stem'),
      t('table.row.branch'), 
      t('table.row.fiveElem'),
      t('table.row.nayin')
    ];
    
    KEYS.forEach((k, i) => {
      rows.forEach((row, j) => {
        const cell = $(`${k}-${row}`);
        if (cell) {
          cell.textContent = (data[row] && data[row][i]) ? data[row][i] : '-';
        }
      });
    });
  }

  function renderBars(pcts) {
    const elems = ['æœ¨','ç«','åœŸ','é‡‘','æ°´'];
    const elemNames = {
      'æœ¨': t('elem.wood'),
      'ç«': t('elem.fire'),
      'åœŸ': t('elem.earth'),
      'é‡‘': t('elem.metal'), 
      'æ°´': t('elem.water')
    };
    
    elems.forEach(e => {
      const pct = Math.max(0, Math.min(100, Math.round(pcts[e] || 0)));
      const bar = $(`bar-${e}`);
      const lab = $(`pct-${e}`);
      const label = $(`elem-${e}`);
      if (bar) bar.style.width = pct + '%';
      if (lab) lab.textContent = pct + '%';
      if (label) label.textContent = elemNames[e];
    });
  }

  function showResultContainers() {
    const result = $('result');
    const butler = $('butlerProfessional');
    if (result) result.style.display = 'block';
    if (butler) butler.style.display = 'block';
  }

  // ä¸“ä¸šæŠ¥å‘Šç”Ÿæˆå™¨ - å¤šè¯­è¨€ç‰ˆæœ¬
function generateProfessionalReport(baziData) {
  const calc = new BaziCalculator();
  const dayStem = baziData.stem[2];
  const tenGods = calc.calculateTenGods(dayStem, baziData.stem);
  
  // è®¡ç®—äº”è¡Œä¸ªæ•°
  const elementCounts = { 'é‡‘': 0, 'æœ¨': 0, 'æ°´': 0, 'ç«': 0, 'åœŸ': 0 };
  baziData.stem.forEach(stem => {
    const element = calc.getStemElement(stem);
    if (element !== '-') elementCounts[element]++;
  });
  baziData.branch.forEach(branch => {
    const element = calc.getBranchElement(branch);
    if (element !== '-') elementCounts[element]++;
  });

  // ç›´æ¥ä½¿ç”¨çœŸå®æ•°æ®ï¼Œä¸ä½¿ç”¨å˜é‡å
  const dayMasterAnalysis = getDayMasterAnalysis(dayStem);
  const relationshipTraits = getRelationshipTraits(dayStem);
  const marriageAdvice = getMarriageAdvice(tenGods);
  const suitableCareers = getSuitableCareers(dayStem);
  const careerAdvice = getCareerAdvice(tenGods);
  const favorableDirections = getFavorableDirections(dayStem);
  const wealthAnalysis = getWealthAnalysis(tenGods);
  const healthAnalysis = getHealthAnalysis(dayStem);
  const healthTips = getHealthTips(dayStem);

  return `
    <div class="butler-section">
      <h4>${t('reportTitles.overview')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.dayMaster')}ï¼š</strong>${dayMasterAnalysis}</p>
        <p><strong>${t('reportLabels.elementCount')}ï¼š</strong>${elementCounts['é‡‘']}${t('elem.metal')}ï¼Œ${elementCounts['æœ¨']}${t('elem.wood')}ï¼Œ${elementCounts['æ°´']}${t('elem.water')}ï¼Œ${elementCounts['ç«']}${t('elem.fire')}ï¼Œ${elementCounts['åœŸ']}${t('elem.earth')}</p>
        <p><strong>${t('reportLabels.elementStrength')}ï¼š</strong>${Object.entries(baziData.elementsPct).sort((a,b) => b[1]-a[1]).map(([k,v]) => {
          const elemNames = { 'æœ¨': t('elem.wood'), 'ç«': t('elem.fire'), 'åœŸ': t('elem.earth'), 'é‡‘': t('elem.metal'), 'æ°´': t('elem.water') };
          return `${elemNames[k]}${Math.round(v)}%`;
        }).join('ï¼Œ')}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.tenGods')}</h4>
      <div class="detail-content">
        <p><strong>${baziData.stem[0]}${baziData.branch[0]}ï¼š</strong>${tenGods[0]} - ${getTenGodsDescription(tenGods[0])}</p>
        <p><strong>${baziData.stem[1]}${baziData.branch[1]}ï¼š</strong>${tenGods[1]} - ${getTenGodsDescription(tenGods[1])}</p>
        <p><strong>${baziData.stem[2]}${baziData.branch[2]}ï¼š</strong>${tenGods[2]} - ${getTenGodsDescription(tenGods[2])}</p>
        <p><strong>${baziData.stem[3]}${baziData.branch[3]}ï¼š</strong>${tenGods[3]} - ${getTenGodsDescription(tenGods[3])}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.relationship')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.traits')}ï¼š</strong>${relationshipTraits}</p>
        <p><strong>${t('reportLabels.marriageAdvice')}ï¼š</strong>${marriageAdvice}</p>
        <p><strong>${t('reportLabels.relationshipTips')}ï¼š</strong>${getRelationshipTips(dayStem)}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.career')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.suitableCareers')}ï¼š</strong>${suitableCareers}</p>
        <p><strong>${t('reportLabels.careerAdvice')}ï¼š</strong>${careerAdvice}</p>
        <p><strong>${t('reportLabels.favorableDirections')}ï¼š</strong>${favorableDirections}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.wealth')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.wealthCharacteristics')}ï¼š</strong>${wealthAnalysis}</p>
        <p><strong>${t('reportLabels.wealthDirections')}ï¼š</strong>${favorableDirections}</p>
        <p><strong>${t('reportLabels.financialAdvice')}ï¼š</strong>${getFinancialAdvice(tenGods)}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.health')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.healthCharacteristics')}ï¼š</strong>${healthAnalysis}</p>
        <p><strong>${t('reportLabels.healthTips')}ï¼š</strong>${healthTips}</p>
        <p><strong>${t('reportLabels.wellnessAdvice')}ï¼š</strong>${getWellnessAdvice(dayStem)}</p>
      </div>
    </div>

    <div class="butler-section">
      <h4>${t('reportTitles.nearTerm')}</h4>
      <div class="detail-content">
        <p><strong>${t('reportLabels.overallFortune')}ï¼š</strong>${getOverallFortune(tenGods)}</p>
        <p><strong>${t('reportLabels.favorableTiming')}ï¼š</strong>${getFavorableTiming(dayStem)}</p>
        <p><strong>${t('reportLabels.cautions')}ï¼š</strong>${getCautions(tenGods)}</p>
      </div>
    </div>
  `;
}

// æ–°å¢è¾…åŠ©å‡½æ•°
function getTenGodsDescription(tenGod) {
  const descriptions = {
    'æ¯”è‚©': 'è¡¨ç¤ºå…„å¼Ÿå§å¦¹ã€æœ‹å‹åŒäº‹ï¼Œä¸»åˆä½œä¸ç«äº‰',
    'åŠ«è´¢': 'è¡¨ç¤ºå¼‚æ€§æœ‹å‹ã€ç«äº‰å¯¹æ‰‹ï¼Œä¸»ç ´è´¢ä¸æœºé‡',
    'é£Ÿç¥': 'è¡¨ç¤ºå­å¥³ã€é£Ÿç¦„ï¼Œä¸»æ‰åä¸äº«å—',
    'ä¼¤å®˜': 'è¡¨ç¤ºæ‰åã€è‰ºæœ¯ï¼Œä¸»åˆ›æ„ä¸æŒ‘æˆ˜',
    'åè´¢': 'è¡¨ç¤ºçˆ¶äº²ã€æ„å¤–ä¹‹è´¢ï¼Œä¸»æ¨ªè´¢ä¸é£é™©',
    'æ­£è´¢': 'è¡¨ç¤ºå¦»å­ã€ç¨³å®šæ”¶å…¥ï¼Œä¸»æ­£è´¢ä¸ç¨³å®š',
    'ä¸ƒæ€': 'è¡¨ç¤ºå‹åŠ›ã€æƒå¨ï¼Œä¸»æŒ‘æˆ˜ä¸æƒåŠ›',
    'æ­£å®˜': 'è¡¨ç¤ºä¸ˆå¤«ã€å®˜èŒï¼Œä¸»äº‹ä¸šä¸è´£ä»»',
    'åå°': 'è¡¨ç¤ºç»§æ¯ã€ç‰¹æ®Šæ‰èƒ½ï¼Œä¸»æ™ºæ…§ä¸ç¥ç§˜',
    'æ­£å°': 'è¡¨ç¤ºæ¯äº²ã€å­¦è¯†ï¼Œä¸»å­¦ä¹ ä¸ä¿æŠ¤'
  };
  return descriptions[tenGod] || 'è¡¨ç¤ºç‰¹å®šçš„äººé™…å…³ç³»å’Œè¿åŠ¿ç‰¹å¾';
}

    return `
      <div class="butler-section">
        <h4>${t('reportTitles.overview')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.dayMaster')}ï¼š</strong>${getDayMasterAnalysis(dayStem)}</p>
          <p><strong>${t('reportLabels.elementCount')}ï¼š</strong>${elementCounts['é‡‘']}${t('elem.metal')}ï¼Œ${elementCounts['æœ¨']}${t('elem.wood')}ï¼Œ${elementCounts['æ°´']}${t('elem.water')}ï¼Œ${elementCounts['ç«']}${t('elem.fire')}ï¼Œ${elementCounts['åœŸ']}${t('elem.earth')}</p>
          <p><strong>${t('reportLabels.elementStrength')}ï¼š</strong>${Object.entries(baziData.elementsPct).sort((a,b) => b[1]-a[1]).map(([k,v]) => {
            const elemNames = { 'æœ¨': t('elem.wood'), 'ç«': t('elem.fire'), 'åœŸ': t('elem.earth'), 'é‡‘': t('elem.metal'), 'æ°´': t('elem.water') };
            return `${elemNames[k]}${Math.round(v)}%`;
          }).join('ï¼Œ')}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.tenGods')}</h4>
        <div class="detail-content">
          <p><strong>${baziData.stem[0]}${baziData.branch[0]}ï¼š</strong>${tenGods[0]} - ${tenGodsDesc[tenGods[0]] || ''}</p>
          <p><strong>${baziData.stem[1]}${baziData.branch[1]}ï¼š</strong>${tenGods[1]} - ${tenGodsDesc[tenGods[1]] || ''}</p>
          <p><strong>${baziData.stem[2]}${baziData.branch[2]}ï¼š</strong>${tenGods[2]} - ${tenGodsDesc[tenGods[2]] || ''}</p>
          <p><strong>${baziData.stem[3]}${baziData.branch[3]}ï¼š</strong>${tenGods[3]} - ${tenGodsDesc[tenGods[3]] || ''}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.relationship')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.traits')}ï¼š</strong>${getRelationshipTraits(dayStem)}</p>
          <p><strong>${t('reportLabels.marriageAdvice')}ï¼š</strong>${getMarriageAdvice(tenGods)}</p>
          <p><strong>${t('reportLabels.relationshipTips')}ï¼š</strong>${t('report.relationship.tips') || 'å­¦ä¼šæ²Ÿé€šç†è§£ï¼Œäº’ç›¸åŒ…å®¹æ”¯æŒ'}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.career')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.suitableCareers')}ï¼š</strong>${getSuitableCareers(dayStem)}</p>
          <p><strong>${t('reportLabels.careerAdvice')}ï¼š</strong>${getCareerAdvice(tenGods)}</p>
          <p><strong>${t('reportLabels.favorableDirections')}ï¼š</strong>${getFavorableDirections(dayStem)}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.wealth')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.wealthCharacteristics')}ï¼š</strong>${getWealthAnalysis(tenGods)}</p>
          <p><strong>${t('reportLabels.wealthDirections')}ï¼š</strong>${getWealthDirections(dayStem)}</p>
          <p><strong>${t('reportLabels.financialAdvice')}ï¼š</strong>${t('report.wealth.advice') || 'ç¨³æ‰ç¨³æ‰“ï¼Œåˆç†è§„åˆ’'}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.health')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.healthCharacteristics')}ï¼š</strong>${getHealthAnalysis(dayStem)}</p>
          <p><strong>${t('reportLabels.healthTips')}ï¼š</strong>${getHealthTips(dayStem)}</p>
          <p><strong>${t('reportLabels.wellnessAdvice')}ï¼š</strong>${t('report.health.advice') || 'è§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨'}</p>
        </div>
      </div>

      <div class="butler-section">
        <h4>${t('reportTitles.nearTerm')}</h4>
        <div class="detail-content">
          <p><strong>${t('reportLabels.overallFortune')}ï¼š</strong>${t('report.fortune.overall') || 'ç¨³ä¸­æ±‚è¿›ï¼Œé€‚åˆå­¦ä¹ æå‡'}</p>
          <p><strong>${t('reportLabels.favorableTiming')}ï¼š</strong>${t('report.fortune.timing') || 'æœªæ¥3-6ä¸ªæœˆæ˜¯å…³é”®å‘å±•æœŸ'}</p>
          <p><strong>${t('reportLabels.cautions')}ï¼š</strong>${t('report.fortune.cautions') || 'é¿å…å†²åŠ¨å†³ç­–ï¼Œæ³¨æ„äººé™…å…³ç³»'}</p>
        </div>
      </div>
    `;
  }
 
// è¾…åŠ©å‡½æ•° - æ•´åˆç‰ˆæœ¬
const BaziAnalysis = {
  // æ—¥ä¸»åˆ†æ
  getDayMasterAnalysis(dayStem) {
    const analysis = {
      'ç”²': t('report.dayMaster.jia') || 'ç”²æœ¨å‘½ï¼šæœ‰ç§¯ææ€§çš„å¼€æ‹“ç²¾ç¥ï¼Œç²¾åŠ›æ—ºç››',
      'ä¹™': t('report.dayMaster.yi') || 'ä¹™æœ¨å‘½ï¼šæ€§æ ¼æŸ”é¡ºï¼Œå–œè¡Œå–„äº‹ï¼Œæœ‰åŒæƒ…å¿ƒ',
      'ä¸™': t('report.dayMaster.bing') || 'ä¸™ç«å‘½ï¼šçƒ­æƒ…è±ªçˆ½ï¼Œè‡ªä¿¡å¥½èƒœï¼Œå–„è¨€å¥è°ˆ',
      'ä¸': t('report.dayMaster.ding') || 'ä¸ç«å‘½ï¼šæ•¦åšæœ´å®ï¼Œé‡ä¿¡å®ˆä¹‰',
      'æˆŠ': t('report.dayMaster.wu') || 'æˆŠåœŸå‘½ï¼šæœ‰ç§¯ææ€§ï¼Œå¹²ä¸€è¡Œæ˜“äºå¯¹äº‹ç‰©çƒ­è¡·',
      'å·±': t('report.dayMaster.ji') || 'å·±åœŸå‘½ï¼šå’Œç¼“ï¼Œè°¨æ…ï¼Œå¿ƒçµæ‰‹å·§',
      'åºš': t('report.dayMaster.geng') || 'åºšé‡‘å‘½ï¼šç§¯æè¿›å–ï¼Œå‹‡æ•¢æœå†³',
      'è¾›': t('report.dayMaster.xin') || 'è¾›é‡‘å‘½ï¼šæ²‰ç€å¦ç›´æ— ç§ï¼Œå¾…äººæ¥ç‰©è®¤çœŸ',
      'å£¬': t('report.dayMaster.ren') || 'å£¬æ°´å‘½ï¼šå¿ƒèƒ¸å®½å¹¿ï¼Œæœºæ™ºçµæ•',
      'ç™¸': t('report.dayMaster.gui') || 'ç™¸æ°´å‘½ï¼šé€å¼ºé¡½å›ºï¼Œæ˜¯åŠªåŠ›å®¶'
    };
    return analysis[dayStem] || t('report.dayMaster.default') || 'ä¸ªæ€§ç‹¬ç‰¹ï¼Œé€‚åº”åŠ›å¼º';
  },

  // æ„Ÿæƒ…å…³ç³»åˆ†æ
  getRelationshipAnalysis(dayStem) {
    const analysis = {
      'ç”²': {
        traits: 'æ„Ÿæƒ…è¾ƒä¸ºä¸»åŠ¨ï¼Œå–œæ¬¢æŒæ¡ä¸»å¯¼æƒï¼Œä½†è¦æ³¨æ„ç»™å¯¹æ–¹ç©ºé—´',
        tips: 'å­¦ä¼šå€¾å¬å¯¹æ–¹æ„è§ï¼Œä¿æŒæ²Ÿé€šå¹³è¡¡'
      },
      'ä¹™': {
        traits: 'æ„Ÿæƒ…ç»†è…»æ¸©æŸ”ï¼Œéœ€è¦ç¨³å®šçš„æƒ…æ„Ÿæ”¯æŒï¼Œä½†ä¸è¦è¿‡åº¦ä¾èµ–å¯¹æ–¹',
        tips: 'å»ºç«‹è‡ªä¿¡ï¼Œæ˜ç¡®è¡¨è¾¾è‡ªå·±çš„éœ€æ±‚'
      },
      'ä¸™': {
        traits: 'æ„Ÿæƒ…çƒ­æƒ…å¥”æ”¾ï¼Œä½†å®¹æ˜“å†²åŠ¨ï¼Œè¦æ§åˆ¶æƒ…ç»ªæ³¢åŠ¨',
        tips: 'æ§åˆ¶æƒ…ç»ªæ³¢åŠ¨ï¼Œé¿å…å†²åŠ¨è¨€è¡Œ'
      },
      'ä¸': {
        traits: 'æ„Ÿæƒ…ä¸“ä¸€æ‰§ç€ï¼Œä½†å®¹æ˜“çŒœç–‘ï¼Œè¦é¿å…è¿‡åº¦çŒœç–‘',
        tips: 'ä¿¡ä»»ä¼´ä¾£ï¼Œå‡å°‘ä¸å¿…è¦çš„çŒœç–‘'
      },
      'æˆŠ': {
        traits: 'æ„Ÿæƒ…ç¨³é‡åŠ¡å®ï¼Œé‡è§†å®¶åº­ç¨³å®šï¼Œä½†è¦å­¦ä¼šè¡¨è¾¾æƒ…æ„Ÿ',
        tips: 'å­¦ä¼šæµªæ¼«è¡¨è¾¾ï¼Œå¢åŠ æƒ…æ„Ÿäº¤æµ'
      },
      'å·±': {
        traits: 'æ„Ÿæƒ…ç»†è…»ä½“è´´ï¼Œä½†å®¹æ˜“ç¼ºä¹å®‰å…¨æ„Ÿï¼Œè¦å»ºç«‹è‡ªä¿¡å¿ƒ',
        tips: 'åŸ¹å…»å®‰å…¨æ„Ÿï¼Œä¸è¦è¿‡åº¦ä¾èµ–'
      },
      'åºš': {
        traits: 'æ„Ÿæƒ…æœæ–­ç›´æ¥ï¼Œä¸å–œæ¬¢æ‹–æ³¥å¸¦æ°´ï¼Œä½†è¦è€ƒè™‘å¯¹æ–¹æ„Ÿå—',
        tips: 'è€ƒè™‘å¯¹æ–¹æ„Ÿå—ï¼Œé€‚å½“æ”¾æ…¢èŠ‚å¥'
      },
      'è¾›': {
        traits: 'æ„Ÿæƒ…è¿½æ±‚å®Œç¾ï¼Œå¯¹ä¼´ä¾£è¦æ±‚è¾ƒé«˜ï¼Œä½†è¦æ¥å—å¯¹æ–¹ç¼ºç‚¹',
        tips: 'æ¥å—ä¸å®Œç¾ï¼Œé™ä½å¯¹ä¼´ä¾£çš„è¦æ±‚'
      },
      'å£¬': {
        traits: 'æ„Ÿæƒ…ä¸°å¯Œå¤šå˜ï¼Œéœ€è¦æ–°é²œæ„Ÿï¼Œä½†è¦ä¿æŒæ„Ÿæƒ…ç¨³å®š',
        tips: 'ä¿æŒæ„Ÿæƒ…ç¨³å®šï¼ŒåŸ¹å…»å…±åŒå…´è¶£'
      },
      'ç™¸': {
        traits: 'æ„Ÿæƒ…ç»†è…»æ•æ„Ÿï¼Œå®¹æ˜“æƒ…ç»ªåŒ–ï¼Œä½†è¦å­¦ä¼šæƒ…ç»ªç®¡ç†',
        tips: 'å­¦ä¼šæƒ…ç»ªç®¡ç†ï¼Œç†æ€§å¤„ç†çŸ›ç›¾'
      }
    };
    const defaultAnalysis = {
      traits: 'æ„Ÿæƒ…è¿åŠ¿å¹³ç¨³ï¼Œéœ€è¦ç”¨å¿ƒç»è¥ï¼Œç›¸äº’ç†è§£ã€çœŸè¯šæ²Ÿé€šæ˜¯ç»´ç³»æ„Ÿæƒ…çš„å…³é”®',
      tips: 'ç›¸äº’å°Šé‡ï¼ŒçœŸè¯šæ²Ÿé€šæ˜¯ç»´ç³»æ„Ÿæƒ…çš„å…³é”®'
    };
    return analysis[dayStem] || defaultAnalysis;
  },

  // å©šå§»å»ºè®®
  getMarriageAdvice(tenGods) {
    if (tenGods.includes('æ­£å®˜') || tenGods.includes('æ­£è´¢')) {
      return t('report.marriage.stable') || 'å©šå§»è¾ƒä¸ºç¨³å®šï¼Œé€‚åˆå»ºç«‹é•¿æœŸå…³ç³»';
    } else if (tenGods.includes('ä¸ƒæ€') || tenGods.includes('åè´¢')) {
      return t('report.marriage.experienced') || 'æ„Ÿæƒ…ç»å†å¯èƒ½è¾ƒå¤šï¼Œéœ€è¦æ‰¾åˆ°çœŸæ­£é€‚åˆçš„ä¼´ä¾£';
    } else {
      return t('report.marriage.default') || 'å©šå§»éœ€è¦åŒæ–¹å…±åŒåŠªåŠ›ç»è¥';
    }
  },

  // èŒä¸šåˆ†æ
  getCareerAnalysis(dayStem, tenGods) {
    const careers = {
      'ç”²': t('report.career.jia') || 'ç®¡ç†å²—ä½ã€åˆ›ä¸šå¼€æ‹“ã€å»ºç­‘å·¥ç¨‹',
      'ä¹™': t('report.career.yi') || 'æ•™è‚²æ–‡åŒ–ã€åˆ›æ„è®¾è®¡ã€å’¨è¯¢é¡¾é—®',
      'ä¸™': t('report.career.bing') || 'å¸‚åœºè¥é”€ã€å¨±ä¹äº§ä¸šã€èƒ½æºè¡Œä¸š',
      'ä¸': t('report.career.ding') || 'æŠ€æœ¯ç ”å‘ã€åŒ»ç–—æœåŠ¡ã€ç²¾å¯†åˆ¶é€ ',
      'æˆŠ': t('report.career.wu') || 'é‡‘èæŠ•èµ„ã€æˆ¿åœ°äº§ã€èµ„æºç®¡ç†',
      'å·±': t('report.career.ji') || 'äººåŠ›èµ„æºã€æœåŠ¡è¡Œä¸šã€å†œä¸šç›¸å…³',
      'åºš': t('report.career.geng') || 'æ³•å¾‹è¡Œä¸šã€æœºæ¢°å·¥ç¨‹ã€å†›è­¦èŒä¸š',
      'è¾›': t('report.career.xin') || 'é‡‘èåˆ†æã€ç²¾å¯†ä»ªå™¨ã€ç å®è¡Œä¸š',
      'å£¬': t('report.career.ren') || 'è´¸æ˜“ç‰©æµã€æ—…æ¸¸è¡Œä¸šã€åˆ›æ„äº§ä¸š',
      'ç™¸': t('report.career.gui') || 'ç ”ç©¶æœºæ„ã€å¿ƒç†å’¨è¯¢ã€è‰ºæœ¯åˆ›ä½œ'
    };
    
    let advice = '';
    if (tenGods.includes('æ­£å®˜') || tenGods.includes('ä¸ƒæ€')) {
      advice = t('report.career.leadership') || 'é€‚åˆç®¡ç†å²—ä½æˆ–è‡ªä¸»åˆ›ä¸šï¼Œæœ‰é¢†å¯¼æ½œåŠ›';
    } else if (tenGods.includes('æ­£è´¢') || tenGods.includes('åè´¢')) {
      advice = t('report.career.business') || 'é€‚åˆå•†ä¸šã€é‡‘èé¢†åŸŸï¼Œè´¢è¿è¾ƒå¥½';
    } else if (tenGods.includes('é£Ÿç¥') || tenGods.includes('ä¼¤å®˜')) {
      advice = t('report.career.creative') || 'é€‚åˆåˆ›æ„ã€è‰ºæœ¯ã€æŠ€æœ¯ç±»å·¥ä½œ';
    } else {
      advice = t('report.career.steady') || 'ç¨³æ‰ç¨³æ‰“ï¼Œåœ¨ä¸“ä¸šé¢†åŸŸæ·±è€•å‘å±•';
    }
    
    return {
      suitable: careers[dayStem] || t('report.career.default') || 'å¤šæ ·åŒ–å‘å±•ï¼Œæ ¹æ®å…´è¶£é€‰æ‹©',
      advice: advice
    };
  },

  // æ±‚è´¢æ–¹ä½
  getWealthDirections(dayStem) {
    const directions = {
      'ç”²': 'ä¸œæ–¹ã€ä¸œå—æ–¹æ±‚è´¢æœ‰åˆ©',
      'ä¹™': 'ä¸œæ–¹ã€å—æ–¹è´¢è¿è¾ƒä½³',
      'ä¸™': 'å—æ–¹æ˜¯æ±‚è´¢æœ€ä½³æ–¹ä½',
      'ä¸': 'å—æ–¹ã€è¥¿å—æ–¹æœ‰åˆ©è´¢è¿',
      'æˆŠ': 'ä¸­éƒ¨åœ°åŒºã€æœ¬åœ°å‘å±•è´¢è¿è¾ƒå¥½',
      'å·±': 'ä¸­éƒ¨ã€è¥¿å—æ–¹æ±‚è´¢æœ‰åˆ©',
      'åºš': 'è¥¿æ–¹ã€è¥¿åŒ—æ–¹è´¢è¿æ—ºç››',
      'è¾›': 'è¥¿æ–¹ã€åŒ—æ–¹é€‚åˆæ±‚è´¢',
      'å£¬': 'åŒ—æ–¹æ˜¯è´¢è¿æœ€ä½³æ–¹ä½',
      'ç™¸': 'åŒ—æ–¹ã€ä¸œæ–¹æœ‰åˆ©è´¢å¯Œç§¯ç´¯'
    };
    return directions[dayStem] || 'æ ¹æ®å…·ä½“å‘½ç›˜ç¡®å®šæœ€ä½³æ±‚è´¢æ–¹ä½';
  },
  
  // è´¢åŠ¡å»ºè®®
  getFinancialAdvice(tenGods) {
    if (tenGods.includes('åè´¢')) {
      return 'å¯ä»¥é€‚å½“æŠ•èµ„ç†è´¢ï¼Œä½†è¦æ§åˆ¶é£é™©ï¼Œè§å¥½å°±æ”¶';
    } else if (tenGods.includes('æ­£è´¢')) {
      return 'ç¨³æ‰ç¨³æ‰“ï¼Œé€šè¿‡ä¸“ä¸šæŠ€èƒ½å’Œç¨³å®šå·¥ä½œç§¯ç´¯è´¢å¯Œ';
    } else {
      return 'é‡å…¥ä¸ºå‡ºï¼Œåšå¥½è´¢åŠ¡è§„åˆ’ï¼Œé¿å…ä¸å¿…è¦çš„å¼€æ”¯';
    }
  },

  // å¥åº·åˆ†æ
  getHealthAnalysis(dayStem) {
    const analysis = {
      'ç”²': 'éœ€è¦æ³¨æ„è‚èƒ†å¥åº·ã€è§†åŠ›é—®é¢˜å’Œç­‹éª¨ä¸é€‚',
      'ä¹™': 'éœ€è¦æ³¨æ„è‚è„åŠŸèƒ½å’Œæƒ…ç»ªè°ƒèŠ‚ï¼Œé¿å…è¿‡åº¦ç”¨çœ¼',
      'ä¸™': 'éœ€è¦æ³¨æ„å¿ƒè¡€ç®¡å¥åº·å’Œçœ¼ç›é—®é¢˜ï¼Œæ§åˆ¶æƒ…ç»ªæ³¢åŠ¨',
      'ä¸': 'éœ€è¦æ³¨æ„å¿ƒè„å’Œè¡€æ¶²å¾ªç¯ç³»ç»Ÿï¼Œä¿è¯å……è¶³ç¡çœ ',
      'æˆŠ': 'éœ€è¦æ³¨æ„è„¾èƒƒæ¶ˆåŒ–åŠŸèƒ½ï¼Œä¿æŒè§„å¾‹é¥®é£Ÿ',
      'å·±': 'éœ€è¦æ³¨æ„è„¾èƒƒå’Œçš®è‚¤é—®é¢˜ï¼Œæ³¨æ„é¥®é£Ÿå«ç”Ÿ',
      'åºš': 'éœ€è¦æ³¨æ„å‘¼å¸ç³»ç»Ÿå’Œå¤§è‚ å¥åº·ï¼Œé¿å…å¹²ç‡¥ç¯å¢ƒ',
      'è¾›': 'éœ€è¦æ³¨æ„è‚ºéƒ¨å’Œå‘¼å¸ç³»ç»Ÿï¼Œä¿æŒç©ºæ°”æµé€š',
      'å£¬': 'éœ€è¦æ³¨æ„è‚¾è„å’Œæ³Œå°¿ç³»ç»Ÿï¼Œä¿æŒæ°´åˆ†å¹³è¡¡',
      'ç™¸': 'éœ€è¦æ³¨æ„è‚¾è„å’Œè†€èƒ±å¥åº·ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯'
    };
    return analysis[dayStem] || 'ä½“è´¨è¾ƒä¸ºå¹³è¡¡ï¼Œæ³¨æ„å…¨é¢ä¿å¥å’Œè§„å¾‹ä½œæ¯';
  },

  // å…»ç”Ÿå»ºè®®
  getWellnessAdvice(dayStem) {
    const advice = {
      'ç”²': 'æ³¨æ„ä¿æŠ¤çœ¼ç›ï¼Œè‚è„å’Œèƒ†å¥åº·ã€ç­‹éª¨é—®é¢˜ï¼Œå¤šè¿›è¡Œæˆ·å¤–è¿åŠ¨ï¼Œå°‘é¥®é…’ï¼Œä¿æŠ¤è§†åŠ›',
      'ä¹™': 'æ³¨æ„è‚è„ã€è§†åŠ›é—®é¢˜ï¼Œä¿æŒå¿ƒæƒ…æ„‰æ‚¦ï¼Œé¿å…è¿‡åº¦ç”¨çœ¼å’Œæƒ…ç»ªå‹æŠ‘',
      'ä¸™': 'æ³¨æ„å¿ƒè¡€ç®¡ã€çœ¼ç›å¥åº·ï¼Œæ§åˆ¶æƒ…ç»ªæ³¢åŠ¨',
      'ä¸': 'æ³¨æ„å¿ƒè„ã€è¡€æ¶²å¾ªç¯ï¼Œä¿è¯å……è¶³ç¡çœ ï¼Œé¿å…è¿‡åº¦ç´§å¼ å’Œç„¦è™‘',
      'æˆŠ': 'æ³¨æ„è„¾èƒƒæ¶ˆåŒ–åŠŸèƒ½ï¼Œè§„å¾‹é¥®é£Ÿ',
      'å·±': 'æ³¨æ„è„¾èƒƒã€çš®è‚¤é—®é¢˜ï¼Œé¥®é£Ÿå«ç”Ÿï¼Œé¿å…æ½®æ¹¿ç¯å¢ƒ',
      'åºš': 'æ³¨æ„å‘¼å¸ç³»ç»Ÿã€å¤§è‚ å¥åº·ï¼Œé¿å…å¹²ç‡¥ç¯å¢ƒ',
      'è¾›': 'æ³¨æ„è‚ºéƒ¨ã€å‘¼å¸ç³»ç»Ÿï¼Œä¿æŒç©ºæ°”æµé€š',
      'å£¬': 'æ³¨æ„è‚¾è„ã€æ³Œå°¿ç³»ç»Ÿï¼Œä¿æŒæ°´åˆ†å¹³è¡¡',
      'ç™¸': 'æ³¨æ„è‚¾è„ã€è†€èƒ±ï¼Œé€‚å½“ä¼‘æ¯ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯å’Œç†¬å¤œ'
    };
    return advice[dayStem] || 'ä½“è´¨è¾ƒä¸ºå¹³è¡¡ï¼Œä¿æŒå‡è¡¡é¥®é£Ÿã€é€‚é‡è¿åŠ¨å’Œè‰¯å¥½ä½œæ¯ï¼Œæ³¨æ„å…¨é¢ä¿å¥';
  },

  // å¥åº·æç¤º
  getHealthTips(dayStem) {
    const tips = {
      'ç”²': t('report.health.tips.jia') || 'å®šæœŸæ£€æŸ¥è‚åŠŸèƒ½ï¼Œä¿æŠ¤è§†åŠ›',
      'ä¹™': t('report.health.tips.yi') || 'æ³¨æ„æƒ…ç»ªè°ƒèŠ‚ï¼Œé¿å…çœ¼éƒ¨ç–²åŠ³',
      'ä¸™': t('report.health.tips.bing') || 'æ§åˆ¶æƒ…ç»ªï¼Œé¿å…ç†¬å¤œ',
      'ä¸': t('report.health.tips.ding') || 'ä¿è¯å……è¶³ç¡çœ ï¼Œé¿å…è¿‡åº¦ç´§å¼ ',
      'æˆŠ': t('report.health.tips.wu') || 'è§„å¾‹é¥®é£Ÿï¼Œé¿å…æš´é¥®æš´é£Ÿ',
      'å·±': t('report.health.tips.ji') || 'æ³¨æ„é¥®é£Ÿå«ç”Ÿï¼Œé¿å…æ½®æ¹¿ç¯å¢ƒ',
      'åºš': t('report.health.tips.geng') || 'æ³¨æ„ä¿æš–ï¼Œé¿å…å¹²ç‡¥ç¯å¢ƒ',
      'è¾›': t('report.health.tips.xin') || 'ä¿æŒç©ºæ°”æµé€šï¼Œé¿å…çƒŸå°˜',
      'å£¬': t('report.health.tips.ren') || 'ä¿æŒæ°´åˆ†å¹³è¡¡ï¼Œé¿å…å—å‡‰',
      'ç™¸': t('report.health.tips.gui') || 'é€‚é‡é¥®æ°´ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯'
    };
    return tips[dayStem] || t('report.health.tips.default') || 'ä¿æŒå¥åº·ç”Ÿæ´»ä¹ æƒ¯ï¼Œå®šæœŸä½“æ£€';
  },

  // è¿åŠ¿åˆ†æ
  getFortuneAnalysis(tenGods, dayStem) {
    let overall = '';
    if (tenGods.includes('æ­£å®˜') || tenGods.includes('æ­£å°')) {
      overall = 'è¿‘æœŸè¿åŠ¿å¹³ç¨³ä¸Šå‡ï¼Œé€‚åˆå­¦ä¹ æå‡å’Œäº‹ä¸šå‘å±•';
    } else if (tenGods.includes('ä¸ƒæ€') || tenGods.includes('ä¼¤å®˜')) {
      overall = 'é¢ä¸´ä¸€äº›æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ˜¯æˆé•¿å’Œçªç ´çš„æœºä¼š';
    } else {
      overall = 'è¿åŠ¿ç›¸å¯¹å¹³ç¨³ï¼Œé€‚åˆå·©å›ºåŸºç¡€å’Œè§„åˆ’æœªæ¥';
    }

    const timing = {
      'ç”²': 'æ˜¥å­£å’Œå†¬å­£è¿åŠ¿è¾ƒä½³',
      'ä¹™': 'æ˜¥å­£å’Œå¤å­£å‘å±•æœºä¼šè¾ƒå¤š',
      'ä¸™': 'å¤å­£è¿åŠ¿æœ€æ—º',
      'ä¸': 'å¤å­£å’Œç§‹å­£é€‚åˆæ¨è¿›è®¡åˆ’',
      'æˆŠ': 'å››å­£çš†å®œï¼Œå°¤å…¶å¤ç§‹ä¹‹äº¤',
      'å·±': 'å¤ç§‹å­£èŠ‚è¿åŠ¿è¾ƒå¥½',
      'åºš': 'ç§‹å­£æœºé‡æœ€å¤š',
      'è¾›': 'ç§‹å­£å’Œå†¬å­£é€‚åˆå‘å±•',
      'å£¬': 'å†¬å­£è¿åŠ¿æœ€ä½³',
      'ç™¸': 'å†¬å­£å’Œæ˜¥å­£æœ‰åˆ©å‘å±•'
    };

    return {
      overall: overall,
      timing: timing[dayStem] || 'æœªæ¥3-6ä¸ªæœˆæ˜¯å…³é”®å‘å±•æœŸ',
      cautions: this.getCautions(tenGods)
    };
  },

  // æ³¨æ„äº‹é¡¹
  getCautions(tenGods) {
    const cautions = [];
    
    if (tenGods.includes('ä¸ƒæ€')) {
      cautions.push('æ³¨æ„å‹åŠ›ç®¡ç†ï¼Œé¿å…å†²åŠ¨å†³ç­–');
    }
    if (tenGods.includes('ä¼¤å®˜')) {
      cautions.push('æ³¨æ„è¨€è¾ï¼Œé¿å…äººé™…å†²çª');
    }
    if (tenGods.includes('åŠ«è´¢')) {
      cautions.push('æ³¨æ„è´¢åŠ¡å®‰å…¨ï¼Œé¿å…æŠ•èµ„é£é™©');
    }
    
    if (cautions.length === 0) {
      cautions.push('ä¿æŒè°¨æ…æ€åº¦ï¼Œæ³¨æ„èº«ä½“å¥åº·');
    }
    
    return cautions.join('ï¼›');
  }
};
  
  // è®¡ç®—å…«å­—æ•°æ®
  function calculateBaziData(birthdate, timeStr, timeUnknown) {
    const [Y, M, D] = birthdate.split('-').map(n => parseInt(n, 10));
    let hour = 12;
    if (!timeUnknown && timeStr) {
      const hh = parseInt(timeStr.slice(0, 2), 10);
      if (!Number.isNaN(hh)) hour = hh;
    }

    const calc = new BaziCalculator();
    const yearP = calc.calculateYearPillar(Y);
    const monthP = calc.calculateMonthPillar(Y, M, D);
    const dayP = calc.calculateDayPillar(Y, M, D);
    const hourP = timeUnknown ? { stem: '-', branch: '-' } : calc.calculateHourPillar(dayP.stem, hour);

    const stems = [yearP.stem, monthP.stem, dayP.stem, hourP.stem];
    const branches = [yearP.branch, monthP.branch, dayP.branch, hourP.branch];
    const elements = stems.map(stem => calc.getStemElement(stem));
    const nayin = stems.map((stem, i) => 
      timeUnknown && i === 3 ? '-' : calc.getNayin(stem, branches[i])
    );

    // è®¡ç®—äº”è¡Œç™¾åˆ†æ¯”
    const counts = { 'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0 };
    const consider = timeUnknown
      ? [[stems[0], branches[0]], [stems[1], branches[1]], [stems[2], branches[2]]]
      : [[stems[0], branches[0]], [stems[1], branches[1]], [stems[2], branches[2]], [stems[3], branches[3]]];

    consider.forEach(([s, b]) => {
      counts[calc.getStemElement(s)] += 1;
      counts[calc.getBranchElement(b)] += 1;
    });

    const total = Object.values(counts).reduce((a, b) => a + b, 0) || 1;
    const elementsPct = Object.fromEntries(
      Object.entries(counts).map(([k, v]) => [k, v / total * 100])
    );

    return {
      pillars: {
        labels: [
          stems[0] + branches[0],
          stems[1] + branches[1],
          stems[2] + branches[2],
          timeUnknown ? '-' : (stems[3] + branches[3])
        ]
      },
      stem: stems,
      branch: branches,
      element: elements,
      nayin: nayin,
      elementsPct,
      timeUnknown: !!timeUnknown
    };
  }

  // ä¸»è¦ç”Ÿæˆå‡½æ•°
  async function onGenerate() {
    const date = $('birthdate')?.value;
    const unknown = $('timeUnknown')?.checked;
    const timeVal = $('birthtime')?.value || '00:00';
    
    if (!date) {
      showErr(t('err.fillBirthdate'));
      return;
    }

    setGenLoading(true);

    try {
      // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
      const [yy, mm, dd] = date.split('-');
      const timeText = unknown ? t('ui.timeUnknown') : 
        (state.lang === 'en' ? `${timeVal.slice(0, 2)}:00` : `${timeVal.slice(0, 2)}æ—¶`);
      
      const summary = t('ui.birthSummary')
        .replace('{y}', yy)
        .replace('{m}', mm)
        .replace('{d}', dd)
        .replace('{timeText}', timeText);
      
      if ($('bazi-date')) $('bazi-date').textContent = summary;

      // è®¡ç®—å…«å­—æ•°æ®
      const baziData = calculateBaziData(date, timeVal, unknown);

      // æ¸²æŸ“å…«å­—ä¿¡æ¯
      renderPillars(baziData.pillars.labels);
      renderTable(baziData);
      renderBars(baziData.elementsPct);
      showResultContainers();

      // ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š
      const professionalReport = $('professionalReport');
      if (professionalReport) {
        professionalReport.innerHTML = generateProfessionalReport(baziData);
      }

    } catch (err) {
      console.error('Generate error:', err);
      showErr(t('err.generateFail'));
    } finally {
      setGenLoading(false);
    }
  }

  // åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
  function initFloatChat() {
    const toggleBtn = $('chatToggle');
    const floatWindow = $('chatFloat');
    const closeBtn = $('chatClose');
    const sendBtn = $('chatSend');
    const input = $('chatInput');
    const messages = $('chatMessages');
    
    if (toggleBtn && floatWindow) {
      toggleBtn.addEventListener('click', () => {
        floatWindow.style.display = floatWindow.style.display === 'flex' ? 'none' : 'flex';
      });
    }
    
    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        if (floatWindow) floatWindow.style.display = 'none';
      });
    }

    // ç®€å•çš„èŠå¤©åŠŸèƒ½
    function sendMessage() {
      const q = (input?.value || '').trim();
      if (!q) return;
      
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      const userMsg = document.createElement('div');
      userMsg.className = 'ss-msg';
      userMsg.textContent = q;
      userMsg.style.background = 'rgba(212,175,55,0.1)';
      userMsg.style.marginLeft = 'auto';
      userMsg.style.marginRight = '0';
      userMsg.style.maxWidth = '80%';
      messages.appendChild(userMsg);
      
      input.value = '';
      
      // æ·»åŠ è‡ªåŠ¨å›å¤
      setTimeout(() => {
        const autoMsg = document.createElement('div');
        autoMsg.className = 'ss-msg';
        autoMsg.textContent = t('chatDyn.autoReply').replace('{q}', q);
        autoMsg.style.background = 'rgba(255,255,255,0.05)';
        autoMsg.style.maxWidth = '80%';
        messages.appendChild(autoMsg);
        messages.scrollTop = messages.scrollHeight;
      }, 1000);
      
      messages.scrollTop = messages.scrollHeight;
    }
    
    if (sendBtn) sendBtn.addEventListener('click', sendMessage);
    if (input) input.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
  }

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', () => {
    // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const mi = String(now.getMinutes()).padStart(2, '0');
    
    const dateInput = $('birthdate');
    const timeInput = $('birthtime');
    if (dateInput && !dateInput.value) dateInput.value = `${yyyy}-${mm}-${dd}`;
    if (timeInput && !timeInput.value) timeInput.value = `${hh}:${mi}`;

    // äº‹ä»¶ç›‘å¬
    const timeUnknown = $('timeUnknown');
    if (timeUnknown) {
      timeUnknown.addEventListener('change', e => {
        const birthtime = $('birthtime');
        if (birthtime) birthtime.disabled = !!e.target.checked;
      });
    }

    const genBtn = $('genBtn');
    if (genBtn) genBtn.addEventListener('click', onGenerate);

    // è¯­è¨€é€‰æ‹©
    const langSelect = $('langSelect');
    if (langSelect) {
      langSelect.value = state.lang;
      langSelect.addEventListener('change', e => {
        state.lang = e.target.value;
        localStorage.setItem('5x_lang', state.lang);
        applyI18n();
        
        // é‡æ–°ç”ŸæˆæŠ¥å‘Šä»¥æ›´æ–°è¯­è¨€
        const professionalReport = $('professionalReport');
        if (professionalReport && professionalReport.innerHTML) {
          const date = $('birthdate')?.value;
          const unknown = $('timeUnknown')?.checked;
          const timeVal = $('birthtime')?.value || '00:00';
          if (date) {
            const baziData = calculateBaziData(date, timeVal, unknown);
            professionalReport.innerHTML = generateProfessionalReport(baziData);
          }
        }
      });
    }

    // åˆå§‹åŒ–ç¿»è¯‘å’ŒèŠå¤©
    applyI18n();
    initFloatChat();
  
  if (!reportData.sections) return reportData;
  
  // å®šä¹‰æ‰€æœ‰å¯èƒ½å‡ºç°çš„è‹±æ–‡å˜é‡åçš„ä¸­æ–‡ç¿»è¯‘
  const translations = {
    'report.dayMaster.ren': isChinese ? 'å£¬æ°´æ—¥ä¸»' : 'Ren Water Day Master',
    'report.tenGods.shangguan': isChinese ? 'ä¼¤å®˜' : 'Hurting Officer',
    'report.tenGods.piancai': isChinese ? 'åè´¢' : 'Partial Wealth',
    'report.tenGods.bijian': isChinese ? 'æ¯”è‚©' : 'Comparable',
    'report.relationship.ren': isChinese ? 'å£¬æ°´æ—¥ä¸»æ„Ÿæƒ…ä¸°å¯Œï¼Œé‡è§†ç²¾ç¥äº¤æµ' : 'Ren Water values emotional connection',
    'report.marriage.experienced': isChinese ? 'é€‚åˆæ‰¾æˆç†Ÿç¨³é‡çš„ä¼´ä¾£' : 'Suitable for mature partners',
    'report.relationship.tips': isChinese ? 'å¤šæ²Ÿé€šï¼Œå°‘çŒœç–‘' : 'More communication, less suspicion',
    'report.career.ren': isChinese ? 'é€‚åˆæ°´ã€æœ¨ç›¸å…³è¡Œä¸š' : 'Suitable for water/wood industries',
    'report.career.business': isChinese ? 'å¯è€ƒè™‘è‡ªä¸»åˆ›ä¸š' : 'Consider entrepreneurship',
    'report.direction.ren': isChinese ? 'åŒ—æ–¹ã€è¥¿æ–¹æœ‰åˆ©' : 'North and West directions favorable',
    'report.wealth.good': isChinese ? 'åè´¢è¿ä½³ï¼Œæœ‰æ„å¤–ä¹‹è´¢' : 'Good partial wealth luck',
    'report.wealth.advice': isChinese ? 'å®œæŠ•èµ„ï¼Œä½†éœ€è°¨æ…' : 'Good for investment but be cautious',
    'report.health.ren': isChinese ? 'è‚¾æ°´ç³»ç»Ÿéœ€æ³¨æ„' : 'Pay attention to kidney system',
    'report.health.tips.ren': isChinese ? 'é¿å…ç†¬å¤œï¼Œå¤šå–æ°´' : 'Avoid staying up late, drink more water',
    'report.health.advice': isChinese ? 'å®šæœŸä½“æ£€ï¼Œæ³¨æ„ä¼‘æ¯' : 'Regular checkups, adequate rest',
    'report.fortune.overall': isChinese ? 'è¿‘æœŸè¿åŠ¿å¹³ç¨³ä¸Šå‡' : 'Recent fortune steadily improving',
    'report.fortune.timing': isChinese ? 'å†¬å­£è¿åŠ¿æœ€ä½³' : 'Best fortune in winter',
    'report.fortune.cautions': isChinese ? 'æ³¨æ„äººé™…å…³ç³»çº çº·' : 'Watch for interpersonal conflicts'
  };
  
  // é€’å½’ä¿®å¤æ‰€æœ‰æ–‡æœ¬å†…å®¹
  function fixTextContent(obj) {
    if (typeof obj === 'string') {
      // ç›´æ¥æ›¿æ¢å·²çŸ¥çš„è‹±æ–‡å˜é‡
      return translations[obj] || obj;
    } else if (Array.isArray(obj)) {
      return obj.map(item => fixTextContent(item));
    } else if (typeof obj === 'object' && obj !== null) {
      const fixed = {};
      for (const [key, value] of Object.entries(obj)) {
        fixed[key] = fixTextContent(value);
      }
      return fixed;
    }
    return obj;
  }
  
  return fixTextContent(reportData);
}
  
  // ä¿®å¤å›½é™…åŒ–æ˜¾ç¤º
  const fixedData = fixReportTemplateI18n(json, state.lang);
  
  const html = fixedData.sections.map(sec => {
    const traits = (sec.traits || []).map(s => `<li>${s}</li>`).join('');
    const actions = (sec.actions || []).map(s => `<li>${s}</li>`).join('');
    const outcomes = (sec.outcomes || []).map(s => `<li>${s}</li>`).join('');
    const cautions = (sec.cautions || []).map(s => `<li>${s}</li>`).join('');

    return `
      <div class="butler-section">
        <h4>${sec.title || sec.id}</h4>
        ${traits ? `<div class="detail-section"><strong>${state.lang.startsWith('zh') ? 'ç‰¹è´¨' : 'Traits'}</strong><ul class="action-list">${traits}</ul></div>` : ''}
        ${actions ? `<div class="detail-section"><strong>${state.lang.startsWith('zh') ? 'è¡ŒåŠ¨å»ºè®®' : 'Actions'}</strong><ul class="action-list">${actions}</ul></div>` : ''}
        ${outcomes ? `<div class="detail-section"><strong>${state.lang.startsWith('zh') ? 'æ½œåœ¨ç»“æœ' : 'Outcomes'}</strong><ul class="action-list">${outcomes}</ul></div>` : ''}
        ${cautions ? `<div class="detail-section"><strong>${state.lang.startsWith('zh') ? 'æ³¨æ„äº‹é¡¹' : 'Cautions'}</strong><ul class="action-list">${cautions}</ul></div>` : ''}
        ${sec.timing ? `<div class="detail-section"><strong>${state.lang.startsWith('zh') ? 'æ—¶æœº' : 'Timing'}</strong><div>${sec.timing}</div></div>` : ''}
        ${typeof sec.confidence === 'number' ? `<div class="detail-section muted">${state.lang.startsWith('zh') ? 'å¯ä¿¡åº¦' : 'Confidence'} ${Math.round(sec.confidence * 100)}%</div>` : ''}
      </div>
    `;
  }).join('');
  
  host.innerHTML = html;
  
  const butlerSection = $('butlerProfessional');
  if (butlerSection) {
    butlerSection.style.display = 'block';
  }
  });
})();
</script>
</body>
</html>
