
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ä¿æŒä½ çš„åŸæœ‰æ ·å¼ï¼Œå¹¶ä¿®å¤/è¡¥å…¨å°‘é‡ç»†èŠ‚ */
:root{
  --bg:#0b0f14;
  --bg-accent:#0e1520;
  --card:#11161dcc;
  --surface:#0f1624;
  --line:#1f2a36;
  --text:#e8edf3;
  --muted:#98a7b7;

  --brand:#d4af37;
  --gold:#d4af37;
  --gold2:#f2d27a;
  --accent:#58b9ff;

  --radius:14px;
  --radius-sm:10px;
  --radius-lg:18px;

  --shadow:0 8px 30px rgba(0,0,0,.35);
  --shadow-sm:0 4px 14px rgba(0,0,0,.28);

  --container:1100px;
  --gap:12px;
  --pad:18px;

  /* ä»…ä¾›æ³¨é‡Šè¯´æ˜ï¼šåª’ä½“æŸ¥è¯¢ä»ç”¨å›ºå®šæ•°å€¼å†™ */
  --bp-s:520px;
  --bp-m:760px;
  --bp-l:900px;
}

/* Reset + base */
*,
*::before,
*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
    linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}

.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}

.site-header{
  position:sticky; top:0; z-index:10;
  background:rgba(11,15,20,.8);
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:var(--shadow-sm);
  font-weight:800; color:#ffe084
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}

.lang{display:flex; align-items:center; gap:8px}
.lang select{
  appearance:none; min-width:140px;
  border-radius:10px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:10px 34px 10px 12px; font-size:0.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}
.lang select:focus{outline:0; box-shadow:var(--focus)}

.section{margin-top:18px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:var(--pad);
  margin:16px 0;
}
.h2{
  font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084;
  display:flex; gap:8px; align-items:center
}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}

.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width: 760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .row.cols-2{grid-template-columns:1fr 1fr}
}

input,select{
  width:100%;
  border-radius:12px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:12px 12px; font-size:15px; outline:0;
}
input::placeholder{color:#6f8092}
input:focus, select:focus{box-shadow:var(--focus); border-color:#3a4c63}

.btn{
  display:inline-grid; place-items:center;
  padding:12px 16px; border-radius:12px;
  border:1px solid #e6c76e;
  background:linear-gradient(180deg,#fff9e6,#e6c76e);
  color:#191919; font-weight:800; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}

.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width: 520px){
  .pillars{grid-template-columns:repeat(2,1fr)}
}

.bazi-table{
  width:100%; border-collapse:collapse; margin-top:12px;
  background:var(--surface); border-radius:8px; overflow:hidden
}
.bazi-table th,.bazi-table td{
  padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle
}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
/* å°å±è¡¨æ ¼å¯æ¨ªå‘æ»šåŠ¨ï¼šæŠŠ table ç”¨ div åŒ…ä¸€å±‚ .bazi-table-wrap å³å¯ */
.bazi-table-wrap{overflow:auto}
@media (max-width: 420px){
  .bazi-table th,.bazi-table td{padding:8px 10px}
}

.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:60px 1fr 60px; gap:10px; align-items:center}

.error-message{
  background:rgba(255,90,95,.1);
  border:1px solid #ff5a5f; border-radius:8px;
  padding:10px; display:none; margin-top:10px
}
.badge-warn{display:inline-block; padding:2px 8px; margin-left:6px; border:1px solid #ffb84d; border-radius:999px; color:#ffb84d; font-size:0.82rem}
.muted{color:var(--muted)}

.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}

.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.rating{display:flex; align-items:center; gap:8px; margin:8px 0}
.rating-stars{color:var(--gold2)}
.tag{display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:0.85rem; margin:2px}

.luck-grid{display:grid; gap:10px}
.luck-item{background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
.luck-year{font-weight:700; color:var(--gold2)}
.luck-desc{font-size:0.9rem; margin-top:4px}

.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width: 900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)
}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

.ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
.ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
.ai-box-c{color:#e8edf3; line-height:1.7}
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.chip{padding:6px 10px; border-radius:999px; border:1px solid #2a3546; background:#0e1520; color:#e8edf3; cursor:pointer; transition:border-color .2s ease, box-shadow .2s ease}
.chip:hover{border-color:#f2d27a; box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
.chip:disabled{opacity:.6; cursor:not-allowed}

.skeleton{display:grid; gap:8px}
.skeleton div{height:12px; border-radius:6px; background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431); animation:sh 1.2s infinite}
@keyframes sh{0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5}}

.ai-lock-overlay{margin-top:10px; padding-top:10px; border-top:1px solid #1f2a36; text-align:center}
.ai-lock-overlay .tip{color:#ffd88a; font-weight:700; margin-bottom:4px}
.ai-lock-overlay .sub{color:var(--muted)}

.detail-view{display:none}
.detail-header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
.back-btn{background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
.detail-content{line-height:1.8}
.detail-section{margin-bottom:24px}
.detail-section h4{color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
.action-list{list-style:none; padding:0; margin:0}
.action-list li{margin-bottom:8px; padding-left:20px; position:relative}
.action-list li::before{content:"â€¢"; color:var(--gold2); position:absolute; left:0; top:0}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}

/* Motion ä¼˜åŒ– */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* Utilities */
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.chips-container{display:flex; flex-wrap:wrap; gap:8px; margin:20px 0; justify-content:center}

/* VIP section demo å¯è§ */
.vip-section{display:block !important}

/* Butler ç»„ä»¶ */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
.butler-chat{margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
.chat-messages{height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:var(--surface); border-radius:8px; border:1px solid #253245}
.chat-input-area{display:flex; gap:10px}
.chat-input-area input{flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3}
.chat-send-btn{padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:700; cursor:pointer}

/* ==== remove the brown/gold focus outline ==== */
:root{ --focus: none; }                 /* disables the var used for focus glow */
input:focus,
select:focus,
textarea:focus{
  outline: none !important;
  box-shadow: none !important;          /* no glow */
  border-color: #243244 !important;     /* keep the normal border */
}
button:focus,
.btn:focus,
a:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* (optional) also remove tap highlight on mobile */
*{ -webkit-tap-highlight-color: transparent; }    
.chip:hover{ border-color:#2a3546; box-shadow:none; }    
</style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="#" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title" data-i18n="brand.subtitle">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="nav.langLabel">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN" data-i18n="lang.zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW" data-i18n="lang.zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en"    data-i18n="lang.en">English</option>
        <option value="ja"    data-i18n="lang.ja">æ—¥æœ¬èª</option>
        <option value="th"    data-i18n="lang.th">à¹„à¸—à¸¢</option>
        <option value="ms"    data-i18n="lang.ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2" data-i18n="app.title">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="form.nameLabel">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted" data-i18n="form.genderLabel">æ€§åˆ«</label>
        <select id="gender">
          <option value=""        data-i18n="form.gender.hidden">ä¸é€éœ²</option>
          <option value="male"    data-i18n="form.gender.male">ç”·æ€§</option>
          <option value="female"  data-i18n="form.gender.female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="form.calendarLabel">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian" data-i18n="form.calendar.gregorian">é˜³å†</option>
          <option value="lunar"     data-i18n="form.calendar.lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted" data-i18n="form.birthdateLabel">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted" data-i18n="form.birthtimeLabel">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span data-i18n="form.timeUnknown">å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText" data-i18n="btn.generate">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none" data-i18n="btn.loading">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

  <section id="result" style="display:none;">
    <div class="card">
      <div class="h2" data-i18n="result.title">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>
     
      <div class="bazi-table-wrap">
  <table class="bazi-table">â€¦</table>
</div>

      <table class="bazi-table">
        <thead>
          <tr>
            <th></th>
            <th data-i18n="pillar.year">å¹´æŸ±</th>
            <th data-i18n="pillar.month">æœˆæŸ±</th>
            <th data-i18n="pillar.day">æ—¥æŸ±</th>
            <th data-i18n="pillar.hour">æ—¶æŸ±</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-i18n="table.row.stem">å¤©å¹²</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.branch">åœ°æ”¯</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.fiveElem">äº”è¡Œ</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.nayin">çº³éŸ³</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2" data-i18n="energy.title">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span data-i18n="elem.wood">æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.fire">ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.earth">åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.metal">é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.water">æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
    <div class="butler-chat">
      <div class="chat-messages" id="chatMessages">
        <div class="ss-msg" data-i18n="pro.welcome">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
        <button class="chat-send-btn" id="chatSend" data-i18n="chat.send">å‘é€</button>
      </div>
    </div>
  </section>

  <section class="card section vip-section">
    <h2 class="group-title" data-i18n="vip.title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.astrology">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.astrology.match">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li data-i18n="vip.astrology.career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li data-i18n="vip.astrology.wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li data-i18n="vip.astrology.pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.spiritual">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.spiritual.record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li data-i18n="vip.spiritual.courses">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li data-i18n="vip.spiritual.family">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li data-i18n="vip.spiritual.practice">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="vip.login.title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head" data-i18n="auth.header">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email">
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰">
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="auth.login">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="auth.reset">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="auth.register">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted" data-i18n="auth.freeTrialNote">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head" data-i18n="vip.services.header">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="vip.upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="vip.back">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted" data-i18n="vip.priceNote">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer data-i18n="footer.copy">Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>

<script>
/*!
 * 5XLiving Â· Bazi Quick Chart (single-file script)
 * Paste this once at the END of your <body>. It includes:
 * - I18N (zh-CN / en / ms)
 * - Language switching
 * - Generate button handler (demo data + API hook)
 * - Pillars/table/5-element bars rendering
 * - Professional report placeholder + simple chat
 */
(() => {
  'use strict';

  /* =========================
   * CONFIG
   * ========================= */
  const CONFIG = {
    // If you already define window.API_BASE elsewhere, this will use it.
    API_BASE: (typeof window.API_BASE === 'string' ? window.API_BASE : ''), // e.g. 'https://your-api.example.com'
    TIMEOUT_MS: 12000
  };

  /* =========================
   * I18N DICTIONARY
   * ========================= */
  const I18N = {
    'zh-CN': {
      brand: { subtitle: '5xLiving Â· å…«å­—ç®€è¯„' },
      nav: { langLabel: 'è¯­è¨€' },
      lang: { 'zh-CN':'ç®€ä½“ä¸­æ–‡','zh-TW':'ç¹é«”ä¸­æ–‡','en':'English','ja':'æ—¥æœ¬èª','th':'à¹„à¸—à¸¢','ms':'Bahasa Melayu' },

      app: { title: 'å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜' },

      form: {
        nameLabel: 'å§“åï¼ˆå¯é€‰ï¼‰',
        namePlaceholder: 'ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰',
        genderLabel: 'æ€§åˆ«',
        gender: { hidden:'ä¸é€éœ²', male:'ç”·æ€§', female:'å¥³æ€§' },
        calendarLabel: 'å†æ³•',
        calendar: { gregorian:'é˜³å†', lunar:'å†œå†' },
        birthdateLabel: 'å‡ºç”Ÿæ—¥æœŸ',
        birthtimeLabel: 'å‡ºç”Ÿæ—¶é—´',
        timeUnknown: 'å‡ºç”Ÿæ—¶é—´ä¸è¯¦'
      },

      btn: { generate:'ç”Ÿæˆå…«å­—', loading:'è®¡ç®—ä¸­...' },

      result: { title:'æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜' },
      pillar: { year:'å¹´æŸ±', month:'æœˆæŸ±', day:'æ—¥æŸ±', hour:'æ—¶æŸ±' },
      table: { row: { stem:'å¤©å¹²', branch:'åœ°æ”¯', fiveElem:'äº”è¡Œ', nayin:'çº³éŸ³' } },

      energy: { title:'äº”è¡Œèƒ½é‡åˆ†æ' },
      elem: { wood:'æœ¨', fire:'ç«', earth:'åœŸ', metal:'é‡‘', water:'æ°´' },

      pro: { title:'ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ', welcome:'æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚' },
      chat: { send:'å‘é€', placeholder:'è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...' },

      vip: {
        title:'ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment',
        group: { astrology:'ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹', spiritual:'ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹' },
        astrology: { match:'å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿', career:'äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›', wealth:'è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº', pet:'å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†' },
        spiritual: { record:'çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·', courses:'å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°', family:'å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­', practice:'æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡' },
        login: { title:'ğŸ’ ç™»å…¥ VIP åŠŸèƒ½' },
        services: { header:'ä¼šå‘˜æœåŠ¡' },
        upgrade:'ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰',
        back:'â† è¿”å›å‘½ç†å•†åŸ',
        priceNote:'$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰'
      },

      auth: {
        header:'è´¦æˆ·ç™»å½• / æ³¨å†Œ',
        login:'ç™»å…¥è´¦æˆ·',
        reset:'ğŸ”‘ é‡è®¾å¯†ç ',
        register:'æ³¨å†Œè´¦æˆ·',
        freeTrialNote:'æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ',
        emailPlaceholder:'é‚®ç®± Email',
        passwordPlaceholder:'å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰'
      },

      footer: { copy:'Â© 5XLiving â€¢ Astro Sanctuary' },

      err: {
        fillBirthdate: 'è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ',
        invalidDate:   'æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼Œè¯·ç”¨ YYYY-MM-DD',
        generateFail:  'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
      },
      ui: {
        unknown:      'æœªçŸ¥',
        timeUnknown:  'æ—¶é—´ä¸è¯¦',
        hourSuffix:   '{h}æ—¶',
        birthSummary: 'å‡ºç”Ÿæ—¥æœŸ: {y}å¹´{m}æœˆ{d}æ—¥ {timeText}',
        balance:      'äº”è¡Œä¸­{strongest}æœ€å¼ºï¼Œ{weakest}æœ€å¼±ã€‚'
      },
      badge: { noHour: 'æœªçº³å…¥æ—¶æŸ±' },
      chatDyn:  { autoReply: 'æ”¶åˆ°ï¼š{q}ã€‚ç¨åå¯åœ¨ä¸“ä¸šæŠ¥å‘Šç›¸åº”ç« èŠ‚æ‰¾åˆ°è¦ç‚¹ã€‚' },
      elemNames: { æœ¨:'æœ¨', ç«:'ç«', åœŸ:'åœŸ', é‡‘:'é‡‘', æ°´:'æ°´' },
      report: { hourUnknownTip: 'âš ï¸ æç¤ºï¼šå› å‡ºç”Ÿæ—¶é—´ä¸è¯¦ï¼Œéƒ¨åˆ†åˆ†æä»…ä¾›å‚è€ƒã€‚' },

      relations: {
        same:       'åŒç±»ï¼ˆäº’åŠ©ï¼‰',
        i_output:   'è¾“å‡ºï¼ˆæˆ‘â†’å¯¹æ–¹ï¼‰',
        benefit_me: 'è¡¥ç›Šï¼ˆå¯¹æ–¹â†’æˆ‘ï¼‰',
        i_control:  'ä¸»æ§ï¼ˆæˆ‘åˆ¶è¡¡ï¼‰',
        control_me: 'å—å‹ï¼ˆå—åˆ¶è¡¡ï¼‰'
      },
      units: { before:'', after:'ä¸ª' },

      elemJoin: '',
      tenGods: { æ¯”è‚©:'æ¯”è‚©', åŠ«è´¢:'åŠ«è´¢', é£Ÿç¥:'é£Ÿç¥', ä¼¤å®˜:'ä¼¤å®˜', åè´¢:'åè´¢', æ­£è´¢:'æ­£è´¢', ä¸ƒæ€:'ä¸ƒæ€', æ­£å®˜:'æ­£å®˜', åå°:'åå°', æ­£å°:'æ­£å°' },
      dirMap: { ä¸œ:'ä¸œ', è¥¿:'è¥¿', å—:'å—', åŒ—:'åŒ—', ä¸­:'ä¸­', æ­£ä¸œæ–¹:'æ­£ä¸œæ–¹', ä¸œå—æ–¹:'ä¸œå—æ–¹', å—æ–¹:'å—æ–¹', è¥¿æ–¹:'è¥¿æ–¹', åŒ—æ–¹:'åŒ—æ–¹', ä¸­å¤®:'ä¸­å¤®' },
      colorMap: { æœ¨:'ç»¿è‰²ã€é’è‰²', ç«:'çº¢è‰²ã€ç´«è‰²', åœŸ:'é»„è‰²ã€æ£•è‰²', é‡‘:'ç™½è‰²ã€é‡‘è‰²', æ°´:'é»‘è‰²ã€è“è‰²' },
      nayinMap: {}
    },

    'en': {
      brand: { subtitle: '5xLiving Â· Bazi Brief' },
      nav: { langLabel: 'Language' },
      lang: { 'zh-CN':'ç®€ä½“ä¸­æ–‡','zh-TW':'ç¹é«”ä¸­æ–‡','en':'English','ja':'æ—¥æœ¬èª','th':'à¹„à¸—à¸¢','ms':'Bahasa Melayu' },

      app: { title: 'Bazi Â· Quick Chart' },

      form: {
        nameLabel: 'Name (optional)',
        namePlaceholder: 'Your name (for personalization)',
        genderLabel: 'Gender',
        gender: { hidden:'Prefer not to say', male:'Male', female:'Female' },
        calendarLabel: 'Calendar',
        calendar: { gregorian:'Gregorian', lunar:'Lunar' },
        birthdateLabel: 'Birth Date',
        birthtimeLabel: 'Birth Time',
        timeUnknown: 'Time unknown'
      },

      btn: { generate:'Generate', loading:'Calculating...' },

      result: { title:'Your Bazi Chart' },
      pillar: { year:'Year', month:'Month', day:'Day', hour:'Hour' },
      table: { row: { stem:'Heavenly Stem', branch:'Earthly Branch', fiveElem:'Five Elements', nayin:'Nayin' } },

      energy: { title:'Five-Element Energy Analysis' },
      elem: { wood:'Wood', fire:'Fire', earth:'Earth', metal:'Metal', water:'Water' },

      pro: { title:'ğŸ§™â€â™‚ï¸ Butler Â· Professional Analysis', welcome:'Hi! I\'ve generated your detailed analysis. Ask me anything.' },
      chat: { send:'Send', placeholder:'Type your question...' },

      vip: {
        title:'ğŸŒ™ VIP Segment',
        group: { astrology:'ğŸ— Exclusive Astrology Content', spiritual:'ğŸŒ™ Spiritual Space Exclusives' },
        astrology: { match:'Relationships: love & marriage', career:'Career: workplace & entrepreneurship', wealth:'Wealth: positions & timing', pet:'Pet astrology: personality & bond' },
        spiritual: { record:'Spiritual records: photos, dreams, voice, prayers', courses:'Courses: Bazi / Tarot / Astrology / Numerology', family:'Family memorial system', practice:'Weekly practices / rituals' },
        login: { title:'ğŸ’ Sign in for VIP' },
        services: { header:'Membership' },
        upgrade:'ğŸ’ Upgrade to VIP (Monthly)',
        back:'â† Back to Store',
        priceNote:'$9.9 / month (Astro + Spiritual + Courses)'
      },

      auth: {
        header:'Sign In / Register',
        login:'Sign In',
        reset:'ğŸ”‘ Reset Password',
        register:'Register',
        freeTrialNote:'New accounts get one free trial',
        emailPlaceholder:'Email',
        passwordPlaceholder:'Password (min 8 chars, mixed case & symbols)'
      },

      footer: { copy:'Â© 5XLiving â€¢ Astro Sanctuary' },

      err: {
        fillBirthdate: 'Please enter your birth date',
        invalidDate:   'Invalid date. Use YYYY-MM-DD.',
        generateFail:  'Failed to generate. Please try again later.'
      },
      ui: {
        unknown:      'Unknown',
        timeUnknown:  'time unknown',
        hourSuffix:   '{h}:00',
        birthSummary: 'Birth date: {y}-{m}-{d} {timeText}',
        balance:      'Among the Five Elements, {strongest} is strongest and {weakest} is weakest.'
      },
      badge: { noHour: 'Hour not included' },
      chatDyn:  { autoReply: 'Got it: {q}. Find key points in the relevant sections.' },
      elemNames: { æœ¨:'Wood', ç«:'Fire', åœŸ:'Earth', é‡‘:'Metal', æ°´:'Water' },
      report: { hourUnknownTip: 'âš ï¸ Note: Birth time unknown; parts of the analysis are for reference only.' },

      relations: {
        same:       'Peer (mutual)',
        i_output:   'Output (I â†’ other)',
        benefit_me: 'Support (other â†’ me)',
        i_control:  'Control (I restrain)',
        control_me: 'Challenge (restrains me)'
      },
      units: { before:'', after:'Ã—' },

      elemJoin: ' - ',
      tenGods: {
        æ¯”è‚©:'Friend', åŠ«è´¢:'Rob Wealth',
        é£Ÿç¥:'Eating God', ä¼¤å®˜:'Hurting Officer',
        åè´¢:'Indirect Wealth', æ­£è´¢:'Direct Wealth',
        ä¸ƒæ€:'Seven Killings', æ­£å®˜:'Direct Officer',
        åå°:'Indirect Resource', æ­£å°:'Direct Resource'
      },
      dirMap: { ä¸œ:'East', è¥¿:'West', å—:'South', åŒ—:'North', ä¸­:'Center', æ­£ä¸œæ–¹:'Due East', ä¸œå—æ–¹:'Southeast', ä¸­å¤®:'Center' },
      colorMap: { æœ¨:'Green, teal', ç«:'Red, purple', åœŸ:'Yellow, brown', é‡‘:'White, gold', æ°´:'Black, blue' },
      nayinMap: {}
    },

    'ms': {
      brand: { subtitle: '5xLiving Â· Ringkas Bazi' },
      nav: { langLabel: 'Bahasa' },
      lang: { 'zh-CN':'ç®€ä½“ä¸­æ–‡','zh-TW':'ç¹é«”ä¸­æ–‡','en':'English','ja':'æ—¥æœ¬èª','th':'à¹„à¸—à¸¢','ms':'Bahasa Melayu' },

      app: { title: 'Bazi Â· Carta Pantas' },

      form: {
        nameLabel: 'Nama (pilihan)',
        namePlaceholder: 'Nama anda (untuk peribadi)',
        genderLabel: 'Jantina',
        gender: { hidden:'Tidak mahu nyatakan', male:'Lelaki', female:'Perempuan' },
        calendarLabel: 'Kalendar',
        calendar: { gregorian:'Masihi', lunar:'Qamari' },
        birthdateLabel: 'Tarikh Lahir',
        birthtimeLabel: 'Masa Lahir',
        timeUnknown: 'Masa tidak pasti'
      },

      btn: { generate:'Jana', loading:'Mengira...' },

      result: { title:'Carta Bazi Anda' },
      pillar: { year:'Tahun', month:'Bulan', day:'Hari', hour:'Jam' },
      table: { row: { stem:'Batang Langit', branch:'Cawangan Bumi', fiveElem:'Lima Unsur', nayin:'Nayin' } },

      energy: { title:'Analisis Tenaga Lima Unsur' },
      elem: { wood:'Kayu', fire:'Api', earth:'Tanah', metal:'Logam', water:'Air' },

      pro: { title:'ğŸ§™â€â™‚ï¸ Butler Â· Analisis Profesional', welcome:'Hai! Laporan terperinci telah dijana. Tanya apa sahaja.' },
      chat: { send:'Hantar', placeholder:'Taip soalan anda...' },

      vip: {
        title:'ğŸŒ™ Segmen VIP',
        group: { astrology:'ğŸ— Kandungan Astrologi Eksklusif', spiritual:'ğŸŒ™ Eksklusif Ruang Spiritual' },
        astrology: { match:'Hubungan: cinta & perkahwinan', career:'Kerjaya: tempat kerja & niaga', wealth:'Rezeki: posisi & masa', pet:'Astrologi haiwan peliharaan' },
        spiritual: { record:'Rekod rohani: foto, mimpi, suara, doa', courses:'Kursus: Bazi / Tarot / Astrologi / Numerologi', family:'Sistem memorial keluarga', practice:'Amalan mingguan / ritual' },
        login: { title:'ğŸ’ Log masuk untuk VIP' },
        services: { header:'Keahlian' },
        upgrade:'ğŸ’ Naik taraf VIP (Bulanan)',
        back:'â† Kembali ke Kedai',
        priceNote:'$9.9 / bulan (Astro + Spiritual + Kursus)'
      },

      auth: {
        header:'Log Masuk / Daftar',
        login:'Log Masuk',
        reset:'ğŸ”‘ Tetap Semula Kata Laluan',
        register:'Daftar',
        freeTrialNote:'Akaun baharu dapat satu percubaan percuma',
        emailPlaceholder:'Emel',
        passwordPlaceholder:'Kata laluan (min 8 aksara, huruf besar/kecil & simbol)'
      },

      footer: { copy:'Â© 5XLiving â€¢ Astro Sanctuary' },

      err: {
        fillBirthdate: 'Sila isi tarikh lahir',
        invalidDate:   'Tarikh tidak sah. Guna YYYY-MM-DD.',
        generateFail:  'Gagal menjana. Cuba lagi nanti.'
      },
      ui: {
        unknown:      'Tidak diketahui',
        timeUnknown:  'masa tidak pasti',
        hourSuffix:   '{h}:00',
        birthSummary: 'Tarikh lahir: {y}-{m}-{d} {timeText}',
        balance:      'Antara Lima Unsur, {strongest} paling kuat dan {weakest} paling lemah.'
      },
      badge: { noHour: 'Jam tidak diambil kira' },
      chatDyn:  { autoReply: 'Diterima: {q}. Poin penting ada di seksyen berkaitan.' },
      elemNames: { æœ¨:'Kayu', ç«:'Api', åœŸ:'Tanah', é‡‘:'Logam', æ°´:'Air' },
      report: { hourUnknownTip: 'âš ï¸ Nota: Masa lahir tidak pasti; sebahagian analisis untuk rujukan.' },

      relations: {
        same:       'Sejenis (saling sokong)',
        i_output:   'Keluaran (saya â†’ pihak lain)',
        benefit_me: 'Sokongan (pihak lain â†’ saya)',
        i_control:  'Mengawal (saya menahan)',
        control_me: 'Dikawal (menahan saya)'
      },
      units: { before:'', after:'Ã—' },

      elemJoin: ' - ',
      tenGods: {
        æ¯”è‚©:'Rakan', åŠ«è´¢:'Rampas Rezeki',
        é£Ÿç¥:'Dewa Makan', ä¼¤å®˜:'Pegawai Terluka',
        åè´¢:'Rezeki Tidak Langsung', æ­£è´¢:'Rezeki Langsung',
        ä¸ƒæ€:'Tujuh Pembunuh', æ­£å®˜:'Pegawai',
        åå°:'Sumber Tidak Langsung', æ­£å°:'Sumber Langsung'
      },
      dirMap: { ä¸œ:'Timur', è¥¿:'Barat', å—:'Selatan', åŒ—:'Utara', ä¸­:'Tengah', æ­£ä¸œæ–¹:'Timur tepat', ä¸œå—æ–¹:'Tenggara', ä¸­å¤®:'Tengah' },
      colorMap: { æœ¨:'Hijau, teal', ç«:'Merah, ungu', åœŸ:'Kuning, coklat', é‡‘:'Putih, emas', æ°´:'Hitam, biru' },
      nayinMap: {}
    }
  };

  /* ===== i18n helpers & now defaults ===== */
const LANG_ALIAS = { 'zh-TW':'zh-CN', 'ja':'en', 'th':'en' };

function dictFor(lang){
  if (I18N[lang]) return I18N[lang];
  if (LANG_ALIAS[lang]) return I18N[LANG_ALIAS[lang]];
  return I18N['en'];
}
function normLang(lang){
  if (I18N[lang]) return lang;
  if (LANG_ALIAS[lang]) return LANG_ALIAS[lang];
  return 'en';
}

function pad(n){ return String(n).padStart(2,'0'); }
function setNowDefaults(){
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = pad(now.getMonth()+1);
  const dd = pad(now.getDate());
  const hh = pad(now.getHours());
  const mi = pad(now.getMinutes());
  const d = $('birthdate'), t = $('birthtime');

  if (d && !d.value) d.value = `${yyyy}-${mm}-${dd}`;
  if (t && !t.value) t.value = `${hh}:${mi}`;
}

  /* =========================
   * UTILS
   * ========================= */
  const $ = id => document.getElementById(id);
  const KEYS = ['year','month','day','hour'];

  const state = {
    lang: localStorage.getItem('5x_lang') || 'zh-CN'
  };

  function get(obj, path){
    return path.split('.').reduce((o,k)=> (o && o[k]!=null) ? o[k] : undefined, obj);
  }
function t(key){
  const dict = dictFor(state.lang);
  const val = get(dict, key);
  return (typeof val === 'string') ? val : '';
}

function applyI18n(){
  const dict = dictFor(state.lang);
  const htmlLang = normLang(state.lang);
  document.documentElement.lang = htmlLang;

    // data-i18n text
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const val = get(dict, key);
    if (typeof val === 'string' && val) el.textContent = val;
  });

  // options
  document.querySelectorAll('option[data-i18n]').forEach(opt=>{
    const key = opt.getAttribute('data-i18n');
    const val = get(dict, key);
    if (typeof val === 'string' && val) opt.textContent = val;
  });

  const ph = {
    name:    get(dict,'form.namePlaceholder'),
    email:   get(dict,'auth.emailPlaceholder'),
    password:get(dict,'auth.passwordPlaceholder'),
    chat:    get(dict,'chat.placeholder')
  };
  if ($('name')     && ph.name)     $('name').placeholder     = ph.name;
  if ($('email')    && ph.email)    $('email').placeholder    = ph.email;
  if ($('password') && ph.password) $('password').placeholder = ph.password;
  if ($('chatInput')&& ph.chat)     $('chatInput').placeholder= ph.chat;

  // keep UI in sync
  const langSelect = $('langSelect');
  if (langSelect) langSelect.value = state.lang;
}

  function showErr(msg){
    const box = $('error');
    if (!box) return;
    box.textContent = msg || t('err.generateFail') || 'Error';
    box.style.display = 'block';
    setTimeout(()=>{ box.style.display='none'; }, 4000);
  }

  function setGenLoading(v){
    const btn = $('genBtn'), txt = $('genBtnText'), ld = $('genBtnLoading');
    if (!btn) return;
    btn.disabled = !!v;
    if (txt) txt.style.display = v ? 'none' : 'inline';
    if (ld)  ld.style.display  = v ? 'inline' : 'none';
  }

  /* =========================
   * RENDERERS
   * ========================= */
  function renderPillars(labels){
    const mapKey = ['pillar.year','pillar.month','pillar.day','pillar.hour'];
    const html = mapKey.map((key,i)=>`
      <div class="pillar">
        <div class="tit">${t(key)}</div>
        <div class="gz">${labels[i] || '-'}</div>
      </div>
    `).join('');
    const box = $('bazi-pillars');
    if (box) box.innerHTML = html;
  }

  function renderTable(data){
    const keys = ['stem','branch','element','nayin'];
    KEYS.forEach((k,i)=>{
      keys.forEach(row=>{
        const cell = document.getElementById(`${k}-${row}`);
        if (cell) cell.textContent = (data[row] && data[row][i]) ? data[row][i] : '-';
      });
    });
  }

  function renderBars(pcts){
    const elems = ['æœ¨','ç«','åœŸ','é‡‘','æ°´'];
    elems.forEach(e=>{
      const pct = Math.max(0, Math.min(100, Math.round(pcts[e] || 0)));
      const bar = $('bar-'+e);
      const lab = $('pct-'+e);
      if (bar) bar.style.width = pct + '%';
      if (lab) lab.textContent = pct + '%';
    });
    const sorted = Object.entries(pcts).sort((a,b)=> b[1]-a[1]);
    const strongest = sorted[0]?.[0];
    const weakest   = sorted[sorted.length-1]?.[0];
    const tip = $('bazi-elements-balance');
    const dict = I18N[state.lang] || I18N['zh-CN'];
    const names = get(dict,'elemNames') || {};
    if (tip && strongest && weakest){
      tip.textContent = (t('ui.balance') || '')
        .replace('{strongest}', names[strongest] || strongest)
        .replace('{weakest}',   names[weakest]   || weakest);
    }
  }

  function buildProReportSections(){
    // 10 sections, brief but solid placeholders
    const sec = [
      ['å‘½ç›˜æ€»è§ˆ / Overview',
       'æ—¥ä¸»æ°”è´¨ã€å‘½å±€ç»“æ„ä¸å¼ºå¼±æ¦‚è§ˆï¼›çœ‹ä¸»å®¢è§‚èµ„æºä¸æ”¯æ’‘ä½ï¼Œç¡®è®¤å½“ä»¤äº”è¡Œä¸åè¡¡ç‚¹ã€‚'],
      ['äº”è¡Œèƒ½é‡åˆ†æ / Five-Element Balance',
       'å…ƒç´ æ¯”ä¾‹ä¸å†·çƒ­ç‡¥æ¹¿ï¼›ä¼˜å…ˆè°ƒå’Œçš„æ–¹å‘ï¼ˆè¡¥æ³„åˆ¶ï¼‰ï¼Œä»¥åŠé¢œè‰²/æ–¹ä½/ä½œæ¯çš„é…åˆå»ºè®®ã€‚'],
      ['åç¥é…ç½®åˆ†æ / Ten Gods',
       'ç”¨/å¿Œç¥æ‰€åœ¨æŸ±ä¸äº’åŠ¨ï¼›æ¯”åŠ«ã€é£Ÿä¼¤ã€è´¢å®˜å°çš„ååŒä¸å†²çªï¼Œåˆ¤æ–­å‘åŠ›è·¯å¾„ã€‚'],
      ['ç”¨ç¥å–œå¿Œ / Useful Spirit',
       'æœ¬å‘½ç”¨ç¥ä¼˜å…ˆçº§ï¼Œå¿Œç¥å›é¿ç­–ç•¥ï¼›ç°å®æ“ä½œï¼šä½œæ¯ã€ç¯å¢ƒã€ç¤¾äº¤ã€é¡¹ç›®é€‰æ‹©ã€‚'],
      ['äº‹ä¸šå‘å±• / Career',
       'è¡Œä¸šé€‚é…ä¸å²—ä½ä¾§é‡ï¼šåˆ›æ„è¾“å‡º/ç³»ç»Ÿç®¡ç†/å¯¹å®¢é”€å”®/æŠ€æœ¯é’»ç ”ï¼›ä¸Šå‡èŠ‚ç‚¹ä¸é¿å‘ç‚¹ã€‚'],
      ['è´¢è¿èµ°åŠ¿ / Wealth',
       'åæ­£è´¢è·¯å¾„ä¸ç°é‡‘æµèŠ‚å¥ï¼›æŠ•å…¥äº§å‡ºæ¯”ã€åˆä¼™/å•å¹²é€‰æ‹©ã€åº“å­˜/å¹¿å‘Šé¢„ç®—ç­–ç•¥ã€‚'],
      ['æ„Ÿæƒ…å©šå§» / Relationship',
       'ç›¸å¤„æ¨¡å¼ã€æ²Ÿé€šåº•å±‚é€»è¾‘ä¸é›·åŒºï¼›æ¨è¿›èŠ‚å¥ä¸å…³é”®çª—å£æœŸã€‚'],
      ['å¥åº·å…»ç”Ÿ / Health',
       'ä½“è´¨å€¾å‘ä¸è„è…‘æ•æ„Ÿç‚¹ï¼›ä½œæ¯é¥®é£Ÿä¸è¿åŠ¨å½¢æ€å»ºè®®ï¼ˆå¼ºåº¦ã€é¢‘ç‡ã€èŠ‚å¾‹ï¼‰ã€‚'],
      ['ç„å­¦ç¼˜åˆ† / Spiritual',
       'çµæ€§ç‰¹è´¨ã€æŠ¤æŒä½“ç³»ä¸åˆé€‚çš„ä¿®ä¹ å…¥å£ï¼ˆå†¥æƒ³/é™è§‚/ç¥ˆæ„¿/è¡ŒæŒï¼‰ã€‚'],
      ['è¿‘æœŸè¿åŠ¿ / Next 3â€“6 Months',
       'é˜¶æ®µç›®æ ‡ä¸è¡ŒåŠ¨æ¸…å•ï¼šç«‹é¡¹ã€æ”¶å°¾ã€ç–é€šä¸å¸ƒå±€ï¼›é¿å…åå¤çš„è§¦å‘å› ç´ ã€‚']
    ];
    return sec.map(([h, p])=>`
      <div class="butler-section">
        <h4>${h}</h4>
        <div class="detail-content">${p}</div>
      </div>
    `).join('');
  }

  function showResultContainers(){
    if ($('result')) $('result').style.display = 'block';
    if ($('butlerProfessional')){
      $('butlerProfessional').style.display = 'block';
      $('professionalReport').innerHTML = buildProReportSections();
    }
  }

  function initChat(){
    const send = $('chatSend');
    const input = $('chatInput');
    const box = $('chatMessages');
    if (!send || !input || !box) return;
    send.onclick = ()=>{
      const q = (input.value || '').trim();
      if (!q) return;
      const me = document.createElement('div');
      me.className = 'ss-msg';
      me.textContent = q;
      box.appendChild(me);
      input.value = '';
      const auto = document.createElement('div');
      auto.className = 'ss-msg';
      auto.textContent = (get(I18N[state.lang],'chatDyn.autoReply') || 'OK: {q}')
                          .replace('{q}', q);
      box.appendChild(auto);
      box.scrollTop = box.scrollHeight;
    };
  }

  /* =========================
   * DATA SHAPES & ADAPTERS
   * =========================
   * Expected API minimal shape (example):
   * {
   *   pillars: { labels: ['æˆŠåˆ','ç”²å¯…','ç”²å¯…','åºšåˆ'] },
   *   stem: ['æˆŠ','ç”²','ç”²','åºš'],
   *   branch: ['åˆ','å¯…','å¯…','åˆ'],
   *   element: ['åœŸ','æœ¨','æœ¨','åœŸ'],
   *   nayin: ['å¤©ä¸Šç«','å¤§æºªæ°´','å¤§æºªæ°´','å¤©ä¸Šç«'],
   *   elementsPct: { 'æœ¨':40,'ç«':20,'åœŸ':25,'é‡‘':10,'æ°´':5 }
   * }
   */
  function hydrateFromAPI(rsp){
    const pillars = rsp?.pillars?.labels || [
      (rsp.stem?.[0]||'-') + (rsp.branch?.[0]||''),
      (rsp.stem?.[1]||'-') + (rsp.branch?.[1]||''),
      (rsp.stem?.[2]||'-') + (rsp.branch?.[2]||''),
      (rsp.stem?.[3]||'-') + (rsp.branch?.[3]||'')
    ];
    renderPillars(pillars);
    renderTable({
      stem: rsp.stem || ['-','-','-','-'],
      branch: rsp.branch || ['-','-','-','-'],
      element: rsp.element || ['-','-','-','-'],
      nayin: rsp.nayin || ['-','-','-','-']
    });
    renderBars(rsp.elementsPct || {'æœ¨':0,'ç«':0,'åœŸ':0,'é‡‘':0,'æ°´':0});
    showResultContainers();
  }

  // Demo generator for immediate rendering (replace with your API later)
  function sampleDemo(birthdate, timeStr, timeUnknown){
    // A simple stable demo payload
    return {
      pillars: { labels: ['æˆŠåˆ','ç”²å¯…','ç”²å¯…','åºšåˆ'] },
      stem: ['æˆŠ','ç”²','ç”²','åºš'],
      branch: ['åˆ','å¯…','å¯…','åˆ'],
      element: ['åœŸ','æœ¨','æœ¨','åœŸ'],
      nayin: ['å¤©ä¸Šç«','å¤§æºªæ°´','å¤§æºªæ°´','å¤©ä¸Šç«'],
      elementsPct: { 'æœ¨': 40, 'ç«': 20, 'åœŸ': 25, 'é‡‘': 10, 'æ°´': 5 }
    };
  }

  /* =========================
   * API CALL (optional)
   * ========================= */
  async function postJSON(url, data){
    const ctrl = new AbortController();
    const t = setTimeout(()=> ctrl.abort(), CONFIG.TIMEOUT_MS);
    try{
      const res = await fetch(url, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(data),
        signal: ctrl.signal
      });
      if (!res.ok) throw new Error('HTTP '+res.status);
      return await res.json();
    } finally {
      clearTimeout(t);
    }
  }

  async function generateViaAPI(payload){
    if (!CONFIG.API_BASE) return null;
    // Try a couple of common endpoints; adapt to your backend.
    const endpoints = [
      '/bazi/quick',
      '/bazi/brief',
      '/bazi'
    ];
    for (const ep of endpoints){
      try{
        const rsp = await postJSON(CONFIG.API_BASE + ep, payload);
        if (rsp) return rsp;
      }catch(_e){ /* try next */ }
    }
    return null;
  }

  /* =========================
   * GENERATE HANDLER
   * ========================= */
  async function onGenerate(){
    const date = $('birthdate')?.value;
    const unknown = $('timeUnknown')?.checked;
    const timeVal = $('birthtime')?.value || '00:00';
    const cal = $('calendar')?.value || 'gregorian';
    const gender = $('gender')?.value || '';
    const name = $('name')?.value || '';

    if (!date){
      showErr(t('err.fillBirthdate') || 'Please enter your birth date');
      return;
    }

    setGenLoading(true);
    try{
      // summary line
      const [yy,mm,dd] = date.split('-');
      const timeText = unknown
        ? (t('ui.timeUnknown') || '')
        : (t('ui.hourSuffix') || '{h}:00').replace('{h}', (timeVal||'00:00').slice(0,2));
      const summaryTpl = t('ui.birthSummary') || 'Birth date: {y}-{m}-{d} {timeText}';
      const summary = summaryTpl.replace('{y}',yy).replace('{m}',mm).replace('{d}',dd).replace('{timeText}', timeText);
      if ($('bazi-date')) $('bazi-date').textContent = summary;

      // Prepare payload
      const payload = {
        name, gender, calendar: cal,
        birthdate: date,
        birthtime: unknown ? null : timeVal,
        timeUnknown: !!unknown,
        locale: state.lang
      };

      // Try API first (if provided), fallback to demo
      let data = null;
      try{
        data = await generateViaAPI(payload);
      }catch(_e){}
      if (!data) data = sampleDemo(date, timeVal, unknown);

      hydrateFromAPI(data);

      // hour-unknown tip
      if (unknown && $('professionalReport')){
        const tip = document.createElement('div');
        tip.className = 'ai-box';
        tip.innerHTML = `<div class="ai-box-h">TIP</div><div class="ai-box-c">${t('report.hourUnknownTip') || ''}</div>`;
        $('professionalReport').prepend(tip);
      }
    }catch(err){
      console.error(err);
      showErr(t('err.generateFail'));
    }finally{
      setGenLoading(false);
    }
  }

  /* =========================
   * INIT
   * ========================= */
  document.addEventListener('DOMContentLoaded', ()=>{
    // language
    const sel = $('langSelect');
    if (sel){
      sel.addEventListener('change', e=>{
        state.lang = e.target.value || 'zh-CN';
        localStorage.setItem('5x_lang', state.lang);
        applyI18n();
      });
    }
    // time unknown bind
    const timeUnknown = $('timeUnknown');
    if (timeUnknown){
      timeUnknown.addEventListener('change', e=>{
        const dis = !!e.target.checked;
        if ($('birthtime')) $('birthtime').disabled = dis;
      });
    }
    // generate
    const gen = $('genBtn');
    if (gen) gen.addEventListener('click', onGenerate);

    initChat();
    applyI18n();
  });

})();
</script>
</body>
</html>
