
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜ - å·²åŒ…å«å¿ƒæ€œç®¡å®¶æ ·å¼ */
    :root{
      --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
      --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
      --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%; margin:0; padding:0;}
    body{
      color:var(--text); background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat, linear-gradient(180deg,#0b0f14,#0b0f14);
      font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
    
    .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}
    
    /* å¤´éƒ¨æ ·å¼ */
    .site-header{
      position:sticky; top:0; z-index:10;
      background:#0b0f14cc;
      border-bottom:1px solid #0f1622;
      backdrop-filter:saturate(140%) blur(12px);
    }
    .head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
    .brand-badge{
      display:inline-grid; place-items:center;
      width:34px; height:34px; border-radius:8px;
      background:linear-gradient(180deg,#0e1520,#0b1018);
      border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35);
      font-weight:800; color:#ffe084;
    }
    .title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em; font-size:1.1rem}
    
    .lang{display:flex; align-items:center; gap:8px}
    .lang select{
      appearance:none; min-width:140px;
      border-radius:10px; border:1px solid #243244;
      background:#0e1520; color:var(--text);
      padding:10px 34px 10px 12px; font-size:.95rem;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
    }

    /* ä¸»è¦å†…å®¹åŒºåŸŸ */
    .section{margin-top:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
    .h2{font-size:1.2rem;margin:0 0 12px;font-weight:800;color:#ffe084;display:flex;gap:8px;align-items:center}
    .h2::before{content:"";width:4px;height:18px;background:var(--brand);border-radius:2px}

    .row{display:grid;gap:12px;grid-template-columns:1fr;}
    @media(min-width:760px){.row.cols-3{grid-template-columns:1fr 1fr 1fr}.row.cols-2{grid-template-columns:1fr 1fr}}

    input,select{
      width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;background:#0e1520;color:var(--text);
      padding:12px 12px;font-size:15px;outline:none;
    }
    input::placeholder{color:#6f8092}
    
    .btn{display:inline-grid;place-items:center;padding:12px 16px;border-radius:12px;border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;font-weight:800;cursor:pointer;transition:all 0.2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(230,199,110,.5)}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .btn.ghost{background:transparent;color:var(--gold2);border:1px solid rgba(212,175,55,.45);box-shadow:none}
    .btn.block{display:block;width:100%}

    /* å…«å­—æŸ±æ ·å¼ */
    .pillars{display:grid;grid-template-columns:repeat(4,1fr);gap:10px; margin-bottom:20px;}
    .pillar{background:#0f1624;border:1px solid #253245;border-radius:12px;padding:14px 10px;text-align:center}
    .pillar .tit{color:#9aa3b2;font-size:.85rem;margin-bottom:6px}
    .pillar .gz{font-size:1.5rem;font-weight:800;color:var(--gold2)}

    .bazi-table{width:100%;border-collapse:collapse;margin-top:12px;background:#0f1624;border-radius:8px;overflow:hidden}
    .bazi-table th,.bazi-table td{padding:10px 12px;border:1px solid #253245;text-align:center}
    .bazi-table th{background:rgba(212,175,55,.1);color:var(--gold2)}

    /* äº”è¡Œèƒ½é‡æ¡ */
    .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
    .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0; transition:width 0.5s ease}
    .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
    
    .error-message{background:rgba(255,90,95,.1);border:1px solid #ff5a5f;border-radius:8px;padding:10px;display:none; margin-top:10px;}
    .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
    .muted{color:var(--muted)}

    /* æ—¶é—´è¾“å…¥è¡Œ */
    .time-row{display:flex;align-items:center;gap:10px}
    .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
    .time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px;}

    /* ç”ŸæˆæŒ‰é’®åŒ…è£… */
    .gen-wrap{display:flex;align-items:flex-end;justify-content:flex-end}
    #genBtn{width:auto !important}

    /* è¯¦ç»†åˆ†æåŒºåŸŸ */
    .analysis-grid {display: grid; gap: 16px; margin-top: 20px;}
    .analysis-card {background: #0f1624; border: 1px solid #253245; border-radius: 12px; padding: 16px;}
    .analysis-card h3 {color: var(--gold2); margin: 0 0 12px 0; font-size: 1.1rem;}
    .analysis-content {line-height: 1.6;}
    .rating {display: flex; align-items: center; gap: 8px; margin: 8px 0;}
    .rating-stars {color: var(--gold2);}
    .tag {display: inline-block; background: rgba(212,175,55,.1); color: var(--gold2); padding: 4px 8px; border-radius: 6px; font-size: 0.85rem; margin: 2px;}
    
    /* å¤§è¿æµå¹´ */
    .luck-grid {display: grid; gap: 10px;}
    .luck-item {background: rgba(255,255,255,.05); border-radius: 8px; padding: 12px; border-left: 3px solid var(--gold2);}
    .luck-year {font-weight: bold; color: var(--gold2);}
    .luck-desc {font-size: 0.9rem; margin-top: 4px;}

    /* ä¼šå‘˜åŒºåŸŸ */
    .columns{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
    .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
    .list-block ul{margin:.2rem 0 0;padding-left:1.1rem}
    .group-title{font-size:1.05rem;color:#ffe084;margin:6px 0 14px}
    
    /* VIPç™»å½•åŒºåŸŸ */
    .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
    .panel .body{padding:18px}
    .spacer{height:12px}
    
    /* AIç®¡å®¶æ ·å¼ */
    .ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0;}
    .ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px;}
    .ai-box-c{color:#e8edf3; line-height:1.7;}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #2a3546;background:#0e1520;color:#e8edf3;cursor:pointer; transition:all 0.2s ease}
    .chip:hover{border-color:#f2d27a;box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
    .chip:disabled{opacity:.6; cursor:not-allowed}
    
    .skeleton{display:grid;gap:8px}
    .skeleton div{height:12px;border-radius:6px;background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);animation:sh 1.2s infinite}
    @keyframes sh{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
    
    .ai-lock-overlay{margin-top:10px;padding-top:10px;border-top:1px solid #1f2a36;text-align:center}
    .ai-lock-overlay .tip{color:#ffd88a;font-weight:700;margin-bottom:4px}
    .ai-lock-overlay .sub{color:var(--muted)}
    
    /* è¯¦ç»†åˆ†æé¡µé¢æ ·å¼ */
    .detail-view {display: none;}
    .detail-header {display: flex; align-items: center; gap: 12px; margin-bottom: 20px;}
    .back-btn {background: rgba(212,175,55,.1); border: 1px solid rgba(212,175,55,.3); color: var(--gold2); padding: 8px 16px; border-radius: 8px; cursor: pointer;}
    .detail-content {line-height: 1.8;}
    .detail-section {margin-bottom: 24px;}
    .detail-section h4 {color: var(--gold2); margin-bottom: 12px; font-size: 1.1rem;}
    .action-list {list-style: none; padding: 0;}
    .action-list li {margin-bottom: 8px; padding-left: 20px; position: relative;}
    .action-list li:before {content: "â€¢"; color: var(--gold2); position: absolute; left: 0;}
    
    /* èŠå¤©æµ®çª— - ç§»é™¤ç›¸å…³æ ·å¼ */
    
    footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0; margin-top:40px;}
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width:520px){
      .title{font-size:1rem}
      .lang select{min-width:120px}
      .pillars{grid-template-columns:repeat(2,1fr);}
      .analysis-grid {grid-template-columns: 1fr;}
    }
    
    .sr-only{
       position:absolute !important;
       width:1px;height:1px;padding:0;margin:-1px;
       overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }

    /* æ·»åŠ åˆ°CSSä¸­ */
    .chips-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 20px 0;
      justify-content: center;
    }

    /* åœ¨CSSéƒ¨åˆ†æ·»åŠ VIPåŒºåŸŸçš„ç‰¹æ®Šç±» */
     .vip-section {
      display: block !important; /* ç¡®ä¿VIPåŒºåŸŸå§‹ç»ˆæ˜¾ç¤º */
    }
        
    /* å¿ƒæ€œç®¡å®¶ä¸“ä¸šçª—å£ */
    .butler-professional {
        display: none;
        margin-top: 20px;
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        padding: 20px;
    }
    
    .butler-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        color: var(--gold2);
        font-size: 1.2rem;
        font-weight: bold;
    }
    
    .butler-content {
        line-height: 1.8;
        max-height: 600px;
        overflow-y: auto;
        padding: 15px;
        background: #0f1624;
        border-radius: 10px;
        border: 1px solid #253245;
    }
    
    .butler-section {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #253245;
    }
    
    .butler-section h4 {
        color: var(--gold2);
        margin-bottom: 10px;
        font-size: 1.1rem;
    }
    
    /* å¯¹è¯ç•Œé¢ */
    .butler-chat {
        margin-top: 20px;
        border-top: 1px solid var(--line);
        padding-top: 15px;
    }
    
    .chat-messages {
        height: 200px;
        overflow-y: auto;
        margin-bottom: 15px;
        padding: 10px;
        background: #0f1624;
        border-radius: 8px;
        border: 1px solid #253245;
    }
    
    .chat-input-area {
        display: flex;
        gap: 10px;
    }
    
    .chat-input-area input {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #253245;
        background: #0e1520;
        color: var(--text);
    }
    
    .chat-send-btn {
        padding: 10px 20px;
        background: var(--gold);
        color: #191919;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }

    /* ç§»é™¤èŠå¤©æµ®çª—ç›¸å…³æ ·å¼ */
  </style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <a class="brand" href="#" target="_self">
      <span class="brand-badge">5X</span>
      <span class="title">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="th">à¹„à¸—à¸¢</option>
        <option value="ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <!-- 1. å…«å­—æ’ç›˜è¡¨å• -->
  <section class="card">
    <div class="h2">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted">æ€§åˆ«</label>
        <select id="gender">
          <option value="">ä¸é€éœ²</option>
          <option value="male">ç”·æ€§</option>
          <option value="female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian">é˜³å†</option>
          <option value="lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span>å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

  <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
  <section id="result" style="display:none;">
    <div class="card">
      <div class="h2">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>

      <table class="bazi-table">
        <thead><tr><th></th><th>å¹´æŸ±</th><th>æœˆæŸ±</th><th>æ—¥æŸ±</th><th>æ—¶æŸ±</th></tr></thead>
        <tbody>
          <tr><td>å¤©å¹²</td><td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td></tr>
          <tr><td>åœ°æ”¯</td><td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td></tr>
          <tr><td>äº”è¡Œ</td><td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td></tr>
          <tr><td>çº³éŸ³</td><td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span>æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span>ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span>åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span>é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span>æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- 2. å¿ƒæ€œç®¡å®¶ä¸“ä¸šçª—å£ -->
  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span>ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    
    <div class="butler-content" id="professionalReport">
      <!-- AIç”Ÿæˆçš„ä¸“ä¸šæŠ¥å‘Šå°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
    </div>
    
    <div class="butler-chat">
      <div class="chat-messages" id="chatMessages">
        <div class="ss-msg">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
        <button class="chat-send-btn" id="chatSend">å‘é€</button>
      </div>
    </div>
  </section>

  <!-- 3. ä¼šå‘˜åŒºåŸŸ -->
  <section class="card section vip-section">
    <h2 class="group-title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li>å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li>äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li>è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li>å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li>çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li>å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li>å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li>æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <!-- VIPç™»å½•åŒºåŸŸ -->
    <div class="group-title" style="margin-top:14px">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <!-- å·¦ä¾§ï¼šè¾“å…¥ + æ³¨å†Œ/ç™»å½• -->
        <div class="panel">
          <div class="head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email" required />
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" required />
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <!-- å³ä¾§ï¼šä¼šå‘˜ä¸è¿”å› -->
        <div class="panel">
          <div class="head">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>

<script>        
// å…«å­—è®¡ç®—å™¨ç±»
class BaziCalculator{
  constructor(){
    this.HEAVENLY_STEMS=['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    this.EARTHLY_BRANCHES=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
    this.ZODIAC=['é¼ ','ç‰›','è™','å…”','é¾™','è›‡','é©¬','ç¾Š','çŒ´','é¸¡','ç‹—','çŒª'];
    this.NAYIN=['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
  }
  
  calculateYearPillar(year){ 
    const s=(year-4)%10, b=(year-4)%12; 
    return {
      stem: this.HEAVENLY_STEMS[(s+10)%10],
      branch: this.EARTHLY_BRANCHES[(b+12)%12],
      zodiac: this.ZODIAC[(b+12)%12]
    }; 
  }
  
  solarMonthIndex(y,m,d){ 
    const mmdd=m*100+d; 
    const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]]; 
    let idx=11; 
    for(const [thr,val] of gates) if(mmdd>=thr) idx=val; 
    const branchBy={1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'}; 
    return {index:idx, branch:branchBy[idx]}; 
  }
  
  calculateMonthPillar(year,month,day){ 
    const {index,branch}=this.solarMonthIndex(year,month,day); 
    const yStemIdx=this.HEAVENLY_STEMS.indexOf(this.calculateYearPillar(year).stem); 
    const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0}; 
    const stemIdx=(startMap[yStemIdx]+(index-1))%10; 
    return {stem:this.HEAVENLY_STEMS[stemIdx], branch}; 
  }
  
  calculateDayPillar(year,month,day){ 
    const baseUTC=Date.UTC(1900,0,31); 
    const targetUTC=Date.UTC(year,month-1,day); 
    const dayDiff=Math.floor((targetUTC-baseUTC)/86400000); 
    const stemIdx=(0+dayDiff)%10; 
    const branchIdx=(4+dayDiff)%12; 
    return {
      stem: this.HEAVENLY_STEMS[(stemIdx+10)%10],
      branch: this.EARTHLY_BRANCHES[(branchIdx+12)%12]
    }; 
  }
  
  calculateHourPillar(dayStem,hour){ 
    const branchMap={23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'}; 
    const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8}; 
    const dayIdx=this.HEAVENLY_STEMS.indexOf(dayStem); 
    const hourIndex=Math.floor((hour+1)/2)%12; 
    const stemIdx=(startMap[dayIdx]+hourIndex)%10; 
    return {
      stem: this.HEAVENLY_STEMS[stemIdx],
      branch: branchMap[hour]
    }; 
  }
  
  getElement(stem,branch){ 
    const s={ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'}; 
    const b={å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'}; 
    return `${s[stem]}${b[branch]}`; 
  }
  
  getNayin(stem,branch){ 
    const si=this.HEAVENLY_STEMS.indexOf(stem), bi=this.EARTHLY_BRANCHES.indexOf(branch); 
    return this.NAYIN[(si*2+bi)%this.NAYIN.length]; 
  }
  
  getStemElement(stem){ 
    return ({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'})[stem]; 
  }
  
  getBranchElement(branch){ 
    return ({å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'})[branch]; 
  }
  
  calculateBazi(year,month,day,hour=12,timeUnknown=false){
    const yearP=this.calculateYearPillar(year), 
          monthP=this.calculateMonthPillar(year,month,day), 
          dayP=this.calculateDayPillar(year,month,day);
    const hourP=timeUnknown?{stem:'ï¼Ÿ',branch:'ï¼Ÿ'}:this.calculateHourPillar(dayP.stem,hour);
    const dayElement=this.getStemElement(dayP.stem);
    const pillars={year:yearP,month:monthP,day:{...dayP,element:dayElement},hour:hourP};
    const cnt={æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    
    (timeUnknown?[yearP,monthP,dayP]:[yearP,monthP,dayP,hourP]).forEach(p=>{ 
      if(p.stem&&p.stem!=='ï¼Ÿ') cnt[this.getStemElement(p.stem)]+=1; 
      if(p.branch&&p.branch!=='ï¼Ÿ') cnt[this.getBranchElement(p.branch)]+=1; 
    });
    
    const total=Object.values(cnt).reduce((a,b)=>a+b,0)||1;
    const pct={
      wood: cnt['æœ¨']/total*100,
      fire: cnt['ç«']/total*100,
      earth: cnt['åœŸ']/total*100, 
      metal: cnt['é‡‘']/total*100,
      water: cnt['æ°´']/total*100
    };
    
    return {pillars, counts:cnt, percents:pct, timeUnknown};
  }
}

const baziCalculator = new BaziCalculator();

// å·¥å…·å‡½æ•°
const $ = id => document.getElementById(id);

function showError(message) {
  const errorEl = $('error');
  if (errorEl) {
    errorEl.textContent = message;
    errorEl.style.display = 'block';
    setTimeout(() => {
      errorEl.style.display = 'none';
    }, 5000);
  }
}

function showAuthErr(message) {
  const errorEl = $('authError');
  if (errorEl) {
    errorEl.textContent = message;
    errorEl.style.display = 'block';
    setTimeout(() => {
      errorEl.style.display = 'none';
    }, 5000);
  }
}

function hideAuthErr() {
  const errorEl = $('authError');
  if (errorEl) {
    errorEl.style.display = 'none';
    errorEl.textContent = '';
  }
}

function lock(el, v) { if(el) el.disabled = v; }

function setText(id, text) {
  const el = $(id);
  if (el) el.textContent = text;
}

function setBar(elementId, percentage) {
  const bar = $(elementId);
  if (bar) {
    setTimeout(() => {
      bar.style.width = Math.max(0, Math.min(100, percentage)) + '%';
    }, 100);
  }
}

// æ¸²æŸ“å…«å­—æŸ±
function renderPillars(pillars, timeUnknown = false) {
  const container = $('bazi-pillars');
  if (!container) return;

  container.innerHTML = '';
  
  const pillarData = [
    { title: 'å¹´æŸ±', pillar: pillars.year },
    { title: 'æœˆæŸ±', pillar: pillars.month },
    { title: 'æ—¥æŸ±', pillar: pillars.day },
    { title: 'æ—¶æŸ±', pillar: pillars.hour }
  ];

  pillarData.forEach(({ title, pillar }) => {
    const isUnknown = (title === 'æ—¶æŸ±' && timeUnknown);
    const div = document.createElement('div');
    div.className = 'pillar';
    div.innerHTML = `
      <div class="tit">${title}</div>
      <div class="gz">${isUnknown ? 'ï¼Ÿ' : pillar.stem}${isUnknown ? 'ï¼Ÿ' : pillar.branch}</div>
    `;
    container.appendChild(div);
  });
}

// æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯è¡¨æ ¼
function displayDetailedInfo(pillars, timeUnknown = false) {
  // å¤©å¹²åœ°æ”¯
  setText('year-stem', pillars.year.stem);
  setText('year-branch', pillars.year.branch);
  setText('month-stem', pillars.month.stem);
  setText('month-branch', pillars.month.branch);
  setText('day-stem', pillars.day.stem);
  setText('day-branch', pillars.day.branch);
  setText('hour-stem', timeUnknown ? 'ï¼Ÿ' : pillars.hour.stem);
  setText('hour-branch', timeUnknown ? 'ï¼Ÿ' : pillars.hour.branch);

  // äº”è¡Œ
  setText('year-element', baziCalculator.getElement(pillars.year.stem, pillars.year.branch));
  setText('month-element', baziCalculator.getElement(pillars.month.stem, pillars.month.branch));
  setText('day-element', baziCalculator.getElement(pillars.day.stem, pillars.day.branch));
  setText('hour-element', timeUnknown ? 'æœªçŸ¥' : baziCalculator.getElement(pillars.hour.stem, pillars.hour.branch));

  // çº³éŸ³
  setText('year-nayin', baziCalculator.getNayin(pillars.year.stem, pillars.year.branch));
  setText('month-nayin', baziCalculator.getNayin(pillars.month.stem, pillars.month.branch));
  setText('day-nayin', baziCalculator.getNayin(pillars.day.stem, pillars.day.branch));
  setText('hour-nayin', timeUnknown ? 'æœªçŸ¥' : baziCalculator.getNayin(pillars.hour.stem, pillars.hour.branch));
}

// ä¸“ä¸šæŠ¥å‘Šç”Ÿæˆå‡½æ•°
// ä¸“ä¸šæŠ¥å‘Šç”Ÿæˆå‡½æ•° - æ ¹æ®å®é™…å…«å­—åŠ¨æ€åˆ†æ
async function generateProfessionalReport(baziData) {
    const pillars = baziData.pillars;
    const counts = baziData.counts;
    const gender = baziData.gender || 'æœªé€éœ²';
    
    const baziString = `${pillars.year.stem}${pillars.year.branch} ${pillars.month.stem}${pillars.month.branch} ${pillars.day.stem}${pillars.day.branch} ${pillars.hour.stem}${pillars.hour.branch}`;
    
    // åŸºäºå®é™…å…«å­—æ•°æ®åŠ¨æ€åˆ†æ
    const dayStem = pillars.day.stem;
    const dayElement = pillars.day.element;
    const monthBranch = pillars.month.branch;
    
    // åŠ¨æ€åˆ†ææ ¼å±€
    const patterns = analyzePatterns(pillars, counts);
    const tenGodsAnalysis = analyzeTenGods(pillars);
    const usefulGods = analyzeUsefulGods(pillars, counts);
    const careerAnalysis = analyzeCareer(pillars, counts, gender);
    const wealthAnalysis = analyzeWealth(pillars, counts);
    const loveAnalysis = analyzeLove(pillars, counts, gender);
    const spiritualAnalysis = analyzeSpiritual(pillars);
    const yearlyAnalysis = analyzeNext3Years(pillars);
    
    return `
        <div class="butler-section">
            <h4>ğŸ”® ä¸€ã€æ ¼å±€å±‚æ¬¡</h4>
            <p><strong>å…«å­—ï¼š</strong>${baziString}</p>
            <p><strong>æ—¥ä¸»ï¼š</strong>${dayStem}${dayElement}</p>
            <p><strong>äº”è¡Œåˆ†å¸ƒï¼š</strong>æœ¨${counts.æœ¨}% ç«${counts.ç«}% åœŸ${counts.åœŸ}% é‡‘${counts.é‡‘}% æ°´${counts.æ°´}%</p>
            <p><strong>ä¸»è¦æ ¼å±€ï¼š</strong></p>
            <ul>
                ${patterns.map(pattern => `<li><strong>${pattern.name}</strong> - ${pattern.description}</li>`).join('')}
            </ul>
            <p><strong>æ ¼å±€ç­‰çº§ï¼š</strong>${patterns[0]?.level || 'éœ€è¯¦ç»†åˆ†æ'}</p>
        </div>

        <div class="butler-section">
            <h4>âš”ï¸ äºŒã€åç¥é…ç½®åˆ†æ</h4>
            ${tenGodsAnalysis}
        </div>

        <div class="butler-section">
            <h4>ğŸ’ ä¸‰ã€ç”¨ç¥å–œå¿Œ</h4>
            ${usefulGods}
        </div>

        <div class="butler-section">
            <h4>ğŸ¯ å››ã€äº‹ä¸šå‘å±•</h4>
            ${careerAnalysis}
        </div>

        <div class="butler-section">
            <h4>ğŸ’° äº”ã€è´¢è¿åˆ†æ</h4>
            ${wealthAnalysis}
        </div>

        <div class="butler-section">
            <h4>â¤ï¸ å…­ã€çˆ±æƒ…åˆ†æ</h4>
            ${loveAnalysis}
        </div>

        <div class="butler-section">
            <h4>ğŸ”® ä¸ƒã€ç„å­¦ç¼˜åˆ†</h4>
            ${spiritualAnalysis}
        </div>

        <div class="butler-section">
            <h4>ğŸ“… å…«ã€æµå¹´è¯¦æ‰¹ï¼ˆæœªæ¥3å¹´ï¼‰</h4>
            ${yearlyAnalysis}
        </div>
    `;
}

// åŠ¨æ€æ ¼å±€åˆ†æå‡½æ•°
function analyzePatterns(pillars, counts) {
    const patterns = [];
    const dayStem = pillars.day.stem;
    const monthBranch = pillars.month.branch;
    
    // å»ºç¦„æ ¼åˆ¤æ–­
    const jianLuBranches = {
        'ç”²': 'å¯…', 'ä¹™': 'å¯', 'ä¸™': 'å·³', 'ä¸': 'åˆ', 'æˆŠ': 'å·³',
        'å·±': 'åˆ', 'åºš': 'ç”³', 'è¾›': 'é…‰', 'å£¬': 'äº¥', 'ç™¸': 'å­'
    };
    
    if (monthBranch === jianLuBranches[dayStem]) {
        patterns.push({
            name: 'å»ºç¦„æ ¼',
            level: 'å¼ºæ ¼',
            description: 'æ—¥ä¸»å¾—æœˆä»¤ï¼Œæ ¹åŸºæ·±åšï¼Œè‡ªå¼ºä¸æ¯'
        });
    }
    
    // æœ¨ç«é€šæ˜æ ¼åˆ¤æ–­
    if ((counts.æœ¨ >= 25 && counts.ç« >= 25) && (dayStem === 'ç”²' || dayStem === 'ä¹™' || dayStem === 'ä¸™' || dayStem === 'ä¸')) {
        patterns.push({
            name: 'æœ¨ç«é€šæ˜æ ¼',
            level: 'è´µæ ¼',
            description: 'æœ¨ç«ç›¸ç”Ÿï¼Œæ–‡æ˜ä¹‹è±¡ï¼Œæ–‡é‡‡å‡ºä¼—'
        });
    }
    
    // ä»å¼ºæ ¼åˆ¤æ–­
    if (counts[getElementFromStem(dayStem)] >= 40) {
        patterns.push({
            name: 'ä»å¼ºæ ¼',
            level: 'ç‰¹æ®Šæ ¼å±€',
            description: 'æ—¥ä¸»ææ—ºï¼Œé¡ºåŠ¿è€Œä¸º'
        });
    }
    
    // è´¢å®˜åŒç¾åˆ¤æ–­
    const wealthGods = countWealthGods(pillars, dayStem);
    const officerGods = countOfficerGods(pillars, dayStem);
    if (wealthGods >= 1 && officerGods >= 1) {
        patterns.push({
            name: 'è´¢å®˜åŒç¾',
            level: 'ä½³æ ¼',
            description: 'è´¢è¿ä¸äº‹ä¸šè¿ä¿±ä½³'
        });
    }
    
    return patterns.length > 0 ? patterns : [{
        name: 'æ™®é€šæ ¼å±€',
        level: 'éœ€è¯¦ç»†åˆ†æ',
        description: 'æ ¼å±€ç»„åˆè¾ƒä¸ºå¹³è¡¡'
    }];
}

// åç¥åˆ†æå‡½æ•°
function analyzeTenGods(pillars) {
    const tenGodsMap = {
        'ç”²': { 'ç”²':'æ¯”è‚©', 'ä¹™':'åŠ«è´¢', 'ä¸™':'é£Ÿç¥', 'ä¸':'ä¼¤å®˜', 'æˆŠ':'åè´¢', 'å·±':'æ­£è´¢', 'åºš':'ä¸ƒæ€', 'è¾›':'æ­£å®˜', 'å£¬':'åå°', 'ç™¸':'æ­£å°' },
        'ä¹™': { 'ç”²':'åŠ«è´¢', 'ä¹™':'æ¯”è‚©', 'ä¸™':'ä¼¤å®˜', 'ä¸':'é£Ÿç¥', 'æˆŠ':'æ­£è´¢', 'å·±':'åè´¢', 'åºš':'æ­£å®˜', 'è¾›':'ä¸ƒæ€', 'å£¬':'æ­£å°', 'ç™¸':'åå°' },
        // å…¶ä»–å¤©å¹²çš„åç¥æ˜ å°„...
    };
    
    const dayStem = pillars.day.stem;
    let analysis = '';
    
    // å¹´æŸ±åç¥
    const yearGod = tenGodsMap[dayStem]?.[pillars.year.stem] || 'æœªçŸ¥';
    analysis += `<p><strong>å¹´æŸ±ï¼š</strong>${yearGod}å${getBranchElement(pillars.year.branch)} - ${getTenGodDescription(yearGod, 'å¹´')}</p>`;
    
    // æœˆæŸ±åç¥
    const monthGod = tenGodsMap[dayStem]?.[pillars.month.stem] || 'æœªçŸ¥';
    analysis += `<p><strong>æœˆæŸ±ï¼š</strong>${monthGod}å${getBranchElement(pillars.month.branch)} - ${getTenGodDescription(monthGod, 'æœˆ')}</p>`;
    
    // æ—¥æŸ±åç¥ï¼ˆæ—¥ä¸»ï¼‰
    analysis += `<p><strong>æ—¥æŸ±ï¼š</strong>${dayStem}${getElementFromStem(dayStem)}æ—¥ä¸»å${getBranchElement(pillars.day.branch)} - è‡ªæˆ‘è®¤çŸ¥ä¸æ ¹åŸº</p>`;
    
    // æ—¶æŸ±åç¥
    const hourGod = tenGodsMap[dayStem]?.[pillars.hour.stem] || 'æœªçŸ¥';
    analysis += `<p><strong>æ—¶æŸ±ï¼š</strong>${hourGod}å${getBranchElement(pillars.hour.branch)} - ${getTenGodDescription(hourGod, 'æ—¶')}</p>`;
    
    return analysis;
}

// ç”¨ç¥åˆ†æå‡½æ•°
function analyzeUsefulGods(pillars, counts) {
    const dayStem = pillars.day.stem;
    const dayElement = getElementFromStem(dayStem);
    
    // ç®€å•çš„èº«å¼ºèº«å¼±åˆ¤æ–­
    const totalElements = Object.values(counts).reduce((a, b) => a + b, 0);
    const selfStrength = counts[dayElement] / totalElements * 100;
    
    let bodyStrength, usefulGods, avoidGods;
    
    if (selfStrength >= 30) {
        bodyStrength = 'èº«å¼º';
        usefulGods = getControllingElements(dayElement); // å…‹æ³„è€—
        avoidGods = getSupportingElements(dayElement);   // ç”Ÿæ‰¶
    } else {
        bodyStrength = 'èº«å¼±';
        usefulGods = getSupportingElements(dayElement);  // ç”Ÿæ‰¶
        avoidGods = getControllingElements(dayElement);  // å…‹æ³„è€—
    }
    
    return `
        <p><strong>èº«å¼ºåˆ†æï¼š</strong>${bodyStrength}ï¼Œ${dayStem}${dayElement}æ—¥ä¸»å æ¯”${Math.round(selfStrength)}%</p>
        <p><strong>å–œç”¨ç¥ï¼š</strong>${usefulGods.join('ã€')}</p>
        <p><strong>å¿Œç¥ï¼š</strong>${avoidGods.join('ã€')}</p>
        <p><strong>è°ƒå€™å»ºè®®ï¼š</strong>${getSeasonalAdvice(pillars.month.branch, dayElement)}</p>
    `;
}

// è¾…åŠ©å‡½æ•°
function getElementFromStem(stem) {
    const stemElements = {
        'ç”²':'æœ¨', 'ä¹™':'æœ¨', 'ä¸™':'ç«', 'ä¸':'ç«', 'æˆŠ':'åœŸ', 
        'å·±':'åœŸ', 'åºš':'é‡‘', 'è¾›':'é‡‘', 'å£¬':'æ°´', 'ç™¸':'æ°´'
    };
    return stemElements[stem] || 'æœªçŸ¥';
}

function getBranchElement(branch) {
    const branchElements = {
        'å­':'æ°´', 'ä¸‘':'åœŸ', 'å¯…':'æœ¨', 'å¯':'æœ¨', 'è¾°':'åœŸ',
        'å·³':'ç«', 'åˆ':'ç«', 'æœª':'åœŸ', 'ç”³':'é‡‘', 'é…‰':'é‡‘', 
        'æˆŒ':'åœŸ', 'äº¥':'æ°´'
    };
    return branchElements[branch] || 'æœªçŸ¥';
}

function getSupportingElements(element) {
    const supportive = {
        'æœ¨': ['æ°´', 'æœ¨'], // æ°´ç”Ÿæœ¨ï¼Œæœ¨åŠ©æœ¨
        'ç«': ['æœ¨', 'ç«'], // æœ¨ç”Ÿç«ï¼Œç«åŠ©ç«
        'åœŸ': ['ç«', 'åœŸ'], // ç«ç”ŸåœŸï¼ŒåœŸåŠ©åœŸ
        'é‡‘': ['åœŸ', 'é‡‘'], // åœŸç”Ÿé‡‘ï¼Œé‡‘åŠ©é‡‘
        'æ°´': ['é‡‘', 'æ°´']  // é‡‘ç”Ÿæ°´ï¼Œæ°´åŠ©æ°´
    };
    return supportive[element] || [];
}

function getControllingElements(element) {
    const controlling = {
        'æœ¨': ['é‡‘', 'ç«', 'åœŸ'], // é‡‘å…‹æœ¨ï¼Œç«æ³„æœ¨ï¼Œæœ¨å…‹åœŸ
        'ç«': ['æ°´', 'åœŸ', 'é‡‘'], // æ°´å…‹ç«ï¼ŒåœŸæ³„ç«ï¼Œç«å…‹é‡‘
        'åœŸ': ['æœ¨', 'é‡‘', 'æ°´'], // æœ¨å…‹åœŸï¼Œé‡‘æ³„åœŸï¼ŒåœŸå…‹æ°´
        'é‡‘': ['ç«', 'æ°´', 'æœ¨'], // ç«å…‹é‡‘ï¼Œæ°´æ³„é‡‘ï¼Œé‡‘å…‹æœ¨
        'æ°´': ['åœŸ', 'æœ¨', 'ç«']  // åœŸå…‹æ°´ï¼Œæœ¨æ³„æ°´ï¼Œæ°´å…‹ç«
    };
    return controlling[element] || [];
}

// å…¶ä»–åˆ†æå‡½æ•°ï¼ˆäº‹ä¸šã€è´¢è¿ã€çˆ±æƒ…ç­‰ï¼‰éœ€è¦ç±»ä¼¼åœ°æ ¹æ®å®é™…å…«å­—æ•°æ®åŠ¨æ€ç”Ÿæˆ
function analyzeCareer(pillars, counts, gender) {
    // åŸºäºå…«å­—æ•°æ®åŠ¨æ€ç”Ÿæˆäº‹ä¸šåˆ†æ
    const dayElement = getElementFromStem(pillars.day.stem);
    const suitableCareers = getSuitableCareers(dayElement, counts);
    
    return `
        <p><strong>æœ€ä½³é¢†åŸŸï¼š</strong></p>
        <ul>
            ${suitableCareers.map(career => `<li><strong>${career.field}</strong> - ${career.reason}</li>`).join('')}
        </ul>
        <p><strong>å‘å±•å»ºè®®ï¼š</strong>${getCareerAdvice(pillars, counts)}</p>
    `;
}

// ç±»ä¼¼çš„ï¼Œéœ€è¦å®ç° analyzeWealth, analyzeLove, analyzeSpiritual, analyzeNext3Years ç­‰å‡½æ•°

// åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
function initButlerChat() {
    const chatSend = document.getElementById('chatSend');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');
    
    if (!chatSend || !chatInput) return;
    
    chatSend.addEventListener('click', sendChatMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChatMessage();
    });
    
    function sendChatMessage() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        const userMsg = document.createElement('div');
        userMsg.className = 'ss-msg me';
        userMsg.textContent = message;
        chatMessages.appendChild(userMsg);
        
        chatInput.value = '';
        
        // æ¨¡æ‹ŸAIå›å¤
        setTimeout(() => {
            const aiMsg = document.createElement('div');
            aiMsg.className = 'ss-msg';
            aiMsg.textContent = 'è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œè®©æˆ‘ç»“åˆæ‚¨çš„å‘½ç›˜ä¸ºæ‚¨è¯¦ç»†åˆ†æ...';
            chatMessages.appendChild(aiMsg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 1000);
    }
}

// é¡µé¢åŠ è½½åˆå§‹åŒ–
function init() {
    // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
    const birthdateInput = $('birthdate');
    if (birthdateInput) {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        birthdateInput.value = `${year}-${month}-${day}`;
    }

    // è®¾ç½®é»˜è®¤æ—¶é—´ä¸ºå½“å‰æ—¶é—´
    const birthtimeInput = $('birthtime');
    if (birthtimeInput) {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        birthtimeInput.value = `${hours}:${minutes}`;
    }

    // ç»‘å®šäº‹ä»¶
    const genBtn = $('genBtn');
    if (genBtn) {
        genBtn.addEventListener('click', generateBaziChart);
    }

    // åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
    initButlerChat();

    // åˆå§‹åŒ–æ—¶é—´æœªçŸ¥åŠŸèƒ½
    const timeUnknown = $('timeUnknown');
    const birthtime = $('birthtime');
    if (timeUnknown && birthtime) {
        timeUnknown.addEventListener('change', () => {
            birthtime.disabled = timeUnknown.checked;
            if (timeUnknown.checked) {
                birthtime.value = '';
            }
        });
    }

    console.log('å…«å­—å‘½ç†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
</script>
</body>
</html>
