<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="icon" href="data:,">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ä¿æŒä½ çš„åŸæœ‰æ ·å¼ï¼Œå¹¶ä¿®å¤/è¡¥å…¨å°‘é‡ç»†èŠ‚ */
:root{
  --bg:#0b0f14;
  --bg-accent:#0e1520; 
  --card:#11161dcc;
  --surface:#0f1624;
  --line:#1f2a36;
  --text:#e8edf3;
  --muted:#98a7b7;

  --brand:#d4af37;
  --gold:#d4af37;
  --gold2:#f2d27a;
  --accent:#58b9ff;

  --radius:14px;
  --radius-sm:10px;
  --radius-lg:18px;

  --shadow:0 8px 30px rgba(0,0,0,.35);
  --shadow-sm:0 4px 14px rgba(0,0,0,.28);

  --container:1100px;
  --gap:12px;
  --pad:18px;

  /* ä¿®å¤ï¼šæ·»åŠ æ­£ç¡®çš„focuså˜é‡ */
  --focus: 0 0 0 2px rgba(212,175,55,0.2);

  /* ä»…ä¾›æ³¨é‡Šè¯´æ˜ï¼šåª’ä½“æŸ¥è¯¢ä»ç”¨å›ºå®šæ•°å€¼å†™ */
  --bp-s:520px;
  --bp-m:760px;
  --bp-l:900px;
}

/* Reset + base */
*,
*::before,
*::after{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:0;
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
    linear-gradient(180deg, #0b0f14, #0b0f14);
  font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect width="100" height="100" fill="%23d4af37"/></svg>') center/cover no-repeat;
  filter:brightness(0.45) saturate(0.9) blur(2px);
}

.container{max-width:var(--container); margin:0 auto; padding:24px 16px 80px}

.site-header{
  position:sticky; top:0; z-index:10;
  background:rgba(11,15,20,.8);
  border-bottom:1px solid #0f1622;
  backdrop-filter:saturate(140%) blur(12px);
}
.head-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:14px 16px}

.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{
  display:inline-grid; place-items:center;
  width:34px; height:34px; border-radius:8px;
  background:linear-gradient(180deg,#0e1520,#0b1018);
  border:1px solid #2a3546; box-shadow:var(--shadow-sm);
  font-weight:800; color:#ffe084
}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:0.02em; font-size:1.1rem}

.lang{display:flex; align-items:center; gap:8px}
.lang select{
  appearance:none; min-width:140px;
  border-radius:10px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:10px 34px 10px 12px; font-size:0.95rem;
  background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:calc(100% - 12px) 50%;
}

.section{margin-top:18px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  padding:var(--pad);
  margin:16px 0;
}
.h2{
  font-size:1.2rem; margin:0 0 12px 0; font-weight:800; color:#ffe084;
  display:flex; gap:8px; align-items:center
}
.h2::before{content:""; width:4px; height:18px; background:var(--brand); border-radius:2px}

.row{display:grid; gap:var(--gap); grid-template-columns:1fr}
@media (min-width: 760px){
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .row.cols-2{grid-template-columns:1fr 1fr}
}

input,select{
  width:100%;
  border-radius:12px; border:1px solid #243244;
  background:var(--bg-accent); color:var(--text);
  padding:12px 12px; font-size:15px; outline:0;
}
input::placeholder{color:#6f8092}
input:focus, select:focus{box-shadow:var(--focus); border-color:#3a4c63}

.btn{
  display:inline-grid; place-items:center;
  padding:12px 16px; border-radius:12px;
  border:1px solid #e6c76e;
  background:linear-gradient(180deg,#fff9e6,#e6c76e);
  color:#191919; font-weight:800; cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(230,199,110,.5)}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn.ghost{background:transparent; color:var(--gold2); border:1px solid rgba(212,175,55,.45); box-shadow:none}
.btn.block{display:block; width:100%}

.pillars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px}
.pillar{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:14px 10px; text-align:center}
.pillar .tit{color:#9aa3b2; font-size:0.85rem; margin-bottom:6px}
.pillar .gz{font-size:1.5rem; font-weight:800; color:var(--gold2)}
@media (max-width: 520px){
  .pillars{grid-template-columns:repeat(2,1fr)}
}

.bazi-table{
  width:100%; border-collapse:collapse; margin-top:12px;
  background:var(--surface); border-radius:8px; overflow:hidden
}
.bazi-table th,.bazi-table td{
  padding:10px 12px; border:1px solid #253245; text-align:center; vertical-align:middle
}
.bazi-table th{background:rgba(212,175,55,.1); color:var(--gold2)}
/* å°å±è¡¨æ ¼å¯æ¨ªå‘æ»šåŠ¨ï¼šæŠŠ table ç”¨ div åŒ…ä¸€å±‚ .bazi-table-wrap å³å¯ */
.bazi-table-wrap{overflow:auto}
@media (max-width: 420px){
  .bazi-table th,.bazi-table td{padding:8px 10px}
}

.bar{height:10px; background:#0d1420; border:1px solid #233146; border-radius:999px; overflow:hidden; margin:6px 0}
.bar i{display:block; height:100%; background:linear-gradient(90deg,#ffe084,#f2d27a); width:0%; transition:width 0.5s ease}
.bar-row{display:grid; grid-template-columns:60px 1fr 60px; gap:10px; align-items:center}

.error-message{
  background:rgba(255,90,95,.1);
  border:1px solid #ff5a5f; border-radius:8px;
  padding:10px; display:none; margin-top:10px
}
.badge-warn{display:inline-block; padding:2px 8px; margin-left:6px; border:1px solid #ffb84d; border-radius:999px; color:#ffb84d; font-size:0.82rem}
.muted{color:var(--muted)}

.time-row{display:flex; align-items:center; gap:10px}
.time-row .time-unknown{display:flex; align-items:center; gap:6px; white-space:nowrap}
.time-row input[type="time"]{width:auto !important; flex:0 0 160px; min-width:140px}

.gen-wrap{display:flex; align-items:flex-end; justify-content:flex-end}
#genBtn{width:auto !important}

.analysis-grid{display:grid; gap:16px; margin-top:20px}
.analysis-card{background:var(--surface); border:1px solid #253245; border-radius:12px; padding:16px}
.analysis-card h3{color:var(--gold2); margin:0 0 12px 0; font-size:1.1rem}
.analysis-content{line-height:1.6}
.rating{display:flex; align-items:center; gap:8px; margin:8px 0}
.rating-stars{color:var(--gold2)}
.tag{display:inline-block; background:rgba(212,175,55,.1); color:var(--gold2); padding:4px 8px; border-radius:6px; font-size:0.85rem; margin:2px}

.luck-grid{display:grid; gap:10px}
.luck-item{background:rgba(255,255,255,.05); border-radius:8px; padding:12px; border-left:3px solid var(--gold2)}
.luck-year{font-weight:700; color:var(--gold2)}
.luck-desc{font-size:0.9rem; margin-top:4px}

.columns{display:grid; gap:12px; grid-template-columns:1fr}
@media (min-width: 900px){ .columns{grid-template-columns:1fr 1fr} }
.list-block{border:1px solid #263448; background:var(--bg-accent); border-radius:12px; padding:16px}
.list-block ul{margin:0.2rem 0 0 0; padding-left:1.1rem}
.group-title{font-size:1.05rem; color:#ffe084; margin:6px 0 14px}

.astro-auth{max-width:980px; margin:28px auto; padding:20px 18px;
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
  border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 18px 50px rgba(0,0,0,.35)
}
.auth-grid{display:grid; gap:18px; grid-template-columns:1.2fr .8fr}
@media (max-width:860px){ .auth-grid{grid-template-columns:1fr} }
.panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid rgba(212,175,55,.22); border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.panel .head{padding:16px 18px; border-bottom:1px solid rgba(212,175,55,.22); color:var(--gold); font-weight:700; letter-spacing:0.3px}
.panel .body{padding:18px}
.spacer{height:12px}

.ai-box{background:#0b111a; border:1px solid #1f2a36; border-radius:12px; padding:14px 16px; margin:14px 0}
.ai-box-h{color:#ffd88a; font-weight:700; margin-bottom:8px}
.ai-box-c{color:#e8edf3; line-height:1.7}
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
.chip{padding:6px 10px; border-radius:999px; border:1px solid #2a3546; background:#0e1520; color:#e8edf3; cursor:pointer; transition:border-color .2s ease, box-shadow .2s ease}
.chip:hover{border-color:#f2d27a; box-shadow:0 0 0 2px rgba(242,210,122,.15) inset}
.chip:disabled{opacity:.6; cursor:not-allowed}

.skeleton{display:grid; gap:8px}
.skeleton div{height:12px; border-radius:6px; background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431); animation:sh 1.2s infinite}
@keyframes sh{0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5}}

.ai-lock-overlay{margin-top:10px; padding-top:10px; border-top:1px solid #1f2a36; text-align:center}
.ai-lock-overlay .tip{color:#ffd88a; font-weight:700; margin-bottom:4px}
.ai-lock-overlay .sub{color:var(--muted)}

.detail-view{display:none}
.detail-header{display:flex; align-items:center; gap:12px; margin-bottom:20px}
.back-btn{background:rgba(212,175,55,.1); border:1px solid rgba(212,175,55,.3); color:var(--gold2); padding:8px 16px; border-radius:8px; cursor:pointer}
.detail-content{line-height:1.8}
.detail-section{margin-bottom:24px}
.detail-section h4{color:var(--gold2); margin-bottom:12px; font-size:1.1rem}
.action-list{list-style:none; padding:0; margin:0}
.action-list li{margin-bottom:8px; padding-left:20px; position:relative}
.action-list li::before{content:"â€¢"; color:var(--gold2); position:absolute; left:0; top:0}

footer{color:#6c7b8c; font-size:0.85rem; text-align:center; padding:30px 0; margin-top:40px}

/* Motion ä¼˜åŒ– */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* Utilities */
.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.chips-container{display:flex; flex-wrap:wrap; gap:8px; margin:20px 0; justify-content:center}

/* VIP section demo å¯è§ */
.vip-section{display:block !important}

/* Butler ç»„ä»¶ */
.butler-professional{display:none; margin-top:20px; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:20px}
.butler-header{display:flex; align-items:center; gap:10px; margin-bottom:20px; color:var(--gold2); font-size:1.2rem; font-weight:700}
.butler-content{line-height:1.8; max-height:600px; overflow-y:auto; padding:15px; background:var(--surface); border-radius:10px; border:1px solid #253245}
.butler-section{margin-bottom:25px; padding-bottom:15px; border-bottom:1px solid #253245}
.butler-section h4{color:var(--gold2); margin-bottom:10px; font-size:1.1rem}
.butler-chat{margin-top:20px; border-top:1px solid var(--line); padding-top:15px}
.chat-messages{height:200px; overflow-y:auto; margin-bottom:15px; padding:10px; background:var(--surface); border-radius:8px; border:1px solid #253245}
.chat-input-area{display:flex; gap:10px}
.chat-input-area input{flex:1; padding:10px; border-radius:8px; border:1px solid #253245; background:#0e1520; color:#e8edf3}
.chat-send-btn{padding:10px 20px; background:var(--gold); color:#191919; border:none; border-radius:8px; font-weight:700; cursor:pointer}

/* ==== remove the brown/gold focus outline ==== */
input:focus,
select:focus,
textarea:focus{
  outline: none !important;
  box-shadow: none !important;
  border-color: #243244 !important;
}
button:focus,
.btn:focus,
a:focus{
  outline: none !important;
  box-shadow: none !important;
}

/* (optional) also remove tap highlight on mobile */
*{ -webkit-tap-highlight-color: transparent; }    
.chip:hover{ border-color:#2a3546; box-shadow:none; }

/* æµ®çª—èŠå¤©æ ·å¼ */
.chat-float {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 350px;
  height: 500px;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  z-index: 1000;
  display: none;
  flex-direction: column;
}

.chat-float-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(212,175,55,.1);
  color: var(--gold2);
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: move;
}

.chat-float-close {
  background: none;
  border: none;
  color: var(--gold2);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}

.chat-float-close:hover {
  background: rgba(212,175,55,.2);
}

.chat-float-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0;
}

.chat-float-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  background: var(--surface);
}

.chat-float-input-area {
  padding: 12px;
  border-top: 1px solid var(--line);
  background: var(--bg-accent);
}

.chat-toggle-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(180deg,#fff9e6,#e6c76e);
  border: 1px solid #e6c76e;
  color: #191919;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(230,199,110,.3);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chat-toggle-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(230,199,110,.5);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .chat-float {
    width: 300px;
    height: 400px;
    bottom: 10px;
    right: 10px;
  }
  
  .chat-toggle-btn {
    width: 50px;
    height: 50px;
    bottom: 10px;
    right: 10px;
  }
}    
</style>
</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com/" target="_self">
        <span class="brand-badge">5X</span>
      <span class="title" data-i18n="brand.subtitle">5xLiving Â· å…«å­—ç®€è¯„</span>
    </a>
    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="nav.langLabel">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
        <option value="zh-CN" data-i18n="lang.zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW" data-i18n="lang.zh-TW">ç¹é«”ä¸­æ–‡</option>
        <option value="en"    data-i18n="lang.en">English</option>
        <option value="ja"    data-i18n="lang.ja">æ—¥æœ¬èª</option>
        <option value="th"    data-i18n="lang.th">à¹„à¸—à¸¢</option>
        <option value="ms"    data-i18n="lang.ms">Bahasa Melayu</option>
      </select>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="h2" data-i18n="app.title">å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜</div>
    <div class="row cols-3">
      <div>
        <label class="muted" data-i18n="form.nameLabel">å§“åï¼ˆå¯é€‰ï¼‰</label>
        <input id="name" placeholder="ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰" />
      </div>
      <div>
        <label class="muted" data-i18n="form.genderLabel">æ€§åˆ«</label>
        <select id="gender">
          <option value=""        data-i18n="form.gender.hidden">ä¸é€éœ²</option>
          <option value="male"    data-i18n="form.gender.male">ç”·æ€§</option>
          <option value="female"  data-i18n="form.gender.female">å¥³æ€§</option>
        </select>
      </div>
      <div>
        <label class="muted" data-i18n="form.calendarLabel">å†æ³•</label>
        <select id="calendar">
          <option value="gregorian" data-i18n="form.calendar.gregorian">é˜³å†</option>
          <option value="lunar"     data-i18n="form.calendar.lunar">å†œå†</option>
        </select>
      </div>
    </div>
    <div class="row cols-3" style="margin-top:10px">
      <div>
        <label class="muted" data-i18n="form.birthdateLabel">å‡ºç”Ÿæ—¥æœŸ</label>
        <input type="date" id="birthdate" />
      </div>
      <div>
        <label class="muted" data-i18n="form.birthtimeLabel">å‡ºç”Ÿæ—¶é—´</label>
        <div class="time-row">
          <input type="time" id="birthtime" />
          <label class="muted time-unknown">
            <input type="checkbox" id="timeUnknown" />
            <span data-i18n="form.timeUnknown">å‡ºç”Ÿæ—¶é—´ä¸è¯¦</span>
          </label>
        </div>
      </div>
      <div class="gen-wrap">
        <button class="btn" id="genBtn" type="button">
          <span id="genBtnText" data-i18n="btn.generate">ç”Ÿæˆå…«å­—</span>
          <span id="genBtnLoading" style="display:none" data-i18n="btn.loading">è®¡ç®—ä¸­...</span>
        </button>
      </div>
    </div>
    <div id="error" class="error-message"></div>
  </section>

<section id="result" style="display:none;">
    <div class="card">
      <div class="h2" data-i18n="result.title">æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜</div>
      <div class="pillars" id="bazi-pillars"></div>
      <div class="muted" id="bazi-date" style="margin-top:6px"></div>
     
      <table class="bazi-table">
        <thead>
          <tr>
            <th></th>
            <th data-i18n="pillar.year">å¹´æŸ±</th>
            <th data-i18n="pillar.month">æœˆæŸ±</th>
            <th data-i18n="pillar.day">æ—¥æŸ±</th>
            <th data-i18n="pillar.hour">æ—¶æŸ±</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-i18n="table.row.stem">å¤©å¹²</td>
            <td id="year-stem">-</td><td id="month-stem">-</td><td id="day-stem">-</td><td id="hour-stem">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.branch">åœ°æ”¯</td>
            <td id="year-branch">-</td><td id="month-branch">-</td><td id="day-branch">-</td><td id="hour-branch">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.fiveElem">äº”è¡Œ</td>
            <td id="year-element">-</td><td id="month-element">-</td><td id="day-element">-</td><td id="hour-element">-</td>
          </tr>
          <tr>
            <td data-i18n="table.row.nayin">çº³éŸ³</td>
            <td id="year-nayin">-</td><td id="month-nayin">-</td><td id="day-nayin">-</td><td id="hour-nayin">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <div class="h2" data-i18n="energy.title">äº”è¡Œèƒ½é‡åˆ†æ</div>
      <div class="bar-row"><span data-i18n="elem.wood">æœ¨</span><div class="bar"><i id="bar-æœ¨"></i></div><span id="pct-æœ¨">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.fire">ç«</span><div class="bar"><i id="bar-ç«"></i></div><span id="pct-ç«">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.earth">åœŸ</span><div class="bar"><i id="bar-åœŸ"></i></div><span id="pct-åœŸ">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.metal">é‡‘</span><div class="bar"><i id="bar-é‡‘"></i></div><span id="pct-é‡‘">0%</span></div>
      <div class="bar-row"><span data-i18n="elem.water">æ°´</span><div class="bar"><i id="bar-æ°´"></i></div><span id="pct-æ°´">0%</span></div>
      <div id="bazi-elements-balance" class="muted"></div>
    </div>
  </section>

  <section id="butlerProfessional" class="butler-professional">
    <div class="butler-header">
      <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    </div>
    <div class="butler-content" id="professionalReport"></div>
</section>
    
<!-- æµ®çª—èŠå¤©æŒ‰é’® -->
<button class="chat-toggle-btn" id="chatToggle" data-i18n="chat.toggle">é—®</button>

<!-- æµ®çª—èŠå¤©çª—å£ -->
<div class="chat-float" id="chatFloat">
  <div class="chat-float-header">
    <span data-i18n="pro.title">ğŸ§™â€â™‚ï¸ å¿ƒæ€œç®¡å®¶ Â· ä¸“ä¸šå‘½ç†åˆ†æ</span>
    <button class="chat-float-close" id="chatClose">Ã—</button>
  </div>
  <div class="chat-float-body">
    <div class="chat-float-messages" id="chatMessages">
      <div class="ss-msg" data-i18n="pro.welcome">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“ä¸šå‘½ç†é¡¾é—®ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†åˆ†ææŠ¥å‘Šã€‚æœ‰ä»€ä¹ˆå…·ä½“é—®é¢˜å¯ä»¥éšæ—¶é—®æˆ‘ã€‚</div>
    </div>
    <div class="chat-float-input-area">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #253245; background: #0e1520; color: #e8edf3;">
        <button class="chat-send-btn" id="chatSend" data-i18n="chat.send" style="padding: 10px 16px; background: var(--gold); color: #191919; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">å‘é€</button>
      </div>
    </div>
  </div>
</div>  

  <section class="card section vip-section">
    <h2 class="group-title" data-i18n="vip.title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
    <div class="columns">
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.astrology">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.astrology.match">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
          <li data-i18n="vip.astrology.career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
          <li data-i18n="vip.astrology.wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
          <li data-i18n="vip.astrology.pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
        </ul>
      </div>
      <div class="list-block">
        <div class="group-title" data-i18n="vip.group.spiritual">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
        <ul>
          <li data-i18n="vip.spiritual.record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
          <li data-i18n="vip.spiritual.courses">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•°</li>
          <li data-i18n="vip.spiritual.family">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
          <li data-i18n="vip.spiritual.practice">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
        </ul>
      </div>
    </div>

    <div class="group-title" style="margin-top:14px" data-i18n="vip.login.title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
    <section class="astro-auth">
      <div class="auth-grid">
        <div class="panel">
          <div class="head" data-i18n="auth.header">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
          <div class="body">
            <div class="row" id="authFields">
              <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email">
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰">
            </div>
            <div class="spacer"></div>
            <form id="loginForm" class="row one">
              <button class="btn block" id="loginBtn" type="submit" data-i18n="auth.login">ç™»å…¥è´¦æˆ·</button>
            </form>
            <div class="spacer"></div>
            <div class="row one">
              <button class="btn ghost block" id="resetBtn" type="button" data-i18n="auth.reset">ğŸ”‘ é‡è®¾å¯†ç </button>
            </div>
            <div class="spacer"></div>
            <form class="row one" id="registerForm">
              <button class="btn block" id="registerBtn" type="submit" data-i18n="auth.register">æ³¨å†Œè´¦æˆ·</button>
              <div class="muted" data-i18n="auth.freeTrialNote">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
              <div class="spacer"></div>
              <div class="error-message" id="authError" style="display:none"></div>
            </form>
          </div>
        </div>

        <div class="panel">
          <div class="head" data-i18n="vip.services.header">ä¼šå‘˜æœåŠ¡</div>
          <div class="body">
            <div class="row one">
              <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="vip.upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
            </div>
            <div class="row one">
              <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="vip.back">â† è¿”å›å‘½ç†å•†åŸ</a>
            </div>
            <div class="muted" data-i18n="vip.priceNote">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <footer data-i18n="footer.copy">Â© 5XLiving â€¢ Astro Sanctuary</footer>
</main>
  
<script>window.API_BASE='https://throbbing-lab-1440.hello5xliving.workers.dev';</script>
<script>
/* =========================================================
 * 5XLiving Â· I18N Term Pack (Hard Presets) â€“ Script 1
 * zh-CN / zh-TW / en / ja / th / ms
 * Provides: window.I18N, window.state.lang, hardTranslate(*),
 *           labelStem/labelBranch/labelElement, mapTenGodsStr
 * ========================================================= */
(function () {
  'use strict';

  /* Root dictionary bucket */
  const I18N  = (window.I18N  = window.I18N  || {});
  const state = (window.state = window.state || { lang: 'zh-CN' });

  /* ------------------------------
   * æœ¯è¯­ç¡¬ç¼–ç ï¼ˆå¤©å¹²/åœ°æ”¯/äº”è¡Œ/åç¥/çº³éŸ³ï¼‰
   * ------------------------------ */
  const HARDCODED_TRANSLATIONS = {
    'zh-CN': {
      'ç”²':'ç”²','ä¹™':'ä¹™','ä¸™':'ä¸™','ä¸':'ä¸','æˆŠ':'æˆŠ','å·±':'å·±','åºš':'åºš','è¾›':'è¾›','å£¬':'å£¬','ç™¸':'ç™¸',
      'å­':'å­','ä¸‘':'ä¸‘','å¯…':'å¯…','å¯':'å¯','è¾°':'è¾°','å·³':'å·³','åˆ':'åˆ','æœª':'æœª','ç”³':'ç”³','é…‰':'é…‰','æˆŒ':'æˆŒ','äº¥':'äº¥',
      'æœ¨':'æœ¨','ç«':'ç«','åœŸ':'åœŸ','é‡‘':'é‡‘','æ°´':'æ°´',
      'æ¯”è‚©':'æ¯”è‚©','åŠ«è´¢':'åŠ«è´¢','é£Ÿç¥':'é£Ÿç¥','ä¼¤å®˜':'ä¼¤å®˜','åè´¢':'åè´¢','æ­£è´¢':'æ­£è´¢','ä¸ƒæ€':'ä¸ƒæ€','æ­£å®˜':'æ­£å®˜','åå°':'åå°','æ­£å°':'æ­£å°',
      'æµ·ä¸­é‡‘':'æµ·ä¸­é‡‘','ç‚‰ä¸­ç«':'ç‚‰ä¸­ç«','å¤§æ—æœ¨':'å¤§æ—æœ¨','è·¯æ—åœŸ':'è·¯æ—åœŸ','å‰‘é”‹é‡‘':'å‰‘é”‹é‡‘'
    },
    'zh-TW': {
      'ç”²':'ç”²','ä¹™':'ä¹™','ä¸™':'ä¸™','ä¸':'ä¸','æˆŠ':'æˆŠ','å·±':'å·±','åºš':'åºš','è¾›':'è¾›','å£¬':'å£¬','ç™¸':'ç™¸',
      'å­':'å­','ä¸‘':'ä¸‘','å¯…':'å¯…','å¯':'å¯','è¾°':'è¾°','å·³':'å·³','åˆ':'åˆ','æœª':'æœª','ç”³':'ç”³','é…‰':'é…‰','æˆŒ':'æˆŒ','äº¥':'äº¥',
      'æœ¨':'æœ¨','ç«':'ç«','åœŸ':'åœŸ','é‡‘':'é‡‘','æ°´':'æ°´',
      'æ¯”è‚©':'æ¯”è‚©','åŠ«è´¢':'åŠ«è²¡','é£Ÿç¥':'é£Ÿç¥','ä¼¤å®˜':'å‚·å®˜','åè´¢':'åè²¡','æ­£è´¢':'æ­£è²¡','ä¸ƒæ€':'ä¸ƒæ®º','æ­£å®˜':'æ­£å®˜','åå°':'åå°','æ­£å°':'æ­£å°',
      'æµ·ä¸­é‡‘':'æµ·ä¸­é‡‘','ç‚‰ä¸­ç«':'çˆä¸­ç«','å¤§æ—æœ¨':'å¤§æ—æœ¨','è·¯æ—åœŸ':'è·¯æ—åœŸ','å‰‘é”‹é‡‘':'åŠé‹’é‡‘'
    },
  'en': {
    'æœ¨':'Wood','ç«':'Fire','åœŸ':'Earth','é‡‘':'Metal','æ°´':'Water',
    'æ¯”è‚©':'Companion Star','åŠ«è´¢':'Competitive Star','é£Ÿç¥':'Output Star',
    'ä¼¤å®˜':'Performer Star','æ­£è´¢':'Direct Wealth Star','åè´¢':'Indirect Wealth Star',
    'æ­£å®˜':'Direct Officer Star','ä¸ƒæ€':'Power Star','æ­£å°':'Resource Star','åå°':'Indirect Resource Star',
    'æµ·ä¸­é‡‘':'Metal of the Sea','ç‚‰ä¸­ç«':'Fire in the Furnace','å¤§æ—æœ¨':'Great Forest Wood','è·¯æ—åœŸ':'Roadside Earth','å‰‘é”‹é‡‘':'Blade-Edge Metal'
  },
'ja': {
  'æœ¨':'æœ¨ï¼ˆã‚‚ãï¼‰','ç«':'ç«ï¼ˆã‹ï¼‰','åœŸ':'åœŸï¼ˆã©ï¼‰','é‡‘':'é‡‘ï¼ˆãã‚“ï¼‰','æ°´':'æ°´ï¼ˆã™ã„ï¼‰',
  'æ¯”è‚©':'åŒç­‰æ˜Ÿï¼ˆã²ã‘ã‚“ã›ã„ï¼‰','åŠ«è´¢':'ç«¶æ˜Ÿï¼ˆã”ã†ã–ã„ã›ã„ï¼‰',
  'é£Ÿç¥':'å‰µé€ æ˜Ÿï¼ˆã—ã‚‡ãã˜ã‚“ã›ã„ï¼‰','ä¼¤å®˜':'è¡¨ç¾æ˜Ÿï¼ˆã—ã‚‡ã†ã‹ã‚“ã›ã„ï¼‰',
  'æ­£è´¢':'å®‰å®šè²¡æ˜Ÿï¼ˆã›ã„ã–ã„ã›ã„ï¼‰','åè´¢':'å¤‰å‹•è²¡æ˜Ÿï¼ˆã¸ã‚“ã–ã„ã›ã„ï¼‰',
  'æ­£å®˜':'æ­£å®˜æ˜Ÿï¼ˆã›ã„ã‹ã‚“ã›ã„ï¼‰','ä¸ƒæ€':'åå®˜æ˜Ÿï¼ˆã¸ã‚“ã‹ã‚“ã›ã„ï¼‰',
  'æ­£å°':'çŸ¥æµæ˜Ÿï¼ˆã›ã„ã„ã‚“ã›ã„ï¼‰','åå°':'ç›´æ„Ÿæ˜Ÿï¼ˆã¸ã‚“ã„ã‚“ã›ã„ï¼‰',
  'æµ·ä¸­é‡‘':'æµ·ã®é‡‘','ç‚‰ä¸­ç«':'ç‚‰ã®ç«','å¤§æ—æœ¨':'å¤§ããªæ£®ã®æœ¨',
  'è·¯æ—åœŸ':'é“ã°ãŸã®åœŸ','å‰‘é”‹é‡‘':'å‰£ã®åˆƒã®é‡‘'
  },
  'th': {
    'æœ¨':'à¹„à¸¡à¹‰','ç«':'à¹„à¸Ÿ','åœŸ':'à¸”à¸´à¸™','é‡‘':'à¸—à¸­à¸‡','æ°´':'à¸™à¹‰à¸³',
    'æ¯”è‚©':'à¸”à¸²à¸§à¹€à¸à¸·à¹ˆà¸­à¸™','åŠ«è´¢':'à¸”à¸²à¸§à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™','é£Ÿç¥':'à¸”à¸²à¸§à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸£à¸£à¸„à¹Œ','ä¼¤å®˜':'à¸”à¸²à¸§à¸­à¸´à¸ªà¸£à¸°',
    'æ­£è´¢':'à¸”à¸²à¸§à¸—à¸£à¸±à¸à¸¢à¹Œà¸•à¸£à¸‡','åè´¢':'à¸”à¸²à¸§à¸—à¸£à¸±à¸à¸¢à¹Œà¸£à¸­à¸‡','æ­£å®˜':'à¸”à¸²à¸§à¸‚à¹‰à¸²à¸£à¸²à¸Šà¸à¸²à¸£à¸•à¸£à¸‡','ä¸ƒæ€':'à¸”à¸²à¸§à¸­à¸³à¸™à¸²à¸ˆ',
    'æ­£å°':'à¸”à¸²à¸§à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸•à¸£à¸‡','åå°':'à¸”à¸²à¸§à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸£à¸­à¸‡',
    'æµ·ä¸­é‡‘':'à¸—à¸­à¸‡à¹à¸«à¹ˆà¸‡à¸—à¸°à¹€à¸¥','ç‚‰ä¸­ç«':'à¹„à¸Ÿà¹ƒà¸™à¹€à¸•à¸²','å¤§æ—æœ¨':'à¹„à¸¡à¹‰à¸›à¹ˆà¸²à¹ƒà¸«à¸à¹ˆ','è·¯æ—åœŸ':'à¸”à¸´à¸™à¸£à¸´à¸¡à¸—à¸²à¸‡','å‰‘é”‹é‡‘':'à¸—à¸­à¸‡à¸›à¸¥à¸²à¸¢à¸”à¸²à¸š'
  },
  'ms': {
    'æœ¨':'Kayu','ç«':'Api','åœŸ':'Tanah','é‡‘':'Logam','æ°´':'Air',
    'æ¯”è‚©':'Bintang Rakan','åŠ«è´¢':'Bintang Persaingan','é£Ÿç¥':'Bintang Kreatif','ä¼¤å®˜':'Bintang Persembahan',
    'æ­£è´¢':'Bintang Kekayaan Langsung','åè´¢':'Bintang Kekayaan Tidak Langsung',
    'æ­£å®˜':'Bintang Pegawai Langsung','ä¸ƒæ€':'Bintang Kuasa',
    'æ­£å°':'Bintang Sumber Langsung','åå°':'Bintang Sumber Tidak Langsung',
    'æµ·ä¸­é‡‘':'Emas Laut','ç‚‰ä¸­ç«':'Api di Relau','å¤§æ—æœ¨':'Kayu Hutan Besar','è·¯æ—åœŸ':'Tanah Tepi Jalan','å‰‘é”‹é‡‘':'Logam Mata Pedang'
  }
};

  /* å¿«é€Ÿç¡¬è¯‘ï¼ˆæœ¯è¯­çº§ï¼‰ */
  function hardTranslate(text){
    if (text == null || text === '') return '';
    const lang = state.lang || 'zh-CN';
    const translations = HARDCODED_TRANSLATIONS[lang] || HARDCODED_TRANSLATIONS['zh-CN'];
    return translations[text] || text;
  }
  function hardTranslateArray(texts){ return (texts || []).map(hardTranslate); }
  function hardTranslateTenGods(str){
    const lang = state.lang || 'zh-CN';
    const trans = HARDCODED_TRANSLATIONS[lang] || HARDCODED_TRANSLATIONS['zh-CN'];
    return String(str).split(/[/ã€|\s]+/).filter(Boolean).map(w => trans[w] || w).join(' / ');
  }

  /* åç§°å­—å…¸ï¼ˆç”¨äº labelXxxï¼‰*/
/* =========================
 * STEMS (Heavenly Stems display names)
 * ========================= */
const STEMS = {
  // Clear English with element in parentheses
  'en': {
    'ç”²':'Jia (Wood)','ä¹™':'Yi (Wood)','ä¸™':'Bing (Fire)','ä¸':'Ding (Fire)',
    'æˆŠ':'Wu (Earth)','å·±':'Ji (Earth)','åºš':'Geng (Metal)','è¾›':'Xin (Metal)',
    'å£¬':'Ren (Water)','ç™¸':'Gui (Water)'
  },
  // Bahasa Melayu â€“ use Malay element words, keep pinyin for clarity
  'ms': {
    'ç”²':'Jia (Kayu)','ä¹™':'Yi (Kayu)','ä¸™':'Bing (Api)','ä¸':'Ding (Api)',
    'æˆŠ':'Wu (Tanah)','å·±':'Ji (Tanah)','åºš':'Geng (Logam)','è¾›':'Xin (Logam)',
    'å£¬':'Ren (Air)','ç™¸':'Gui (Air)'
  },
  // Japanese â€“ show pinyin + element in kana so non-specialists can read
  'ja': {
    'ç”²':'Jiaï¼ˆæœ¨ãƒ»ã‚‚ãï¼‰','ä¹™':'Yiï¼ˆæœ¨ãƒ»ã‚‚ãï¼‰','ä¸™':'Bingï¼ˆç«ãƒ»ã‹ï¼‰','ä¸':'Dingï¼ˆç«ãƒ»ã‹ï¼‰',
    'æˆŠ':'Wuï¼ˆåœŸãƒ»ã©ï¼‰','å·±':'Jiï¼ˆåœŸãƒ»ã©ï¼‰','åºš':'Gengï¼ˆé‡‘ãƒ»ãã‚“ï¼‰','è¾›':'Xinï¼ˆé‡‘ãƒ»ãã‚“ï¼‰',
    'å£¬':'Renï¼ˆæ°´ãƒ»ã™ã„ï¼‰','ç™¸':'Guiï¼ˆæ°´ãƒ»ã™ã„ï¼‰'
  },
  // Thai â€“ keep pinyin + Thai element (easy to learn/recognize)
  'th': {
    'ç”²':'Jia (à¹„à¸¡à¹‰)','ä¹™':'Yi (à¹„à¸¡à¹‰)','ä¸™':'Bing (à¹„à¸Ÿ)','ä¸':'Ding (à¹„à¸Ÿ)',
    'æˆŠ':'Wu (à¸”à¸´à¸™)','å·±':'Ji (à¸”à¸´à¸™)','åºš':'Geng (à¹‚à¸¥à¸«à¸°)','è¾›':'Xin (à¹‚à¸¥à¸«à¸°)',
    'å£¬':'Ren (à¸™à¹‰à¸³)','ç™¸':'Gui (à¸™à¹‰à¸³)'
  },
  // Traditional Chinese â€“ standard â€œstem+elementâ€
  'zh-TW': {
    'ç”²':'ç”²æœ¨','ä¹™':'ä¹™æœ¨','ä¸™':'ä¸™ç«','ä¸':'ä¸ç«','æˆŠ':'æˆŠåœŸ','å·±':'å·±åœŸ',
    'åºš':'åºšé‡‘','è¾›':'è¾›é‡‘','å£¬':'å£¬æ°´','ç™¸':'ç™¸æ°´'
  }
};

/* =========================
 * BRANCHES (Earthly Branches display names)
 * ========================= */
const BRANCHES = {
  'en': {
    'å­':'Zi (Rat)','ä¸‘':'Chou (Ox)','å¯…':'Yin (Tiger)','å¯':'Mao (Rabbit)',
    'è¾°':'Chen (Dragon)','å·³':'Si (Snake)','åˆ':'Wu (Horse)','æœª':'Wei (Goat)',
    'ç”³':'Shen (Monkey)','é…‰':'You (Rooster)','æˆŒ':'Xu (Dog)','äº¥':'Hai (Pig)'
  },
  'ms': {
    'å­':'Zi (Tikus)','ä¸‘':'Chou (Lembu)','å¯…':'Yin (Harimau)','å¯':'Mao (Arnab)',
    'è¾°':'Chen (Naga)','å·³':'Si (Ular)','åˆ':'Wu (Kuda)','æœª':'Wei (Kambing)',
    'ç”³':'Shen (Monyet)','é…‰':'You (Ayam)','æˆŒ':'Xu (Anjing)','äº¥':'Hai (Babi)'
  },
  'ja': {
    'å­':'å­ï¼ˆã­ï¼‰','ä¸‘':'ä¸‘ï¼ˆã†ã—ï¼‰','å¯…':'å¯…ï¼ˆã¨ã‚‰ï¼‰','å¯':'å¯ï¼ˆã†ï¼‰',
    'è¾°':'è¾°ï¼ˆãŸã¤ï¼‰','å·³':'å·³ï¼ˆã¿ï¼‰','åˆ':'åˆï¼ˆã†ã¾ï¼‰','æœª':'æœªï¼ˆã²ã¤ã˜ï¼‰',
    'ç”³':'ç”³ï¼ˆã•ã‚‹ï¼‰','é…‰':'é…‰ï¼ˆã¨ã‚Šï¼‰','æˆŒ':'æˆŒï¼ˆã„ã¬ï¼‰','äº¥':'äº¥ï¼ˆã„ï¼‰'
  },
  'th': {
    'å­':'à¸Šà¸§à¸”','ä¸‘':'à¸‰à¸¥à¸¹','å¯…':'à¸‚à¸²à¸¥','å¯':'à¹€à¸–à¸²à¸°',
    'è¾°':'à¸¡à¸°à¹‚à¸£à¸‡','å·³':'à¸¡à¸°à¹€à¸ªà¹‡à¸‡','åˆ':'à¸¡à¸°à¹€à¸¡à¸µà¸¢','æœª':'à¸¡à¸°à¹à¸¡',
    'ç”³':'à¸§à¸­à¸','é…‰':'à¸£à¸°à¸à¸²','æˆŒ':'à¸ˆà¸­','äº¥':'à¸à¸¸à¸™'
  },
  'zh-TW': {
    'å­':'å­','ä¸‘':'ä¸‘','å¯…':'å¯…','å¯':'å¯','è¾°':'è¾°','å·³':'å·³',
    'åˆ':'åˆ','æœª':'æœª','ç”³':'ç”³','é…‰':'é…‰','æˆŒ':'æˆŒ','äº¥':'äº¥'
  }
};

/* =========================
 * ELEMENTS (Five Elements single-word labels)
 * ========================= */
const ELEMENTS = {
  'en': {'æœ¨':'Wood','ç«':'Fire','åœŸ':'Earth','é‡‘':'Metal','æ°´':'Water'},
  'ms': {'æœ¨':'Kayu','ç«':'Api','åœŸ':'Tanah','é‡‘':'Logam','æ°´':'Air'},
  'ja': {'æœ¨':'ã‚‚','ç«':'ã‹','åœŸ':'ã©','é‡‘':'ãã‚“','æ°´':'ã™ã„'},
  'th': {'æœ¨':'à¹„à¸¡à¹‰','ç«':'à¹„à¸Ÿ','åœŸ':'à¸”à¸´à¸™','é‡‘':'à¹‚à¸¥à¸«à¸°','æ°´':'à¸™à¹‰à¸³'},
  'zh-TW': {'æœ¨':'æœ¨','ç«':'ç«','åœŸ':'åœŸ','é‡‘':'é‡‘','æ°´':'æ°´'}
};

/* =========================
 * TEN GODS (ShiShen) â€“ reader-friendly, faithful, with pinyin/kana aids
 * ========================= */
const TEN_GODS_MAP = {
  // Mainland Simplified (baseline)
  'zh-CN': {
    'æ¯”è‚©':'æ¯”è‚©','åŠ«è´¢':'åŠ«è´¢','é£Ÿç¥':'é£Ÿç¥','ä¼¤å®˜':'ä¼¤å®˜',
    'æ­£è´¢':'æ­£è´¢','åè´¢':'åè´¢','æ­£å®˜':'æ­£å®˜','ä¸ƒæ€':'ä¸ƒæ€',
    'æ­£å°':'æ­£å°','åå°':'åå°'
  },
  // Traditional Chinese
  'zh-TW': {
    'æ¯”è‚©':'æ¯”è‚©','åŠ«è´¢':'åŠ«è²¡','é£Ÿç¥':'é£Ÿç¥','ä¼¤å®˜':'å‚·å®˜',
    'æ­£è´¢':'æ­£è²¡','åè´¢':'åè²¡','æ­£å®˜':'æ­£å®˜','ä¸ƒæ€':'ä¸ƒæ®º',
    'æ­£å°':'æ­£å°','åå°':'åå°'
  },
  // English â€“ natural names + (pinyin) for precision
  'en': {
    'æ¯”è‚©':'Companion (Bi Jian)','åŠ«è´¢':'Rival Wealth (Jie Cai)',
    'é£Ÿç¥':'Eating God (Shi Shen)','ä¼¤å®˜':'Hurting Officer (Shang Guan)',
    'æ­£è´¢':'Direct Wealth (Zheng Cai)','åè´¢':'Indirect Wealth (Pian Cai)',
    'æ­£å®˜':'Direct Officer (Zheng Guan)','ä¸ƒæ€':'Seven Killings / Indirect Officer (Qi Sha)',
    'æ­£å°':'Direct Resource (Zheng Yin)','åå°':'Indirect Resource (Pian Yin)'
  },
  // Japanese â€“ keep standard kanji term + kana reading (ä¸€èˆ¬èª­è€…OK)
  'ja': {
    'æ¯”è‚©':'æ¯”è‚©ï¼ˆã²ã‘ã‚“ï¼‰','åŠ«è´¢':'åŠ«è²¡ï¼ˆã”ã†ã–ã„ï¼‰',
    'é£Ÿç¥':'é£Ÿç¥ï¼ˆã—ã‚‡ãã˜ã‚“ï¼‰','ä¼¤å®˜':'å‚·å®˜ï¼ˆã—ã‚‡ã†ã‹ã‚“ï¼‰',
    'æ­£è´¢':'æ­£è²¡ï¼ˆã›ã„ã–ã„ï¼‰','åè´¢':'åè²¡ï¼ˆã¸ã‚“ã–ã„ï¼‰',
    'æ­£å®˜':'æ­£å®˜ï¼ˆã›ã„ã‹ã‚“ï¼‰','ä¸ƒæ€':'åå®˜ï¼ˆã¸ã‚“ã‹ã‚“ï¼‰', // ä¸ƒæ®º=åå®˜ï¼ˆå®Ÿå‹™çš„ã«ã“ã¡ã‚‰ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ï¼‰
    'æ­£å°':'æ­£å°ï¼ˆã›ã„ã„ã‚“ï¼‰','åå°':'åå°ï¼ˆã¸ã‚“ã„ã‚“ï¼‰'
  },
  // Thai â€“ natural Thai label + (pinyin) so readers can Google terms
  'th': {
    'æ¯”è‚©':'à¸”à¸²à¸§à¹€à¸à¸·à¹ˆà¸­à¸™/à¹€à¸—à¹ˆà¸²à¹€à¸—à¸µà¸¢à¸¡',
    'åŠ«è´¢':'à¸”à¸²à¸§à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™à¸—à¸£à¸±à¸à¸¢à¹Œ',
    'é£Ÿç¥':'à¸”à¸²à¸§à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸£à¸£à¸„à¹Œ/à¸„à¸§à¸²à¸¡à¸­à¸´à¹ˆà¸¡',
    'ä¼¤å®˜':'à¸”à¸²à¸§à¹à¸ªà¸”à¸‡à¸­à¸­à¸/à¸‚à¸±à¸”à¸•à¹ˆà¸­à¸£à¸°à¹€à¸šà¸µà¸¢à¸š',
    'æ­£è´¢':'à¸”à¸²à¸§à¸—à¸£à¸±à¸à¸¢à¹Œà¸›à¸£à¸°à¸ˆà¸³',
    'åè´¢':'à¸”à¸²à¸§à¸—à¸£à¸±à¸à¸¢à¹Œà¸‰à¸²à¸šà¸‰à¸§à¸¢',
    'æ­£å®˜':'à¸”à¸²à¸§à¸à¸à¸£à¸°à¹€à¸šà¸µà¸¢à¸š/à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡',
    'ä¸ƒæ€':'à¸”à¸²à¸§à¸à¸”à¸”à¸±à¸™/à¸—à¹‰à¸²à¸—à¸²à¸¢',
    'æ­£å°':'à¸”à¸²à¸§à¸›à¸±à¸à¸à¸²/à¸à¸²à¸£à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™',
    'åå°':'à¸”à¸²à¸§à¸ªà¸±à¸à¸Šà¸²à¸•à¸à¸²à¸“/à¹„à¸¡à¹ˆà¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡'
  },
  // Malay â€“ use English semantics + (pinyin) to avoid weird literal Malay
'ms': {
  'æ¯”è‚©':'Rakan Sejajar',
  'åŠ«è´¢':'Harta Persaingan',
  'é£Ÿç¥':'Bintang Kreatif / Mencipta',
  'ä¼¤å®˜':'Bintang Pengaruh / Menampilkan',
  'æ­£è´¢':'Harta Terus',
  'åè´¢':'Harta Tidak Terus / Peluang',
  'æ­£å®˜':'Pihak Berkuasa Terus',
  'ä¸ƒæ€':'Daya/Kuasa Cabaran',
  'æ­£å°':'Sumber Terus',
  'åå°':'Sumber Tidak Terus / Intuitif'
  }
};


  /* å°†åè¯å­—å…¸æŒ‚åˆ° I18Nï¼ˆä»…å½“æœªè¢«ä¸» I18N æä¾›æ—¶ï¼‰ */
  ['zh-CN','en','ms','ja','th','zh-TW'].forEach(lang => {
    I18N[lang] ||= {};
    if (!I18N[lang].stemNames   && STEMS[lang])    I18N[lang].stemNames   = STEMS[lang];
    if (!I18N[lang].branchNames && BRANCHES[lang]) I18N[lang].branchNames = BRANCHES[lang];
    if (!I18N[lang].elemNames   && ELEMENTS[lang]) I18N[lang].elemNames   = ELEMENTS[lang];
  });

  /* å…¬å…±å·¥å…· */
  if (!window.labelStem) {
    window.labelStem = function labelStem(stem){
      const lang = state.lang || 'zh-CN';
      const dict = I18N[lang] && I18N[lang].stemNames;
      if (dict && dict[stem]) return dict[stem];
      const zhElem = {'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´'}[stem] || '';
      return stem + zhElem;
    };
  }
  if (!window.labelBranch) {
    window.labelBranch = function labelBranch(branch){
      const lang = state.lang || 'zh-CN';
      const dict = I18N[lang] && I18N[lang].branchNames;
      return (dict && dict[branch]) || branch;
    };
  }
  if (!window.labelElement) {
    window.labelElement = function labelElement(elemHanzi){
      const direct = hardTranslate(elemHanzi);
      if (direct && direct !== elemHanzi) return direct;
      const lang = state.lang || 'zh-CN';
      const dict = I18N[lang] && I18N[lang].elemNames;
      return (dict && dict[elemHanzi]) || elemHanzi;
    };
  }
  if (!window.mapTenGodsStr) {
    window.mapTenGodsStr = function mapTenGodsStr(str){
      const lang = state.lang || 'zh-CN';
      const map = TEN_GODS_MAP[lang] || TEN_GODS_MAP['en'];
      return String(str).split(/[/ã€|\s]+/).filter(Boolean).map(w => map[w] || w).join(' / ');
    };
  }

  /* æš´éœ²ç»™ä¸»è„šæœ¬ */
  window.hardTranslate = hardTranslate;
  window.hardTranslateArray = hardTranslateArray;
  window.hardTranslateTenGods = hardTranslateTenGods;

})();
</script>
<script>
/* =========================================================
 * 5XLiving Â· I18N Term Pack (Hard Presets) â€” zh-CN only
 * Exposes:
 *   - window.I18N['zh-CN']  (UI dictionary)
 *   - window.hardTranslate / hardTranslateArray / hardTranslateTenGods
 *   - window.labelStem / labelBranch / labelElement / mapTenGodsStr
 * ========================================================= */
(function () {
  'use strict';

  /* Roots */
  const I18N = (window.I18N = window.I18N || {});
  const state = (window.state = window.state || { lang: 'zh-CN' });

  /* ------------------------------
   * æœ¯è¯­ç¡¬ç¼–ç ï¼ˆå¤©å¹²/åœ°æ”¯/äº”è¡Œ/åç¥/çº³éŸ³ç¤ºä¾‹ï¼‰
   * ------------------------------ */
  const HARDCODED_TRANSLATIONS = {
    'zh-CN': {
      // å¤©å¹²
      'ç”²':'ç”²','ä¹™':'ä¹™','ä¸™':'ä¸™','ä¸':'ä¸','æˆŠ':'æˆŠ','å·±':'å·±','åºš':'åºš','è¾›':'è¾›','å£¬':'å£¬','ç™¸':'ç™¸',
      // åœ°æ”¯
      'å­':'å­','ä¸‘':'ä¸‘','å¯…':'å¯…','å¯':'å¯','è¾°':'è¾°','å·³':'å·³','åˆ':'åˆ','æœª':'æœª','ç”³':'ç”³','é…‰':'é…‰','æˆŒ':'æˆŒ','äº¥':'äº¥',
      // äº”è¡Œ
      'æœ¨':'æœ¨','ç«':'ç«','åœŸ':'åœŸ','é‡‘':'é‡‘','æ°´':'æ°´',
      // åç¥
      'æ¯”è‚©':'æ¯”è‚©','åŠ«è´¢':'åŠ«è´¢','é£Ÿç¥':'é£Ÿç¥','ä¼¤å®˜':'ä¼¤å®˜','åè´¢':'åè´¢','æ­£è´¢':'æ­£è´¢','ä¸ƒæ€':'ä¸ƒæ€','æ­£å®˜':'æ­£å®˜','åå°':'åå°','æ­£å°':'æ­£å°',
      // å¸¸è§çº³éŸ³ï¼ˆç•™æ ·ï¼Œåç»­å¯è¡¥å…¨ï¼‰
      'æµ·ä¸­é‡‘':'æµ·ä¸­é‡‘','ç‚‰ä¸­ç«':'ç‚‰ä¸­ç«','å¤§æ—æœ¨':'å¤§æ—æœ¨','è·¯æ—åœŸ':'è·¯æ—åœŸ','å‰‘é”‹é‡‘':'å‰‘é”‹é‡‘','å±±å¤´ç«':'å±±å¤´ç«','æ¶§ä¸‹æ°´':'æ¶§ä¸‹æ°´',
      'åŸå¤´åœŸ':'åŸå¤´åœŸ','ç™½èœ¡é‡‘':'ç™½èœ¡é‡‘','æ¨æŸ³æœ¨':'æ¨æŸ³æœ¨','æ³‰ä¸­æ°´':'æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ':'å±‹ä¸ŠåœŸ','éœ¹é›³ç«':'éœ¹é›³ç«','æ¾æŸæœ¨':'æ¾æŸæœ¨',
      'é•¿æµæ°´':'é•¿æµæ°´','ç ‚çŸ³é‡‘':'ç ‚çŸ³é‡‘','å±±ä¸‹ç«':'å±±ä¸‹ç«','å¹³åœ°æœ¨':'å¹³åœ°æœ¨','å£ä¸ŠåœŸ':'å£ä¸ŠåœŸ','é‡‘ç®”é‡‘':'é‡‘ç®”é‡‘','ä½›ç¯ç«':'ä½›ç¯ç«',
      'å¤©æ²³æ°´':'å¤©æ²³æ°´','å¤§é©¿åœŸ':'å¤§é©¿åœŸ','é’—é’é‡‘':'é’—é’é‡‘','æ¡‘æŸ˜æœ¨':'æ¡‘æŸ˜æœ¨','å¤§æºªæ°´':'å¤§æºªæ°´','æ²™ä¸­åœŸ':'æ²™ä¸­åœŸ','å¤©ä¸Šç«':'å¤©ä¸Šç«',
      'çŸ³æ¦´æœ¨':'çŸ³æ¦´æœ¨','å¤§æµ·æ°´':'å¤§æµ·æ°´'
    }
  };

  /* å¿«é€Ÿç¡¬è¯‘ï¼šå•è¯/çŸ­è¯­ */
  function hardTranslate(text){
    if (text == null || text === '') return '';
    const lang = state.lang || 'zh-CN';
    const translations = HARDCODED_TRANSLATIONS[lang] || HARDCODED_TRANSLATIONS['zh-CN'];
    return translations[text] || text;
  }
  /* æ‰¹é‡ç¡¬è¯‘ï¼šæ•°ç»„ */
  function hardTranslateArray(texts){
    return (texts || []).map(hardTranslate);
  }
  /* åç¥å­—ç¬¦ä¸²ç¡¬è¯‘ï¼ˆæ”¯æŒ '/', 'ã€', '|', ç©ºæ ¼ï¼‰ */
  function hardTranslateTenGods(str){
    const lang = state.lang || 'zh-CN';
    const trans = HARDCODED_TRANSLATIONS[lang] || HARDCODED_TRANSLATIONS['zh-CN'];
    return String(str)
      .split(/[/ã€|\s]+/)
      .filter(Boolean)
      .map(w => trans[w] || w)
      .join('ã€');
  }

  /* -------- æ ‡ç­¾è¾…åŠ©ï¼ˆä¸­æ–‡ç¯å¢ƒä¸‹ä¸»è¦ç›´å‡ºæ±‰å­—ï¼‰ -------- */
  if (!window.labelStem) {
    window.labelStem = function labelStem(stem){
      // ç›´å‡ºâ€œä¸™ç«/åºšé‡‘â€ç­‰
      const elem = ({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'})[stem] || '';
      return stem + elem;
    };
  }
  if (!window.labelBranch) {
    window.labelBranch = function labelBranch(branch){ return branch || ''; };
  }
  if (!window.labelElement) {
    window.labelElement = function labelElement(elemHanzi){
      const v = hardTranslate(elemHanzi);
      return v || elemHanzi || '';
    };
  }
  if (!window.mapTenGodsStr) {
    window.mapTenGodsStr = function mapTenGodsStr(str){
      // zh-CN ç›´æ¥è¿”å›ç¡¬è¯‘ä¸²
      return hardTranslateTenGods(str);
    };
  }

  /* ------------------------------
   * UI è¯å…¸ï¼šI18N['zh-CN']
   * ------------------------------ */
  I18N['zh-CN'] = {
    /* é¡¶éƒ¨ä¸å¯¼èˆª */
    brand:{ subtitle:'5xLiving Â· å…«å­—ç®€è¯„' },
    nav:{ langLabel:'è¯­è¨€' },
    lang:{ 'zh-CN':'ç®€ä½“ä¸­æ–‡','zh-TW':'ç¹é«”ä¸­æ–‡','en':'English','ja':'æ—¥æœ¬èª','th':'à¹„à¸—à¸¢','ms':'Bahasa Melayu' },

    /* App åŸºæœ¬ */
    app:{ title:'å…«å­—å‘½ç† Â· å¿«é€Ÿæ’ç›˜' },
    form:{
      nameLabel:'å§“åï¼ˆå¯é€‰ï¼‰',
      namePlaceholder:'ä½ çš„ç§°å‘¼ï¼ˆç”¨äºä¸ªæ€§åŒ–ï¼‰',
      genderLabel:'æ€§åˆ«',
      gender:{ hidden:'ä¸é€éœ²', male:'ç”·æ€§', female:'å¥³æ€§' },
      calendarLabel:'å†æ³•',
      calendar:{ gregorian:'é˜³å†', lunar:'å†œå†' },
      birthdateLabel:'å‡ºç”Ÿæ—¥æœŸ',
      birthtimeLabel:'å‡ºç”Ÿæ—¶é—´',
      timeUnknown:'å‡ºç”Ÿæ—¶é—´ä¸è¯¦'
    },

    /* æŒ‰é’®ä¸ç»“æœ */
    btn:{ generate:'ç”Ÿæˆå…«å­—', loading:'æ­£åœ¨ç”Ÿæˆâ€¦' },
    result:{ title:'æ‚¨çš„ç”Ÿè¾°å…«å­—å‘½ç›˜' },

    /* å››æŸ±æ ‡é¢˜ */
    pillar:{ year:'å¹´æŸ±', month:'æœˆæŸ±', day:'æ—¥æŸ±', hour:'æ—¶æŸ±' },

    /* è¡¨æ ¼ */
    table:{
      header:['å¹´æŸ±','æœˆæŸ±','æ—¥æŸ±','æ—¶æŸ±'],
      row:{ stem:'å¤©å¹²', branch:'åœ°æ”¯', fiveElem:'äº”è¡Œ', nayin:'çº³éŸ³' }
    },

    /* èƒ½é‡æ¡ */
    energy:{ title:'äº”è¡Œèƒ½é‡' },
    elem:{ wood:'æœ¨', fire:'ç«', earth:'åœŸ', metal:'é‡‘', water:'æ°´', month:'æœˆ' },

    /* å…¶ä»– UI */
    chat:{ toggle:'æ‰“å¼€/æ”¶èµ· å’¨è¯¢' },
    badge:{ noHour:'æœªçŸ¥æ—¶è¾°' },

    /* é”™è¯¯æç¤º */
    err:{
      fillBirthdate:'è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ',
      invalidDate:'æ—¥æœŸæ ¼å¼æ— æ•ˆ (YYYY-MM-DD)',
      generateFail:'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
    },

    /* è¯´æ˜ä¸ç»Ÿä¸€çŸ­è¯­ */
    ui:{
      balance:'{strongest}æœ€å¼ºï¼›{weakest}æœ€å¼±ã€‚',
      birthSummary:'å‡ºç”Ÿï¼š{y}-{m}-{d} {timeText}',
      hourSuffix:'{hh}:{mm}',
      timeUnknown:'å‡ºç”Ÿæ—¶é—´ä¸è¯¦'
    },
    sameQi:'åŒæ°”ç›¸åŠ©',
    complement:'å–è¡¥ä»¥è¡¡',
    layout:'ï¼Œå¸ƒå±€çµæ´»è°ƒæ•´',

    /* è¿åŠ¿å€¾å‘ */
    fortune:{
      steady:'æ•´ä½“è¿åŠ¿ç¨³ä¸­æœ‰è¿›',
      upward:'ç«æœ¨æ—ºï¼ŒåŠ¨èƒ½ä¸Šæ‰¬',
      focus:'é‡‘æ—ºï¼Œå®œæ”¶æ•›èšç„¦',
      study:'æ°´æ—ºï¼Œå®œå­¦ä¹ æ²‰æ·€',
      foundation:'åœŸæ—ºï¼Œæ‰“å¥½åŸºç¡€'
    },

    /* ä¸“ä¸šæŠ¥å‘Šï¼šæ ‡é¢˜ä¸æ ‡ç­¾ */
    reportTitles:{
      overview:'å‘½ç›˜æ€»è§ˆ',
      fiveElements:'äº”è¡Œèƒ½é‡åˆ†æ',
      tenGods:'åç¥é…ç½®',
      useful:'ç”¨ç¥å–œå¿Œ',
      relationship:'æ„Ÿæƒ…å©šå§»',
      career:'äº‹ä¸šå‘å±•',
      wealth:'è´¢è¿è¶‹åŠ¿',
      health:'å¥åº·å…»ç”Ÿ',
      nearTerm:'è¿‘æœŸè¿åŠ¿',
      actions:'è¡ŒåŠ¨å»ºè®®'
    },
    reportLabels:{
      dayMaster:'æ—¥ä¸»',
      strength:'èº«å¼º/èº«å¼±',
      elementCount:'å…ƒç´ è®¡æ•°',
      supportElements:'åŠ©åŠ›å…ƒç´ ',
      missingElements:'ç¼ºå¤±å…ƒç´ ',
      tenGods:'åç¥',
      usefulSpirit:'å–œç”¨ç¥',
      restrainElements:'åˆ¶è¡¡å…ƒç´ ',
      traits:'æ„Ÿæƒ…ç‰¹è´¨',
      marriageAdvice:'å©šå§»å»ºè®®',
      relationshipTips:'ç›¸å¤„æç¤º',
      suitableCareers:'é€‚åˆæ–¹å‘',
      careerAdvice:'å‘å±•å»ºè®®',
      favorableDirections:'æœ‰åˆ©æ–¹ä½',
      wealthCharacteristics:'è´¢è¿ç‰¹æ€§',
      wealthDirections:'æ±‚è´¢æ–¹ä½',
      financialAdvice:'ç†è´¢å»ºè®®',
      healthCharacteristics:'ä½“è´¨ç‰¹ç‚¹',
      healthTips:'å…»ç”Ÿæç¤º',
      wellnessAdvice:'æ—¥å¸¸å»ºè®®',
      overallFortune:'æ•´ä½“è¶‹åŠ¿',
      favorableTiming:'æœ‰åˆ©æ—¶æœº',
      cautions:'æ³¨æ„äº‹é¡¹'
    },

    /* æŠ¥å‘Šå†…å®¹æ¨¡æ¿ */
    report:{
      tipTitle:'æé†’',
      hourUnknownTip:'æœªæä¾›æ—¶è¾°ï¼Œéƒ¨åˆ†å†…å®¹ä»¥ä¸‰æŸ±æ¨æ–­ï¼›è¡¥ä¸Šæ—¶è¾°å°†æ›´ç²¾å‡†ã€‚',
      career:{
        steady:'ç¨³æ­¥æ¨è¿›ï¼Œç§¯ç´¯å£ç¢‘',
        leadership:'é€‚åˆå›¢é˜Ÿç®¡ç†ä¸å†³ç­–ä½',
        business:'é€‚åˆç»å•†ä¸èµ„æºæ•´åˆ',
        creative:'é€‚åˆåˆ›æ„è¡¨è¾¾ä¸å†…å®¹è¾“å‡º'
      },
      marriage:{
        stable:'ä»¥ç¨³å®šä¸ºå…ˆï¼Œé‡è§†æ²Ÿé€šä¸æ‰¿è¯º',
        experienced:'ç»å†æ³¢æŠ˜åæ›´æ‡‚ç»è¥å…³ç³»',
        default:'ä»¥çœŸè¯šä¸å°Šé‡å»ºç«‹é•¿æœŸ'
      },
      health:{
        tips:{
          jia:'é‡è§†ç­‹éª¨/è‚èƒ†è°ƒç†',
          yi:'ç–è‚ç†æ°”ã€æŸ”éŸ§è®­ç»ƒ',
          bing:'ä½œæ¯è§„å¾‹ï¼ŒæŠ¤å¿ƒæŠ¤çœ¼',
          ding:'ç¡çœ ä¼˜å…ˆï¼Œå°‘ç†¬å¤œ',
          wu:'è„¾èƒƒä¸ºæœ¬ï¼Œé¥®é£ŸèŠ‚åˆ¶',
          ji:'é¥®é£Ÿæ¸…æ·¡ï¼Œçš®è‚¤æŠ¤ç†',
          geng:'é€šé£æ¶¦è‚ºï¼Œé€‚åº¦è®­ç»ƒ',
          xin:'æŠ¤è‚ºæ¶¦ç‡¥ï¼Œè§„å¾‹å‘¼å¸',
          ren:'è¡¥è‚¾æŠ¤æ°´ï¼Œæ³¨æ„è…°éƒ¨',
          gui:'è°ƒç†è‚¾æ°”ï¼Œé¿å…è¿‡åŠ³'
        }
      }
    },

    /* å…¶å®ƒçŸ­å¥ */
    wealth:{
      stable:'åé‡ç¨³å®šç°é‡‘æµçš„ç§¯ç´¯',
      opportunity:'æœºä¼šè´¢è¾ƒå¤šï¼Œå®œè®¾æ­¢ç›ˆ',
      steady:'é‡å…¥ä¸ºå‡ºï¼Œç¨³å¥ç†è´¢'
    },
    wellness:{ default:'ä¿æŒä½œæ¯è§„å¾‹ã€é¥®é£Ÿæ¸…æ·¡ä¸é€‚åº¦è¿åŠ¨' },
    cautions:{ default:'é¿å…æƒ…ç»ªåŒ–å†³ç­–ï¼Œé‡å¤§äº‹é¡¹å…ˆåšé¢„æ¡ˆ' },
    action:{
      weekly:'æ¯å‘¨è¿›è¡Œ',
      energy:'èƒ½é‡è¡¥å……ç»ƒä¹ ï¼ˆå‘¼å¸/å†¥æƒ³/æˆ·å¤–ï¼‰',
      career:'äº‹ä¸šï¼šä¾æ®å½“å‰å¼ºé¡¹ï¼Œ',
      career2:' å¹¶é€æ­¥å¸ƒå±€é•¿æœŸç›®æ ‡',
      relationship:'æ„Ÿæƒ…ï¼šå¦è¯šæ²Ÿé€šä¸è¾¹ç•Œæ„Ÿå¹¶é‡',
      wealth:'è´¢åŠ¡ï¼šè®¾é¢„ç®—ä¸å¤ç›˜æ”¯å‡º'
    },

    /* æ—¥ä¸»ä¸€å¥è¯ */
    dayMaster:{
      jia:'ç”²æœ¨ï¼šå‘ä¸Šç”Ÿé•¿ï¼Œé‡åŸåˆ™ä¸”å…·å¼€åˆ›åŠ›',
      yi:'ä¹™æœ¨ï¼šæŸ”éŸ§åŒ…å®¹ï¼Œæ“…ä¿®é¥°ä¸ç»†æ´»',
      bing:'ä¸™ç«ï¼šçƒ­æƒ…å¤–æ”¾ï¼Œå¸¦åŠ¨æ°›å›´',
      ding:'ä¸ç«ï¼šæ¸©æš–ç»†è…»ï¼ŒæŒç»­åŠ›å¼º',
      wu:'æˆŠåœŸï¼šæ‰¿è½½åŠ›ä¸ç¨³å®šæ€§ä½³',
      ji:'å·±åœŸï¼šè°ƒå’Œå‘¨å…¨ï¼Œæ“…äºæœåŠ¡',
      geng:'åºšé‡‘ï¼šå†³æ–­æœæ•¢ï¼Œé€‚åˆè§„åˆ™ä¸æ‰§è¡Œ',
      xin:'è¾›é‡‘ï¼šç²¾è‡´å®¡ç¾ï¼Œæ³¨é‡å“è´¨',
      ren:'å£¬æ°´ï¼šæµåŠ¨æ™ºæ…§ï¼Œæ“…æ²Ÿé€šè¿æ¥',
      gui:'ç™¸æ°´ï¼šå†…æ•›æ•æ„Ÿï¼Œæ€è€ƒæ·±å…¥'
    },

    /* VIP æ¨¡å—ï¼ˆå ä½ï¼‰ */
    vip:{
      title:'VIP ä¸“åŒº',
      group:{ astrology:'å‘½ç†æ–¹å‘', spiritual:'å¿ƒçµæ–¹å‘' },
      astrology:{ match:'åˆç›˜/å©šé…', career:'äº‹ä¸š', wealth:'è´¢è¿', pet:'å® ç‰©å‘½ç†' },
      spiritual:{ record:'å¿ƒçµè®°å¿†ç³»ç»Ÿ', courses:'çµæ€§è¯¾ç¨‹', family:'å®¶æ—çºªå¿µ', practice:'èƒ½é‡ç»ƒä¹ ' },
      login:{ title:'ç™»å½•ä»¥è§£é” VIP' }
    },
    auth:{
      header:'ä¼šå‘˜ç™»å½•',
      login:'ç™»å½•',
      reset:'é‡è®¾å¯†ç ',
      register:'æ³¨å†Œ',
      freeTrialNote:'å¯å…ˆä½“éªŒå…è´¹åŠŸèƒ½'
    },
    vipServices:{ header:'ä¼šå‘˜ä¸“äº«æœåŠ¡' },
    vipUpgrade:'å‡çº§ä¸º VIP',
    vipBack:'è¿”å›',
    vipPriceNote:'$9.90/æœˆ æˆ– $9.9/å¹´',
    footer:{ copy:'Â© 5xLiving' }
  };


  // zh-TW / en / ja / th / ms dictionaries (short; fall back to zh-CN)
  I18N['zh-TW'] = Object.assign({
    pillar:{year:'å¹´æŸ±',month:'æœˆæŸ±',day:'æ—¥æŸ±',hour:'æ™‚æŸ±'},
    elem:{wood:'æœ¨',fire:'ç«',earth:'åœŸ',metal:'é‡‘',water:'æ°´',month:'æœˆ'},
    ui:{ balance:'{strongest}æœ€å¼·ï¼›{weakest}æœ€å¼±ã€‚', birthSummary:'å‡ºç”Ÿï¼š{y}-{m}-{d} {timeText}', hourSuffix:'{hh}:{mm}', timeUnknown:'å‡ºç”Ÿæ™‚é–“ä¸è©³' },
    badge:{ noHour:'æœªçŸ¥æ™‚è¾°' },
    err:{ fillBirthdate:'è«‹å¡«å¯«å‡ºç”Ÿæ—¥æœŸ', invalidDate:'æ—¥æœŸæ ¼å¼ç„¡æ•ˆ (YYYY-MM-DD)', generateFail:'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦' },
    sameQi:'åŒæ°£ç›¸åŠ©', complement:'å–è£œä»¥è¡¡', layout:'ï¼Œä½ˆå±€å½ˆæ€§èª¿æ•´'
  }, I18N['zh-TW']||{});

  I18N['en'] = Object.assign({
    pillar:{year:'Year',month:'Month',day:'Day',hour:'Hour'},
    elem:{wood:'Wood',fire:'Fire',earth:'Earth',metal:'Metal',water:'Water',month:'month'},
    ui:{ balance:'Strongest: {strongest}; Weakest: {weakest}.', birthSummary:'Birth: {y}-{m}-{d} {timeText}', hourSuffix:'{hh}:{mm}', timeUnknown:'Time unknown' },
    badge:{ noHour:'No hour' },
    err:{ fillBirthdate:'Please fill birth date', invalidDate:'Invalid date (YYYY-MM-DD)', generateFail:'Generation failed, try again' },
    sameQi:'same qi', complement:'complement', layout:', adjust layout flexibly'
  }, I18N['en']||{});

  I18N['ja'] = Object.assign({
    pillar:{year:'å¹´æŸ±',month:'æœˆæŸ±',day:'æ—¥æŸ±',hour:'æ™‚æŸ±'},
    elem:{wood:'æœ¨',fire:'ç«',earth:'åœŸ',metal:'é‡‘',water:'æ°´',month:'æœˆ'},
    ui:{ balance:'æœ€å¼·ï¼š{strongest}ï¼›æœ€å¼±ï¼š{weakest}', birthSummary:'å‡ºç”Ÿï¼š{y}-{m}-{d} {timeText}', hourSuffix:'{hh}:{mm}', timeUnknown:'å‡ºç”Ÿæ™‚é–“ä¸æ˜' },
    badge:{ noHour:'æ™‚åˆ»ä¸æ˜' },
    err:{ fillBirthdate:'ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', invalidDate:'æ—¥ä»˜å½¢å¼ãŒç„¡åŠ¹ (YYYY-MM-DD)', generateFail:'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ' },
    sameQi:'åŒæ°—', complement:'è£œã„', layout:'ã€æŸ”è»Ÿã«é…ç½®'
  }, I18N['ja']||{});

  I18N['th'] = Object.assign({
    pillar:{year:'à¸›à¸µ',month:'à¹€à¸”à¸·à¸­à¸™',day:'à¸§à¸±à¸™',hour:'à¸Šà¸±à¹ˆà¸§à¸¢à¸²à¸¡'},
    elem:{wood:'à¹„à¸¡à¹‰',fire:'à¹„à¸Ÿ',earth:'à¸”à¸´à¸™',metal:'à¸—à¸­à¸‡',water:'à¸™à¹‰à¸³',month:'à¹€à¸”à¸·à¸­à¸™'},
    ui:{ balance:'à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡à¸ªà¸¸à¸”: {strongest}; à¸­à¹ˆà¸­à¸™à¸ªà¸¸à¸”: {weakest}', birthSummary:'à¹€à¸à¸´à¸”: {y}-{m}-{d} {timeText}', hourSuffix:'{hh}:{mm}', timeUnknown:'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”' },
    badge:{ noHour:'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸Šà¸±à¹ˆà¸§à¸¢à¸²à¸¡' },
    err:{ fillBirthdate:'à¹‚à¸›à¸£à¸”à¸à¸£à¸­à¸à¸§à¸±à¸™à¹€à¸à¸´à¸”', invalidDate:'à¸£à¸¹à¸›à¹à¸šà¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ (YYYY-MM-DD)', generateFail:'à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ' },
    sameQi:'à¸à¸¥à¸±à¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™', complement:'à¹€à¸ªà¸£à¸´à¸¡à¹ƒà¸«à¹‰à¸ªà¸¡à¸”à¸¸à¸¥', layout:', à¸ˆà¸±à¸”à¸§à¸²à¸‡à¹„à¸”à¹‰à¸¢à¸·à¸”à¸«à¸¢à¸¸à¹ˆà¸™'
  }, I18N['th']||{});

  I18N['ms'] = Object.assign({
    pillar:{year:'Tahun',month:'Bulan',day:'Hari',hour:'Jam'},
    elem:{wood:'Kayu',fire:'Api',earth:'Tanah',metal:'Logam',water:'Air',month:'bulan'},
    ui:{ balance:'Terkuat: {strongest}; Terlemah: {weakest}', birthSummary:'Lahir: {y}-{m}-{d} {timeText}', hourSuffix:'{hh}:{mm}', timeUnknown:'Masa tidak diketahui' },
    badge:{ noHour:'Tiada jam' },
    err:{ fillBirthdate:'Sila isi tarikh lahir', invalidDate:'Format tarikh tidak sah (YYYY-MM-DD)', generateFail:'Gagal menjana, cuba lagi' },
    sameQi:'qi sama', complement:'pelengkap', layout:', laraskan susun atur secara fleksibel'
  }, I18N['ms']||{});

    /* æš´éœ²å·¥å…· */
  window.hardTranslate = hardTranslate;
  window.hardTranslateArray = hardTranslateArray;
  window.hardTranslateTenGods = hardTranslateTenGods;

})();


  function deepGet(obj, path){
    return String(path).split('.').reduce((o,k)=> (o && o[k] != null) ? o[k] : undefined, obj);
  }
  function t(key){
    const lang = state.lang || 'zh-CN';
    const dict = I18N[lang] || {};
    const base = I18N['zh-CN'] || {};
    let v = deepGet(dict, key); if (v != null) return v;
    if (Object.prototype.hasOwnProperty.call(dict, key)) return dict[key];
    if (key.startsWith('report.')){
      const k2 = key.slice(7);
      v = deepGet(dict, k2); if (v != null) return v;
      if (Object.prototype.hasOwnProperty.call(dict, k2)) return dict[k2];
    }
    v = deepGet(base, key); if (v != null) return v;
    if (Object.prototype.hasOwnProperty.call(base, key)) return base[key];
    if (key.startsWith('report.')){
      const k2 = key.slice(7);
      v = deepGet(base, k2); if (v != null) return v;
      if (Object.prototype.hasOwnProperty.call(base, k2)) return base[k2];
    }
    return key;
  }
  window.t = t;

  function applyI18n(){
    document.documentElement.lang = state.lang || 'zh-CN';
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      const val = t(key);
      if (typeof val === 'string') el.textContent = val;
    });
    document.querySelectorAll('option[data-i18n]').forEach(opt=>{
      const key = opt.getAttribute('data-i18n');
      const val = t(key);
      if (typeof val === 'string') opt.textContent = val;
    });
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const key = el.getAttribute('data-i18n-ph');
      const val = t(key);
      if (typeof val === 'string') el.setAttribute('placeholder', val);
    });

    // Only set auth placeholders if visible (privacy)
    const authBox = $('authBox');
    const visible = authBox && getComputedStyle(authBox).display !== 'none' && !authBox.hasAttribute('hidden') && authBox.dataset.locked !== 'true';
    if (visible){
      const email = $('email'), pw = $('password');
      if (email) email.placeholder = t('auth.emailPlaceholder') || 'Email';
      if (pw) pw.placeholder = t('auth.passwordPlaceholder') || 'Password';
    }

    if (typeof buildProReport === 'function' && window.lastCtx) buildProReport(window.lastCtx);
    if (typeof tickNow === 'function') tickNow();
  }
  window.applyI18n = applyI18n;

  function setLang(lang){
    if (!I18N[lang]) return;
    state.lang = lang;
    try { localStorage.setItem(LS_LANG_KEY, lang); } catch {}
    applyI18n();
  }
  window.setLang = setLang;

  /* ========= SG CLOCK ========= */
  function tickNow(){
    const box = $('nowBox'); if (!box) return;
    const localeMap = { 'zh-CN':'zh-CN','zh-TW':'zh-TW','en':'en-US','ja':'ja-JP','th':'th-TH','ms':'ms' };
    const loc = localeMap[state.lang] || 'en-US';
    const fmt = new Intl.DateTimeFormat(loc, {
      weekday:'short', year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', hour12:false, timeZone: SG_TZ
    });
    box.textContent = fmt.format(new Date()) + ' (SGT)';
  }
  window.tickNow = tickNow;

  /* ========= BAZI CORE ========= */
  class BaziCalculator {
    constructor(){
      this.HEAVENLY_STEMS=['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
      this.EARTHLY_BRANCHES=['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
      this.NAYIN=['æµ·ä¸­é‡‘','ç‚‰ä¸­ç«','å¤§æ—æœ¨','è·¯æ—åœŸ','å‰‘é”‹é‡‘','å±±å¤´ç«','æ¶§ä¸‹æ°´','åŸå¤´åœŸ','ç™½èœ¡é‡‘','æ¨æŸ³æœ¨','æ³‰ä¸­æ°´','å±‹ä¸ŠåœŸ','éœ¹é›³ç«','æ¾æŸæœ¨','é•¿æµæ°´','ç ‚çŸ³é‡‘','å±±ä¸‹ç«','å¹³åœ°æœ¨','å£ä¸ŠåœŸ','é‡‘ç®”é‡‘','ä½›ç¯ç«','å¤©æ²³æ°´','å¤§é©¿åœŸ','é’—é’é‡‘','æ¡‘æŸ˜æœ¨','å¤§æºªæ°´','æ²™ä¸­åœŸ','å¤©ä¸Šç«','çŸ³æ¦´æœ¨','å¤§æµ·æ°´'];
    }
    yearPillar(year){
      const s=(year-4)%10, b=(year-4)%12;
      return {stem:this.HEAVENLY_STEMS[(s+10)%10], branch:this.EARTHLY_BRANCHES[(b+12)%12]};
    }
    solarMonthIndex(y,m,d){
      const mmdd=m*100+d;
      const gates=[[106,12],[204,1],[306,2],[405,3],[506,4],[606,5],[707,6],[808,7],[908,8],[1008,9],[1107,10],[1207,11]];
      let idx=11; for(const [thr,val] of gates){ if(mmdd>=thr) idx=val; }
      const branchBy={1:'å¯…',2:'å¯',3:'è¾°',4:'å·³',5:'åˆ',6:'æœª',7:'ç”³',8:'é…‰',9:'æˆŒ',10:'äº¥',11:'å­',12:'ä¸‘'};
      return {index:idx, branch:branchBy[idx]};
    }
    monthPillar(year,month,day){
      const {index,branch}=this.solarMonthIndex(year,month,day);
      const yStemIdx=this.HEAVENLY_STEMS.indexOf(this.yearPillar(year).stem);
      const startMap={0:2,1:4,2:6,3:8,4:0,5:2,6:4,7:6,8:8,9:0};
      const stemIdx=(startMap[yStemIdx]+(index-1))%10;
      return {stem:this.HEAVENLY_STEMS[stemIdx], branch};
    }
    dayPillar(year,month,day){
      const baseUTC=Date.UTC(1900,0,31), targetUTC=Date.UTC(year,month-1,day);
      const dayDiff=Math.floor((targetUTC-baseUTC)/86400000);
      const stemIdx=(0+dayDiff)%10, branchIdx=(4+dayDiff)%12;
      return {stem:this.HEAVENLY_STEMS[(stemIdx+10)%10],branch:this.EARTHLY_BRANCHES[(branchIdx+12)%12]};
    }
    hourPillar(dayStem,hour){
      const branchMap={23:'å­',0:'å­',1:'ä¸‘',2:'ä¸‘',3:'å¯…',4:'å¯…',5:'å¯',6:'å¯',7:'è¾°',8:'è¾°',9:'å·³',10:'å·³',11:'åˆ',12:'åˆ',13:'æœª',14:'æœª',15:'ç”³',16:'ç”³',17:'é…‰',18:'é…‰',19:'æˆŒ',20:'æˆŒ',21:'äº¥',22:'äº¥'};
      const startMap={0:0,1:2,2:4,3:6,4:8,5:0,6:2,7:4,8:6,9:8};
      const dayIdx=this.HEAVENLY_STEMS.indexOf(dayStem);
      const hourIndex=Math.floor((hour+1)/2)%12;
      const stemIdx=(startMap[dayIdx]+hourIndex)%10;
      return {stem:this.HEAVENLY_STEMS[stemIdx], branch:branchMap[hour]};
    }
    stemElem(s){ return ({ç”²:'æœ¨',ä¹™:'æœ¨',ä¸™:'ç«',ä¸:'ç«',æˆŠ:'åœŸ',å·±:'åœŸ',åºš:'é‡‘',è¾›:'é‡‘',å£¬:'æ°´',ç™¸:'æ°´'})[s]||'-'; }
    branchElem(b){ return ({å­:'æ°´',ä¸‘:'åœŸ',å¯…:'æœ¨',å¯:'æœ¨',è¾°:'åœŸ',å·³:'ç«',åˆ:'ç«',æœª:'åœŸ',ç”³:'é‡‘',é…‰:'é‡‘',æˆŒ:'åœŸ',äº¥:'æ°´'})[b]||'-'; }
    nayin(s,b){ const si=this.HEAVENLY_STEMS.indexOf(s), bi=this.EARTHLY_BRANCHES.indexOf(b); return this.NAYIN[(si*2+bi)%this.NAYIN.length]; }
    tenGods(dayStem, stems){
      const map={
        'ç”²':{'ç”²':'æ¯”è‚©','ä¹™':'åŠ«è´¢','ä¸™':'é£Ÿç¥','ä¸':'ä¼¤å®˜','æˆŠ':'åè´¢','å·±':'æ­£è´¢','åºš':'ä¸ƒæ€','è¾›':'æ­£å®˜','å£¬':'åå°','ç™¸':'æ­£å°'},
        'ä¹™':{'ç”²':'åŠ«è´¢','ä¹™':'æ¯”è‚©','ä¸™':'ä¼¤å®˜','ä¸':'é£Ÿç¥','æˆŠ':'æ­£è´¢','å·±':'åè´¢','åºš':'æ­£å®˜','è¾›':'ä¸ƒæ€','å£¬':'æ­£å°','ç™¸':'åå°'},
        'ä¸™':{'ç”²':'åå°','ä¹™':'æ­£å°','ä¸™':'æ¯”è‚©','ä¸':'åŠ«è´¢','æˆŠ':'é£Ÿç¥','å·±':'ä¼¤å®˜','åºš':'åè´¢','è¾›':'æ­£è´¢','å£¬':'ä¸ƒæ€','ç™¸':'æ­£å®˜'},
        'ä¸':{'ç”²':'æ­£å°','ä¹™':'åå°','ä¸™':'åŠ«è´¢','ä¸':'æ¯”è‚©','æˆŠ':'ä¼¤å®˜','å·±':'é£Ÿç¥','åºš':'æ­£è´¢','è¾›':'åè´¢','å£¬':'æ­£å®˜','ç™¸':'ä¸ƒæ€'},
        'æˆŠ':{'ç”²':'ä¸ƒæ€','ä¹™':'æ­£å®˜','ä¸™':'åå°','ä¸':'æ­£å°','æˆŠ':'æ¯”è‚©','å·±':'åŠ«è´¢','åºš':'é£Ÿç¥','è¾›':'ä¼¤å®˜','å£¬':'åè´¢','ç™¸':'æ­£è´¢'},
        'å·±':{'ç”²':'æ­£å®˜','ä¹™':'ä¸ƒæ€','ä¸™':'æ­£å°','ä¸':'åå°','æˆŠ':'åŠ«è´¢','å·±':'æ¯”è‚©','åºš':'ä¼¤å®˜','è¾›':'é£Ÿç¥','å£¬':'æ­£è´¢','ç™¸':'åè´¢'},
        'åºš':{'ç”²':'åè´¢','ä¹™':'æ­£è´¢','ä¸™':'ä¸ƒæ€','ä¸':'æ­£å®˜','æˆŠ':'åå°','å·±':'æ­£å°','åºš':'æ¯”è‚©','è¾›':'åŠ«è´¢','å£¬':'é£Ÿç¥','ç™¸':'ä¼¤å®˜'},
        'è¾›':{'ç”²':'æ­£è´¢','ä¹™':'åè´¢','ä¸™':'æ­£å®˜','ä¸':'ä¸ƒæ€','æˆŠ':'æ­£å°','å·±':'åå°','åºš':'åŠ«è´¢','è¾›':'æ¯”è‚©','å£¬':'ä¼¤å®˜','ç™¸':'é£Ÿç¥'},
        'å£¬':{'ç”²':'é£Ÿç¥','ä¹™':'ä¼¤å®˜','ä¸™':'åè´¢','ä¸':'æ­£è´¢','æˆŠ':'ä¸ƒæ€','å·±':'æ­£å®˜','åºš':'åå°','è¾›':'æ­£å°','å£¬':'æ¯”è‚©','ç™¸':'åŠ«è´¢'},
        'ç™¸':{'ç”²':'ä¼¤å®˜','ä¹™':'é£Ÿç¥','ä¸™':'æ­£è´¢','ä¸':'åè´¢','æˆŠ':'æ­£å®˜','å·±':'ä¸ƒæ€','åºš':'æ­£å°','è¾›':'åå°','å£¬':'åŠ«è´¢','ç™¸':'æ¯”è‚©'}
      };
      const m=map[dayStem]||{}; return stems.map(s=>m[s]||'-');
    }
  }
  const calc = new BaziCalculator();
  window.calc = calc;

  /* ========= HELPERS ========= */
  function stemToPinyin(stem){
    const map = {'ç”²':'jia','ä¹™':'yi','ä¸™':'bing','ä¸':'ding','æˆŠ':'wu','å·±':'ji','åºš':'geng','è¾›':'xin','å£¬':'ren','ç™¸':'gui'};
    return map[stem] || String(stem).toLowerCase();
  }
  function countElements(arr){
    const c = {æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    (arr||[]).forEach(e=>{ if (c[e] != null) c[e]++; });
    return c;
  }

  /* ========= UI UTIL ========= */
  function showErr(msg){
    const box=$('error'); if(!box) return;
    box.textContent = msg || t('err.generateFail');
    box.style.display = 'block';
    setTimeout(()=>{ box.style.display='none'; }, 4000);
  }
  function setGenLoading(v){
    const btn=$('genBtn'), txt=$('genBtnText'), ld=$('genBtnLoading');
    if (btn) btn.disabled = !!v;
    if (txt) txt.style.display = v ? 'none' : 'inline';
    if (ld) ld.style.display = v ? 'inline' : 'none';
  }

  /* ========= RENDERERS ========= */
  function renderPillars(labels){
    const titles=[t('pillar.year'),t('pillar.month'),t('pillar.day'),t('pillar.hour')];
    const box = $('bazi-pillars'); if(!box) return;
    box.innerHTML = labels.map((lab,i)=>`
      <div class="pillar"><div class="tit">${titles[i]}</div><div class="gz">${lab||'-'}</div></div>
    `).join('');
  }
  function renderTable(data){
    const keys=['year','month','day','hour'];
    ['stem','branch','element','nayin'].forEach(row=>{
      keys.forEach((k,i)=>{
        const cell=$(k+'-'+row); if(!cell) return;
        let v = (Array.isArray(data[row]) ? data[row][i] : '-') ?? '-';
        if (row==='element') v = window.hardTranslate(v);
        cell.textContent = v;
      });
    });
  }
  function renderBars(pcts){
    ['æœ¨','ç«','åœŸ','é‡‘','æ°´'].forEach(e=>{
      const pct=Math.max(0,Math.min(100,Math.round((pcts||{})[e]||0)));
      const bar=$('bar-'+e), lab=$('pct-'+e);
      if(bar) bar.style.width=pct+'%';
      if(lab) lab.textContent=pct+'%';
    });
    const entries=Object.entries(pcts||{}).sort((a,b)=>b[1]-a[1]);
    if(entries.length){
      const strongest=entries[0][0], weakest=entries[entries.length-1][0];
      const mapName={æœ¨:t('elem.wood'),ç«:t('elem.fire'),åœŸ:t('elem.earth'),é‡‘:t('elem.metal'),æ°´:t('elem.water')};
      const tpl=(t('ui.balance')||'{strongest} strongest; {weakest} weakest.');
      const txt=tpl.replace('{strongest}', mapName[strongest]).replace('{weakest}', mapName[weakest]);
      const el=$('bazi-elements-balance'); if(el) el.textContent=txt;
    }
    return pcts;
  }
  window.renderBars = renderBars;

  /* ========= ANALYSIS ========= */
  const BaziAnalysis = {
    dayMasterLine(stem){ return t('dayMaster.'+stemToPinyin(stem)) || (stem + calc.stemElem(stem)); },
    relation(dayStem){
      const dict={'ç”²':{traits:'æ„Ÿæƒ…è¾ƒä¸ºä¸»åŠ¨ï¼Œå–œæ¬¢æŒæ§èŠ‚å¥',tips:'å¤šè†å¬ã€å¤šåŒ…å®¹'},
      'ä¹™':{traits:'æ¸©æŸ”ç»†è…»ï¼Œé‡è§†å®‰å…¨æ„Ÿ',tips:'è¡¨è¾¾éœ€æ±‚ï¼Œå»ºç«‹è¾¹ç•Œ'},
      'ä¸™':{traits:'çƒ­æƒ…å¤–æ”¾ï¼Œæƒ…ç»ªæ³¢åŠ¨è¾ƒå¤§',tips:'æ§åˆ¶èŠ‚å¥ï¼Œç¨³å®šæ²Ÿé€š'},
      'ä¸':{traits:'ç»†æ°´é•¿æµï¼Œä¸“æ³¨ä¸é™ªä¼´',tips:'å‡å°‘çŒœç–‘ï¼Œç»™ä¿¡ä»»'},
      'æˆŠ':{traits:'ç¨³é‡åŠ¡å®ï¼Œé¡¾å®¶',tips:'å­¦ä¼šæµªæ¼«è¡¨è¾¾'},
      'å·±':{traits:'ä½“è´´å‘¨åˆ°ï¼Œæ˜“é¡¾è™‘',tips:'æå‡è‡ªä¿¡ï¼Œä¸å¿…è¿‡åº¦æ‹…å¿§'},
      'åºš':{traits:'ç›´æ¥æœæ–­',tips:'ç…§é¡¾å¯¹æ–¹æ„Ÿå—'},
      'è¾›':{traits:'è¿½æ±‚å®Œç¾',tips:'æ¥å—ä¸å®Œç¾'},
      'å£¬':{traits:'å¤šå˜çµåŠ¨',tips:'ä¿æŒç¨³å®šä¸æ‰¿è¯º'},
      'ç™¸':{traits:'æ•æ„Ÿç»†è…»',tips:'ç»ƒä¹ æƒ…ç»ªç®¡ç†'}};
      return dict[dayStem]||{traits:'æ„Ÿæƒ…å¹³ç¨³',tips:'å°Šé‡ä¸æ²Ÿé€š'};
    },
    marriageAdvice(ten){
      if(ten.includes('æ­£å®˜')||ten.includes('æ­£è´¢')) return t('report.marriage.stable');
      if(ten.includes('ä¸ƒæ€')||ten.includes('åè´¢')) return t('report.marriage.experienced');
      return t('report.marriage.default');
    },
    career(dayStem,ten){
      const map={ç”²:'ç®¡ç†/å¼€æ‹“/å·¥ç¨‹',ä¹™:'æ•™è‚²/è®¾è®¡/å’¨è¯¢',ä¸™:'å¸‚åœº/ä¼ åª’/èƒ½æº',ä¸:'ç ”å‘/åŒ»ç–—/ç²¾å¯†',æˆŠ:'é‡‘è/åœ°äº§/èµ„æº',å·±:'æœåŠ¡/å†œä¸š/äººèµ„',åºš:'æ³•å¾‹/æœºæ¢°/å†›è­¦',è¾›:'é‡‘è/ç å®/å®¡è®¡',å£¬:'è´¸æ˜“/ç‰©æµ/æ—…æ¸¸',ç™¸:'ç ”ç©¶/å¿ƒç†/è‰ºæœ¯'};
      let adv='report.career.steady';
      if(ten.includes('æ­£å®˜')||ten.includes('ä¸ƒæ€')) adv='report.career.leadership';
      else if(ten.includes('æ­£è´¢')||ten.includes('åè´¢')) adv='report.career.business';
      else if(ten.includes('é£Ÿç¥')||ten.includes('ä¼¤å®˜')) adv='report.career.creative';
      return {suitable:map[dayStem]||t('report.career.steady'), advice:adv};
    },
    wealthDirs(dayStem){
      const dirs={ç”²:'ä¸œæ–¹ã€ä¸œå—æ–¹',ä¹™:'ä¸œæ–¹ã€å—æ–¹',ä¸™:'å—æ–¹',ä¸:'å—æ–¹ã€è¥¿å—æ–¹',æˆŠ:'ä¸­éƒ¨ã€æœ¬åœ°',å·±:'ä¸­éƒ¨ã€è¥¿å—æ–¹',åºš:'è¥¿æ–¹ã€è¥¿åŒ—æ–¹',è¾›:'è¥¿æ–¹ã€åŒ—æ–¹',å£¬:'åŒ—æ–¹',ç™¸:'åŒ—æ–¹ã€ä¸œæ–¹'};
      return dirs[dayStem]||'-';
    },
    financeAdvice(ten){
      if(ten.includes('åè´¢')) return 'é€‚å½“æŠ•èµ„ç†è´¢ï¼Œæ§åˆ¶é£é™©ï¼Œè§å¥½å°±æ”¶';
      if(ten.includes('æ­£è´¢')) return 'ç¨³æ‰ç¨³æ‰“ï¼Œé€šè¿‡ä¸“ä¸šä¸ç¨³å®šæ”¶å…¥ç§¯ç´¯è´¢å¯Œ';
      return 'é‡å…¥ä¸ºå‡ºï¼Œåšå¥½è§„åˆ’ï¼Œé¿å…ä¸å¿…è¦å¼€æ”¯';
    },
    health(dayStem){
      const c={ç”²:'è‚èƒ†/ç­‹éª¨',ä¹™:'è‚æ°”/æƒ…ç»ª',ä¸™:'å¿ƒè¡€ç®¡/çœ¼ç›',ä¸:'å¿ƒè„/ç¡çœ ',æˆŠ:'è„¾èƒƒ/é¥®é£Ÿ',å·±:'è„¾èƒƒ/çš®è‚¤',åºš:'å‘¼å¸/å¤§è‚ ',è¾›:'è‚ºéƒ¨/ç‡¥',å£¬:'è‚¾/æ³Œå°¿/æ°´åˆ†',ç™¸:'è‚¾/è†€èƒ±/é¿å…è¿‡åŠ³'};
      return c[dayStem]||'ä½“è´¨å¹³è¡¡ï¼Œè§„å¾‹ä½œæ¯';
    }
  };
  window.BaziAnalysis = BaziAnalysis;

  /* ========= REPORT (10 sections) ========= */
  function i18nDirs(s){
    if(!s) return '';
    const L = state.lang || 'zh-CN';
  const maps = {
    'zh-CN': {
      'ä¸œæ–¹':'ä¸œæ–¹','ä¸œå—æ–¹':'ä¸œå—æ–¹','å—æ–¹':'å—æ–¹','è¥¿å—æ–¹':'è¥¿å—æ–¹','è¥¿æ–¹':'è¥¿æ–¹','è¥¿åŒ—æ–¹':'è¥¿åŒ—æ–¹','åŒ—æ–¹':'åŒ—æ–¹','ä¸œåŒ—æ–¹':'ä¸œåŒ—æ–¹','ä¸­éƒ¨ã€æœ¬åœ°':'ä¸­éƒ¨/æœ¬åœ°'
    },
    'zh-TW': {
      'ä¸œæ–¹':'æ±æ–¹','ä¸œå—æ–¹':'æ±å—æ–¹','å—æ–¹':'å—æ–¹','è¥¿å—æ–¹':'è¥¿å—æ–¹','è¥¿æ–¹':'è¥¿æ–¹','è¥¿åŒ—æ–¹':'è¥¿åŒ—æ–¹','åŒ—æ–¹':'åŒ—æ–¹','ä¸œåŒ—æ–¹':'æ±åŒ—æ–¹','ä¸­éƒ¨ã€æœ¬åœ°':'ä¸­éƒ¨/æœ¬åœ°'
    },
    'en': {
      'ä¸œæ–¹':'East','ä¸œå—æ–¹':'Southeast','å—æ–¹':'South','è¥¿å—æ–¹':'Southwest','è¥¿æ–¹':'West','è¥¿åŒ—æ–¹':'Northwest','åŒ—æ–¹':'North','ä¸œåŒ—æ–¹':'Northeast','ä¸­éƒ¨ã€æœ¬åœ°':'Center / Local'
    },
    'ja': {
      'ä¸œæ–¹':'æ±æ–¹ï¼ˆã²ãŒã—ï¼‰','ä¸œå—æ–¹':'æ±å—ï¼ˆã¨ã†ãªã‚“ï¼‰','å—æ–¹':'å—ï¼ˆã¿ãªã¿ï¼‰','è¥¿å—æ–¹':'è¥¿å—ï¼ˆã›ã„ãªã‚“ï¼‰',
      'è¥¿æ–¹':'è¥¿ï¼ˆã«ã—ï¼‰','è¥¿åŒ—æ–¹':'è¥¿åŒ—ï¼ˆã›ã„ã»ãï¼‰','åŒ—æ–¹':'åŒ—ï¼ˆããŸï¼‰','ä¸œåŒ—æ–¹':'åŒ—æ±ï¼ˆã»ãã¨ã†ï¼‰','ä¸­éƒ¨ã€æœ¬åœ°':'ä¸­å¤®ï¼ç¾åœ°ï¼ˆã¡ã‚…ã†ãŠã†ï¼ã’ã‚“ã¡ï¼‰'
    },
    'th': {
      'ä¸œæ–¹':'à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸','ä¸œå—æ–¹':'à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸à¹€à¸‰à¸µà¸¢à¸‡à¹ƒà¸•à¹‰','å—æ–¹':'à¹ƒà¸•à¹‰','è¥¿å—æ–¹':'à¸•à¸°à¸§à¸±à¸™à¸•à¸à¹€à¸‰à¸µà¸¢à¸‡à¹ƒà¸•à¹‰',
      'è¥¿æ–¹':'à¸•à¸°à¸§à¸±à¸™à¸•à¸','è¥¿åŒ—æ–¹':'à¸•à¸°à¸§à¸±à¸™à¸•à¸à¹€à¸‰à¸µà¸¢à¸‡à¹€à¸«à¸™à¸·à¸­','åŒ—æ–¹':'à¹€à¸«à¸™à¸·à¸­','ä¸œåŒ—æ–¹':'à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸à¹€à¸‰à¸µà¸¢à¸‡à¹€à¸«à¸™à¸·à¸­','ä¸­éƒ¨ã€æœ¬åœ°':'à¸à¸¶à¹ˆà¸‡à¸à¸¥à¸²à¸‡/à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¹ƒà¸à¸¥à¹‰'
    },
    'ms': {
      'ä¸œæ–¹':'Timur','ä¸œå—æ–¹':'Tenggara','å—æ–¹':'Selatan','è¥¿å—æ–¹':'Barat Daya',
      'è¥¿æ–¹':'Barat','è¥¿åŒ—æ–¹':'Barat Laut','åŒ—æ–¹':'Utara','ä¸œåŒ—æ–¹':'Timur Laut','ä¸­éƒ¨ã€æœ¬åœ°':'Tengah/Tempatan'
    }
  };
    const map = maps[L] || maps['en'];
    return Object.keys(map).reduce((acc,k)=> acc.replaceAll(k, map[k]), s);
  }

  function buildProReport(ctx){
    const host = $('professionalReport'); if(!host) return;
    window.lastCtx = ctx;

    const dayStem = ctx.dayStem || (ctx.day && ctx.day.stem) || '-';
    const pcts = ctx.pcts || {æœ¨:0,ç«:0,åœŸ:0,é‡‘:0,æ°´:0};
    const unknown = !!ctx.unknown;

    const allElems = [
      ctx.yearElem, ctx.monthElem, ctx.dayElem, ctx.hourElem,
      calc.branchElem(ctx.year.branch), calc.branchElem(ctx.month.branch), calc.branchElem(ctx.day.branch),
      ctx.hour && ctx.hour.branch ? calc.branchElem(ctx.hour.branch) : null
    ].filter(Boolean);
    const eCnt = countElements(allElems);
    const entries = Object.entries(eCnt).sort((a,b)=>b[1]-a[1]);
    const strongest = entries[0]?.[0] || 'æœ¨';
    const zeros = Object.entries(eCnt).filter(([_,v])=>v===0).map(([k])=>k);
    const weakest = zeros[0] || entries[entries.length-1]?.[0] || 'æ°´';

    const stems = [ctx.year.stem, ctx.month.stem, ctx.day.stem, (ctx.hour && ctx.hour.stem)||'-'].filter(s=>s && s!=='-');
    const tgArr = stems.length ? calc.tenGods(dayStem, stems) : ['-'];

    const S = {
      titles: (I18N[state.lang] && I18N[state.lang].reportTitles) || I18N['zh-CN'].reportTitles,
      labels: (I18N[state.lang] && I18N[state.lang].reportLabels) || I18N['zh-CN'].reportLabels
    };
    const dmLine = t('dayMaster.'+stemToPinyin(dayStem)) || (dayStem + calc.stemElem(dayStem));
    const hourNote = unknown ? `<div class="ai-box"><div class="ai-box-h">${t('report.tipTitle')}</div><div class="ai-box-c">${t('report.hourUnknownTip')}</div></div>` : '';

    function supportElems(dm){
      const map={ç”²:['æ°´','æœ¨'],ä¹™:['æ°´','æœ¨'],ä¸™:['æœ¨','ç«'],ä¸:['æœ¨','ç«'],æˆŠ:['ç«','åœŸ'],å·±:['ç«','åœŸ'],åºš:['åœŸ','é‡‘'],è¾›:['åœŸ','é‡‘'],å£¬:['é‡‘','æ°´'],ç™¸:['é‡‘','æ°´']};
      return (map[dm]||[]).map(window.hardTranslate).join('ã€') || '-';
    }
    function restrainElems(dm){
      const map={ç”²:['é‡‘'],ä¹™:['é‡‘'],ä¸™:['æ°´'],ä¸:['æ°´'],æˆŠ:['æœ¨'],å·±:['æœ¨'],åºš:['ç«'],è¾›:['ç«'],å£¬:['åœŸ'],ç™¸:['åœŸ']};
      return (map[dm]||[]).map(window.hardTranslate).join('ã€') || '-';
    }
    function computeUseful(p){
      return Object.entries({æœ¨:p.æœ¨||0,ç«:p.ç«||0,åœŸ:p.åœŸ||0,é‡‘:p.é‡‘||0,æ°´:p.æ°´||0})
        .sort((a,b)=>a[1]-b[1]).slice(0,2).map(([k])=>window.hardTranslate(k)).join('ã€') || '-';
    }
    function wealthTrait(tg){
      const s=tg.join(',');
      if(s.includes('æ­£è´¢')) return t('wealth.stable');
      if(s.includes('åè´¢')) return t('wealth.opportunity');
      return t('wealth.steady');
    }
    function nearTermOverall(strong,weak){
      if (!strong || strong===weak) return t('fortune.steady');
      if (strong==='æœ¨'||strong==='ç«') return t('fortune.upward');
      if (strong==='é‡‘') return t('fortune.focus');
      if (strong==='æ°´') return t('fortune.study');
      return t('fortune.foundation');
    }

    const html = `
      ${hourNote}
      <div class="butler-section">
        <h4>${S.titles.overview}</h4>
        <div>${S.labels.dayMaster}ï¼š${window.hardTranslate(ctx.day.stem)}${window.hardTranslate(calc.stemElem(ctx.day.stem))}ï½œ${dmLine}</div>
        <div>${S.labels.strength}ï¼š${t('fortune.steady')}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.fiveElements}</h4>
        <div>${S.labels.elementCount}ï¼š${window.hardTranslate('æœ¨')}${eCnt.æœ¨||0} ${window.hardTranslate('ç«')}${eCnt.ç«||0} ${window.hardTranslate('åœŸ')}${eCnt.åœŸ||0} ${window.hardTranslate('é‡‘')}${eCnt.é‡‘||0} ${window.hardTranslate('æ°´')}${eCnt.æ°´||0}</div>
        <div>${(t('ui.balance')||'{strongest} strongest; {weakest} weakest.')
          .replace('{strongest}', window.hardTranslate(strongest))
          .replace('{weakest}', window.hardTranslate(weakest))}</div>
        <div>${S.labels.supportElements}ï¼š${supportElems(ctx.day.stem)}</div>
        <div>${S.labels.missingElements}ï¼š${(zeros.map(window.hardTranslate).join('ã€')) || '-'}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.tenGods}</h4>
        <div>${S.labels.tenGods}ï¼š${window.hardTranslateTenGods(tgArr.join('ã€'))}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.useful}</h4>
        <div>${S.labels.usefulSpirit}ï¼š${computeUseful(pcts)}</div>
        <div>${S.labels.supportElements}ï¼š${supportElems(dayStem)}</div>
        <div>${S.labels.restrainElements}ï¼š${restrainElems(dayStem)}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.relationship}</h4>
        <div>${S.labels.traits}ï¼š${BaziAnalysis.relation(dayStem).traits}</div>
        <div>${S.labels.marriageAdvice}ï¼š${BaziAnalysis.marriageAdvice(tgArr)}</div>
        <div>${S.labels.relationshipTips}ï¼š${BaziAnalysis.relation(dayStem).tips}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.career}</h4>
        <div>${S.labels.suitableCareers}ï¼š${BaziAnalysis.career(dayStem, tgArr).suitable}</div>
        <div>${S.labels.careerAdvice}ï¼š${t(BaziAnalysis.career(dayStem, tgArr).advice)}</div>
        <div>${S.labels.favorableDirections}ï¼š${i18nDirs(BaziAnalysis.wealthDirs(dayStem))}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.wealth}</h4>
        <div>${S.labels.wealthCharacteristics}ï¼š${wealthTrait(tgArr)}</div>
        <div>${S.labels.wealthDirections}ï¼š${i18nDirs(BaziAnalysis.wealthDirs(dayStem))}</div>
        <div>${S.labels.financialAdvice}ï¼š${BaziAnalysis.financeAdvice(tgArr)}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.health}</h4>
        <div>${S.labels.healthCharacteristics}ï¼š${BaziAnalysis.health(dayStem)}</div>
        <div>${S.labels.healthTips}ï¼š${t('report.health.tips.'+stemToPinyin(dayStem)) || t('report.health.tips.jia')}</div>
        <div>${S.labels.wellnessAdvice}ï¼š${t('wellness.default')}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.nearTerm}</h4>
        <div>${S.labels.overallFortune}ï¼š${nearTermOverall(strongest, weakest)}</div>
        <div>${S.labels.favorableTiming}ï¼š${strongest ? 'é€¢'+window.hardTranslate(strongest)+t('elem.month')+'ï¼ˆ'+t('sameQi')+'ï¼‰' : 'â€”'}${weakest ? 'ï¼Œæˆ–'+window.hardTranslate(weakest)+t('elem.month')+'ï¼ˆ'+t('complement')+'ï¼‰' : ''}${t('layout')}</div>
        <div>${S.labels.cautions}ï¼š${t('cautions.default')}</div>
      </div>

      <div class="butler-section">
        <h4>${S.titles.actions}</h4>
        <ul class="action-list">
          <li>${t('action.weekly')} ${weakest ? window.hardTranslate(weakest) : t('elem.fiveElements')} ${t('action.energy')}</li>
          <li>${t('action.career')}${t(BaziAnalysis.career(dayStem, tgArr).advice)}${t('action.career2')}</li>
          <li>${t('action.relationship')}</li>
          <li>${t('action.wealth')}</li>
        </ul>
      </div>
    `;
    host.innerHTML = html;

    const proBox = $('butlerProfessional');
    if (proBox) proBox.style.display = 'block';
  }
  window.buildProReport = buildProReport;

  /* ========= GENERATE ========= */
  function renderResultBarsFromCounts(counts){
    const total = Object.values(counts).reduce((a,b)=>a+b,0) || 1;
    return Object.fromEntries(Object.entries(counts).map(([k,v])=>[k, 100*v/total]));
  }

  function generate(){
    const birth = ($('birthdate')?.value||'').trim();
    if(!birth) return showErr(t('err.fillBirthdate'));
    if(!/^\d{4}-\d{2}-\d{2}$/.test(birth)) return showErr(t('err.invalidDate'));
    const [Y,M,D]=birth.split('-').map(n=>parseInt(n,10));
    const unknown = !!($('timeUnknown')?.checked);
    const timeVal = $('birthtime')?.value || '00:00';
    const [hhStr, mmStr] = timeVal.split(':');
    const hh = parseInt(hhStr||'0',10) || 0;

    setGenLoading(true);
    try{
      const y = calc.yearPillar(Y);
      const m = calc.monthPillar(Y,M,D);
      const d = calc.dayPillar(Y,M,D);
      const h = unknown ? {stem:'-',branch:'-'} : calc.hourPillar(d.stem, hh);

      const labels=[y.stem+y.branch, m.stem+m.branch, d.stem+d.branch, unknown? (t('badge.noHour')||'-') : (h.stem+h.branch)];
      renderPillars(labels);

      const stems=[y.stem,m.stem,d.stem, unknown? '-' : h.stem];
      const branch=[y.branch,m.branch,d.branch, unknown? '-' : h.branch];
      const rawElems=[calc.stemElem(y.stem),calc.stemElem(m.stem),calc.stemElem(d.stem), unknown? '-' : calc.stemElem(h.stem)];
      const elements = rawElems.map(e => window.hardTranslate(e));
      const nayin=[calc.nayin(y.stem,y.branch),calc.nayin(m.stem,m.branch),calc.nayin(d.stem,d.branch), unknown? '-' : calc.nayin(h.stem,h.branch)];
      renderTable({stem:stems,branch:branch,element:elements,nayin});

      const allElems = [calc.stemElem(y.stem),calc.stemElem(m.stem),calc.stemElem(d.stem)]
        .concat(unknown?[]:[calc.stemElem(h.stem)])
        .concat([calc.branchElem(y.branch),calc.branchElem(m.branch),calc.branchElem(d.branch)])
        .concat(unknown?[]:[calc.branchElem(h.branch)]);
      const counts = countElements(allElems);
      const pcts = renderResultBarsFromCounts(counts);
      renderBars(pcts);

      const timeText = unknown ? (t('ui.timeUnknown')||'') : (t('ui.hourSuffix')||'{hh}:{mm}')
        .replace('{hh}', String(hh).padStart(2,'0'))
        .replace('{mm}', String(parseInt(mmStr||'0',10)||0).padStart(2,'0'));
      const btxt = (t('ui.birthSummary')||'')
        .replace('{y}',Y).replace('{m}',M).replace('{d}',D)
        .replace('{timeText}', timeText);
      const bd=$('bazi-date'); if (bd) bd.textContent = btxt;

      const tg = calc.tenGods(d.stem, stems.filter(s=>s && s!=='-'));
      const ctx = {
        pcts, dayStem: d.stem, tenGods: tg, unknown,
        year: y, month: m, day: d, hour: h,
        yearElem: calc.stemElem(y.stem), monthElem: calc.stemElem(m.stem),
        dayElem: calc.stemElem(d.stem), hourElem: (h.stem && h.stem!=='-') ? calc.stemElem(h.stem) : null
      };
      buildProReport(ctx);

      const r=$('result'), b=$('butlerProfessional');
      if(r) r.style.display='block';
      if(b) b.style.display='block';
    }catch(e){
      console.error(e);
      showErr(t('err.generateFail'));
    }finally{
      setGenLoading(false);
    }
  }
  window.generate = generate;

  /* ========= AUTH: HIDE BY DEFAULT ========= */
  function setupAuthReveal(){
    const fields = $('authFields'); if (!fields) return;
    fields.style.display='none';
    const btn = document.createElement('button');
    btn.type='button';
    btn.className='btn ghost block';
    btn.id='revealAuthBtn';
    btn.textContent = 'ğŸ‘ æ˜¾ç¤ºè´¦å·è¾“å…¥ / Reveal login fields';
    const panelBody = fields.parentElement || fields;
    panelBody.insertBefore(btn, panelBody.firstChild);
    btn.addEventListener('click', ()=>{
      const visible = fields.style.display!=='none';
      fields.style.display = visible ? 'none' : 'grid';
      btn.textContent = visible ? 'ğŸ‘ æ˜¾ç¤ºè´¦å·è¾“å…¥ / Reveal login fields' : 'ğŸ™ˆ éšè—è´¦å·è¾“å…¥ / Hide login fields';
      applyI18n();
    });
    function block(e){
      e?.preventDefault();
      const err=$('authError'); if(err){ err.style.display='block'; err.textContent='Auth not wired yet / ç™»å½•æš‚æœªæ¥å…¥'; setTimeout(()=>err.style.display='none',3000); }
    }
    $('loginForm')?.addEventListener('submit', block);
    $('registerForm')?.addEventListener('submit', block);
    $('resetBtn')?.addEventListener('click', block);
  }

  /* ========= BOOT ========= */
  function onLangChange(e){ setLang(e.target?.value || 'zh-CN'); }

  function boot(){
    if (boot._didBoot) return; boot._didBoot = true;

    const langSel = $('langSelect');
    if (langSel){
      langSel.value = state.lang;
      langSel.addEventListener('change', onLangChange);
    }
    applyI18n();

    const unk = $('timeUnknown'), bt = $('birthtime');
    if (unk && bt){
      const sync = ()=>{ bt.disabled = !!unk.checked; bt.style.opacity = bt.disabled ? 0.5 : 1; };
      unk.addEventListener('change', sync); sync();
    }

    $('genBtn')?.addEventListener('click', generate);

    tickNow(); if (!boot._clock) boot._clock = setInterval(tickNow, 1000);

    setupAuthReveal();

    // default birthdate/time (SGT)
    const nowSG = new Date(new Date().toLocaleString('en-US', { timeZone: SG_TZ }));
    const bd = $('birthdate') || document.querySelector('[name="birthdate"]');
    const bt2 = $('birthtime') || document.querySelector('[name="birthtime"]');
    if (bd && !bd.value){
      const y=nowSG.getFullYear(), m=String(nowSG.getMonth()+1).padStart(2,'0'), d=String(nowSG.getDate()).padStart(2,'0');
      bd.value = `${y}-${m}-${d}`;
    }
    if (bt2 && !bt2.value){
      const hh=String(nowSG.getHours()).padStart(2,'0'), mm=String(nowSG.getMinutes()).padStart(2,'0');
      bt2.value = `${hh}:${mm}`;
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot, { once:true });
  } else {
    boot();
  }

})();
</script>
<script src="i18n-terms.js" defer></script>
<script src="bazi-app.js" defer></script>
</body>
</html>  

