<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title data-i18n="page_title">å‘½ç†å¿ƒæ€œç©ºé—´ Â· VIP Soul Sanctuary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
    --brand:#d4af37; --gold:#ffe084; --gold2:#f2d27a; --accent:#58b9ff;
    --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
  }

  /* ===== Base ===== */
  html,body{height:100%}
  html{font-size:16px}
  @media (min-width:768px){ html{font-size:17px} }
  @media (min-width:1200px){ html{font-size:18px} }
  body{
    margin:0; color:var(--text);
    background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
                linear-gradient(180deg,#0b0f14,#0b0f14);
    font-family:Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  body::before{content:"";position:fixed;inset:0;z-index:-2;background:#090d13;filter:brightness(.45) saturate(.9) blur(2px)}
  .container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

  /* ===== Header ===== */
  .site-header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
  .head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
  .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text)}
  .brand-badge{display:inline-grid;place-items:center;width:34px;height:34px;border-radius:8px;background:linear-gradient(180deg,#0e1520,#0b1018);border:1px solid #2a3546;box-shadow:0 4px 14px rgba(0,0,0,.35);font-weight:800;color:var(--gold)}
  .title{font-family:"Noto Serif SC","Noto Serif",serif!important;font-weight:600!important;letter-spacing:.02em;font-size:1.1rem!important;line-height:1.25}
  .title a{color:inherit;text-decoration:none}
  .title a:hover{text-decoration:underline;text-underline-offset:3px}

  .lang{display:flex;align-items:center;gap:8px}
  .lang label{white-space:nowrap;color:var(--muted)}
  .lang select{min-width:170px}
  @media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

  /* ===== Headings / Cards ===== */
  .h1{margin:12px 0 6px;color:var(--gold);font-weight:800;font-size:1.8rem}
  .section>h2{margin:0 0 10px;color:var(--gold);font-weight:800;font-size:1.25rem}
  .sub{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(10px);padding:18px;margin:16px 0}
  .group-title{font-size:1.05rem;color:var(--gold);margin:10px 0 8px}

  /* ===== Form Grid ===== */
  .row{display:grid;gap:12px}
  .row.row-2,.row.cols-2{grid-template-columns:1fr}
  .row.row-3,.row.cols-3{grid-template-columns:1fr}
  @media(min-width:760px){
    .row.row-2,.row.cols-2{grid-template-columns:1fr 1fr}
    .row.row-3,.row.cols-3{grid-template-columns:1fr 1fr 1fr}
  }
  label.muted{display:block;margin-bottom:4px;color:var(--muted)}

  input,select,textarea{
    width:100%;box-sizing:border-box;border-radius:12px;border:1px solid #243244;
    background:#0e1520;color:var(--text);padding:12px;font-size:15px;outline:none
  }
  select{
    appearance:none;
    padding-right:34px;
    background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E");
    background-repeat:no-repeat;background-position:calc(100% - 12px) 50%;
  }
  input::placeholder,textarea::placeholder{color:#6f8092}
  input:focus,select:focus,textarea:focus{border-color:#3a4a60;box-shadow:0 0 0 3px rgba(212,175,55,.18)}

  /* ===== Buttons ===== */
  .btn, a.btn{
    display:inline-grid;place-items:center;gap:6px;padding:12px 16px;border-radius:12px;
    border:1px solid #e6c76e;background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;
    font-weight:800;cursor:pointer;text-decoration:none;user-select:none;
    transition:transform .05s ease, box-shadow .2s ease, filter .2s ease;
  }
  .btn:hover{filter:saturate(105%) brightness(1.02)}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn.secondary{background:#101826;color:var(--gold);border-color:#3a3f47}
  .btn.secondary:hover{background:#121b2b;border-color:#4a5565}
  .btn.ghost{background:transparent;color:var(--gold);border:1px solid rgba(212,175,55,.45);box-shadow:none}
  .btn.ghost:hover{background:rgba(255,232,149,.06)}
  .btn.sm{padding:9px 12px;border-radius:10px;font-weight:700}
  .btn.lg{padding:14px 18px;border-radius:14px}
  .btns .btn{min-width:110px}

  /* ===== å…«å­—ä¸“ç”¨æ ·å¼ ===== */
  .pillars{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:12px 0}
  .pillar{background:#0f1624;border:1px solid #253245;border-radius:12px;padding:14px 10px;text-align:center}
  .pillar .tit{color:#9aa3b2;font-size:.85rem;margin-bottom:6px}
  .pillar .gz{font-size:1.5rem;font-weight:800;color:var(--gold2)}
  
  .bazi-table{width:100%;border-collapse:collapse;margin-top:12px;background:#0f1624;border-radius:8px;overflow:hidden}
  .bazi-table th,.bazi-table td{padding:10px 12px;border:1px solid #253245;text-align:center}
  .bazi-table th{background:rgba(212,175,55,.1);color:var(--gold2)}
  
  .bar{height:10px;background:#0d1420;border:1px solid #233146;border-radius:999px;overflow:hidden;margin:6px 0}
  .bar i{display:block;height:100%;background:linear-gradient(90deg,#ffe084,#f2d27a);width:0}
  .bar-row{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
  .badge-warn{display:inline-block;padding:2px 8px;margin-left:6px;border:1px solid #ffb84d;border-radius:999px;color:#ffb84d;font-size:.82rem}
  
  /* æ—¶é—´è¾“å…¥è¡Œ */
  .time-row{display:flex;align-items:center;gap:10px}
  .time-row .time-unknown{display:flex;align-items:center;gap:6px;white-space:nowrap}
  .btn-mini{padding:8px 10px;border-radius:10px}

  /* ===== Report / Rich text ===== */
  .report{margin-top:12px;display:grid;gap:10px}
  .report .sec{padding:12px;border:1px solid var(--line);background:#0e1520;border-radius:12px}
  .report .sec h3{margin:0 0 6px;color:var(--gold);font-size:1.05rem}
  .report p,.report li{line-height:1.7}
  .ai-content{white-space:pre-wrap;line-height:1.7}
  .ai-content h2,.ai-content h3{color:var(--gold)}

  /* ===== List blocks ===== */
  .list-block{border:1px solid #263448;background:#0e1520;border-radius:12px;padding:16px}
  .list-block ul{margin:.2rem 0 0;padding-left:1.1rem;color:var(--muted)}
  .list-block .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}

  /* ===== ä¼šå‘˜åŒºåŸŸæ ·å¼ ===== */
  .columns{display:grid;gap:12px;grid-template-columns:1fr}
  @media(min-width:900px){ .columns{grid-template-columns:1fr 1fr} }
  .astro-auth{max-width:980px;margin:28px auto;padding:20px 18px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
  .auth-grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
  @media(max-width:860px){ .auth-grid{grid-template-columns:1fr} }
  .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(212,175,55,.22);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .panel .head{padding:16px 18px;border-bottom:1px solid rgba(212,175,55,.22);color:var(--gold);font-weight:700;letter-spacing:.3px}
  .panel .body{padding:18px}
  .spacer{height:12px}
  .auth-grid > * { min-width: 0; }
  .panel .body .row.one > * { min-width: 0; }

  /* ===== Chat widget ===== */
  .ss-chat-fab{
    position:fixed;right:18px;bottom:18px;z-index:50;width:56px;height:56px;border-radius:50%;
    background:linear-gradient(180deg,#fff9e6,#e6c76e);color:#191919;display:grid;place-items:center;font-weight:800;
    box-shadow:0 8px 30px rgba(0,0,0,.35);cursor:pointer;border:1px solid #e6c76e
  }
  .ss-chat-panel{
    position:fixed;right:18px;bottom:88px;z-index:50;width:min(460px,92vw);display:none;flex-direction:column;
    background:#0e1520;border:1px solid #243244;border-radius:14px;box-shadow:var(--shadow)
  }
  .ss-chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #243244}
  .ss-chat-title{font-weight:700}
  .ss-close{cursor:pointer;opacity:.8}
  .ss-chat-body{max-height:300px;overflow:auto;padding:10px 12px}
  .ss-msg{padding:8px 10px;background:#0f1624;border:1px solid #243244;border-radius:10px;margin:6px 0;max-width:80%}
  .ss-msg.me{margin-left:auto;background:#132033}
  .ss-chat-input{display:flex;align-items:center;gap:8px;padding:10px 12px;border-top:1px solid #243244}
  .ss-chat-input input{flex:1 1 auto;min-width:0}
  .ss-chat-input .btn,.ss-chat-input button{flex:0 0 auto;width:auto!important;white-space:nowrap;padding:10px 14px}

  /* ===== Misc ===== */
  footer{color:#6c7b8c;font-size:.85rem;text-align:center;padding:30px 0}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid #2a3546;background:#0e1520;color:var(--text);cursor:pointer}
  .skeleton{display:grid;gap:8px}
  .skeleton div{height:12px;border-radius:6px;background:linear-gradient(90deg,#1a2431,#1f2b3b,#1a2431);animation:sh 1.2s infinite}
  @keyframes sh{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
  .ai-lock-overlay{position:static;inset:auto;background:none;backdrop-filter:none;margin-top:10px;padding-top:10px;border-top:1px solid var(--line);text-align:center}
  .ai-lock-overlay .tip{color:#ffd88a;font-weight:700;margin-bottom:4px}
  .ai-lock-overlay .sub{color:var(--muted)}
  
  .error{color:#ff6b6b;margin-top:8px;display:none}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  .block{width:100%}
</style>

</head>
<body>
  <header class="site-header">
    <div class="head-inner container">
      <a class="brand" href="https://astro.5xliving.com" target="_self" rel="nofollow">
        <span class="brand-badge">5X</span>    
          <div class="title" data-i18n="site_title">å‘½ç†å¿ƒæ€œç©ºé—´ Â· VIP Soul Sanctuary</div>
    </a>
      <div class="lang">
        <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
        <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
        </select>
      </div>
    </div>
  </header>
  
  <main class="container">
    <!-- é¡¶éƒ¨ï¼šå‘½ç†åˆ†æè¡¨å• -->
    <section class="card section">
      <h2 data-i18n="form_title">å‘½ç†åˆ†æ Â· ç”ŸæˆæŠ¥å‘Š</h2>

      <div class="group-title" data-i18n="choose_type">é€‰æ‹©å‘½ç›˜ç±»å‹</div>
      <div class="row row-2">
        <select id="type" name="type" onchange="togglePartner(this.value)">
          <option value="personal" data-i18n="type_personal">ä¸ªäººå‘½ç›˜</option>
          <option value="compatibility" data-i18n="type_compat">åˆç›˜ï¼ˆä¸¤äººèµ„æ–™ï¼‰</option>
        </select>
        <select id="culture" name="culture">
          <option value="auto" data-i18n="culture_auto">è‡ªåŠ¨è¯†åˆ« Auto Detect</option>
          <option value="ä¸œæ–¹" data-i18n="culture_cn">ä¸œæ–¹ Chinese / Bazi</option>
          <option value="è¥¿æ–¹" data-i18n="culture_west">è¥¿æ–¹ Astrology / Tarot</option>
          <option value="æ—¥å¼" data-i18n="culture_jp">æ—¥å¼ä¹æ˜Ÿ Japanese</option>
          <option value="å é™€" data-i18n="culture_vedic">å°åº¦å é™€ Vedic</option>
        </select>
      </div>

      <div class="group-title" data-i18n="self_info">æœ¬äººèµ„æ–™</div>
      <div class="row row-3">
        <input type="text" id="name1" name="name1" placeholder="å§“åï¼ˆæœ¬äººï¼‰" required data-i18n-ph="ph_name1">
        <input type="date" id="birthdate1" name="birthdate1" required>
        <div class="time-row">
          <input type="time" id="birthtime1" name="birthtime1" placeholder="å‡ºç”Ÿæ—¶é—´" data-i18n-ph="ph_time1">
          <div class="time-unknown">
            <input type="checkbox" id="timeUnknown">
            <label for="timeUnknown">ä¸è¯¦</label>
          </div>
        </div>
      </div>
      <div class="row row-3" style="margin-top:6px">
        <select id="calendar1" name="calendar1">
          <option value="é˜³å†" data-i18n="cal_g">é˜³å† (Gregorian)</option>
          <option value="å†œå†" data-i18n="cal_l">å†œå† (Lunar)</option>
        </select>
        <input type="text" id="country1" name="country1" placeholder="å‡ºç”Ÿå›½å®¶ / åœ°åŒº" required data-i18n-ph="ph_country1">
        <button class="btn" id="btnNext" type="button" data-i18n="btn_next">ç”Ÿæˆåˆ†æ</button>
      </div>

      <!-- éšå½¢è¡¨å•ç”¨äºæäº¤ -->
      <form id="reportForm" action="report.html" method="GET" style="display:none"></form>

      <div id="partner-section" style="display:none; margin-top:16px">
        <div class="group-title" data-i18n="partner_info">ç¬¬äºŒäººèµ„æ–™ï¼ˆåˆç›˜ï¼‰</div>
        <div class="row row-3">
          <input type="text" id="name2" name="name2" placeholder="å§“åï¼ˆç¬¬äºŒäººï¼‰" form="reportForm" data-i18n-ph="ph_name2">
          <input type="date" id="birthdate2" name="birthdate2" form="reportForm">
          <div class="time-row">
            <input type="time" id="birthtime2" name="birthtime2" placeholder="å‡ºç”Ÿæ—¶é—´" form="reportForm" data-i18n-ph="ph_time2">
            <div class="time-unknown">
              <input type="checkbox" id="timeUnknown2">
              <label for="timeUnknown2">ä¸è¯¦</label>
            </div>
          </div>
        </div>
        <div class="row row-2" style="margin-top:6px">
          <select id="calendar2" name="calendar2" form="reportForm">
            <option value="é˜³å†" data-i18n="cal_g">é˜³å† (Gregorian)</option>
            <option value="å†œå†" data-i18n="cal_l">å†œå† (Lunar)</option>
          </select>
          <input type="text" id="country2" name="country2" placeholder="å‡ºç”Ÿå›½å®¶ / åœ°åŒº" form="reportForm" data-i18n-ph="ph_country2">
        </div>
      </div>

      <div class="group-title" style="margin-top:12px" data-i18n="focus_title">å‘½ç†é€‰é¢˜ï¼ˆæŠ¥å‘Šèšç„¦ï¼‰</div>
      <div class="row">
        <select id="purpose_personal" name="purpose" form="reportForm">
          <optgroup label="å§»ç¼˜ Love" data-i18n="opt_love"></optgroup>
          <option value="æ‹çˆ±ç¼˜åˆ†" data-i18n="opt_dating">æ‹çˆ±ç¼˜åˆ†</option>
          <option value="å©šå§»èµ°åŠ¿" data-i18n="opt_marriage">å©šå§»èµ°åŠ¿</option>

          <optgroup label="äº‹ä¸š Career" data-i18n="opt_career"></optgroup>
          <option value="èŒåœºå‘å±•" data-i18n="opt_work">èŒåœºå‘å±•</option>
          <option value="åˆ›ä¸šæ½œåŠ›" data-i18n="opt_startup">åˆ›ä¸šæ½œåŠ›</option>

          <optgroup label="è´¢è¿ Wealth" data-i18n="opt_wealth"></optgroup>
          <option value="è´¢ä½åˆ†æ" data-i18n="opt_wealthpos">è´¢ä½åˆ†æ</option>
          <option value="ç†è´¢æ—¶æœº" data-i18n="opt_timing">ç†è´¢æ—¶æœº</option>

          <optgroup label="æ‹©æ—¥ Auspicious Date" data-i18n="opt_dates"></optgroup>
          <option value="å©šæœŸæ‹©æ—¥" data-i18n="opt_wedding">å©šæœŸæ‹©æ—¥</option>
          <option value="æ–°ç”Ÿå®å®æ‹©æ—¥" data-i18n="opt_babydate">æ–°ç”Ÿå®å®æ‹©æ—¥</option>
          <option value="æ–°å®¶å…¥ä½æ‹©æ—¥" data-i18n="opt_house">æ–°å®¶å…¥ä½æ‹©æ—¥</option>
          <option value="æ–°å…¬å¸å…¥ä½æ‹©æ—¥" data-i18n="opt_office">æ–°å…¬å¸å…¥ä½æ‹©æ—¥</option>

          <optgroup label="æµ‹å Name Analysis" data-i18n="opt_name"></optgroup>
          <option value="å®å®å" data-i18n="opt_babyname">å®å®å</option>
          <option value="å® ç‰©å" data-i18n="opt_petname">å® ç‰©å</option>
          <option value="å…¬å¸å" data-i18n="opt_companyname">å…¬å¸å</option>
          <option value="å‘½åæ”¹è¿" data-i18n="opt_rename">å‘½åæ”¹è¿</option>

          <optgroup label="é£æ°´ Feng Shui" data-i18n="opt_fs"></optgroup>
          <option value="ä½å®¶" data-i18n="opt_home">ä½å®¶</option>
          <option value="åŠå…¬å®¤" data-i18n="opt_officefs">åŠå…¬å®¤</option>
        </select>

        <select id="purpose_compatibility" name="purpose" style="display:none" form="reportForm">
          <optgroup label="åˆç›˜åˆ†æ Compatibility" data-i18n="opt_comp"></optgroup>
          <option value="ç¼˜åˆ†èµ·è½" data-i18n="opt_couple">æƒ…ä¾£åˆç›˜ï¼ˆç¼˜åˆ†èµ·è½ / æš§æ˜§è¿›å±•ï¼‰</option>
          <option value="å¤«å¦»æµå¹´" data-i18n="opt_spouse">å¤«å¦»æµå¹´ï¼ˆå©šå§»å‘å±•ï¼‰</option>
          <option value="åˆç›˜åˆ†æ" data-i18n="opt_personality">ä¸ªæ€§åˆç›˜ï¼ˆå†²çª / äº’è¡¥ï¼‰</option>
          <option value="äº‹ä¸šå…±äº‹" data-i18n="opt_partner">äº‹ä¸šåˆç›˜ï¼ˆåˆä¼™äºº / å‘˜å·¥ï¼‰</option>
          <option value="æ–­è”ä¿®å¤" data-i18n="opt_reconnect">æ–­è”ä¿®å¤ï¼ˆæœ‹å‹ / æƒ…äºº / å®¶äººï¼‰</option>
          <option value="å® ç‰©ç¼˜åˆ†" data-i18n="opt_petbond">å® ç‰©åˆç›˜ï¼ˆä¸»äººä¸å® ç‰©ï¼‰</option>
        </select>
      </div>
    </section>

    <!-- å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®® - æ”¾åœ¨å‰é¢ -->
    <section class="card" id="result" style="display:none">
      <h2 style="margin:0 0 10px;color:var(--gold)" data-i18n="res_title">å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®</h2>
      <div id="butler-host"></div>
      <div id="rich-report"></div>
      <div id="xl-free-report"></div>
    </section>

    <!-- å¿ƒæ€œç©ºé—´åŠŸèƒ½å…¥å£ - æ”¾åœ¨å°¾ç«¯ -->
    <section class="card section">
      <h2 data-i18n="portal_title">å¿ƒæ€œç©ºé—´ Â· åŠŸèƒ½å…¥å£</h2>

      <div class="list-block" style="margin-bottom:12px">
        <div class="group-title" data-i18n="diary_title">ğŸ§˜â€â™€ï¸ çµæ€§æ—¥è®°</div>
        <ul><li data-i18n="diary_desc">ç…§ç‰‡ä¸Šä¼  / è¯­éŸ³è®°å½• / çµæ€§ç¬”è®° / å®¶åº­æ—¥å¿— / æ„¿æœ›ç¥ˆç¥·ï¼ˆæ¯æ—¥åŠ æŒï¼‰</li></ul>
        <div class="btns" style="margin-top:8px">
          <a class="btn link-btn" href="personal_memory.html" data-i18n="btn_personal">ä¸ªäººéšè—è®°å½•</a>
          <a class="btn link-btn" href="family_memory.html" data-i18n="btn_family">å®¶åº­å…±äº«è®°å½•</a>
          <a class="btn link-btn" href="memory_upload.html" data-i18n="btn_upload">ä¸Šä¼ è®°å½•</a>
        </div>
      </div>

      <div class="list-block" style="margin-bottom:12px">
        <div class="group-title" data-i18n="course_title">ğŸ“˜ å‘½ç†è¯¾ç¨‹ä¸“åŒº</div>
        <ul>
          <li data-i18n="course_bazi">å…«å­—å‘½ç†ï¼šåç¥ / æµå¹´ / ç”¨ç¥åˆ†æ</li>
          <li data-i18n="course_tarot">å¡”ç½—ç‰Œï¼šç‰Œé˜µè§£è¯» / æƒ…å¢ƒå®æˆ˜</li>
        </ul>
        <div class="muted" style="margin-top:6px" data-i18n="course_coming">
          ğŸŒ™ ä»¥ä¸‹è¯¾ç¨‹é…é…¿ä¸­ï¼šå æ˜Ÿ / çµæ•° / äººç±»å›¾ / å…­çˆ» / å†¥æƒ³å¼•å¯¼ / å¥‡é—¨ / æ—¥å¼ç¥æ˜ / ç´«å¾® / èƒ½é‡å­¦ / è¥¿æ´‹å æ˜Ÿ / å¿ƒçµè¯¾ç¨‹â€¦â€¦
        </div>
        <div class="btns" style="margin-top:8px">
          <a class="btn link-btn" href="soul_integration_course.html" data-i18n="btn_enter_course">è¿›å…¥è¯¾ç¨‹</a>
        </div>
      </div>

      <div class="list-block" style="margin-bottom:12px">
        <div class="group-title" data-i18n="shop_title">ğŸ›ï¸ èƒ½é‡å•†åŸ Â· VIPæŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</div>
        <ul><li data-i18n="shop_desc">ä¸“å±ç¥ˆæ„¿åŒ…åˆ†ç±»ï¼š</li></ul>
        <div class="btns" style="flex-wrap:wrap">
          <a class="btn link-btn" href="é˜´å€ºå’Œè§£åŒ….html">é˜´å€ºå’Œè§£åŒ…</a>
          <a class="btn link-btn" href="è´¢åº“åŒ….html">è´¢åº“åŒ…</a>
          <a class="btn link-btn" href="çµé­‚å¼€æ‚Ÿçš„æŒ‡å¼•åŒ….html">å¿ƒçµåŒ…</a>
          <a class="btn link-btn" href="è´¢è¿åŒ….html">è´¢è¿åŒ…</a>
          <a class="btn link-btn" href="å§»ç¼˜åŒ….html">å§»ç¼˜åŒ…</a>
          <a class="btn link-btn" href="å­¦ä¸šåŒ….html">å­¦ä¸šåŒ…</a>
          <a class="btn link-btn" href="äº‹ä¸šåŒ….html">äº‹ä¸šåŒ…</a>
          <a class="btn link-btn" href="å¾¡å®ˆåŒ….html">å¾¡å®ˆåŒ…</a>
          <a class="btn link-btn" href="å¤ªå²åŒ….html">å¤ªå²åŒ…</a>
          <a class="btn link-btn" href="ä¸ƒæœˆåŒ….html">ä¸ƒæœˆåŒ…</a>
          <a class="btn link-btn" href="å®¶æ—ç¦æŠ¥åŒ….html">å®¶æ—ç¦æŠ¥åŒ…</a>
          <a class="btn link-btn" href="æƒ…ä¼¤ç–—æ„ˆåŒ….html">æƒ…ä¼¤ç–—æ„ˆåŒ…</a>
          <a class="btn link-btn" href="åŠ«éš¾åŒ….html">åŠ«éš¾åŒ…</a>
          <a class="btn link-btn" href="æ–°å®…åŠå…¬å®¤åŒ….html">æ–°å®… / åŠå…¬å®¤åŒ…</a>
        </div>
      </div>

      <div class="list-block" style="margin-bottom:12px">
        <div class="group-title" data-i18n="wish_title">ğŸ”® æ¢¦æƒ³æäº¤ Dream Submission</div>
        <div class="btns" style="margin-top:8px">
          <a class="btn link-btn" href="wish_submission.html" data-i18n="btn_manifest">æ¢¦æƒ³è§„åˆ’ / Manifestation</a>
        </div>
      </div>

      <div class="list-block">
        <div class="group-title" data-i18n="memorial_title">ğŸ“– çµæ€§ç©ºé—´ ~ å¾€ç”Ÿè®°æ€œå½•</div>
        <ul><li data-i18n="memorial_desc">çµé­‚æ¡£æ¡ˆ / çºªå¿µå›å¿†ï¼ˆå›¾æ–‡éŸ³ï¼‰ / çµæ€§å»¶ç»­ï¼ˆåŠŸå¾·ä¼ æ‰¿ï¼‰</li></ul>
        <div class="btns" style="margin-top:8px">
          <a class="btn link-btn" href="login_memorial.html" data-i18n="btn_login_memorial">ç™»å…¥çµæ€§ç©ºé—´</a>
          <a class="btn link-btn" href="upload_memorial.html" data-i18n="btn_upload_memorial">ä¸Šä¼ å¾€ç”Ÿå½•</a>
          <a class="btn link-btn" href="register_soul_memorial.html" data-i18n="btn_register_memorial">æ³¨å†Œçµæ€§ç©ºé—´</a>
        </div>
      </div>
    </section>

    <!-- ä¼šå‘˜åŒºåŸŸ -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>
      <section class="astro-auth">
        <div class="auth-grid">
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
            <div class="body">
              <div class="row" id="authFields">
                <label for="email" class="sr-only" data-i18n="ph_email">é‚®ç®± Email</label>
                <input id="email" name="email" type="email" inputmode="email" autocomplete="username" placeholder="é‚®ç®± Email">
                <label for="password" class="sr-only" data-i18n="ph_label_password">å¯†ç  Password</label>
                <input id="password" type="password" autocomplete="new-password" placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" data-i18n-ph="ph_password" required/>
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
                <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <div class="panel">
            <div class="head" data-i18n="panel_member_head">ä¼šå‘˜æœåŠ¡</div>
            <div class="body">
              <div class="row one">
                <a class="btn block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
            </div>
          </div>
        </div>
      </section>
    </section>
  </main>

  <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>

<script>
'use strict';

/* ==============================
   CONFIG
============================== */
const API_BASE = 'https://throbbing-lab-1440.hello5xliving.workers.dev';
const DEFAULT_LANG = "zh-CN";

// ç¿»è¯‘å¯¹è±¡ä¿æŒä¸å˜...
const translations = {
  "zh-CN": {
    "page_title": "å‘½ç†å¿ƒæ€œç©ºé—´ Â· VIP Soul Sanctuary",
    "site_title": "å‘½ç†å¿ƒæ€œç©ºé—´ Â· VIP Soul Sanctuary",
    "lang_label": "è¯­è¨€",
    "form_title": "å‘½ç†åˆ†æ Â· ç”ŸæˆæŠ¥å‘Š",
    "choose_type": "é€‰æ‹©å‘½ç›˜ç±»å‹",
    "type_personal": "ä¸ªäººå‘½ç›˜",
    "type_compat": "åˆç›˜ï¼ˆä¸¤äººèµ„æ–™ï¼‰",
    "culture_auto": "è‡ªåŠ¨è¯†åˆ« Auto Detect",
    "culture_cn": "ä¸œæ–¹ Chinese / Bazi",
    "culture_west": "è¥¿æ–¹ Astrology / Tarot",
    "culture_jp": "æ—¥å¼ä¹æ˜Ÿ Japanese",
    "culture_vedic": "å°åº¦å é™€ Vedic",
    "self_info": "æœ¬äººèµ„æ–™",
    "ph_name1": "å§“åï¼ˆæœ¬äººï¼‰",
    "ph_time1": "å‡ºç”Ÿæ—¶é—´",
    "cal_g": "é˜³å† (Gregorian)",
    "cal_l": "å†œå† (Lunar)",
    "ph_country1": "å‡ºç”Ÿå›½å®¶ / åœ°åŒº",
    "btn_next": "ç”Ÿæˆåˆ†æ",
    "partner_info": "ç¬¬äºŒäººèµ„æ–™ï¼ˆåˆç›˜ï¼‰",
    "ph_name2": "å§“åï¼ˆç¬¬äºŒäººï¼‰",
    "ph_time2": "å‡ºç”Ÿæ—¶é—´",
    "ph_country2": "å‡ºç”Ÿå›½å®¶ / åœ°åŒº",
    "focus_title": "å‘½ç†é€‰é¢˜ï¼ˆæŠ¥å‘Šèšç„¦ï¼‰",
    "opt_love": "å§»ç¼˜ Love",
    "opt_dating": "æ‹çˆ±ç¼˜åˆ†",
    "opt_marriage": "å©šå§»èµ°åŠ¿",
    "opt_career": "äº‹ä¸š Career",
    "opt_work": "èŒåœºå‘å±•",
    "opt_startup": "åˆ›ä¸šæ½œåŠ›",
    "opt_wealth": "è´¢è¿ Wealth",
    "opt_wealthpos": "è´¢ä½åˆ†æ",
    "opt_timing": "ç†è´¢æ—¶æœº",
    "opt_dates": "æ‹©æ—¥ Auspicious Date",
    "opt_wedding": "å©šæœŸæ‹©æ—¥",
    "opt_babydate": "æ–°ç”Ÿå®å®æ‹©æ—¥",
    "opt_house": "æ–°å®¶å…¥ä½æ‹©æ—¥",
    "opt_office": "æ–°å…¬å¸å…¥ä½æ‹©æ—¥",
    "opt_name": "æµ‹å Name Analysis",
    "opt_babyname": "å®å®å",
    "opt_petname": "å® ç‰©å",
    "opt_companyname": "å…¬å¸å",
    "opt_rename": "å‘½åæ”¹è¿",
    "opt_fs": "é£æ°´ Feng Shui",
    "opt_home": "ä½å®¶",
    "opt_officefs": "åŠå…¬å®¤",
    "opt_comp": "åˆç›˜åˆ†æ Compatibility",
    "opt_couple": "æƒ…ä¾£åˆç›˜ï¼ˆç¼˜åˆ†èµ·è½ / æš§æ˜§è¿›å±•ï¼‰",
    "opt_spouse": "å¤«å¦»æµå¹´ï¼ˆå©šå§»å‘å±•ï¼‰",
    "opt_personality": "ä¸ªæ€§åˆç›˜ï¼ˆå†²çª / äº’è¡¥ï¼‰",
    "opt_partner": "äº‹ä¸šåˆç›˜ï¼ˆåˆä¼™äºº / å‘˜å·¥ï¼‰",
    "opt_reconnect": "æ–­è”ä¿®å¤ï¼ˆæœ‹å‹ / æƒ…äºº / å®¶äººï¼‰",
    "opt_petbond": "å® ç‰©åˆç›˜ï¼ˆä¸»äººä¸å® ç‰©ï¼‰",
    "portal_title": "å¿ƒæ€œç©ºé—´ Â· åŠŸèƒ½å…¥å£",
    "diary_title": "ğŸ§˜â€â™€ï¸ çµæ€§æ—¥è®°",
    "diary_desc": "ç…§ç‰‡ä¸Šä¼  / è¯­éŸ³è®°å½• / çµæ€§ç¬”è®° / å®¶åº­æ—¥å¿— / æ„¿æœ›ç¥ˆç¥·ï¼ˆæ¯æ—¥åŠ æŒï¼‰",
    "btn_personal": "ä¸ªäººéšè—è®°å½•",
    "btn_family": "å®¶åº­å…±äº«è®°å½•",
    "btn_upload": "ä¸Šä¼ è®°å½•",
    "course_title": "ğŸ“˜ å‘½ç†è¯¾ç¨‹ä¸“åŒº",
    "course_bazi": "å…«å­—å‘½ç†ï¼šåç¥ / æµå¹´ / ç”¨ç¥åˆ†æ",
    "course_tarot": "å¡”ç½—ç‰Œï¼šç‰Œé˜µè§£è¯» / æƒ…å¢ƒå®æˆ˜",
    "course_coming": "ğŸŒ™ ä»¥ä¸‹è¯¾ç¨‹é…é…¿ä¸­ï¼šå æ˜Ÿ / çµæ•° / äººç±»å›¾ / å…­çˆ» / å†¥æƒ³å¼•å¯¼ / å¥‡é—¨ / æ—¥å¼ç¥æ˜ / ç´«å¾® / èƒ½é‡å­¦ / è¥¿æ´‹å æ˜Ÿ / å¿ƒçµè¯¾ç¨‹â€¦â€¦",
    "btn_enter_course": "è¿›å…¥è¯¾ç¨‹",
    "shop_title": "ğŸ›ï¸ èƒ½é‡å•†åŸ Â· VIPæŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
    "shop_desc": "ä¸“å±ç¥ˆæ„¿åŒ…åˆ†ç±»ï¼š",
    "wish_title": "ğŸ”® æ¢¦æƒ³æäº¤ Dream Submission",
    "btn_manifest": "æ¢¦æƒ³è§„åˆ’ / Manifestation",
    "memorial_title": "ğŸ“– çµæ€§ç©ºé—´ ~ å¾€ç”Ÿè®°æ€œå½•",
    "memorial_desc": "çµé­‚æ¡£æ¡ˆ / çºªå¿µå›å¿†ï¼ˆå›¾æ–‡éŸ³ï¼‰ / çµæ€§å»¶ç»­ï¼ˆåŠŸå¾·ä¼ æ‰¿ï¼‰",
    "btn_login_memorial": "ç™»å…¥çµæ€§ç©ºé—´",
    "btn_upload_memorial": "ä¸Šä¼ å¾€ç”Ÿå½•",
    "btn_register_memorial": "æ³¨å†Œçµæ€§ç©ºé—´",
    "vip_title": "ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment",
    "vip_mingli": "ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹",
    "vip_love": "å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿",
    "vip_career": "äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›",
    "vip_wealth": "è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº",
    "vip_pet": "å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†",
    "vip_hepan": "åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶",
    "vip_name": "æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿",
    "vip_fengshui": "è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ",
    "vip_xinlian": "ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹",
    "vip_record": "çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·",
    "vip_course": "å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾",
    "vip_memorial": "å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­",
    "vip_tasks": "æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡",
    "vip_shop": "èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶",
    "login_title": "ğŸ’ ç™»å…¥ VIP åŠŸèƒ½",
    "panel_login_head": "è´¦æˆ·ç™»å½• / æ³¨å†Œ",
    "ph_email": "é‚®ç®± Email",
    "ph_label_password": "å¯†ç  Password",
    "ph_password": "å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰",
    "btn_login": "ç™»å…¥è´¦æˆ·",
    "btn_reset": "ğŸ”‘ é‡è®¾å¯†ç ",
    "btn_register": "æ³¨å†Œè´¦æˆ·",
    "note_price": "æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ",
    "panel_member_head": "ä¼šå‘˜æœåŠ¡",
    "btn_upgrade": "ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰",
    "btn_backshop": "â† è¿”å›å‘½ç†å•†åŸ",
    "note_price1": "$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰",
    "res_title": "å¿ƒæ€œç®¡å®¶è§£è¯»ä¸å»ºè®®",
    "chat_fab": "ğŸ’¬",
    "chat_placeholder": "è¾“å…¥æ‚¨çš„é—®é¢˜...",
    "chat_send": "å‘é€",
    "butler_title": "å¿ƒæ€œç®¡å®¶ Â· å»ºè®®",
    "elements_balance_tpl": "å…ƒç´ å¹³è¡¡ï¼šåå¼º {max} Â· åå¼± {min}"
  }
  // å…¶ä»–è¯­è¨€ç¿»è¯‘...
};

// å·¥å…·å‡½æ•°ä¿æŒä¸å˜...
const $ = id => document.getElementById(id);
function ensureErrorBox(){
  let box = $('error');
  if (!box){
    box = document.createElement('div');
    box.id = 'error';
    box.className = 'error';
    box.style.cssText = 'margin-top:10px;color:#ff8b8b';
    (document.querySelector('.section') || document.body).appendChild(box);
  }
  return box;
}
function showErr(msg){ const e = ensureErrorBox(); e.textContent = msg; e.style.display = 'block'; setTimeout(()=>{ e.style.display='none'; }, 5000); }
function hideErr(){ const e = $('error'); if (e){ e.style.display='none'; e.textContent=''; } }
function setText(id, txt){ const el=$(id); if(el) el.textContent = (txt ?? ''); }
function setBar(el, pct){ if(!el) return; const v=Math.max(0,Math.min(100,Number(pct)||0)); el.style.width = v+'%'; el.setAttribute('aria-valuenow', String(Math.round(v))); }

// è¯­è¨€ç®¡ç†ä¿æŒä¸å˜...
const LANG_KEY = "site_lang";
function getLang(){ return localStorage.getItem(LANG_KEY) || document.documentElement.lang || "zh-CN"; }
function setLang(code){ localStorage.setItem(LANG_KEY, code); document.documentElement.lang = code; }
function t(key){ const lang = getLang(); const pack = translations[lang] || translations["zh-CN"]; return pack[key] || key; }
function applyI18n(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{ const key = el.getAttribute("data-i18n"); el.textContent = t(key); });
  document.querySelectorAll("[data-i18n-ph]").forEach(el=>{ const key = el.getAttribute("data-i18n-ph"); el.setAttribute("placeholder", t(key)); });
  const titleEl = document.querySelector("title[data-i18n]"); if (titleEl) titleEl.textContent = t(titleEl.getAttribute("data-i18n"));
}

// è¡¨å•åˆ‡æ¢åŠŸèƒ½ä¿æŒä¸å˜...
function togglePartner(value){
  const section = $('partner-section'), personal = $('purpose_personal'), compat = $('purpose_compatibility');
  const show = (value === "compatibility");
  if (section) section.style.display = show ? "block" : "none";
  if (personal){ personal.style.display = show ? "none" : "block"; personal.disabled = show; }
  if (compat){ compat.style.display = show ? "block": "none"; compat.disabled = !show; }
}

// ç»“æœåŒºåŸŸç»“æ„
function ensureResultHost(){
  let result = $('result');
  if (!result) return null;
  
  // ç¡®ä¿å…«å­—æŠ¥å‘Šç»“æ„å­˜åœ¨
  if (!document.getElementById('xl-free-report')){
    const free = document.createElement('div');
    free.id = 'xl-free-report';
    free.innerHTML = `
      <div class="card" style="margin-top:8px">
        <div class="h2">å‘½ç†ç®€æŠ¥</div>
        <div id="bazi-date" class="sub" style="margin-bottom:8px"></div>
        <div id="bazi-pillars" class="pillars"></div>
        <div class="row cols-5" style="align-items:center;margin-top:10px">
          <div><div>æœ¨</div><div class="bar"><i id="bar-æœ¨"></i></div><div id="pct-æœ¨" class="muted" style="margin-top:4px"></div></div>
          <div><div>ç«</div><div class="bar"><i id="bar-ç«"></i></div><div id="pct-ç«" class="muted" style="margin-top:4px"></div></div>
          <div><div>åœŸ</div><div class="bar"><i id="bar-åœŸ"></i></div><div id="pct-åœŸ" class="muted" style="margin-top:4px"></div></div>
          <div><div>é‡‘</div><div class="bar"><i id="bar-é‡‘"></i></div><div id="pct-é‡‘" class="muted" style="margin-top:4px"></div></div>
          <div><div>æ°´</div><div class="bar"><i id="bar-æ°´"></i></div><div id="pct-æ°´" class="muted" style="margin-top:4px"></div></div>
        </div>
        <div id="bazi-elements-balance" class="sub" style="margin-top:8px"></div>
      </div>
    `;
    result.appendChild(free);
  }
  
  return result;
}

// å…«å­—è®¡ç®—å™¨ï¼ˆç®€åŒ–ç‰ˆï¼‰ä¿æŒä¸å˜...
const baziCalculator = {
  heavenlyStems: ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'],
  earthlyBranches: ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'],
  calculateYearPillar: function(year) {
    const stemIndex = (year - 4) % 10, branchIndex = (year - 4) % 12;
    return { stem: this.heavenlyStems[stemIndex], branch: this.earthlyBranches[branchIndex], element: 'æœ¨' };
  },
  calculateMonthPillar: function(year, month, day) {
    const monthMap = { 1: { stem: 'ä¸™', branch: 'å¯…' }, 2: { stem: 'ä¸', branch: 'å¯' }, 3: { stem: 'æˆŠ', branch: 'è¾°' }, 4: { stem: 'å·±', branch: 'å·³' }, 5: { stem: 'åºš', branch: 'åˆ' }, 6: { stem: 'è¾›', branch: 'æœª' }, 7: { stem: 'å£¬', branch: 'ç”³' }, 8: { stem: 'ç™¸', branch: 'é…‰' }, 9: { stem: 'ç”²', branch: 'æˆŒ' }, 10: { stem: 'ä¹™', branch: 'äº¥' }, 11: { stem: 'ä¸™', branch: 'å­' }, 12: { stem: 'ä¸', branch: 'ä¸‘' } };
    const pillar = monthMap[month] || monthMap[1];
    return { stem: pillar.stem, branch: pillar.branch, element: 'æœ¨' };
  },
  calculateDayPillar: function(year, month, day) {
    const date = new Date(year, month - 1, day);
    const dayNum = Math.floor((date - new Date(1900, 0, 1)) / (1000 * 60 * 60 * 24));
    const stemIndex = dayNum % 10, branchIndex = dayNum % 12;
    return { stem: this.heavenlyStems[stemIndex], branch: this.earthlyBranches[branchIndex], element: 'æœ¨' };
  },
  calculateHourPillar: function(dayStem, hour) {
    const hourIndex = Math.floor((hour + 1) / 2) % 12;
    return { stem: 'ç”²', branch: this.earthlyBranches[hourIndex], element: 'æœ¨' };
  },
  calculateBazi: function(year, month, day, hour, timeUnknown) {
    const pillars = {
      year: this.calculateYearPillar(year),
      month: this.calculateMonthPillar(year, month, day),
      day: this.calculateDayPillar(year, month, day),
      hour: timeUnknown ? { stem: '?', branch: '?', element: 'æœªçŸ¥' } : this.calculateHourPillar(this.calculateDayPillar(year, month, day).stem, hour)
    };
    const percents = { wood: 25, fire: 25, earth: 25, metal: 15, water: 10 };
    return { pillars, percents, timeUnknown };
  }
};

// æ¸²æŸ“å…«å­—æŸ±
function renderPillars(root,p,timeUnknown=false){
  if(!root) return; root.innerHTML='';
  [['å¹´æŸ±',p.year],['æœˆæŸ±',p.month],['æ—¥æŸ±',p.day],['æ—¶æŸ±',p.hour]].forEach(([tit,v])=>{
    const u=(tit==='æ—¶æŸ±'&&timeUnknown); const stem=u?'ï¼Ÿ':v.stem,branch=u?'ï¼Ÿ':v.branch;
    const div=document.createElement('div'); div.className='pillar';
    div.innerHTML=`<div class="tit">${tit}</div><div class="gz">${stem}${branch}</div>`;
    root.appendChild(div);
  });
}

// ç”Ÿæˆå‘½ç›˜
async function genChart(){
  const get = id => $(id)?.value?.trim() || '';
  const bd1 = get('birthdate1'), bt1 = get('birthtime1');
  if (!bd1){ showErr('è¯·å¡«å†™æœ¬äººå‡ºç”Ÿæ—¥æœŸ'); return; }

  const [Y,M,D] = bd1.split('-').map(Number);
  const hour = bt1 ? parseInt(bt1.split(':')[0],10) : 12;
  const timeUnknown = $('#timeUnknown')?.checked || false;

  const nextBtn = $('btnNext');
  if (nextBtn){ nextBtn.disabled = true; nextBtn.textContent = 'ç”Ÿæˆä¸­...'; }

  try{
    const { pillars, percents, timeUnknown: tu } = baziCalculator.calculateBazi(Y, M, D, hour, timeUnknown);
    
    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
    $('result').style.display = 'block';
    ensureResultHost();

    // æ¸²æŸ“å…«å­—ä¿¡æ¯
    const timeText = tu ? 'æ—¶é—´ä¸è¯¦' : (hour + 'æ—¶');
    setText('bazi-date', `å‡ºç”Ÿæ—¥æœŸ: ${Y}å¹´${M}æœˆ${D}æ—¥ ${timeText}`);
    renderPillars($('bazi-pillars'), pillars, tu);

    // æ¸²æŸ“äº”è¡Œç™¾åˆ†æ¯”
    setBar($('bar-æœ¨'), percents.wood); setText('pct-æœ¨', Math.round(percents.wood) + '%');
    setBar($('bar-ç«'), percents.fire); setText('pct-ç«', Math.round(percents.fire) + '%');
    setBar($('bar-åœŸ'), percents.earth); setText('pct-åœŸ', Math.round(percents.earth) + '%');
    setBar($('bar-é‡‘'), percents.metal); setText('pct-é‡‘', Math.round(percents.metal) + '%');
    setBar($('bar-æ°´'), percents.water); setText('pct-æ°´', Math.round(percents.water) + '%');

    setText('bazi-elements-balance', 'å…ƒç´ å¹³è¡¡åˆ†ææ˜¾ç¤ºä¸­...');

    // æ¸²æŸ“å¿ƒæ€œç®¡å®¶
    mountButlerCard();
    // æ¸²æŸ“å¯ŒæŠ¥å‘Š
    mountRichReport({ pillars, percents });

  } catch (err){
    console.error(err);
    showErr('è®¡ç®—å…«å­—æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
  } finally {
    if (nextBtn){ nextBtn.disabled = false; nextBtn.textContent = t('btn_next') || 'ç”Ÿæˆåˆ†æ'; }
    $('result')?.scrollIntoView({ behavior:'smooth', block:'start' });
  }
}

// å¿ƒæ€œç®¡å®¶å¡ç‰‡
function mountButlerCard(){
  const host = $('butler-host') || $('result');
  if (!host.querySelector('#aiCard')){
    const card = document.createElement('div');
    card.id = 'aiCard';
    card.className = 'sec';
    card.innerHTML = `
      <h3 id="butlerTitle">${t('butler_title') || 'å¿ƒæ€œç®¡å®¶ Â· å»ºè®®'}</h3>
      <div class="chips" id="butlerChips"></div>
      <div class="ai-content">
        <p>æ ¹æ®æ‚¨çš„å…«å­—åˆ†æï¼Œä¸ºæ‚¨æä¾›ä¸ªæ€§åŒ–çš„å‘½ç†å»ºè®®å’Œäººç”ŸæŒ‡å¯¼ã€‚</p>
        <p>VIPä¼šå‘˜å¯è§£é”æ›´è¯¦ç»†çš„æ·±åº¦åˆ†æå’Œæ—¥å¸¸ç»ƒä¹ å¡ã€‚</p>
      </div>
      <div class="ai-lock-overlay">
        <div class="tip">VIP è§£é”æ›´å¤šä¸ªæ€§åŒ–å»ºè®®</div>
        <div class="sub">ç™»å½•åå¯ç”Ÿæˆå®Œæ•´æ·±åº¦æŠ¥å‘Šä¸æ—¥å¸¸ç»ƒä¹ å¡ã€‚</div>
      </div>
    `;
    host.appendChild(card);
  }
  renderChips();
}

function renderChips(){
  const el = $('butlerChips'); if (!el) return;
  el.innerHTML='';
  const chips = ['æ‹çˆ±ç¼˜åˆ†', 'å©šå§»èµ°åŠ¿', 'èŒåœºå‘å±•', 'åˆ›ä¸šæ½œåŠ›', 'è´¢ä½åˆ†æ', 'ç†è´¢æ—¶æœº'];
  chips.forEach(txt=>{ const c=document.createElement('div'); c.className='chip'; c.textContent=txt; el.appendChild(c); });
}

// å¯ŒæŠ¥å‘Š
function mountRichReport({ pillars, percents }) {
  let host = $('rich-report');
  if (!host) {
    host = document.createElement('div');
    host.id = 'rich-report';
    $('result').appendChild(host);
  }
  
  host.innerHTML = `
    <div class="sec">
      <h3>å…«å­—è¯¦ç»†åˆ†æ</h3>
      <p>æ‚¨çš„å…«å­—ç»„åˆæ˜¾ç¤ºå‡ºç‹¬ç‰¹çš„å‘½ç†ç‰¹å¾ï¼š</p>
      <ul>
        <li>å¹´æŸ± ${pillars.year.stem}${pillars.year.branch} - ä»£è¡¨ç¥–ä¸Šæ ¹åŸºå’Œæ—©å¹´è¿åŠ¿</li>
        <li>æœˆæŸ± ${pillars.month.stem}${pillars.month.branch} - ä»£è¡¨çˆ¶æ¯å®«å’Œé’å¹´è¿åŠ¿</li>
        <li>æ—¥æŸ± ${pillars.day.stem}${pillars.day.branch} - ä»£è¡¨è‡ªèº«å’Œé…å¶</li>
        <li>æ—¶æŸ± ${pillars.hour.stem}${pillars.hour.branch} - ä»£è¡¨å­å¥³å’Œæ™šå¹´è¿åŠ¿</li>
      </ul>
    </div>
  `;
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
  // è¯­è¨€åˆå§‹åŒ–
  const select = $('langSelect');
  const current = getLang();
  if (select) { select.value = current; select.addEventListener('change', ()=>{ setLang(select.value); applyI18n(); }); }
  applyI18n();

  // ç±»å‹åˆ‡æ¢
  const typeSel = $('type');
  if (typeSel){
    togglePartner(typeSel.value);
    typeSel.addEventListener('change', e => togglePartner(e.target.value));
  }

  // ç”Ÿæˆåˆ†ææŒ‰é’®
  const nextBtn = $('btnNext');
  if (nextBtn){
    nextBtn.addEventListener('click', (e)=>{
      e.preventDefault(); hideErr(); genChart();
    });
  }

  // æ—¶é—´ä¸è¯¦å¤„ç†
  const timeUnknown = $('#timeUnknown');
  const birthtime1 = $('#birthtime1');
  if (timeUnknown && birthtime1) {
    timeUnknown.addEventListener('change', function() {
      birthtime1.disabled = this.checked;
      if (this.checked) birthtime1.value = '';
    });
  }
});
</script>
</body>
</html>
