<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>å¡”ç½—ç‰Œå åœ Â· Tarot</title>
<link rel="icon" href="data:,">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
  --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
  --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
  --card-w:128px; --card-h:212px; --gap:14px;
}
@media (max-width:640px){ :root{ --card-w:100px; --card-h:168px; --gap:10px; } }

html,body{height:100%}
body{
  margin:0; color:var(--text);
  background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
              linear-gradient(180deg,#0b0f14,#0b0f14);
  font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
.container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

/* â€”â€” ç»Ÿä¸€å¤´éƒ¨ï¼ˆä¸å…«å­—é¡µä¸€è‡´ï¼‰ â€”â€” */
.site-header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
.head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em}
.title a{ color: inherit; text-decoration: none; }
.title a:hover{ text-decoration: underline; text-underline-offset: 3px; }
.lang{display:flex; align-items:center; gap:8px}
.lang label{white-space:nowrap; color:var(--muted); margin-right:4px}
.lang select{appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}
@media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

/* â€”â€” é¡µé¢ç»“æ„ â€”â€” */
.app{max-width:1100px; margin:0 auto; padding:18px}
.h1{margin:6px 0 14px; color:#ffe084; font-weight:800; font-size:1.8rem}
.controls{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px}
.controls input, .controls select, .controls button{padding:12px; border-radius:12px; border:1px solid #273245; background:#0f1420; color:var(--text)}
.controls input{flex:1; min-width:220px}
.controls button{cursor:pointer; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#121212; border-color:#e6c76e; font-weight:800}
.q{margin:6px 0 12px; font-weight:600; color:var(--muted)}

/* â€”â€” ç‰Œé¢ä¸å¸ƒå±€ â€”â€” */
.board{display:grid; gap:var(--gap); justify-content:center; align-content:start}
.card{display:flex; flex-direction:column; align-items:center; gap:6px; text-align:center; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:10px 10px 12px; box-shadow:var(--shadow); width:calc(var(--card-w) + 20px)}
.imgwrap{width:var(--card-w); height:var(--card-h); border-radius:10px; overflow:hidden; background:#000; display:grid; place-items:center; border:1px solid #34455a}
.card-img{display:block; width:100%; height:100%; object-fit:cover}
.cap{font-weight:700}
.mean{font-size:.92rem; color:var(--muted)}
.board.spread-1{grid-template-columns:repeat(1, max-content)}
.board.spread-3{grid-template-columns:repeat(3, max-content)}
.board.spread-5{display:grid; grid-template-columns:repeat(3, max-content); grid-template-rows:auto auto auto; grid-template-areas:"top top top" "left center right" "bottom bottom bottom"}
.board.spread-5 .pos-top{grid-area:top}
.board.spread-5 .pos-left{grid-area:left}
.board.spread-5 .pos-center{grid-area:center}
.board.spread-5 .pos-right{grid-area:right}
.board.spread-5 .pos-bottom{grid-area:bottom}
.board.spread-10{gap:var(--gap)}
.board.spread-10 .row{display:grid; gap:var(--gap); justify-content:center}
.board.spread-10 .row-1{grid-template-columns:repeat(3, max-content)}
.board.spread-10 .row-2{grid-template-columns:repeat(3, max-content)}
.board.spread-10 .row-3{grid-template-columns:repeat(4, max-content)}

/* â€”â€” é˜…è¯»é¢æ¿ â€”â€” */
.panel{margin-top:16px; padding:14px; border:1px solid var(--line); background:#0f1420; border-radius:12px}
.muted{color:var(--muted)}
.btn{padding:8px 12px; border-radius:10px; border:1px solid #273245; background:#0f1420; color:#ffe084; cursor:pointer}
.btn.ghost{background:transparent; color:var(--text)}

/* â€”â€” GPT/å¿ƒæ€œç®¡å®¶ â€”â€” */
.ss-chat-fab{position:fixed; right:18px; bottom:18px; z-index:50; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; padding:12px 16px; border-radius:999px; border:1px solid #e6c76e; box-shadow:var(--shadow); cursor:pointer}
.ss-chat-panel{position:fixed; right:18px; bottom:88px; width:min(460px,92vw); max-height:70vh; background:#0e1520; border:1px solid #243244; border-radius:16px; display:none; flex-direction:column; overflow:hidden; box-shadow:var(--shadow); z-index:50}
.ss-chat-panel[aria-hidden="false"]{display:flex}
.ss-chat-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244}
.ss-chat-title{font-weight:700}
.ss-close{cursor:pointer; opacity:.8}
.ss-chat-body{padding:12px; overflow:auto; display:flex; flex-direction:column; gap:10px}
.ss-msg{background:#11161dcc; border:1px solid #243244; padding:10px; border-radius:10px; font-size:.95rem; max-width:80%}
.ss-msg .meta{font-size:.8rem; color:var(--muted); margin-bottom:4px}
.ss-msg.me{margin-left:auto; background:#132033}
.ss-chat-input{display:flex; gap:8px; padding:10px; border-top:1px solid #243244}
.ss-chat-input input{flex:1; padding:10px; border-radius:10px; border:1px solid #273245; background:#0b0f14; color:var(--text)}

/* â€”â€” ç™»å½•å¼¹çª— â€”â€” */
.auth-mask{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:60}
.auth-mask[aria-hidden="false"]{display:flex}
.auth-box{width:min(520px,92vw); background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow)}
.auth-head{padding:12px 14px; border-bottom:1px solid #243244; font-weight:700}
.auth-body{padding:14px}
.auth-actions{display:flex; gap:10px; justify-content:flex-end; padding:0 14px 14px}

/* â€”â€” ä¼°æ—¶é—´å¼¹çª—ï¼ˆä¿ç•™å ä½ï¼Œä¸ä½¿ç”¨å¯ç§»é™¤ï¼‰ â€”â€” */
.tw-mask{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:40}
.tw-mask[aria-hidden="false"]{display:flex}
.tw-box{width:min(560px, 92vw); background:#0f1420; border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow)}
.tw-head{padding:12px 14px; border-bottom:1px solid var(--line); font-weight:700}
.tw-body{padding:12px 14px}
.tw-grid{display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:8px}
.tw-foot{display:flex; gap:8px; justify-content:flex-end; padding:12px 14px; border-top:1px solid var(--line)}
</style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <!-- å“ç‰Œï¼šç‚¹å‡»å›åˆ°â€œå…«å­—ç®€è¯„â€æœ¬é¡µ -->
<a class="brand" href="https://astro.5xliving.com/" target="_self">
  <span class="brand-badge">5X</span>
  <span class="title">
    5xLiving Â· <span data-i18n="page_title">å¡”ç½—ç‰Œå åœ</span>
  </span>
</a>

    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="lang_label">è¯­è¨€</label>
      <select id="langSelect" aria-label="Language">
          <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
          <option value="en">English</option>
          <option value="ja">æ—¥æœ¬èª</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="ms">Bahasa Melayu</option>
      </select>
</header>

<div class="app">
  <h1 class="h1" data-i18n="page_title">å¡”ç½—ç‰Œå åœ</h1>
  <div class="controls">
    <input id="question" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼ˆå¿…å¡«ï¼Œå†³å®šè§£è¯»æ–¹å‘ï¼‰" data-i18n-placeholder="q_ph" />
    <select id="spread">
      <option value="1" data-i18n="s1">å•å¼ </option>
      <option value="3" data-i18n="s3">ä¸‰å¼ ï¼ˆè¿‡å» / ç°åœ¨ / æœªæ¥ï¼‰</option>
      <option value="5" data-i18n="s5">åå­—æ’æ³•ï¼ˆ5å¼ ï¼‰</option>
      <option value="10" data-i18n="s10">å‡¯å°”ç‰¹åå­—ï¼ˆ10å¼ ï¼‰</option>
    </select>
    <button id="go" data-i18n="draw_btn">æŠ½ç‰Œ</button>
  </div>

  <div id="qdisplay" class="q muted" data-i18n="tip_focus">ï¼ˆæç¤ºï¼šè¾“å…¥é—®é¢˜ä¼šè®©è§£è¯»æ›´èšç„¦ï¼‰</div>
  <div id="board" class="board"></div>

  <div id="reading" class="panel" style="display:none">
    <h3 style="margin:0 0 8px;font-weight:800" data-i18n="reading_title">è§£è¯»ä¸å»ºè®®</h3>
    <div id="readingText"></div>
    <div class="panel muted" style="margin-top:12px" data-i18n="disclaimer">è¯´æ˜ï¼šå¡”ç½—ä¸ºæŒ‡å¼•å·¥å…·ï¼ŒéåŒ»å­¦/æ³•å¾‹/é‡‘èå»ºè®®ï¼Œè¯·ä»¥ç†æ€§åˆ¤æ–­ä¸è‡ªæˆ‘æ„æ„¿ä¸ºå…ˆã€‚</div>
  </div>
</div>

<!-- GPT / å¿ƒæ€œç®¡å®¶ï¼ˆç»Ÿä¸€æµ®çª—ï¼‰ -->
<div class="ss-chat-fab" id="chatFab">å¿ƒæ€œç®¡å®¶</div>
<div class="ss-chat-panel" id="chatPanel" aria-hidden="true">
  <div class="ss-chat-head">
    <div class="ss-chat-title" id="chatTitle">å¿ƒæ€œç®¡å®¶ Â· GPT</div>
    <div class="ss-close" id="chatClose">âœ•</div>
  </div>
  <div class="ss-chat-body" id="chatBody">
    <div class="ss-msg"><div class="meta">Demo</div>å½“å‰ä¸ºå‰ç«¯ç¤ºä¾‹ã€‚æ¥å…¥åç«¯ï¼šåœ¨ <code>sendGPT()</code> ä¸­è°ƒç”¨ä½ çš„ APIã€‚</div>
  </div>
  <div class="ss-chat-input">
    <input id="chatInput" placeholder="è¾“å…¥é—®é¢˜â€¦"/>
    <button class="btn" id="chatSend">å‘é€</button>
</div>

<!-- ä¼°æ—¶é—´å¼¹çª—ï¼ˆå¦‚ä¸éœ€è¦å¯åˆ é™¤ï¼‰ -->
<div class="tw-mask" id="twMask" aria-hidden="true">
  <div class="tw-box" role="dialog" aria-modal="true" aria-labelledby="twTitle">
    <div class="tw-head" id="twTitle">ğŸ§­ ä¼°ä¸€ä¸ªå¤§è‡´å‡ºç”Ÿæ—¶é—´</div>
    <div class="tw-body">
      <div class="muted" style="margin-bottom:8px">é€‰æ‹©ä½ è®°å¾—çš„<strong>å¤§æ¦‚æ—¶æ®µ</strong>ï¼ˆåœ°æ”¯åŒå°æ—¶æ®µï¼‰</div>
      <div class="tw-grid" id="twGrid"></div>
      <div class="muted" style="margin-top:10px;font-size:.9em">é€‰æ‹©åç‚¹â€œå¡«å…¥æ—¶é—´â€ï¼Œä¼šç”¨è¯¥æ—¶æ®µçš„ä¸­ä½æ—¶é—´å†™åˆ°ä¸Šæ–¹æ—¶é—´è¾“å…¥æ¡†ï¼Œå¹¶è‡ªåŠ¨å–æ¶ˆâ€œæ—¶é—´ä¸è¯¦â€ã€‚</div>
    </div>
    <div class="tw-foot">
      <button class="btn ghost" id="twCancel" type="button">å–æ¶ˆ</button>
      <button class="btn" id="twApply" type="button" disabled>å¡«å…¥æ—¶é—´</button>
    </div>

  <!-- ç™»å½•å¼¹çª—ï¼ˆç»Ÿä¸€æ ·å¼ï¼‰ -->
    <!-- ä¼šå‘˜ä¸“åŒº -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">ğŸŒ™ ä¼šå‘˜åŒºåŸŸ VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">ğŸ— å‘½ç†ç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_love">å§»ç¼˜æ–¹å‘ï¼šæ‹çˆ±ç¼˜åˆ†ã€å©šå§»èµ°åŠ¿</li>
            <li data-i18n="vip_career">äº‹ä¸šæ–¹å‘ï¼šèŒåœºå‘å±•ã€åˆ›ä¸šæ½œåŠ›</li>
            <li data-i18n="vip_wealth">è´¢è¿æ–¹å‘ï¼šè´¢ä½åˆ†æã€ç†è´¢æ—¶æœº</li>
            <li data-i18n="vip_pet">å® ç‰©å‘½ç†ï¼šä¼´ä¾£åŠ¨ç‰©çš„æ€§æ ¼ä¸ç¼˜åˆ†</li>
            <li data-i18n="vip_hepan">åˆç›˜åˆ†æï¼šå©šæœŸæ‹©æ—¥ã€æ–°ç”Ÿæ‹©æ—¶</li>
            <li data-i18n="vip_name">æµ‹ååˆ†æï¼šå…¬å¸åã€å®å®åã€å‘½åæ”¹è¿</li>
            <li data-i18n="vip_fengshui">è´¢ä½åˆç›˜ï¼šä½å®¶ / åŠå…¬å®¤åŠ¨çº¿é…åˆ</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">ğŸŒ™ å¿ƒæ€œç©ºé—´ä¸“å±å†…å®¹</div>
          <ul>
            <li data-i18n="vip_record">çµæ€§è®°å½•ï¼šç…§ç‰‡ã€æ¢¦å¢ƒã€å£°éŸ³ã€æ„¿æœ›ç¥ˆç¥·</li>
            <li data-i18n="vip_course">å‘½ç†è¯¾ç¨‹ï¼šå…«å­— / å¡”ç½— / å æ˜Ÿ / çµæ•° / äººç±»å›¾</li>
            <li data-i18n="vip_memorial">å®¶æ—çºªå¿µç³»ç»Ÿï¼šäº²äººçµæ€§çºªå¿µ & å»¶ç»­</li>
            <li data-i18n="vip_tasks">æ¯å‘¨èƒ½é‡ç»ƒä¹  / ç¥æ˜ä»ªå¼ä»»åŠ¡</li>
            <li data-i18n="vip_shop">èƒ½é‡å•†åŸä¸“å±æŠ˜æ‰£ & å¾¡å®ˆè®¢åˆ¶</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">ğŸ’ ç™»å…¥ VIP åŠŸèƒ½</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- å·¦ä¾§ï¼šè¾“å…¥ + æ³¨å†Œ/ç™»å½• -->
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">è´¦æˆ·ç™»å½• / æ³¨å†Œ</div>
            <div class="body">
              <div class="row" id="authFields">
            <label for="email" class="sr-only" data-i18n="ph_email">é‚®ç®± Email</label>
            <input
               id="email"
               name="email"
               type="email"
               inputmode="email"
               autocomplete="username"   <!-- ç™»å½•/æ³¨å†Œå»ºè®®ç”¨ usernameï¼Œå¯†ç ç®¡ç†å™¨æ›´å®¹æ˜“é…å¯¹ -->
            <label for="password" class="sr-only" data-i18n="ph_label_password">å¯†ç  Password</label>    
            <input 
               id="password" 
               type="password" 
               autocomplete="new-password" 
               placeholder="å¯†ç  Passwordï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™æ•°å­—ç¬¦å·ï¼‰" data-i18n-ph="ph_password" required/>
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">ç™»å…¥è´¦æˆ·</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">ğŸ”‘ é‡è®¾å¯†ç </button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">æ³¨å†Œè´¦æˆ·</button>
                <div class="muted" data-i18n="note_price">æ³¨å†Œè´¦å·èµ é€ä¸€æ¬¡å…è´¹ä½“éªŒ</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- å³ä¾§ï¼šä¼šå‘˜ä¸è¿”å› -->
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">ä¼šå‘˜æœåŠ¡</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">ğŸ’ å‡çº§ä¸º VIPï¼ˆæœˆè´¹ï¼‰</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">â† è¿”å›å‘½ç†å•†åŸ</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / æœˆè´¹ VIPï¼ˆå‘½ç†ç©ºé—´ + å¿ƒæ€œç©ºé—´ + çµæ€§è¯¾ç¨‹ï¼‰</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>Â© 5XLiving â€¢ Astro Sanctuary</footer>


<script>
/* ===========================
   I18N â€”â€” äº”è¯­ï¼ˆç®€ä¸­ / ç¹ä¸­ / è‹± / æ³° / é©¬æ¥ï¼‰
=========================== */
const I18N = {
  'zh-CN': { ui:{ brand:'5xLiving Â· å‘½ç†å¿ƒæ€œç©ºé—´ Â· Soul Sanctuary', label_lang:'è¯­è¨€', page_title:'å¡”ç½—ç‰Œå åœ', q_ph:'è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼ˆå¿…å¡«ï¼Œå†³å®šè§£è¯»æ–¹å‘ï¼‰', s1:'å•å¼ ', s3:'ä¸‰å¼ ï¼ˆè¿‡å» / ç°åœ¨ / æœªæ¥ï¼‰', s5:'åå­—æ’æ³•ï¼ˆ5å¼ ï¼‰', s10:'å‡¯å°”ç‰¹åå­—ï¼ˆ10å¼ ï¼‰', draw_btn:'æŠ½ç‰Œ', tip_focus:'ï¼ˆæç¤ºï¼šè¾“å…¥é—®é¢˜ä¼šè®©è§£è¯»æ›´èšç„¦ï¼‰', reading_title:'è§£è¯»ä¸å»ºè®®', disclaimer:'è¯´æ˜ï¼šå¡”ç½—ä¸ºæŒ‡å¼•å·¥å…·ï¼ŒéåŒ»å­¦/æ³•å¾‹/é‡‘èå»ºè®®ï¼Œè¯·ä»¥ç†æ€§åˆ¤æ–­ä¸è‡ªæˆ‘æ„æ„¿ä¸ºå…ˆã€‚', you:'ä½ ', reading:'è§£è¯»', no_q:'ï¼ˆæœªå¡«å†™é—®é¢˜ï¼‰' },
    pos:{single:'å½“ä¸‹æ ¸å¿ƒ', past:'è¿‡å»', present:'ç°åœ¨', future:'æœªæ¥', top:'æŒ‡å¼•/ä¸»é¢˜', left:'è¿‡å»æ ¹æº', center:'å½“ä¸‹æ ¸å¿ƒ', right:'å¤–åœ¨å½±å“', bottom:'æœªæ¥å‘å±•', p1:'å½“ä¸‹', p2:'é˜»ç¢', p3:'æ½œæ„è¯†', p4:'è¿‡å»', p5:'æ˜¾æ„è¯†', p6:'æœªæ¥', p7:'è‡ªæˆ‘', p8:'ç¯å¢ƒ', p9:'å¸Œæœ›/ææƒ§', p10:'ç»“æœ'},
    suits:{ wands:{name:'æƒæ–',domain:'è¡ŒåŠ¨/çƒ­æƒ…'}, cups:{name:'åœ£æ¯',domain:'æƒ…æ„Ÿ/å…³ç³»'}, swords:{name:'å®å‰‘',domain:'æ€ç»´/æ²Ÿé€š'}, pentacles:{name:'é’±å¸',domain:'ç°å®/èµ„æº'} },
    ranks:{ ace:'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'ä¸ƒ','8':'å…«','9':'ä¹','10':'å', page:'ä¾ä»', knight:'éª‘å£«', queen:'çš‡å', king:'å›½ç‹', tone:{ ace:'èµ·ç‚¹/æ½œèƒ½','2':'å¯¹è¯/é€‰æ‹©','3':'åä½œ/æˆé•¿','4':'ç»“æ„/ç¨³å®š','5':'æŒ‘æˆ˜/æ³¢åŠ¨','6':'äº¤æµ/æ”¯æŒ','7':'è¯„ä¼°/è€å¿ƒ','8':'æ¨è¿›/æ•ˆç‡','9':'æˆæœ/è´Ÿæ‹…','10':'é˜¶æ®µå®Œæˆ', page:'è®¯æ¯/å­¦ä¹ ', knight:'è¡ŒåŠ¨/æ¨åŠ¨', queen:'æˆç†Ÿ/æ»‹å…»', king:'æŒæ§/å®šè°ƒ'} },
    majors:[ ['æ„šè€…','è‡ªç”±/è·ƒè¿','æ‹¥æŠ±æœªçŸ¥ï¼Œè½»è£…å¯ç¨‹'],['é­”æœ¯å¸ˆ','æ„å¿—/æ˜¾åŒ–','é›†ä¸­èµ„æºï¼Œç«‹å³è¡ŒåŠ¨'],['å¥³ç¥­å¸','ç›´è§‰/æ½œæ„è¯†','å…ˆè§‚å¯Ÿï¼Œåè¡¨æ€'],['å¥³çš‡','æ»‹å…»/ä¸°ç››','ä»¥æ¸©æŸ”ä¸ç…§æ–™ä¿ƒè¿›æˆé•¿'],['çš‡å¸','ç§©åº/ç»“æ„','å®šè§„åˆ™ã€ç«‹è¾¹ç•Œã€ç»™å®‰å…¨æ„Ÿ'],['æ•™çš‡','è§„èŒƒ/ä¼ æ‰¿','éµå¾ªåˆ¶åº¦ä¸é•¿è¾ˆå»ºè®®'],['æ‹äºº','é€‰æ‹©/è¿ç»“','å¯¹é½ä»·å€¼è§‚å†æ‰¿è¯º'],['æˆ˜è½¦','æ¨è¿›/èƒœè´Ÿ','å®šç›®æ ‡ï¼Œå¼ºåŠ¿æ¨è¿›'],['åŠ›é‡','å‹‡æ°”/æ¸©æŸ”','ä»¥æŸ”å…‹åˆšï¼Œç¨³å®šè€å¿ƒ'],['éšè€…','å†…çœ/ç‹¬å¤„','æ”¶å¿ƒå®¡è§†ï¼Œç‹¬ç«‹åˆ¤æ–­'],['å‘½è¿ä¹‹è½®','å‘¨æœŸ/æœºç¼˜','é¡ºåŠ¿è€Œä¸ºï¼ŒæŠ“æ—¶æœº'],['æ­£ä¹‰','è¡¡é‡/å…¬å¹³','ä»¥äº‹å®ä¸è¾¹ç•Œè§£å†³'],['å€’åŠäºº','åœæ­¢/æ¢è§’','æš‚ç¼“æ¨è¿›ï¼Œæ¢ä½æ€è€ƒ'],['æ­»ç¥','ç»“æŸ/é‡ç”Ÿ','æœæ–­æ­¢æŸï¼Œè¿æ¥æ–°ç”Ÿ'],['èŠ‚åˆ¶','è°ƒå’Œ/èŠ‚å¾‹','é™å¼ºåº¦ï¼Œç¨³èŠ‚å¥'],['æ¶é­”','æ‰§è‘—/è¯±æƒ‘','è¾¨ä¾èµ–ï¼Œæ–­ä¸è‰¯å¾ªç¯'],['é«˜å¡”','çªå˜/ç“¦è§£','æ¥çº³å˜åŒ–ï¼Œå¿«é€Ÿé‡ç»„'],['æ˜Ÿæ˜Ÿ','å¸Œæœ›/å¤åŸ','é‡å»ºä¿¡ä»»ï¼Œæ¸©æŸ”ä¿®å¤'],['æœˆäº®','è¿·é›¾/ä¸å®‰','æ¨è¿Ÿé‡å¤§å†³å®šï¼Œå…ˆæŸ¥æ˜'],['å¤ªé˜³','æ¸…æ™°/å–œæ‚¦','å…¬å¼€é€æ˜ï¼Œåº†ç¥æˆæœ'],['å®¡åˆ¤','è§‰é†’/å¬å›','å›åº”å¬å”¤ï¼Œçº åå¤ç›˜'],['ä¸–ç•Œ','å®Œæˆ/æ•´åˆ','é—­ç¯ä¸å‡çº§ï¼Œå¼€å¯æ–°ç¯‡'] ],
    tags:{upright:'æ­£ä½', reversed:'é€†ä½'}, nextSteps:'<b>ä¸‹ä¸€æ­¥ï¼ˆ48 å°æ—¶å†…ï¼‰ï¼š</b><br>â‘  å†™ä¸‹ 1 æ¡å°ç›®æ ‡ï¼›â‘¡ å®‰æ’ 1 ä¸ªå…·ä½“è¡ŒåŠ¨ï¼›â‘¢ ç”¨ 3 ä¸ªå®¢è§‚æŒ‡æ ‡è¡¡é‡ã€‚',
    domainAdvice:{ general:{majorRev:'å…ˆç¨³ä½å†å†³ç­–', majorOk:'å°æ­¥éªŒè¯ï¼Œé€æ­¥æ¨è¿›', wands:'æ”¾ç¼“èŠ‚å¥ï¼Œèšç„¦ä¸€äº‹', cups:'ä¼˜å…ˆå…³ç³»è´¨é‡', swords:'å…ˆä¿¡æ¯å¯¹é½', pentacles:'å…ˆåšå¯è½åœ°é…ç½®'} }
  },

  'zh-TW': { ui:{ brand:'5xLiving Â· å‘½ç†å¿ƒæ†ç©ºé–“ Â· Soul Sanctuary', label_lang:'èªè¨€', page_title:'å¡”ç¾…ç‰Œå åœ', q_ph:'è«‹è¼¸å…¥ä½ çš„å•é¡Œï¼ˆå¿…å¡«ï¼Œæ±ºå®šè§£è®€æ–¹å‘ï¼‰', s1:'å–®å¼µ', s3:'ä¸‰å¼µï¼ˆéå» / ç¾åœ¨ / æœªä¾†ï¼‰', s5:'åå­—æ’æ³•ï¼ˆ5å¼µï¼‰', s10:'å‡±çˆ¾ç‰¹åå­—ï¼ˆ10å¼µï¼‰', draw_btn:'æŠ½ç‰Œ', tip_focus:'ï¼ˆæç¤ºï¼šè¼¸å…¥å•é¡Œæœƒè®“è§£è®€æ›´èšç„¦ï¼‰', reading_title:'è§£è®€èˆ‡å»ºè­°', disclaimer:'èªªæ˜ï¼šå¡”ç¾…ç‚ºæŒ‡å¼•å·¥å…·ï¼Œéé†«å­¸/æ³•å¾‹/é‡‘èå»ºè­°ï¼Œè«‹ä»¥ç†æ€§åˆ¤æ–·ç‚ºå…ˆã€‚', you:'ä½ ', reading:'è§£è®€', no_q:'ï¼ˆæœªå¡«å¯«å•é¡Œï¼‰' },
    pos:{single:'ç•¶ä¸‹æ ¸å¿ƒ', past:'éå»', present:'ç¾åœ¨', future:'æœªä¾†', top:'æŒ‡å¼•/ä¸»é¡Œ', left:'éå»æ ¹æº', center:'ç•¶ä¸‹æ ¸å¿ƒ', right:'å¤–åœ¨å½±éŸ¿', bottom:'æœªä¾†ç™¼å±•', p1:'ç•¶ä¸‹', p2:'é˜»ç¤™', p3:'æ½›æ„è­˜', p4:'éå»', p5:'é¡¯æ„è­˜', p6:'æœªä¾†', p7:'è‡ªæˆ‘', p8:'ç’°å¢ƒ', p9:'å¸Œæœ›/ææ‡¼', p10:'çµæœ'},
    suits:{ wands:{name:'æ¬Šæ–',domain:'è¡Œå‹•/ç†±æƒ…'}, cups:{name:'è–æ¯',domain:'æƒ…æ„Ÿ/é—œä¿‚'}, swords:{name:'å¯¶åŠ',domain:'æ€ç¶­/æºé€š'}, pentacles:{name:'éŒ¢å¹£',domain:'ç¾å¯¦/è³‡æº'} },
    ranks:{ ace:'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'ä¸ƒ','8':'å…«','9':'ä¹','10':'å', page:'ä¾å¾', knight:'é¨å£«', queen:'çš‡å', king:'åœ‹ç‹', tone:{ ace:'èµ·é»/æ½›èƒ½','2':'å°è©±/é¸æ“‡','3':'å”ä½œ/æˆé•·','4':'çµæ§‹/ç©©å®š','5':'æŒ‘æˆ°/æ³¢å‹•','6':'äº¤æµ/æ”¯æŒ','7':'è©•ä¼°/è€å¿ƒ','8':'æ¨é€²/æ•ˆç‡','9':'æˆæœ/è² æ“”','10':'éšæ®µå®Œæˆ', page:'è¨Šæ¯/å­¸ç¿’', knight:'è¡Œå‹•/æ¨å‹•', queen:'æˆç†Ÿ/æ»‹é¤Š', king:'æŒæ§/å®šèª¿'} },
    majors: null, tags:{upright:'æ­£ä½', reversed:'é€†ä½'}, nextSteps:'<b>48 å°æ™‚å…§ï¼š</b>â‘  å¯«ä¸‹ä¸€å€‹å°ç›®æ¨™ï¼›â‘¡ å®‰æ’ä¸€å€‹å…·é«”è¡Œå‹•ï¼›â‘¢ è¨­ 3 å€‹è¡¡é‡æŒ‡æ¨™ã€‚', domainAdvice:{ general:{majorRev:'å…ˆç©©ä½å†æ±ºç­–', majorOk:'å°æ­¥é©—è­‰é€æ­¥æ¨é€²', wands:'æ”¾æ…¢ç¯€å¥', cups:'é‡è¦–é—œä¿‚å“è³ª', swords:'å…ˆè³‡è¨Šå°é½Š', pentacles:'è³‡æºé…ç½®å…ˆè¡Œ'} } },

  'en-US': { ui:{ brand:'5xLiving Â· Soul Sanctuary', label_lang:'Language', page_title:'Tarot Reading', q_ph:'Type your question (focuses the reading)', s1:'Single', s3:'Three (Past / Present / Future)', s5:'Cross (5)', s10:'Celtic Cross (10)', draw_btn:'Draw', tip_focus:'(Tip: a clear question focuses the reading)', reading_title:'Insights & Advice', disclaimer:'Tarot offers guidance, not medical/legal/financial advice. Use your judgment.', you:'You', reading:'Reading', no_q:'(No question)' },
    pos:{single:'Core Now', past:'Past', present:'Present', future:'Future', top:'Theme/Guidance', left:'Roots', center:'Core Now', right:'External', bottom:'Development', p1:'Present', p2:'Obstacle', p3:'Subconscious', p4:'Past', p5:'Conscious', p6:'Future', p7:'Self', p8:'Environment', p9:'Hopes/Fears', p10:'Outcome'},
    suits:{ wands:{name:'Wands',domain:'Action/Passion'}, cups:{name:'Cups',domain:'Emotion/Relations'}, swords:{name:'Swords',domain:'Mind/Communication'}, pentacles:{name:'Pentacles',domain:'Material/Resources'} },
    ranks:{ ace:'Ace','2':'Two','3':'Three','4':'Four','5':'Five','6':'Six','7':'Seven','8':'Eight','9':'Nine','10':'Ten', page:'Page', knight:'Knight', queen:'Queen', king:'King', tone:{ ace:'Seed/Potential','2':'Duality/Choice','3':'Collab/Growth','4':'Structure/Stability','5':'Challenge/Flux','6':'Exchange/Support','7':'Evaluate/Patience','8':'Momentum/Efficiency','9':'Result/Burden','10':'Completion', page:'Message/Learning', knight:'Action/Drive', queen:'Maturity/Nurture', king:'Authority/Setting Tone'} },
    majors:[ ['The Fool','Freedom/Leap','Embrace the unknown; travel light'],['The Magician','Will/Manifest','Align resources; act now'],['The High Priestess','Intuition/Subconscious','Observe first, speak later'],['The Empress','Nurture/Abundance','Gentle care grows results'],['The Emperor','Order/Structure','Set rules and safety'],['The Hierophant','Norms/Tradition','Follow guidance and standards'],['The Lovers','Choice/Union','Align values before commitment'],['The Chariot','Push/Win','Pick a target; drive forward'],['Strength','Courage/Gentleness','Soft power, steady patience'],['The Hermit','Introspect/Alone','Withdraw to assess'],['Wheel of Fortune','Cycle/Timing','Ride the turn; seize timing'],['Justice','Measure/Fairness','Facts and boundaries solve it'],['The Hanged Man','Pause/Reframe','Wait; see from another angle'],['Death','Ending/Rebirth','Cut losses; welcome renewal'],['Temperance','Blend/Rhythm','Lower intensity; steady cadence'],['The Devil','Attachment/Temptation','Name the bind; break the loop'],['The Tower','Shock/Collapse','Accept change; rebuild swiftly'],['The Star','Hope/Recovery','Restore trust; heal gently'],['The Moon','Fog/Anxiety','Delay big moves; verify facts'],['The Sun','Clarity/Joy','Be open; celebrate wins'],['Judgement','Awakening/Call','Answer the call; correct course'],['The World','Completion/Integration','Close the loop; level up'] ], tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>Next 48h:</b> (1) Write one small goal; (2) Schedule one concrete action; (3) Track 3 metrics.', domainAdvice:{ general:{majorRev:'Stabilize before deciding', majorOk:'Validate in small steps', wands:'Slow down; single-task', cups:'Prioritize relationship quality', swords:'Align information first', pentacles:'Resource a concrete plan first'} } },

  'th-TH': { ui:{ brand:'5xLiving Â· Soul Sanctuary', label_lang:'à¸ à¸²à¸©à¸²', page_title:'à¹„à¸à¹ˆà¸—à¸²à¹‚à¸£à¸•à¹Œ', q_ph:'à¸à¸´à¸¡à¸à¹Œà¸„à¸³à¸–à¸²à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“ (à¸Šà¹ˆà¸§à¸¢à¹‚à¸Ÿà¸à¸±à¸ªà¸„à¸³à¸—à¸³à¸™à¸²à¸¢)', s1:'à¹ƒà¸šà¹€à¸”à¸µà¸¢à¸§', s3:'à¸ªà¸²à¸¡à¹ƒà¸š (à¸­à¸”à¸µà¸• / à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ / à¸­à¸™à¸²à¸„à¸•)', s5:'à¸à¸²à¸‡à¹€à¸‚à¸™ (5 à¹ƒà¸š)', s10:'Celtic Cross (10)', draw_btn:'à¸ªà¸¸à¹ˆà¸¡à¹„à¸à¹ˆ', tip_focus:'(à¹€à¸„à¸¥à¹‡à¸”à¸¥à¸±à¸š: à¸„à¸³à¸–à¸²à¸¡à¸Šà¸±à¸” à¹‚à¸Ÿà¸à¸±à¸ªà¸”à¸µ)', reading_title:'à¸„à¸³à¹à¸›à¸¥à¹à¸¥à¸°à¸„à¸³à¹à¸™à¸°à¸™à¸³', disclaimer:'à¸—à¸²à¹‚à¸£à¸•à¹Œà¹ƒà¸«à¹‰à¸„à¸³à¹à¸™à¸°à¸™à¸³ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸„à¸³à¸›à¸£à¸¶à¸à¸©à¸²à¸—à¸²à¸‡à¹à¸à¸—à¸¢à¹Œ/à¸à¸à¸«à¸¡à¸²à¸¢/à¸à¸²à¸£à¹€à¸‡à¸´à¸™ à¹‚à¸›à¸£à¸”à¹ƒà¸Šà¹‰à¸§à¸´à¸ˆà¸²à¸£à¸“à¸à¸²à¸“', you:'à¸„à¸¸à¸“', reading:'à¸„à¸³à¸­à¹ˆà¸²à¸™', no_q:'(à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸³à¸–à¸²à¸¡)' }, pos:null, suits:null, ranks:null, majors:null, tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>à¸ à¸²à¸¢à¹ƒà¸™ 48 à¸Šà¸¡.:</b> à¸•à¸±à¹‰à¸‡ 1 à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¹€à¸¥à¹‡à¸ à¹† à¸§à¸²à¸‡ 1 à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³ à¹à¸¥à¸°à¸•à¸´à¸”à¸•à¸²à¸¡ 3 à¸•à¸±à¸§à¸Šà¸µà¹‰à¸§à¸±à¸”', domainAdvice:{ general:{majorRev:'à¸›à¸£à¸°à¸„à¸­à¸‡à¹ƒà¸«à¹‰à¸¡à¸±à¹ˆà¸™à¸„à¸‡à¸à¹ˆà¸­à¸™à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ', majorOk:'à¸„à¹ˆà¸­à¸¢ à¹† à¸—à¸”à¸¥à¸­à¸‡à¹€à¸›à¹‡à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™'} } },

  'ms-MY': { ui:{ brand:'5xLiving Â· Soul Sanctuary', label_lang:'Bahasa', page_title:'Bacaan Tarot', q_ph:'Taip soalan anda (memfokuskan bacaan)', s1:'Satu', s3:'Tiga (Lalu / Kini / Hadapan)', s5:'Salib (5)', s10:'Celtic Cross (10)', draw_btn:'Tarik', tip_focus:'(Tip: soalan jelas, bacaan lebih fokus)', reading_title:'Wawasan & Nasihat', disclaimer:'Tarot ialah panduan, bukan nasihat perubatan/undang-undang/kewangan. Guna pertimbangan sendiri.', you:'Anda', reading:'Bacaan', no_q:'(Tiada soalan)' }, pos:null, suits:null, ranks:null, majors:null, tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>48j akan datang:</b> Tetapkan 1 matlamat kecil, jadualkan 1 tindakan, jejak 3 metrik.', domainAdvice:{ general:{majorRev:'Stabilkan dahulu sebelum buat keputusan', majorOk:'Sahkan langkah kecil dahulu'} } }
};

// è‹¥æŸè¯­è¨€æœªå®Œæ•´å®šä¹‰ pos/suits/ranks/majorsï¼Œåˆ™å›é€€åˆ°è‹±æ–‡
function withFallback(lang){
  const base = JSON.parse(JSON.stringify(I18N[lang]));
  const en = I18N['en-US'];
  ['pos','suits','ranks','majors','tags','domainAdvice'].forEach(k=>{ if(base[k]==null) base[k]=en[k]; });
  return base;
}

/* å°å·¥å…· */
const $ = s => document.querySelector(s); const $$ = s => Array.from(document.querySelectorAll(s)); const rnd = n => Math.floor(Math.random()*n);
const FALLBACK = 'zh-CN';
function detectLang(){ const nav=(navigator.language||'').toLowerCase(); if(nav.startsWith('zh-tw')) return 'zh-TW'; if(nav.startsWith('zh')) return 'zh-CN'; if(nav.startsWith('th')) return 'th-TH'; if(nav.startsWith('ms')) return 'ms-MY'; if(nav.startsWith('en')) return 'en-US'; return FALLBACK; }
let CUR = detectLang();
const langSel = document.getElementById('langSel'); langSel.value = CUR;

function t(path, dflt=''){ const parts = path.split('.'); let node = withFallback(CUR); for(const p of parts){ if(!node) break; node=node[p]; } return node==null ? dflt : node; }

function applyStaticUI(){
  document.querySelector('.title').innerHTML = `<a href="#">${t('ui.brand','5xLiving')}</a>`;
  document.querySelector('.lang label').textContent = t('ui.label_lang','è¯­è¨€');
  document.querySelector('[data-i18n="page_title"]').textContent = t('ui.page_title');
  document.getElementById('go').textContent = t('ui.draw_btn');
  const spread = document.getElementById('spread');
  spread.options[0].textContent = t('ui.s1');
  spread.options[1].textContent = t('ui.s3');
  spread.options[2].textContent = t('ui.s5');
  spread.options[3].textContent = t('ui.s10');
  document.getElementById('question').setAttribute('placeholder', t('ui.q_ph'));
  const disclaimer = document.querySelector('[data-i18n="disclaimer"]'); if(disclaimer) disclaimer.textContent = t('ui.disclaimer');
}

/* ç‰Œåº“ */
const SUITS = ['wands','cups','swords','pentacles'];
const RANKS = ['ace','2','3','4','5','6','7','8','9','10','page','knight','queen','king'];
const MAJORS = Array.from({length:22},(_,i)=>i);
let IMG_BASE = '/img/tarot';
function buildDeck(){ const deck=[]; MAJORS.forEach(i=> deck.push({id:`major_${String(i).padStart(2,'0')}`, group:'major', idx:i})); SUITS.forEach(s=> RANKS.forEach(r=> deck.push({id:`${s}_${r}`, group:'minor', suit:s, rank:r}))); return deck; }
const DECK = buildDeck();
function draw(n){ const pool=[...DECK], picks=[]; for(let i=0;i<n;i++){ const idx=rnd(pool.length); const card=pool.splice(idx,1)[0]; card.reversed=Math.random()<0.5; picks.push(card);} return picks; }
function imgFor(card){ return `${IMG_BASE}/${card.id}.webp`; }

/* æ–‡æ¡ˆè¾…åŠ© */
function dataPack(){ return withFallback(CUR); }
function cardName(card){ const pack=dataPack(); if(card.group==='major'){ return pack.majors[card.idx][0]; } const s=pack.suits[card.suit]; const r=pack.ranks[card.rank] || card.rank.toUpperCase(); return `${s.name}${r}`; }
function previewLine(card){ const pack=dataPack(); if(card.group==='major'){ const row=pack.majors[card.idx]; return `${row[1]} Â· ${row[2]}`; } const s=pack.suits[card.suit]; const tone=pack.ranks.tone[card.rank]; return `${s.name}ï¼ˆ${s.domain}ï¼‰Â· ${tone}`; }
function posLabel(key){ const pack=dataPack(); return pack.pos[key] || key; }
function tagFor(rev){ const pack=dataPack(); return rev ? pack.tags.reversed : pack.tags.upright; }

/* æ¸²æŸ“ */
function cardNode(card, cls, posKey){ const div=document.createElement('div'); div.className=`card ${cls||''}`; div.setAttribute('data-card-id', card.id); div.setAttribute('data-reversed', card.reversed?'true':'false'); const wrap=document.createElement('div'); wrap.className='imgwrap'; if(card.reversed) wrap.style.transform='rotate(180deg)'; const img=document.createElement('img'); img.className='card-img'; img.src=imgFor(card); img.alt=cardName(card); img.onerror=()=>{img.onerror=null; img.src=`${IMG_BASE}/back.webp`;}; wrap.appendChild(img); const cap=document.createElement('div'); cap.className='cap'; cap.textContent = `ã€${posLabel(posKey)}ã€‘${cardName(card)}ï¼ˆ${tagFor(card.reversed)}ï¼‰`; const mean=document.createElement('div'); mean.className='mean'; mean.textContent = previewLine(card); div.appendChild(wrap); div.appendChild(cap); div.appendChild(mean); return div; }

const SPREADS={1:{layout:'spread-1',positions:[{key:'single'}]},3:{layout:'spread-3',positions:[{key:'past'},{key:'present'},{key:'future'}]},5:{layout:'spread-5',positions:[{key:'top',cls:'pos-top'},{key:'left',cls:'pos-left'},{key:'center',cls:'pos-center'},{key:'right',cls:'pos-right'},{key:'bottom',cls:'pos-bottom'}]},10:{layout:'spread-10',positions:[{key:'p1'},{key:'p2'},{key:'p3'},{key:'p4'},{key:'p5'},{key:'p6'},{key:'p7'},{key:'p8'},{key:'p9'},{key:'p10'}]}};

function renderBoard(n,cards){ const board=document.getElementById('board'); board.className='board'; const conf=SPREADS[n]; if(!conf){ board.innerHTML=''; return;} board.classList.add(conf.layout); if(n===10){ board.innerHTML='<div class="row row-1"></div><div class="row row-2"></div><div class="row row-3"></div>'; const rows=$$('#board .row'); const slots=[3,3,4]; let k=0; slots.forEach((count,rowi)=>{ for(let j=0;j<count;j++){ const c=cards[k++]; const posKey=conf.positions[k-1].key; rows[rowi].appendChild(cardNode(c,`c${k}`,posKey)); } }); } else { board.innerHTML=''; cards.forEach((c,i)=>{ const pos=conf.positions[i]; board.appendChild(cardNode(c,`c${i+1} ${pos.cls||''}`,pos.key)); }); } }

function renderReading(question,n,cards){ const pack=dataPack(); const posKeys=(n===10)?['p1','p2','p3','p4','p5','p6','p7','p8','p9','p10']:(n===5)?['top','left','center','right','bottom']:(n===3)?['past','present','future']:['single']; const domAdv=pack.domainAdvice.general; const seg=cards.map((card,i)=>{ const title=`ã€${posLabel(posKeys[i])}ã€‘${cardName(card)}ï¼ˆ${tagFor(card.reversed)}ï¼‰`; const arch=previewLine(card); return `<div style="margin:8px 0 12px"><div style="font-weight:700">${title}</div><div class="muted" style="margin:4px 0">${arch}</div><ul style="margin:6px 0 0 18px"><li>${card.group==='major'? (card.reversed?domAdv.majorRev:domAdv.majorOk) : (domAdv[card.suit]||domAdv.majorOk)}</li></ul></div>`; }).join(''); const you=pack.ui.you||'You'; const read=pack.ui.reading||'Reading'; return `<div class="chat"><div class="msg user"><div class="meta">${you}</div>${escapeHTML(question||'')}</div><div class="msg assistant"><div class="meta">${read}</div>${seg}<hr style="border:0;border-top:1px solid #273245;margin:12px 0">${pack.nextSteps||''}</div></div>`; }

function escapeHTML(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));}

/* äº‹ä»¶ç»‘å®š */
const goBtn=$('#go'); const spreadSel=$('#spread'); const qInput=$('#question'); const qDisplay=$('#qdisplay'); const readingPanel=$('#reading'); const readingText=$('#readingText');
qInput.addEventListener('input', ()=>{ qDisplay.textContent = qInput.value ? ((['en-US','th-TH','ms-MY'].includes(CUR)?'Question: ':'é—®é¢˜ï¼š') + qInput.value) : t('ui.tip_focus'); });
goBtn.addEventListener('click', ()=>{ const n=parseInt(spreadSel.value,10); const picks=draw(n); window.__LAST_PICKS=picks; renderBoard(n,picks); const q=qInput.value||t('ui.no_q'); const html=renderReading(q,n,picks); readingText.innerHTML=html; readingPanel.style.display='block'; });

function refreshAll(){ applyStaticUI(); const picks=window.__LAST_PICKS||null; if(picks){ const n=parseInt(spreadSel.value,10); renderBoard(n,picks); const q=qInput.value||''; readingText.innerHTML=renderReading(q,n,picks); readingPanel.style.display='block'; } }
langSel.addEventListener('change', ()=>{ CUR = langSel.value in I18N ? langSel.value : FALLBACK; refreshAll(); });
refreshAll();

/* â€”â€” GPT / å¿ƒæ€œç®¡å®¶ â€”â€” */
const chatFab=$('#chatFab'), chatPanel=$('#chatPanel'), chatClose=$('#chatClose'), chatInput=$('#chatInput'), chatSend=$('#chatSend'), chatBody=$('#chatBody');
chatFab.addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','false'));
chatClose.addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','true'));
function addMsg(who,text){ const div=document.createElement('div'); div.className='ss-msg' + (who==='You'?' me':''); div.innerHTML=`<div class="meta">${who}</div>` + escapeHTML(text); chatBody.appendChild(div); chatBody.scrollTop = chatBody.scrollHeight; }
function sendGPT(text){ /* TODO: æ¥å…¥ä½ çš„åç«¯ï¼ˆOpenAI / Cloudflare Worker / è‡ªå»º APIï¼‰ */ setTimeout(()=> addMsg('GPT','ï¼ˆç¤ºä¾‹ï¼‰æ”¶åˆ°ï¼š'+text), 120); }
chatSend.addEventListener('click', ()=>{ const v=(chatInput.value||'').trim(); if(!v) return; chatInput.value=''; addMsg('You',v); sendGPT(v); });
chatInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); chatSend.click(); } });

/* â€”â€” ç™»å½•å¼¹çª— â€”â€” */
const loginBtn=$('#loginBtn'); const authMask=$('#authMask'); const authCancel=$('#authCancel'); const authSubmit=$('#authSubmit'); const authErr=$('#authErr');
loginBtn.addEventListener('click', ()=> authMask.setAttribute('aria-hidden','false'));
authCancel.addEventListener('click', ()=> authMask.setAttribute('aria-hidden','true'));
authSubmit.addEventListener('click', ()=>{ const email=$('#authEmail').value.trim(); const pwd=$('#authPwd').value; if(!email||!pwd){ authErr.textContent='è¯·è¾“å…¥é‚®ç®±ä¸å¯†ç  / Please enter email & password.'; authErr.style.display='block'; return; } authErr.style.display='none'; // TODO: æ¥åç«¯ç™»å½•
  setTimeout(()=>{ authMask.setAttribute('aria-hidden','true'); alert('Demo: ç™»å½•æˆåŠŸ'); }, 200);
});
</script>
</body>
</html>
