<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>塔罗牌占卜 · 5X</title>
  <style>
    *{box-sizing:border-box}
    body{margin:0;background:#0b0f14;color:#e8edf3;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans SC",Arial,sans-serif}
    .app{max-width:1100px;margin:0 auto;padding:18px}
    h1{margin:6px 0 14px;color:#d4af37;font-weight:700;letter-spacing:.5px}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    .controls input,.controls select,.controls button{
      padding:10px 12px;border-radius:10px;border:1px solid #333;background:#111;color:#e8edf3
    }
    .controls button{color:#191919;background:linear-gradient(180deg,#fff9e6,#e6c76e);border-color:#e6c76e}
    .q{margin:6px 0 10px;font-weight:600}
    .board{position:relative;min-height:140px;display:grid;gap:14px}
    .card{display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center}
    .imgwrap{width:128px;height:212px;border:1px solid #444;border-radius:10px;overflow:hidden;background:#000;display:grid;place-items:center}
    img.card-img{width:100%;height:100%;object-fit:contain;display:block}
    .cap{font-size:13px;color:#98a7b7}
    .err{font-size:12px;color:#ffb3b3}
    /* 三张横排 */
    .spread-3{grid-template-columns:repeat(3,128px);justify-content:center}
    /* 单张置中 */
    .spread-1{grid-template-columns:128px;justify-content:center}
    /* 十字(5张)布局：中、上、左、右、下 */
    .spread-5{grid-template-areas:
      "top top top"
      "left center right"
      ". bottom .";
      grid-template-columns:128px 128px 128px;justify-content:center}
    .pos-top{grid-area:top}.pos-left{grid-area:left}.pos-center{grid-area:center}.pos-right{grid-area:right}.pos-bottom{grid-area:bottom}
    /* 凯尔特十字(10张)简化布局 */
    .spread-10{
      grid-template-areas:
      "c1 c2 c7 c9"
      "c3 c4 c8 c10"
      "c5 c6 c8 c10";
      grid-template-columns:128px 128px 128px 128px;
      justify-content:center
    }
    .c1{grid-area:c1}.c2{grid-area:c2}.c3{grid-area:c3}.c4{grid-area:c4}.c5{grid-area:c5}
    .c6{grid-area:c6}.c7{grid-area:c7}.c8{grid-area:c8}.c9{grid-area:c9}.c10{grid-area:c10}
    @media(max-width:560px){
      .imgwrap{width:100px;height:166px}
      .spread-3{grid-template-columns:repeat(3,100px)}
      .spread-1{grid-template-columns:100px}
      .spread-5{grid-template-columns:100px 100px 100px}
      .spread-10{grid-template-columns:100px 100px 100px 100px}
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>塔罗牌占卜</h1>

    <div class="controls">
      <input id="question" placeholder="请输入你的问题（必填，决定解读方向）" style="flex:1;min-width:220px" />
      <select id="spread">
        <option value="1">单张</option>
        <option value="3">三张（过去 / 现在 / 未来）</option>
        <option value="5">十字排法（5张）</option>
        <option value="10">凯尔特十字（10张）</option>
      </select>
      <button id="go">抽牌</button>
    </div>

    <div id="qdisplay" class="q"></div>
    <div id="board" class="board"></div>
  </div>

<script>
/* ------------------ 图片地址：缩略图 + 失败自动代理 ------------------ */
function toThumb(url, w = 360){
  try{
    const u = new URL(url);
    const ps = u.pathname.split('/');
    const file = ps.pop();
    ps.push('thumb', file, `${w}px-${file}`);
    u.pathname = ps.join('/');
    return u.toString();
  }catch{return url;}
}
function viaProxy(url, w=360){
  // 统一 https，并走图片代理（适配某些地区或 CSP）
  const noProto = url.replace(/^https?:\/\//,'');
  return `https://images.weserv.nl/?url=${encodeURIComponent(noProto)}&w=${w}`;
}
/* ------------------ 78 张牌（维基原图） ------------------ */
const WIKI_CARDS = {
  // 大阿尔克那
  "00_愚者 Fool":"https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_00_Fool.jpg",
  "01_魔术师 Magician":"https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg",
  "02_女祭司 High Priestess":"https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg",
  "03_女皇 Empress":"https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg",
  "04_皇帝 Emperor":"https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg",
  "05_教皇 Hierophant":"https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg",
  "06_恋人 Lovers":"https://upload.wikimedia.org/wikipedia/commons/3/3a/TheLovers.jpg",
  "07_战车 Chariot":"https://upload.wikimedia.org/wikipedia/commons/9/9b/TheChariot.jpg",
  "08_力量 Strength":"https://upload.wikimedia.org/wikipedia/commons/f/f5/Strength_tarot_card.jpg",
  "09_隐士 Hermit":"https://upload.wikimedia.org/wikipedia/commons/4/4d/TheHermit.jpg",
  "10_命运之轮 Wheel of Fortune":"https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg",
  "11_正义 Justice":"https://upload.wikimedia.org/wikipedia/commons/e/e0/JusticeTarot.JPG",
  "12_倒吊人 Hanged Man":"https://upload.wikimedia.org/wikipedia/commons/2/2b/TheHangedMan.jpg",
  "13_死神 Death":"https://upload.wikimedia.org/wikipedia/commons/d/d7/Death_card.jpg",
  "14_节制 Temperance":"https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg",
  "15_恶魔 Devil":"https://upload.wikimedia.org/wikipedia/commons/5/55/TheDevil.jpg",
  "16_高塔 Tower":"https://upload.wikimedia.org/wikipedia/commons/5/53/TheTower.jpg",
  "17_星星 Star":"https://upload.wikimedia.org/wikipedia/commons/d/db/TheStar.jpg",
  "18_月亮 Moon":"https://upload.wikimedia.org/wikipedia/commons/7/7f/TheMoonTarotCard.jpg",
  "19_太阳 Sun":"https://upload.wikimedia.org/wikipedia/commons/1/17/TheSunTarotCard.jpg",
  "20_审判 Judgement":"https://upload.wikimedia.org/wikipedia/commons/d/dd/JudgementTarot.jpg",
  "21_世界 World":"https://upload.wikimedia.org/wikipedia/commons/f/ff/TheWorldTarotCard.jpg",
  // 圣杯
  "圣杯Ace":"https://upload.wikimedia.org/wikipedia/commons/3/36/Cups01.jpg",
  "圣杯2":"https://upload.wikimedia.org/wikipedia/commons/f/f8/Cups02.jpg",
  "圣杯3":"https://upload.wikimedia.org/wikipedia/commons/7/7d/Cups03.jpg",
  "圣杯4":"https://upload.wikimedia.org/wikipedia/commons/3/35/Cups04.jpg",
  "圣杯5":"https://upload.wikimedia.org/wikipedia/commons/0/06/Cups05.jpg",
  "圣杯6":"https://upload.wikimedia.org/wikipedia/commons/1/17/Cups06.jpg",
  "圣杯7":"https://upload.wikimedia.org/wikipedia/commons/a/ab/Cups07.jpg",
  "圣杯8":"https://upload.wikimedia.org/wikipedia/commons/6/60/Cups08.jpg",
  "圣杯9":"https://upload.wikimedia.org/wikipedia/commons/2/24/Cups09.jpg",
  "圣杯10":"https://upload.wikimedia.org/wikipedia/commons/8/84/Cups10.jpg",
  "圣杯侍从":"https://upload.wikimedia.org/wikipedia/commons/6/6d/Cups11.jpg",
  "圣杯骑士":"https://upload.wikimedia.org/wikipedia/commons/f/f0/Cups12.jpg",
  "圣杯皇后":"https://upload.wikimedia.org/wikipedia/commons/6/62/Cups13.jpg",
  "圣杯国王":"https://upload.wikimedia.org/wikipedia/commons/0/04/Cups14.jpg",
  // 权杖
  "权杖Ace":"https://upload.wikimedia.org/wikipedia/commons/1/11/Wands01.jpg",
  "权杖2":"https://upload.wikimedia.org/wikipedia/commons/0/0f/Wands02.jpg",
  "权杖3":"https://upload.wikimedia.org/wikipedia/commons/f/ff/Wands03.jpg",
  "权杖4":"https://upload.wikimedia.org/wikipedia/commons/a/a4/Wands04.jpg",
  "权杖5":"https://upload.wikimedia.org/wikipedia/commons/9/9d/Wands05.jpg",
  "权杖6":"https://upload.wikimedia.org/wikipedia/commons/3/3b/Wands06.jpg",
  "权杖7":"https://upload.wikimedia.org/wikipedia/commons/e/e4/Wands07.jpg",
  "权杖8":"https://upload.wikimedia.org/wikipedia/commons/6/6b/Wands08.jpg",
  "权杖9":"https://upload.wikimedia.org/wikipedia/commons/0/0b/Wands09.jpg",
  "权杖10":"https://upload.wikimedia.org/wikipedia/commons/4/4d/Wands10.jpg",
  "权杖侍从":"https://upload.wikimedia.org/wikipedia/commons/0/0a/Wands11.jpg",
  "权杖骑士":"https://upload.wikimedia.org/wikipedia/commons/6/6b/Wands12.jpg",
  "权杖皇后":"https://upload.wikimedia.org/wikipedia/commons/1/1c/Wands13.jpg",
  "权杖国王":"https://upload.wikimedia.org/wikipedia/commons/0/0d/Wands14.jpg",
  // 宝剑
  "宝剑Ace":"https://upload.wikimedia.org/wikipedia/commons/1/1a/Swords01.jpg",
  "宝剑2":"https://upload.wikimedia.org/wikipedia/commons/9/9e/Swords02.jpg",
  "宝剑3":"https://upload.wikimedia.org/wikipedia/commons/0/02/Swords03.jpg",
  "宝剑4":"https://upload.wikimedia.org/wikipedia/commons/b/bf/Swords04.jpg",
  "宝剑5":"https://upload.wikimedia.org/wikipedia/commons/2/23/Swords05.jpg",
  "宝剑6":"https://upload.wikimedia.org/wikipedia/commons/2/29/Swords06.jpg",
  "宝剑7":"https://upload.wikimedia.org/wikipedia/commons/3/34/Swords07.jpg",
  "宝剑8":"https://upload.wikimedia.org/wikipedia/commons/b/b8/Swords08.jpg",
  "宝剑9":"https://upload.wikimedia.org/wikipedia/commons/2/2f/Swords09.jpg",
  "宝剑10":"https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords10.jpg",
  "宝剑侍从":"https://upload.wikimedia.org/wikipedia/commons/4/4c/Swords11.jpg",
  "宝剑骑士":"https://upload.wikimedia.org/wikipedia/commons/4/4c/Swords12.jpg",
  "宝剑皇后":"https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords13.jpg",
  "宝剑国王":"https://upload.wikimedia.org/wikipedia/commons/3/31/Swords14.jpg",
  // 钱币
  "钱币Ace":"https://upload.wikimedia.org/wikipedia/commons/f/fd/Pents01.jpg",
  "钱币2":"https://upload.wikimedia.org/wikipedia/commons/9/9f/Pents02.jpg",
  "钱币3":"https://upload.wikimedia.org/wikipedia/commons/4/42/Pents03.jpg",
  "钱币4":"https://upload.wikimedia.org/wikipedia/commons/3/35/Pents04.jpg",
  "钱币5":"https://upload.wikimedia.org/wikipedia/commons/5/50/Pents05.jpg",
  "钱币6":"https://upload.wikimedia.org/wikipedia/commons/4/42/Pents06.jpg",
  "钱币7":"https://upload.wikimedia.org/wikipedia/commons/f/f0/Pents07.jpg",
  "钱币8":"https://upload.wikimedia.org/wikipedia/commons/e/e7/Pents08.jpg",
  "钱币9":"https://upload.wikimedia.org/wikipedia/commons/6/6a/Pents09.jpg",
  "钱币10":"https://upload.wikimedia.org/wikipedia/commons/4/42/Pents10.jpg",
  "钱币侍从":"https://upload.wikimedia.org/wikipedia/commons/7/78/Pents11.jpg",
  "钱币骑士":"https://upload.wikimedia.org/wikipedia/commons/2/2d/Pents12.jpg",
  "钱币皇后":"https://upload.wikimedia.org/wikipedia/commons/8/88/Pents13.jpg",
  "钱币国王":"https://upload.wikimedia.org/wikipedia/commons/4/42/Pents14.jpg"
};
const DECK = Object.entries(WIKI_CARDS);

/* ------------------ 牌义（简明） ------------------ */
// 大阿尔克那关键词
const MAJOR_MEAN = {
  0:"新的开始/自由/潜能",1:"意志/行动/显化",2:"直觉/神秘/内在智慧",
  3:"滋养/丰盛/创造",4:"秩序/权威/结构",5:"传统/信念/导师",
  6:"选择/关系/吸引",7:"前进/掌控/胜利",8:"勇气/温柔的力量",
  9:"独处/寻找答案",10:"周期/转折/命运",11:"公平/因果/平衡",
  12:"暂停/换位/臣服",13:"结束与重生",14:"调和/节制/中道",
  15:"诱惑/束缚/阴影",16:"突变/瓦解/醒悟",17:"希望/疗愈/启发",
  18:"不安/潜意识/迷雾",19:"喜悦/成功/清晰",20:"觉醒/召唤/赦免",
  21:"完成/整合/世界"
};
// 小阿尔克那花色 & 点数关键词（自动组合）
const SUIT = {
  "圣杯":"情感/关系","权杖":"行动/热情","宝剑":"思维/挑战","钱币":"物质/事业"
};
const RANK = {
  "Ace":"开始/机遇","2":"平衡/对立","3":"成长/协作","4":"稳定/停滞","5":"冲突/压力",
  "6":"给予/和谐","7":"考验/选择","8":"行动/进展","9":"成果/负担","10":"阶段结束/丰收",
  "侍从":"讯息/起步","骑士":"推动/追求","皇后":"成熟/吸引","国王":"掌控/负责"
};
function parseMeaning(name, reversed){
  // 大阿尔克那：以编号开头
  if (/^\d{2}_/.test(name)){
    const n = parseInt(name.slice(0,2),10);
    const base = MAJOR_MEAN[n] || "";
    return (reversed ? "逆位：" : "正位：") + (reversed ?
      base.replace(/\/[^/]+/g,"/阻滞") : base);
  }
  // 小阿尔克那：花色+点数
  const m = name.match(/^(圣杯|权杖|宝剑|钱币)(Ace|[2-9]|10|侍从|骑士|皇后|国王)/);
  if (m){
    const suit = m[1], rank = m[2];
    const base = `${SUIT[suit]} · ${RANK[rank]||""}`;
    return (reversed ? "逆位：" : "正位：") + (reversed ? `${base}（阻滞/反向）` : base);
  }
  return reversed ? "逆位" : "正位";
}

/* ------------------ 抽牌 ＋ 布局 ＋ 解读 ------------------ */
function draw(){
  const n = +document.getElementById('spread').value;
  const q = document.getElementById('question').value.trim();
  document.getElementById('qdisplay').textContent = q ? `问题：${q}` : '（提示：输入问题会让解读更聚焦）';

  const board = document.getElementById('board');
  board.innerHTML = '';
  board.className = 'board ' + (n===1?'spread-1':n===3?'spread-3':n===5?'spread-5':'spread-10');

  const pool = [...DECK];
  const take = ()=> pool.splice(Math.floor(Math.random()*pool.length),1)[0];

  const labels10 = ['当下','阻碍','潜意识','显意识','过去','未来','自我','环境','希望','结果'];

  const place = (pair,label,extraClass='')=>{
    const [name, url] = pair;
    const reversed = Math.random() < 0.5;

    const wrap = document.createElement('div');
    wrap.className = `card ${extraClass}`;

    const imgw = document.createElement('div');
    imgw.className = 'imgwrap';

    const img = new Image();
    img.className = 'card-img';
    img.loading = 'eager';
    img.src = toThumb(url, 360);
    if (reversed) img.style.transform = 'rotate(180deg)';
    img.onerror = ()=>{ img.onerror=null; img.src = viaProxy(url, 360); };

    const cap = document.createElement('div');
    cap.className = 'cap';
    cap.textContent = label ? `${name} · ${label}` : name;

    const expl = document.createElement('div');
    expl.style.fontSize='12px'; expl.style.opacity='.9'; expl.style.marginTop='4px';
    expl.textContent = parseMeaning(name, reversed);

    imgw.appendChild(img);
    wrap.appendChild(imgw);
    wrap.appendChild(cap);
    wrap.appendChild(expl);
    board.appendChild(wrap);
  };

  if (n===1){
    place(take(), '当下');
  }else if(n===3){
    place(take(), '过去');
    place(take(), '现在');
    place(take(), '未来');
  }else if(n===5){
    place(take(), '过去','pos-top');
    place(take(), '潜意识','pos-left');
    place(take(), '当下','pos-center');
    place(take(), '外在影响','pos-right');
    place(take(), '未来趋势','pos-bottom');
  }else{ // 10张：凯尔特十字
    for(let i=0;i<10;i++) place(take(), labels10[i], `c${i+1}`);
  }
}
document.getElementById('go').addEventListener('click', draw);
</script>

</body>
</html>
