<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>塔罗牌占卜 · Tarot</title>
<link rel="icon" href="data:,">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f14; --card:#11161dcc; --line:#1f2a36; --text:#e8edf3; --muted:#98a7b7;
  --brand:#d4af37; --gold:#d4af37; --gold2:#f2d27a; --accent:#58b9ff;
  --radius:14px; --shadow:0 8px 30px rgba(0,0,0,.35);
  --card-w:128px; --card-h:212px; --gap:14px;
}
@media (max-width:640px){ :root{ --card-w:100px; --card-h:168px; --gap:10px; } }

html,body{height:100%}
body{
  margin:0; color:var(--text);
  background: radial-gradient(1200px 600px at 70% -10%, #16202b 10%, transparent 60%) no-repeat,
              linear-gradient(180deg,#0b0f14,#0b0f14);
  font-family: Inter,system-ui,-apple-system,"Noto Sans SC","Segoe UI",Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
body::before{content:""; position:fixed; inset:0; z-index:-2; background:url('assets/images/gate.jpg') center/cover no-repeat; filter:brightness(.45) saturate(.9) blur(2px)}
.container{max-width:1100px;margin:0 auto;padding:24px 16px 80px}

/* —— 统一头部（与八字页一致） —— */
.site-header{position:sticky;top:0;z-index:10;background:#0b0f14cc;border-bottom:1px solid #0f1622;backdrop-filter:saturate(140%) blur(12px)}
.head-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 16px}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text)}
.brand-badge{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,#0e1520,#0b1018); border:1px solid #2a3546; box-shadow:0 4px 14px rgba(0,0,0,.35); font-weight:800; color:#ffe084}
.title{font-family:"Noto Serif SC",serif; font-weight:700; letter-spacing:.02em}
.title a{ color: inherit; text-decoration: none; }
.title a:hover{ text-decoration: underline; text-underline-offset: 3px; }
.lang{display:flex; align-items:center; gap:8px}
.lang label{white-space:nowrap; color:var(--muted); margin-right:4px}
.lang select{appearance:none; min-width:170px; border-radius:10px; border:1px solid #243244; background:#0e1520; color:var(--text); padding:10px 34px 10px 12px; font-size:.95rem; background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2398a7b7' stroke-width='2' fill='none'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:calc(100% - 12px) 50%}
@media (max-width:520px){ .title{font-size:1rem} .lang select{min-width:140px} }

/* —— 页面结构 —— */
.app{max-width:1100px; margin:0 auto; padding:18px}
.h1{margin:6px 0 14px; color:#ffe084; font-weight:800; font-size:1.8rem}
.controls{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px}
.controls input, .controls select, .controls button{padding:12px; border-radius:12px; border:1px solid #273245; background:#0f1420; color:var(--text)}
.controls input{flex:1; min-width:220px}
.controls button{cursor:pointer; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#121212; border-color:#e6c76e; font-weight:800}
.q{margin:6px 0 12px; font-weight:600; color:var(--muted)}

/* —— 牌面与布局 —— */
.board{display:grid; gap:var(--gap); justify-content:center; align-content:start}
.card{display:flex; flex-direction:column; align-items:center; gap:6px; text-align:center; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:10px 10px 12px; box-shadow:var(--shadow); width:calc(var(--card-w) + 20px)}
.imgwrap{width:var(--card-w); height:var(--card-h); border-radius:10px; overflow:hidden; background:#000; display:grid; place-items:center; border:1px solid #34455a}
.card-img{display:block; width:100%; height:100%; object-fit:cover}
.cap{font-weight:700}
.mean{font-size:.92rem; color:var(--muted)}
.board.spread-1{grid-template-columns:repeat(1, max-content)}
.board.spread-3{grid-template-columns:repeat(3, max-content)}
.board.spread-5{display:grid; grid-template-columns:repeat(3, max-content); grid-template-rows:auto auto auto; grid-template-areas:"top top top" "left center right" "bottom bottom bottom"}
.board.spread-5 .pos-top{grid-area:top}
.board.spread-5 .pos-left{grid-area:left}
.board.spread-5 .pos-center{grid-area:center}
.board.spread-5 .pos-right{grid-area:right}
.board.spread-5 .pos-bottom{grid-area:bottom}
.board.spread-10{gap:var(--gap)}
.board.spread-10 .row{display:grid; gap:var(--gap); justify-content:center}
.board.spread-10 .row-1{grid-template-columns:repeat(3, max-content)}
.board.spread-10 .row-2{grid-template-columns:repeat(3, max-content)}
.board.spread-10 .row-3{grid-template-columns:repeat(4, max-content)}

/* —— 阅读面板 —— */
.panel{margin-top:16px; padding:14px; border:1px solid var(--line); background:#0f1420; border-radius:12px}
.muted{color:var(--muted)}
.btn{padding:8px 12px; border-radius:10px; border:1px solid #273245; background:#0f1420; color:#ffe084; cursor:pointer}
.btn.ghost{background:transparent; color:var(--text)}

/* —— GPT/心怜管家 —— */
.ss-chat-fab{position:fixed; right:18px; bottom:18px; z-index:50; background:linear-gradient(180deg,#fff9e6,#e6c76e); color:#191919; font-weight:800; padding:12px 16px; border-radius:999px; border:1px solid #e6c76e; box-shadow:var(--shadow); cursor:pointer}
.ss-chat-panel{position:fixed; right:18px; bottom:88px; width:min(460px,92vw); max-height:70vh; background:#0e1520; border:1px solid #243244; border-radius:16px; display:none; flex-direction:column; overflow:hidden; box-shadow:var(--shadow); z-index:50}
.ss-chat-panel[aria-hidden="false"]{display:flex}
.ss-chat-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #243244}
.ss-chat-title{font-weight:700}
.ss-close{cursor:pointer; opacity:.8}
.ss-chat-body{padding:12px; overflow:auto; display:flex; flex-direction:column; gap:10px}
.ss-msg{background:#11161dcc; border:1px solid #243244; padding:10px; border-radius:10px; font-size:.95rem; max-width:80%}
.ss-msg .meta{font-size:.8rem; color:var(--muted); margin-bottom:4px}
.ss-msg.me{margin-left:auto; background:#132033}
.ss-chat-input{display:flex; gap:8px; padding:10px; border-top:1px solid #243244}
.ss-chat-input input{flex:1; padding:10px; border-radius:10px; border:1px solid #273245; background:#0b0f14; color:var(--text)}

/* —— 登录弹窗 —— */
.auth-mask{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:60}
.auth-mask[aria-hidden="false"]{display:flex}
.auth-box{width:min(520px,92vw); background:#0e1520; border:1px solid #243244; border-radius:14px; box-shadow:var(--shadow)}
.auth-head{padding:12px 14px; border-bottom:1px solid #243244; font-weight:700}
.auth-body{padding:14px}
.auth-actions{display:flex; gap:10px; justify-content:flex-end; padding:0 14px 14px}

/* —— 估时间弹窗（保留占位，不使用可移除） —— */
.tw-mask{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:40}
.tw-mask[aria-hidden="false"]{display:flex}
.tw-box{width:min(560px, 92vw); background:#0f1420; border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow)}
.tw-head{padding:12px 14px; border-bottom:1px solid var(--line); font-weight:700}
.tw-body{padding:12px 14px}
.tw-grid{display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:8px}
.tw-foot{display:flex; gap:8px; justify-content:flex-end; padding:12px 14px; border-top:1px solid var(--line)}
</style>
</head>
<body>
<header class="site-header">
  <div class="head-inner container">
    <!-- 品牌：点击回到“八字简评”本页 -->
<a class="brand" href="https://astro.5xliving.com/" target="_self">
  <span class="brand-badge">5X</span>
  <span class="title">
    5xLiving · <span data-i18n="page_title">塔罗牌占卜</span>
  </span>
</a>

    <div class="lang">
      <label for="langSelect" class="muted" data-i18n="lang_label">语言</label>
      <select id="langSelect" aria-label="Language">
          <option value="zh-CN">简体中文</option>
          <option value="zh-TW">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="th">ไทย</option>
          <option value="ms">Bahasa Melayu</option>
      </select>
</header>

<div class="app">
  <h1 class="h1" data-i18n="page_title">塔罗牌占卜</h1>
  <div class="controls">
    <input id="question" placeholder="请输入你的问题（必填，决定解读方向）" data-i18n-placeholder="q_ph" />
    <select id="spread">
      <option value="1" data-i18n="s1">单张</option>
      <option value="3" data-i18n="s3">三张（过去 / 现在 / 未来）</option>
      <option value="5" data-i18n="s5">十字排法（5张）</option>
      <option value="10" data-i18n="s10">凯尔特十字（10张）</option>
    </select>
    <button id="go" data-i18n="draw_btn">抽牌</button>
  </div>

  <div id="qdisplay" class="q muted" data-i18n="tip_focus">（提示：输入问题会让解读更聚焦）</div>
  <div id="board" class="board"></div>

  <div id="reading" class="panel" style="display:none">
    <h3 style="margin:0 0 8px;font-weight:800" data-i18n="reading_title">解读与建议</h3>
    <div id="readingText"></div>
    <div class="panel muted" style="margin-top:12px" data-i18n="disclaimer">说明：塔罗为指引工具，非医学/法律/金融建议，请以理性判断与自我意愿为先。</div>
  </div>
</div>

<!-- GPT / 心怜管家（统一浮窗） -->
<div class="ss-chat-fab" id="chatFab">心怜管家</div>
<div class="ss-chat-panel" id="chatPanel" aria-hidden="true">
  <div class="ss-chat-head">
    <div class="ss-chat-title" id="chatTitle">心怜管家 · GPT</div>
    <div class="ss-close" id="chatClose">✕</div>
  </div>
  <div class="ss-chat-body" id="chatBody">
    <div class="ss-msg"><div class="meta">Demo</div>当前为前端示例。接入后端：在 <code>sendGPT()</code> 中调用你的 API。</div>
  </div>
  <div class="ss-chat-input">
    <input id="chatInput" placeholder="输入问题…"/>
    <button class="btn" id="chatSend">发送</button>
</div>

<!-- 估时间弹窗（如不需要可删除） -->
<div class="tw-mask" id="twMask" aria-hidden="true">
  <div class="tw-box" role="dialog" aria-modal="true" aria-labelledby="twTitle">
    <div class="tw-head" id="twTitle">🧭 估一个大致出生时间</div>
    <div class="tw-body">
      <div class="muted" style="margin-bottom:8px">选择你记得的<strong>大概时段</strong>（地支双小时段）</div>
      <div class="tw-grid" id="twGrid"></div>
      <div class="muted" style="margin-top:10px;font-size:.9em">选择后点“填入时间”，会用该时段的中位时间写到上方时间输入框，并自动取消“时间不详”。</div>
    </div>
    <div class="tw-foot">
      <button class="btn ghost" id="twCancel" type="button">取消</button>
      <button class="btn" id="twApply" type="button" disabled>填入时间</button>
    </div>

  <!-- 登录弹窗（统一样式） -->
    <!-- 会员专区 -->
    <section class="card section">
      <h2 class="group-title" data-i18n="vip_title">🌙 会员区域 VIP Segment</h2>
      <div class="columns">
        <div class="list-block">
          <div class="group-title" data-i18n="vip_mingli">🗝 命理空间专属内容</div>
          <ul>
            <li data-i18n="vip_love">姻缘方向：恋爱缘分、婚姻走势</li>
            <li data-i18n="vip_career">事业方向：职场发展、创业潜力</li>
            <li data-i18n="vip_wealth">财运方向：财位分析、理财时机</li>
            <li data-i18n="vip_pet">宠物命理：伴侣动物的性格与缘分</li>
            <li data-i18n="vip_hepan">合盘分析：婚期择日、新生择时</li>
            <li data-i18n="vip_name">测名分析：公司名、宝宝名、命名改运</li>
            <li data-i18n="vip_fengshui">财位合盘：住家 / 办公室动线配合</li>
          </ul>
        </div>
        <div class="list-block">
          <div class="group-title" data-i18n="vip_xinlian">🌙 心怜空间专属内容</div>
          <ul>
            <li data-i18n="vip_record">灵性记录：照片、梦境、声音、愿望祈祷</li>
            <li data-i18n="vip_course">命理课程：八字 / 塔罗 / 占星 / 灵数 / 人类图</li>
            <li data-i18n="vip_memorial">家族纪念系统：亲人灵性纪念 & 延续</li>
            <li data-i18n="vip_tasks">每周能量练习 / 神明仪式任务</li>
            <li data-i18n="vip_shop">能量商城专属折扣 & 御守订制</li>
          </ul>
        </div>
      </div>

      <div class="group-title" style="margin-top:14px" data-i18n="login_title">💎 登入 VIP 功能</div>

      <section class="astro-auth">
        <div class="auth-grid">
          <!-- 左侧：输入 + 注册/登录 -->
          <div class="panel">
            <div class="head" data-i18n="panel_login_head">账户登录 / 注册</div>
            <div class="body">
              <div class="row" id="authFields">
            <label for="email" class="sr-only" data-i18n="ph_email">邮箱 Email</label>
            <input
               id="email"
               name="email"
               type="email"
               inputmode="email"
               autocomplete="username"   <!-- 登录/注册建议用 username，密码管理器更容易配对 -->
            <label for="password" class="sr-only" data-i18n="ph_label_password">密码 Password</label>    
            <input 
               id="password" 
               type="password" 
               autocomplete="new-password" 
               placeholder="密码 Password（至少8位，含大小写数字符号）" data-i18n-ph="ph_password" required/>
              </div>
              <div class="spacer"></div>
              <form id="loginForm" class="row one">
                <button class="btn block" id="loginBtn" type="submit" data-i18n="btn_login">登入账户</button>
              </form>
              <div class="spacer"></div>
              <div class="row one">
                <button class="btn ghost block" id="resetBtn" type="button" data-i18n="btn_reset">🔑 重设密码</button>
              </div>
              <div class="spacer"></div>
              <form class="row one" id="registerForm">
                <button class="btn block" id="registerBtn" type="submit" data-i18n="btn_register">注册账户</button>
                <div class="muted" data-i18n="note_price">注册账号赠送一次免费体验</div>
                <div class="spacer"></div>
                <div class="error-message" id="authError" style="display:none"></div>
              </form>
            </div>
          </div>

          <!-- 右侧：会员与返回 -->
          <div class="panel">
            <div class="head" data-i18n="panel_member_head">会员服务</div>
            <div class="body">
              <div class="row one">
                <a class="btn btn-gold block" href="https://yourshopifyshop.com/products/monthly-vip" target="_blank" rel="noopener noreferrer" data-i18n="btn_upgrade">💎 升级为 VIP（月费）</a>
              </div>
              <div class="spacer"></div>
              <div class="row one">
                <a class="btn ghost block" href="https://yourshopifyshop.myshopify.com" target="_blank" rel="noopener noreferrer" data-i18n="btn_backshop">← 返回命理商城</a>
              </div>
              <div class="spacer"></div>
              <div class="muted" data-i18n="note_price1">$9.9 / 月费 VIP（命理空间 + 心怜空间 + 灵性课程）</div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <footer>© 5XLiving • Astro Sanctuary</footer>


<script>
/* ===========================
   I18N —— 五语（简中 / 繁中 / 英 / 泰 / 马来）
=========================== */
const I18N = {
  'zh-CN': { ui:{ brand:'5xLiving · 命理心怜空间 · Soul Sanctuary', label_lang:'语言', page_title:'塔罗牌占卜', q_ph:'请输入你的问题（必填，决定解读方向）', s1:'单张', s3:'三张（过去 / 现在 / 未来）', s5:'十字排法（5张）', s10:'凯尔特十字（10张）', draw_btn:'抽牌', tip_focus:'（提示：输入问题会让解读更聚焦）', reading_title:'解读与建议', disclaimer:'说明：塔罗为指引工具，非医学/法律/金融建议，请以理性判断与自我意愿为先。', you:'你', reading:'解读', no_q:'（未填写问题）' },
    pos:{single:'当下核心', past:'过去', present:'现在', future:'未来', top:'指引/主题', left:'过去根源', center:'当下核心', right:'外在影响', bottom:'未来发展', p1:'当下', p2:'阻碍', p3:'潜意识', p4:'过去', p5:'显意识', p6:'未来', p7:'自我', p8:'环境', p9:'希望/恐惧', p10:'结果'},
    suits:{ wands:{name:'权杖',domain:'行动/热情'}, cups:{name:'圣杯',domain:'情感/关系'}, swords:{name:'宝剑',domain:'思维/沟通'}, pentacles:{name:'钱币',domain:'现实/资源'} },
    ranks:{ ace:'一','2':'二','3':'三','4':'四','5':'五','6':'六','7':'七','8':'八','9':'九','10':'十', page:'侍从', knight:'骑士', queen:'皇后', king:'国王', tone:{ ace:'起点/潜能','2':'对话/选择','3':'协作/成长','4':'结构/稳定','5':'挑战/波动','6':'交流/支持','7':'评估/耐心','8':'推进/效率','9':'成果/负担','10':'阶段完成', page:'讯息/学习', knight:'行动/推动', queen:'成熟/滋养', king:'掌控/定调'} },
    majors:[ ['愚者','自由/跃迁','拥抱未知，轻装启程'],['魔术师','意志/显化','集中资源，立即行动'],['女祭司','直觉/潜意识','先观察，后表态'],['女皇','滋养/丰盛','以温柔与照料促进成长'],['皇帝','秩序/结构','定规则、立边界、给安全感'],['教皇','规范/传承','遵循制度与长辈建议'],['恋人','选择/连结','对齐价值观再承诺'],['战车','推进/胜负','定目标，强势推进'],['力量','勇气/温柔','以柔克刚，稳定耐心'],['隐者','内省/独处','收心审视，独立判断'],['命运之轮','周期/机缘','顺势而为，抓时机'],['正义','衡量/公平','以事实与边界解决'],['倒吊人','停止/换角','暂缓推进，换位思考'],['死神','结束/重生','果断止损，迎接新生'],['节制','调和/节律','降强度，稳节奏'],['恶魔','执著/诱惑','辨依赖，断不良循环'],['高塔','突变/瓦解','接纳变化，快速重组'],['星星','希望/复原','重建信任，温柔修复'],['月亮','迷雾/不安','推迟重大决定，先查明'],['太阳','清晰/喜悦','公开透明，庆祝成果'],['审判','觉醒/召回','回应召唤，纠偏复盘'],['世界','完成/整合','闭环与升级，开启新篇'] ],
    tags:{upright:'正位', reversed:'逆位'}, nextSteps:'<b>下一步（48 小时内）：</b><br>① 写下 1 条小目标；② 安排 1 个具体行动；③ 用 3 个客观指标衡量。',
    domainAdvice:{ general:{majorRev:'先稳住再决策', majorOk:'小步验证，逐步推进', wands:'放缓节奏，聚焦一事', cups:'优先关系质量', swords:'先信息对齐', pentacles:'先做可落地配置'} }
  },

  'zh-TW': { ui:{ brand:'5xLiving · 命理心憐空間 · Soul Sanctuary', label_lang:'語言', page_title:'塔羅牌占卜', q_ph:'請輸入你的問題（必填，決定解讀方向）', s1:'單張', s3:'三張（過去 / 現在 / 未來）', s5:'十字排法（5張）', s10:'凱爾特十字（10張）', draw_btn:'抽牌', tip_focus:'（提示：輸入問題會讓解讀更聚焦）', reading_title:'解讀與建議', disclaimer:'說明：塔羅為指引工具，非醫學/法律/金融建議，請以理性判斷為先。', you:'你', reading:'解讀', no_q:'（未填寫問題）' },
    pos:{single:'當下核心', past:'過去', present:'現在', future:'未來', top:'指引/主題', left:'過去根源', center:'當下核心', right:'外在影響', bottom:'未來發展', p1:'當下', p2:'阻礙', p3:'潛意識', p4:'過去', p5:'顯意識', p6:'未來', p7:'自我', p8:'環境', p9:'希望/恐懼', p10:'結果'},
    suits:{ wands:{name:'權杖',domain:'行動/熱情'}, cups:{name:'聖杯',domain:'情感/關係'}, swords:{name:'寶劍',domain:'思維/溝通'}, pentacles:{name:'錢幣',domain:'現實/資源'} },
    ranks:{ ace:'一','2':'二','3':'三','4':'四','5':'五','6':'六','7':'七','8':'八','9':'九','10':'十', page:'侍從', knight:'騎士', queen:'皇后', king:'國王', tone:{ ace:'起點/潛能','2':'對話/選擇','3':'協作/成長','4':'結構/穩定','5':'挑戰/波動','6':'交流/支持','7':'評估/耐心','8':'推進/效率','9':'成果/負擔','10':'階段完成', page:'訊息/學習', knight:'行動/推動', queen:'成熟/滋養', king:'掌控/定調'} },
    majors: null, tags:{upright:'正位', reversed:'逆位'}, nextSteps:'<b>48 小時內：</b>① 寫下一個小目標；② 安排一個具體行動；③ 設 3 個衡量指標。', domainAdvice:{ general:{majorRev:'先穩住再決策', majorOk:'小步驗證逐步推進', wands:'放慢節奏', cups:'重視關係品質', swords:'先資訊對齊', pentacles:'資源配置先行'} } },

  'en-US': { ui:{ brand:'5xLiving · Soul Sanctuary', label_lang:'Language', page_title:'Tarot Reading', q_ph:'Type your question (focuses the reading)', s1:'Single', s3:'Three (Past / Present / Future)', s5:'Cross (5)', s10:'Celtic Cross (10)', draw_btn:'Draw', tip_focus:'(Tip: a clear question focuses the reading)', reading_title:'Insights & Advice', disclaimer:'Tarot offers guidance, not medical/legal/financial advice. Use your judgment.', you:'You', reading:'Reading', no_q:'(No question)' },
    pos:{single:'Core Now', past:'Past', present:'Present', future:'Future', top:'Theme/Guidance', left:'Roots', center:'Core Now', right:'External', bottom:'Development', p1:'Present', p2:'Obstacle', p3:'Subconscious', p4:'Past', p5:'Conscious', p6:'Future', p7:'Self', p8:'Environment', p9:'Hopes/Fears', p10:'Outcome'},
    suits:{ wands:{name:'Wands',domain:'Action/Passion'}, cups:{name:'Cups',domain:'Emotion/Relations'}, swords:{name:'Swords',domain:'Mind/Communication'}, pentacles:{name:'Pentacles',domain:'Material/Resources'} },
    ranks:{ ace:'Ace','2':'Two','3':'Three','4':'Four','5':'Five','6':'Six','7':'Seven','8':'Eight','9':'Nine','10':'Ten', page:'Page', knight:'Knight', queen:'Queen', king:'King', tone:{ ace:'Seed/Potential','2':'Duality/Choice','3':'Collab/Growth','4':'Structure/Stability','5':'Challenge/Flux','6':'Exchange/Support','7':'Evaluate/Patience','8':'Momentum/Efficiency','9':'Result/Burden','10':'Completion', page:'Message/Learning', knight:'Action/Drive', queen:'Maturity/Nurture', king:'Authority/Setting Tone'} },
    majors:[ ['The Fool','Freedom/Leap','Embrace the unknown; travel light'],['The Magician','Will/Manifest','Align resources; act now'],['The High Priestess','Intuition/Subconscious','Observe first, speak later'],['The Empress','Nurture/Abundance','Gentle care grows results'],['The Emperor','Order/Structure','Set rules and safety'],['The Hierophant','Norms/Tradition','Follow guidance and standards'],['The Lovers','Choice/Union','Align values before commitment'],['The Chariot','Push/Win','Pick a target; drive forward'],['Strength','Courage/Gentleness','Soft power, steady patience'],['The Hermit','Introspect/Alone','Withdraw to assess'],['Wheel of Fortune','Cycle/Timing','Ride the turn; seize timing'],['Justice','Measure/Fairness','Facts and boundaries solve it'],['The Hanged Man','Pause/Reframe','Wait; see from another angle'],['Death','Ending/Rebirth','Cut losses; welcome renewal'],['Temperance','Blend/Rhythm','Lower intensity; steady cadence'],['The Devil','Attachment/Temptation','Name the bind; break the loop'],['The Tower','Shock/Collapse','Accept change; rebuild swiftly'],['The Star','Hope/Recovery','Restore trust; heal gently'],['The Moon','Fog/Anxiety','Delay big moves; verify facts'],['The Sun','Clarity/Joy','Be open; celebrate wins'],['Judgement','Awakening/Call','Answer the call; correct course'],['The World','Completion/Integration','Close the loop; level up'] ], tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>Next 48h:</b> (1) Write one small goal; (2) Schedule one concrete action; (3) Track 3 metrics.', domainAdvice:{ general:{majorRev:'Stabilize before deciding', majorOk:'Validate in small steps', wands:'Slow down; single-task', cups:'Prioritize relationship quality', swords:'Align information first', pentacles:'Resource a concrete plan first'} } },

  'th-TH': { ui:{ brand:'5xLiving · Soul Sanctuary', label_lang:'ภาษา', page_title:'ไพ่ทาโรต์', q_ph:'พิมพ์คำถามของคุณ (ช่วยโฟกัสคำทำนาย)', s1:'ใบเดียว', s3:'สามใบ (อดีต / ปัจจุบัน / อนาคต)', s5:'กางเขน (5 ใบ)', s10:'Celtic Cross (10)', draw_btn:'สุ่มไพ่', tip_focus:'(เคล็ดลับ: คำถามชัด โฟกัสดี)', reading_title:'คำแปลและคำแนะนำ', disclaimer:'ทาโรต์ให้คำแนะนำ ไม่ใช่คำปรึกษาทางแพทย์/กฎหมาย/การเงิน โปรดใช้วิจารณญาณ', you:'คุณ', reading:'คำอ่าน', no_q:'(ไม่มีคำถาม)' }, pos:null, suits:null, ranks:null, majors:null, tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>ภายใน 48 ชม.:</b> ตั้ง 1 เป้าหมายเล็ก ๆ วาง 1 การกระทำ และติดตาม 3 ตัวชี้วัด', domainAdvice:{ general:{majorRev:'ประคองให้มั่นคงก่อนตัดสินใจ', majorOk:'ค่อย ๆ ทดลองเป็นขั้นตอน'} } },

  'ms-MY': { ui:{ brand:'5xLiving · Soul Sanctuary', label_lang:'Bahasa', page_title:'Bacaan Tarot', q_ph:'Taip soalan anda (memfokuskan bacaan)', s1:'Satu', s3:'Tiga (Lalu / Kini / Hadapan)', s5:'Salib (5)', s10:'Celtic Cross (10)', draw_btn:'Tarik', tip_focus:'(Tip: soalan jelas, bacaan lebih fokus)', reading_title:'Wawasan & Nasihat', disclaimer:'Tarot ialah panduan, bukan nasihat perubatan/undang-undang/kewangan. Guna pertimbangan sendiri.', you:'Anda', reading:'Bacaan', no_q:'(Tiada soalan)' }, pos:null, suits:null, ranks:null, majors:null, tags:{upright:'Upright', reversed:'Reversed'}, nextSteps:'<b>48j akan datang:</b> Tetapkan 1 matlamat kecil, jadualkan 1 tindakan, jejak 3 metrik.', domainAdvice:{ general:{majorRev:'Stabilkan dahulu sebelum buat keputusan', majorOk:'Sahkan langkah kecil dahulu'} } }
};

// 若某语言未完整定义 pos/suits/ranks/majors，则回退到英文
function withFallback(lang){
  const base = JSON.parse(JSON.stringify(I18N[lang]));
  const en = I18N['en-US'];
  ['pos','suits','ranks','majors','tags','domainAdvice'].forEach(k=>{ if(base[k]==null) base[k]=en[k]; });
  return base;
}

/* 小工具 */
const $ = s => document.querySelector(s); const $$ = s => Array.from(document.querySelectorAll(s)); const rnd = n => Math.floor(Math.random()*n);
const FALLBACK = 'zh-CN';
function detectLang(){ const nav=(navigator.language||'').toLowerCase(); if(nav.startsWith('zh-tw')) return 'zh-TW'; if(nav.startsWith('zh')) return 'zh-CN'; if(nav.startsWith('th')) return 'th-TH'; if(nav.startsWith('ms')) return 'ms-MY'; if(nav.startsWith('en')) return 'en-US'; return FALLBACK; }
let CUR = detectLang();
const langSel = document.getElementById('langSel'); langSel.value = CUR;

function t(path, dflt=''){ const parts = path.split('.'); let node = withFallback(CUR); for(const p of parts){ if(!node) break; node=node[p]; } return node==null ? dflt : node; }

function applyStaticUI(){
  document.querySelector('.title').innerHTML = `<a href="#">${t('ui.brand','5xLiving')}</a>`;
  document.querySelector('.lang label').textContent = t('ui.label_lang','语言');
  document.querySelector('[data-i18n="page_title"]').textContent = t('ui.page_title');
  document.getElementById('go').textContent = t('ui.draw_btn');
  const spread = document.getElementById('spread');
  spread.options[0].textContent = t('ui.s1');
  spread.options[1].textContent = t('ui.s3');
  spread.options[2].textContent = t('ui.s5');
  spread.options[3].textContent = t('ui.s10');
  document.getElementById('question').setAttribute('placeholder', t('ui.q_ph'));
  const disclaimer = document.querySelector('[data-i18n="disclaimer"]'); if(disclaimer) disclaimer.textContent = t('ui.disclaimer');
}

/* 牌库 */
const SUITS = ['wands','cups','swords','pentacles'];
const RANKS = ['ace','2','3','4','5','6','7','8','9','10','page','knight','queen','king'];
const MAJORS = Array.from({length:22},(_,i)=>i);
let IMG_BASE = '/img/tarot';
function buildDeck(){ const deck=[]; MAJORS.forEach(i=> deck.push({id:`major_${String(i).padStart(2,'0')}`, group:'major', idx:i})); SUITS.forEach(s=> RANKS.forEach(r=> deck.push({id:`${s}_${r}`, group:'minor', suit:s, rank:r}))); return deck; }
const DECK = buildDeck();
function draw(n){ const pool=[...DECK], picks=[]; for(let i=0;i<n;i++){ const idx=rnd(pool.length); const card=pool.splice(idx,1)[0]; card.reversed=Math.random()<0.5; picks.push(card);} return picks; }
function imgFor(card){ return `${IMG_BASE}/${card.id}.webp`; }

/* 文案辅助 */
function dataPack(){ return withFallback(CUR); }
function cardName(card){ const pack=dataPack(); if(card.group==='major'){ return pack.majors[card.idx][0]; } const s=pack.suits[card.suit]; const r=pack.ranks[card.rank] || card.rank.toUpperCase(); return `${s.name}${r}`; }
function previewLine(card){ const pack=dataPack(); if(card.group==='major'){ const row=pack.majors[card.idx]; return `${row[1]} · ${row[2]}`; } const s=pack.suits[card.suit]; const tone=pack.ranks.tone[card.rank]; return `${s.name}（${s.domain}）· ${tone}`; }
function posLabel(key){ const pack=dataPack(); return pack.pos[key] || key; }
function tagFor(rev){ const pack=dataPack(); return rev ? pack.tags.reversed : pack.tags.upright; }

/* 渲染 */
function cardNode(card, cls, posKey){ const div=document.createElement('div'); div.className=`card ${cls||''}`; div.setAttribute('data-card-id', card.id); div.setAttribute('data-reversed', card.reversed?'true':'false'); const wrap=document.createElement('div'); wrap.className='imgwrap'; if(card.reversed) wrap.style.transform='rotate(180deg)'; const img=document.createElement('img'); img.className='card-img'; img.src=imgFor(card); img.alt=cardName(card); img.onerror=()=>{img.onerror=null; img.src=`${IMG_BASE}/back.webp`;}; wrap.appendChild(img); const cap=document.createElement('div'); cap.className='cap'; cap.textContent = `【${posLabel(posKey)}】${cardName(card)}（${tagFor(card.reversed)}）`; const mean=document.createElement('div'); mean.className='mean'; mean.textContent = previewLine(card); div.appendChild(wrap); div.appendChild(cap); div.appendChild(mean); return div; }

const SPREADS={1:{layout:'spread-1',positions:[{key:'single'}]},3:{layout:'spread-3',positions:[{key:'past'},{key:'present'},{key:'future'}]},5:{layout:'spread-5',positions:[{key:'top',cls:'pos-top'},{key:'left',cls:'pos-left'},{key:'center',cls:'pos-center'},{key:'right',cls:'pos-right'},{key:'bottom',cls:'pos-bottom'}]},10:{layout:'spread-10',positions:[{key:'p1'},{key:'p2'},{key:'p3'},{key:'p4'},{key:'p5'},{key:'p6'},{key:'p7'},{key:'p8'},{key:'p9'},{key:'p10'}]}};

function renderBoard(n,cards){ const board=document.getElementById('board'); board.className='board'; const conf=SPREADS[n]; if(!conf){ board.innerHTML=''; return;} board.classList.add(conf.layout); if(n===10){ board.innerHTML='<div class="row row-1"></div><div class="row row-2"></div><div class="row row-3"></div>'; const rows=$$('#board .row'); const slots=[3,3,4]; let k=0; slots.forEach((count,rowi)=>{ for(let j=0;j<count;j++){ const c=cards[k++]; const posKey=conf.positions[k-1].key; rows[rowi].appendChild(cardNode(c,`c${k}`,posKey)); } }); } else { board.innerHTML=''; cards.forEach((c,i)=>{ const pos=conf.positions[i]; board.appendChild(cardNode(c,`c${i+1} ${pos.cls||''}`,pos.key)); }); } }

function renderReading(question,n,cards){ const pack=dataPack(); const posKeys=(n===10)?['p1','p2','p3','p4','p5','p6','p7','p8','p9','p10']:(n===5)?['top','left','center','right','bottom']:(n===3)?['past','present','future']:['single']; const domAdv=pack.domainAdvice.general; const seg=cards.map((card,i)=>{ const title=`【${posLabel(posKeys[i])}】${cardName(card)}（${tagFor(card.reversed)}）`; const arch=previewLine(card); return `<div style="margin:8px 0 12px"><div style="font-weight:700">${title}</div><div class="muted" style="margin:4px 0">${arch}</div><ul style="margin:6px 0 0 18px"><li>${card.group==='major'? (card.reversed?domAdv.majorRev:domAdv.majorOk) : (domAdv[card.suit]||domAdv.majorOk)}</li></ul></div>`; }).join(''); const you=pack.ui.you||'You'; const read=pack.ui.reading||'Reading'; return `<div class="chat"><div class="msg user"><div class="meta">${you}</div>${escapeHTML(question||'')}</div><div class="msg assistant"><div class="meta">${read}</div>${seg}<hr style="border:0;border-top:1px solid #273245;margin:12px 0">${pack.nextSteps||''}</div></div>`; }

function escapeHTML(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));}

/* 事件绑定 */
const goBtn=$('#go'); const spreadSel=$('#spread'); const qInput=$('#question'); const qDisplay=$('#qdisplay'); const readingPanel=$('#reading'); const readingText=$('#readingText');
qInput.addEventListener('input', ()=>{ qDisplay.textContent = qInput.value ? ((['en-US','th-TH','ms-MY'].includes(CUR)?'Question: ':'问题：') + qInput.value) : t('ui.tip_focus'); });
goBtn.addEventListener('click', ()=>{ const n=parseInt(spreadSel.value,10); const picks=draw(n); window.__LAST_PICKS=picks; renderBoard(n,picks); const q=qInput.value||t('ui.no_q'); const html=renderReading(q,n,picks); readingText.innerHTML=html; readingPanel.style.display='block'; });

function refreshAll(){ applyStaticUI(); const picks=window.__LAST_PICKS||null; if(picks){ const n=parseInt(spreadSel.value,10); renderBoard(n,picks); const q=qInput.value||''; readingText.innerHTML=renderReading(q,n,picks); readingPanel.style.display='block'; } }
langSel.addEventListener('change', ()=>{ CUR = langSel.value in I18N ? langSel.value : FALLBACK; refreshAll(); });
refreshAll();

/* —— GPT / 心怜管家 —— */
const chatFab=$('#chatFab'), chatPanel=$('#chatPanel'), chatClose=$('#chatClose'), chatInput=$('#chatInput'), chatSend=$('#chatSend'), chatBody=$('#chatBody');
chatFab.addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','false'));
chatClose.addEventListener('click', ()=> chatPanel.setAttribute('aria-hidden','true'));
function addMsg(who,text){ const div=document.createElement('div'); div.className='ss-msg' + (who==='You'?' me':''); div.innerHTML=`<div class="meta">${who}</div>` + escapeHTML(text); chatBody.appendChild(div); chatBody.scrollTop = chatBody.scrollHeight; }
function sendGPT(text){ /* TODO: 接入你的后端（OpenAI / Cloudflare Worker / 自建 API） */ setTimeout(()=> addMsg('GPT','（示例）收到：'+text), 120); }
chatSend.addEventListener('click', ()=>{ const v=(chatInput.value||'').trim(); if(!v) return; chatInput.value=''; addMsg('You',v); sendGPT(v); });
chatInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); chatSend.click(); } });

/* —— 登录弹窗 —— */
const loginBtn=$('#loginBtn'); const authMask=$('#authMask'); const authCancel=$('#authCancel'); const authSubmit=$('#authSubmit'); const authErr=$('#authErr');
loginBtn.addEventListener('click', ()=> authMask.setAttribute('aria-hidden','false'));
authCancel.addEventListener('click', ()=> authMask.setAttribute('aria-hidden','true'));
authSubmit.addEventListener('click', ()=>{ const email=$('#authEmail').value.trim(); const pwd=$('#authPwd').value; if(!email||!pwd){ authErr.textContent='请输入邮箱与密码 / Please enter email & password.'; authErr.style.display='block'; return; } authErr.style.display='none'; // TODO: 接后端登录
  setTimeout(()=>{ authMask.setAttribute('aria-hidden','true'); alert('Demo: 登录成功'); }, 200);
});
</script>
</body>
</html>
